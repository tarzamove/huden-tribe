<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HUDEN TRIBE">
    <title>TRIBE v48 â€“ HUDEN Movement</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    
    <style>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           HUDEN TRIBE v48 - MOBILE APP OPTIMIZED
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           Design Principles:
           - Nike Run Club App UI patterns (brutal typography, generous space)
           - Photography + Typography + Space (HUDEN Brand Manual)
           - Mobile-first responsive design (48px touch targets)
           - Black, White, Gray only (NO chocolate orange)
           - Progressive Web App ready (PWA manifest, iOS support)
           - Performance optimized (lazy loading, reduced motion support)
           - Accessibility compliant (WCAG 2.1 AA, keyboard navigation)
           
           FASE 1: Touch targets 48px, viewport optimizado, PWA bÃ¡sico
           FASE 2: Smooth scrolling iOS, spacing Nike (20-24px), containers max-width
           FASE 3: Z-index system, prefers-reduced-motion, performance
           FASE 4: Typography brutal, final polish
        */

        :root {
            /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
               COLOR SYSTEM - HUDEN Brand Manual Compliant
               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
            --black: #000000;
            --white: #FFFFFF;
            --gray-50: #FAFAFA;
            --gray-100: #F5F5F5;
            --gray-200: #E5E5E5;
            --gray-300: #D4D4D4;
            --gray-400: #A3A3A3;
            --gray-500: #737373;
            --gray-600: #525252;
            --gray-700: #404040;
            --gray-800: #262626;
            --gray-900: #171717;
            
            /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
               SPACING SYSTEM - 8px Grid
               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
            --space-1: 8px;
            --space-2: 16px;
            --space-3: 24px;
            --space-4: 32px;
            --space-5: 40px;
            --space-6: 48px;
            --space-7: 56px;
            --space-8: 64px;
            --space-10: 80px;
            --space-12: 96px;
            --space-14: 112px;
            --space-16: 128px;
            
            /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
               TYPOGRAPHY - System Fonts (SF Pro Display / Helvetica Neue)
               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
            --font-system: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', Arial, sans-serif;
            
            /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
               TRANSITIONS - Nike-style smooth animations
               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
            --transition-fast: 0.15s ease;
            --transition-base: 0.2s ease;
            --transition-slow: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
               SHADOWS - Subtle depth (Nike style)
               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.04), 0 1px 4px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 2px 4px rgba(0, 0, 0, 0.06), 0 4px 12px rgba(0, 0, 0, 0.04);
            --shadow-lg: 0 4px 6px rgba(0, 0, 0, 0.07), 0 8px 16px rgba(0, 0, 0, 0.06);
            --shadow-xl: 0 8px 16px rgba(0, 0, 0, 0.08), 0 16px 32px rgba(0, 0, 0, 0.06);
            
            /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
               BORDERS & RADIUS
               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
            --radius-pill: 500px;
            
            /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
               Z-INDEX SYSTEM - Escalable y organizado
               Level 10: Navigation, Level 20: Dropdowns, Level 30: Modals
               Level 40: Notifications, Level 50: Debug
               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
            --z-navigation: 10;
            --z-dropdown: 20;
            --z-modal: 30;
            --z-overlay: 35;
            --z-notification: 40;
            --z-debug: 50;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RESET & BASE STYLES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body {
            font-family: var(--font-system);
            background: var(--white);
            color: var(--black);
            line-height: 1.5;
            overflow-x: hidden;
            padding-bottom: 72px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }

        /* Main app container con max-width para desktop */
        #app {
            max-width: 1440px;
            margin: 0 auto;
            position: relative;
        }

        /* Page wrapper con padding Nike-style */
        .page-wrapper {
            padding: 32px 20px; /* Nike mobile: 32px vertical, 20px horizontal */
        }

        @media (min-width: 768px) {
            .page-wrapper {
                padding: 64px 32px; /* Nike desktop: 64px vertical, 32px horizontal */
            }
        }

        @media (min-width: 768px) {
            body {
                padding-bottom: 72px;
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           TYPOGRAPHY SCALE - Nike Brutal Style
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .hero-title {
            font-size: clamp(56px, 13vw, 96px);
            font-weight: 900;
            letter-spacing: -0.04em; /* MÃ¡s aggressive */
            line-height: 0.85; /* MÃ¡s tight */
            text-transform: uppercase;
            margin: 0;
        }

        .section-title {
            font-size: clamp(28px, 4vw, 48px);
            font-weight: 900;
            letter-spacing: -0.04em; /* MÃ¡s aggressive */
            line-height: 0.95; /* MÃ¡s tight */
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: -0.02em; /* MÃ¡s tight */
            line-height: 1.1; /* MÃ¡s compact */
        }

        .body-text {
            font-size: 15px;
            font-weight: 400;
            line-height: 1.6;
        }

        .small-text {
            font-size: 13px;
            font-weight: 500;
            line-height: 1.4;
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ROLE SELECTOR - TESTING TOOL (Ctrl+R)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           Nike-style brutal minimal design for tier switching during development
        */
        
        .role-selector-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: var(--z-debug);
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity var(--transition-base);
        }

        .role-selector-overlay.active {
            display: flex;
            opacity: 1;
        }

        .role-selector-panel {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            max-width: 400px;
            width: 90%;
            box-shadow: var(--shadow-xl);
            transform: scale(0.95);
            transition: transform var(--transition-base);
        }

        .role-selector-overlay.active .role-selector-panel {
            transform: scale(1);
        }

        .role-selector-header {
            margin-bottom: var(--space-3);
            padding-bottom: var(--space-2);
            border-bottom: 1px solid var(--gray-200);
        }

        .role-selector-title {
            font-size: 20px;
            font-weight: 800;
            letter-spacing: -0.01em;
            color: var(--black);
            margin-bottom: var(--space-1);
        }

        .role-selector-subtitle {
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-600);
        }

        .role-selector-current {
            background: var(--gray-100);
            padding: var(--space-2);
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-3);
        }

        .role-selector-current-label {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--gray-600);
            margin-bottom: 4px;
        }

        .role-selector-current-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--black);
            text-transform: uppercase;
        }

        .role-selector-buttons {
            display: flex;
            flex-direction: column;
            gap: var(--space-1);
        }

        .role-selector-button {
            background: var(--white);
            border: 2px solid var(--gray-300);
            color: var(--black);
            padding: 10px 20px; /* Ajustado para 40px altura */
            border-radius: 20px; /* Pill completo */
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.02em;
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 40px; /* Altura uniforme */
        }

        .role-selector-button:hover {
            background: var(--gray-100);
            border-color: var(--black);
            transform: translateX(4px);
        }

        .role-selector-button.active {
            background: var(--black);
            color: var(--white);
            border-color: var(--black);
        }

        .role-selector-button.active:hover {
            background: var(--gray-800);
        }

        .role-selector-button-tier {
            font-weight: 700;
        }

        .role-selector-button-desc {
            font-size: 12px;
            font-weight: 500;
            color: var(--gray-600);
            text-transform: none;
            letter-spacing: 0;
        }

        .role-selector-button.active .role-selector-button-desc {
            color: var(--gray-400);
        }

        .role-selector-footer {
            margin-top: var(--space-3);
            padding-top: var(--space-2);
            border-top: 1px solid var(--gray-200);
            text-align: center;
        }

        .role-selector-hint {
            font-size: 12px;
            font-weight: 500;
            color: var(--gray-600);
        }

        .role-selector-hint strong {
            color: var(--black);
            font-weight: 700;
        }

        /* Mobile optimization */
        @media (max-width: 768px) {
            .role-selector-panel {
                max-width: 90%;
            }

            .role-selector-button {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           VIDEO CALLS - REMOTE SESSION INTERFACE (v31)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        .video-call-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--black);
            display: none;
            z-index: 9999;
            flex-direction: column;
        }

        .video-call-container.active {
            display: flex;
        }

        .video-grid {
            flex: 1;
            display: grid;
            gap: var(--space-2);
            padding: var(--space-2);
            overflow: hidden;
        }

        .video-grid.single {
            grid-template-columns: 1fr;
        }

        .video-grid.dual {
            grid-template-columns: 1fr;
        }

        @media (min-width: 768px) {
            .video-grid.dual {
                grid-template-columns: 1fr 1fr;
            }
        }

        .video-participant {
            position: relative;
            background: var(--gray-900);
            border-radius: var(--radius-lg);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .video-participant video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .participant-info {
            position: absolute;
            bottom: var(--space-2);
            left: var(--space-2);
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            padding: var(--space-1) var(--space-2);
            border-radius: var(--radius-pill);
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .participant-name {
            color: var(--white);
            font-size: 14px;
            font-weight: 600;
        }

        .participant-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00FF00;
        }

        .participant-status.muted {
            background: var(--gray-500);
        }

        .video-controls {
            background: var(--black);
            padding: var(--space-3) var(--space-2);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: var(--space-2);
            border-top: 0.5px solid var(--gray-800);
        }

        @media (min-width: 768px) {
            .video-controls {
                padding: var(--space-4) var(--space-6);
                gap: var(--space-3);
            }
        }

        .video-control-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--gray-800);
            border: none;
            color: var(--white);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-base);
            font-size: 20px;
        }

        .video-control-btn:hover {
            background: var(--gray-700);
            transform: scale(1.05);
        }

        .video-control-btn:active {
            transform: scale(0.95);
        }

        .video-control-btn.danger {
            background: #E53E3E;
        }

        .video-control-btn.danger:hover {
            background: #C53030;
        }

        .video-control-btn.active {
            background: var(--white);
            color: var(--black);
        }

        .video-booking-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            z-index: var(--z-modal);
            align-items: center;
            justify-content: center;
            padding: var(--space-2);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .video-booking-modal.active {
            display: flex;
        }

        .video-booking-content {
            background: var(--white);
            border-radius: var(--radius-xl);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            position: relative;
        }

        .video-booking-header {
            padding: var(--space-5) var(--space-4) var(--space-4);
            border-bottom: 0.5px solid var(--gray-200);
            position: sticky;
            top: 0;
            background: var(--white);
            z-index: 1;
        }

        .video-booking-title {
            font-size: 32px;
            font-weight: 900;
            letter-spacing: -0.02em;
            margin-bottom: var(--space-1);
            text-transform: uppercase;
        }

        .video-booking-subtitle {
            font-size: 14px;
            color: var(--gray-600);
        }

        .video-booking-body {
            padding: var(--space-4);
        }

        .booking-form-group {
            margin-bottom: var(--space-4);
        }

        .booking-form-label {
            display: block;
            font-size: 14px;
            font-weight: 700;
            margin-bottom: var(--space-1);
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        .booking-form-input,
        .booking-form-select,
        .booking-form-textarea {
            width: 100%;
            padding: var(--space-2) var(--space-3);
            border: 1.5px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-family: var(--font-system);
            font-size: 16px;
            transition: all var(--transition-base);
        }

        .booking-form-input:focus,
        .booking-form-select:focus,
        .booking-form-textarea:focus {
            outline: none;
            border-color: var(--black);
        }

        .booking-form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .time-slots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: var(--space-2);
            margin-top: var(--space-2);
        }

        .time-slot-btn {
            padding: var(--space-2);
            background: var(--white);
            border: 1.5px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            text-align: center;
        }

        .time-slot-btn:hover {
            border-color: var(--black);
            transform: translateY(-2px);
        }

        .time-slot-btn.selected {
            background: var(--black);
            border-color: var(--black);
            color: var(--white);
        }

        .time-slot-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .time-slot-btn:disabled:hover {
            transform: none;
        }

        .booking-summary {
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-top: var(--space-4);
        }

        .booking-summary-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: var(--space-2);
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        .booking-summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-2) 0;
            border-bottom: 0.5px solid var(--gray-200);
        }

        .booking-summary-item:last-child {
            border-bottom: none;
        }

        .booking-summary-label {
            font-size: 14px;
            color: var(--gray-600);
        }

        .booking-summary-value {
            font-size: 14px;
            font-weight: 600;
        }

        .video-sessions-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .video-session-card {
            background: var(--white);
            border: 0.5px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            transition: all var(--transition-base);
        }

        .video-session-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
            border-color: var(--gray-400);
        }

        .video-session-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-3);
        }

        .video-session-client {
            flex: 1;
        }

        .video-session-client-name {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .video-session-client-tier {
            font-size: 13px;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .video-session-status {
            padding: 6px 12px;
            border-radius: var(--radius-pill);
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .video-session-status.upcoming {
            background: var(--gray-100);
            color: var(--black);
        }

        .video-session-status.live {
            background: var(--black);
            color: var(--white);
        }

        .video-session-status.completed {
            background: var(--gray-200);
            color: var(--gray-600);
        }

        .video-session-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: var(--space-3);
            padding: var(--space-3);
            background: var(--gray-50);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-3);
        }

        .video-session-detail {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .video-session-detail-label {
            font-size: 12px;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .video-session-detail-value {
            font-size: 15px;
            font-weight: 600;
        }

        .video-session-actions {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
        }

        .coach-video-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--black);
            color: var(--white);
            border-radius: var(--radius-pill);
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: var(--space-2);
        }

        .coach-video-badge::before {
            content: 'ğŸ“¹';
            font-size: 14px;
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MENTORSHIP REQUEST FLOW (v32)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* Request Mentorship Button in Coach Profile */
        .coach-actions {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-4);
            flex-wrap: wrap;
        }

        /* Mentorship Request Modal */
        .mentorship-request-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            z-index: var(--z-modal);
            align-items: center;
            justify-content: center;
            padding: var(--space-2);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .mentorship-request-modal.active {
            display: flex;
        }

        .mentorship-request-content {
            background: var(--white);
            border-radius: var(--radius-xl);
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            position: relative;
        }

        .mentorship-request-header {
            padding: var(--space-6) var(--space-5) var(--space-4);
            border-bottom: 0.5px solid var(--gray-200);
            position: sticky;
            top: 0;
            background: var(--white);
            z-index: 1;
        }

        .mentorship-request-title {
            font-size: 32px;
            font-weight: 900;
            letter-spacing: -0.02em;
            margin-bottom: var(--space-1);
            text-transform: uppercase;
        }

        .mentorship-request-subtitle {
            font-size: 14px;
            color: var(--gray-600);
            line-height: 1.5;
        }

        .mentorship-request-body {
            padding: var(--space-5);
        }

        /* Coach Info Card in Request */
        .request-coach-card {
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-5);
            display: flex;
            gap: var(--space-3);
            align-items: center;
        }

        .request-coach-avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
        }

        .request-coach-info {
            flex: 1;
        }

        .request-coach-name {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .request-coach-details {
            font-size: 13px;
            color: var(--gray-600);
        }

        /* Form Sections */
        .request-section {
            margin-bottom: var(--space-5);
        }

        .request-section-title {
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.02em;
            margin-bottom: var(--space-3);
        }

        .request-section-description {
            font-size: 14px;
            color: var(--gray-600);
            line-height: 1.6;
            margin-bottom: var(--space-3);
        }

        /* Form Groups */
        .request-form-group {
            margin-bottom: var(--space-4);
        }

        .request-form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: var(--space-1);
        }

        .request-form-hint {
            font-size: 13px;
            color: var(--gray-500);
            margin-bottom: var(--space-2);
        }

        .request-form-input,
        .request-form-textarea,
        .request-form-select {
            width: 100%;
            padding: var(--space-2) var(--space-3);
            border: 1.5px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-family: var(--font-system);
            font-size: 16px;
            transition: all var(--transition-base);
        }

        .request-form-input:focus,
        .request-form-textarea:focus,
        .request-form-select:focus {
            outline: none;
            border-color: var(--black);
        }

        .request-form-textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.6;
        }

        /* Checkbox Groups */
        .request-checkbox-group {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .request-checkbox-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-2);
            padding: var(--space-2);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: background var(--transition-fast);
        }

        .request-checkbox-item:hover {
            background: var(--gray-50);
        }

        .request-checkbox-item input[type="checkbox"] {
            margin-top: 2px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .request-checkbox-label {
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            flex: 1;
        }

        /* Commitment Agreement */
        .commitment-box {
            background: var(--gray-900);
            color: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-top: var(--space-4);
        }

        .commitment-box-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: var(--space-2);
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        .commitment-box-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .commitment-box-list li {
            font-size: 14px;
            padding: var(--space-1) 0;
            padding-left: var(--space-3);
            position: relative;
            line-height: 1.5;
        }

        .commitment-box-list li::before {
            content: 'â€¢';
            position: absolute;
            left: 0;
            font-weight: 700;
        }

        /* Investment Summary */
        .investment-summary {
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-top: var(--space-4);
        }

        .investment-summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-2) 0;
            font-size: 14px;
        }

        .investment-summary-row:not(:last-child) {
            border-bottom: 0.5px solid var(--gray-200);
        }

        .investment-summary-label {
            color: var(--gray-600);
        }

        .investment-summary-value {
            font-weight: 600;
        }

        .investment-total {
            font-size: 20px;
            font-weight: 700;
            padding-top: var(--space-2);
        }

        /* Actions */
        .request-actions {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-5);
            padding-top: var(--space-4);
            border-top: 0.5px solid var(--gray-200);
        }

        /* Active Mentorships List */
        .active-mentorships {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .mentorship-card {
            background: var(--white);
            border: 0.5px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            transition: all var(--transition-base);
        }

        .mentorship-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--gray-400);
        }

        .mentorship-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-3);
        }

        .mentorship-participant {
            display: flex;
            gap: var(--space-2);
            align-items: center;
        }

        .mentorship-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
        }

        .mentorship-participant-info h4 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .mentorship-participant-role {
            font-size: 12px;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .mentorship-status {
            padding: 6px 12px;
            border-radius: var(--radius-pill);
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .mentorship-status.active {
            background: var(--black);
            color: var(--white);
        }

        .mentorship-status.pending {
            background: var(--gray-200);
            color: var(--gray-700);
        }

        .mentorship-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: var(--space-3);
            padding: var(--space-3);
            background: var(--gray-50);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-3);
        }

        .mentorship-meta-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .mentorship-meta-label {
            font-size: 12px;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .mentorship-meta-value {
            font-size: 14px;
            font-weight: 600;
        }

        .mentorship-actions {
            display: flex;
            gap: var(--space-2);
            flex-wrap: wrap;
        }

        /* External Video Link Button */
        .video-link-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
        }

        .video-link-btn::before {
            content: 'ğŸ”—';
            font-size: 16px;
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           WISDOM LIBRARY - THRESHOLD MODAL & SACRED SPACE STYLING
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        

        /* Post Type Badges */
        .post-type-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-radius: var(--radius-pill);
            margin-bottom: var(--space-2);
        }

        .post-type-teaching {
            background: var(--gray-800);
            color: var(--white);
        }

        .post-type-inquiry {
            background: var(--gray-700);
            color: var(--white);
        }

        .post-type-reflection {
            background: var(--gray-600);
            color: var(--white);
        }

        /* Teaching Post Special Styling */
        .post-card.teaching-post {
            border: 1px solid var(--gray-600);
        }

        .post-card.teaching-post .post-header {
            background: var(--gray-800);
        }

        /* Mentor Badge */
        .mentor-badge {
            display: inline-block;
            padding: 4px 10px;
            background: var(--white);
            color: var(--black);
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-radius: var(--radius-pill);
            margin-left: 8px;
        }

        /* Cross-link to Feed */
        .post-origin {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: var(--space-2);
            background: var(--gray-800);
            border-radius: var(--radius-sm);
            font-size: 13px;
            color: var(--gray-400);
            margin-bottom: var(--space-2);
        }

        .post-origin a {
            color: var(--white);
            text-decoration: none;
            font-weight: 600;
        }

        .post-origin a:hover {
            text-decoration: underline;
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           HERO SECTION
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .hero-section {
            position: relative;
            height: 60vh;
            min-height: 500px;
            max-height: 800px;
            margin-top: 0;
            overflow: hidden;
            z-index: 1;
            transition: opacity 0.3s ease;
        }

        .hero-section.hidden {
            display: none;
        }

        .hero-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.65);
        }

        /* Hero Carousel */
        .hero-carousel {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .hero-slide {
            opacity: 0;
            transition: opacity 0.8s ease;
            pointer-events: none;
        }

        .hero-slide.active {
            opacity: 1;
            pointer-events: all;
        }

        /* Carousel Dots - Nike Style */
        .hero-carousel-dots {
            position: absolute;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 10;
        }

        .hero-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 0;
        }

        .hero-dot.active {
            background: var(--white);
            width: 24px;
            border-radius: 4px;
        }

        .hero-dot:hover {
            background: rgba(255, 255, 255, 0.8);
        }

        /* Hero Pause Button - Bottom Right (Ultra minimal) */
        .hero-pause-btn {
            position: absolute;
            bottom: 24px;
            right: 24px;
            width: 28px; /* Ultra pequeÃ±o */
            height: 28px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.85);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 11;
        }

        .hero-pause-btn:hover {
            background: var(--white);
            transform: scale(1.15);
        }

        .hero-pause-btn:active {
            transform: scale(0.9);
        }

        .hero-pause-btn svg {
            width: 14px; /* Icono ultra pequeÃ±o */
            height: 14px;
            stroke: var(--black);
        }

        .hero-content {
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-end;
            text-align: left;
            color: var(--white);
            padding: 0 24px 48px 24px;
            z-index: 2;
        }

        /* Hero centrado - para Home */
        .hero-content-centered {
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 24px;
        }

        .hero-content-centered .hero-title {
            font-size: clamp(64px, 15vw, 120px); /* Nike brutal size - MASIVO */
            font-weight: 900;
            letter-spacing: -0.04em;
            line-height: 0.85;
            margin-bottom: 24px;
            text-transform: uppercase;
        }

        .hero-content-centered .hero-subtitle {
            font-size: 18px;
            font-weight: 400;
            margin-bottom: 40px;
            text-transform: none;
            letter-spacing: 0.01em;
            opacity: 0.95;
            max-width: 400px;
        }

        .hero-subtitle {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            opacity: 0.9;
        }

        /* Hero CTA Button - Nike exact measurements */
        .hero-cta {
            background: var(--white);
            color: var(--black);
            border: none;
            border-radius: 20px; /* Nike exact pill radius */
            padding: 8px 24px; /* Nike exact: 8px vertical, 24px horizontal */
            font-size: 15px;
            font-weight: 500; /* Nike: medium, not semibold */
            font-family: var(--font-system);
            cursor: pointer;
            transition: all 0.2s ease;
            letter-spacing: 0;
            box-shadow: none;
            height: 40px; /* Nike exact total height */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .hero-cta:hover {
            transform: scale(1.05);
        }

        .hero-cta:active {
            transform: scale(0.98);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           HOME POSTS GRID - Nike.com Style (Edge-to-edge)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           NIKE HORIZONTAL CAROUSEL - Pixel-Perfect Clone
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .nike-carousel-section {
            padding: 64px 0 48px 0;
            background: var(--white);
        }

        @media (max-width: 767px) {
            .nike-carousel-section {
                padding: 48px 0 32px 0;
            }
        }

        .nike-carousel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 48px;
            margin-bottom: 32px;
        }

        @media (max-width: 767px) {
            .nike-carousel-header {
                padding: 0 24px;
                margin-bottom: 24px;
            }
        }

        .nike-carousel-title {
            font-size: 28px;
            font-weight: 500;
            color: var(--black);
            letter-spacing: -0.01em;
            line-height: 1.2;
        }

        @media (max-width: 767px) {
            .nike-carousel-title {
                font-size: 22px;
            }
        }

        .nike-carousel-nav {
            display: flex;
            gap: 8px;
        }

        @media (max-width: 767px) {
            .nike-carousel-nav {
                display: none;
            }
        }

        .nike-carousel-nav-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--gray-100);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .nike-carousel-nav-btn:hover {
            background: var(--gray-200);
        }

        .nike-carousel-nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .nike-carousel-nav-btn svg {
            width: 20px;
            height: 20px;
        }

        .nike-carousel-track-container {
            overflow: hidden;
            padding: 0 48px;
        }

        @media (max-width: 767px) {
            .nike-carousel-track-container {
                padding: 0 24px;
            }
        }

        .nike-carousel-track {
            display: flex;
            gap: 12px;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .nike-carousel-track::-webkit-scrollbar {
            display: none;
        }

        .nike-carousel-item {
            flex: 0 0 auto;
            width: calc(33.333% - 8px);
            scroll-snap-align: start;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        @media (max-width: 1200px) {
            .nike-carousel-item {
                width: calc(50% - 6px);
            }
        }

        @media (max-width: 767px) {
            .nike-carousel-item {
                width: calc(85% - 6px);
            }
        }

        .nike-carousel-item-image {
            width: 100%;
            aspect-ratio: 3 / 4;
            object-fit: cover;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nike-carousel-item:hover .nike-carousel-item-image {
            transform: scale(1.03);
        }

        .nike-carousel-item-label {
            position: absolute;
            bottom: 24px;
            left: 24px;
            background: var(--white);
            color: var(--black);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            transition: all 0.2s ease;
        }

        @media (max-width: 767px) {
            .nike-carousel-item-label {
                bottom: 16px;
                left: 16px;
                font-size: 13px;
                padding: 6px 14px;
            }
        }

        .nike-carousel-item:hover .nike-carousel-item-label {
            transform: scale(1.05);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           HOME POSTS GRID - NIKE CARD DESIGN (Pixel-Perfect Clone)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .home-posts-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin: 0;
            padding: 12px 12px 100px 12px;
        }

        @media (min-width: 768px) {
            .home-posts-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
                padding: 12px 12px 100px 12px;
            }
        }

        .home-post-card {
            position: relative;
            aspect-ratio: 1 / 1;
            overflow: hidden;
            cursor: pointer;
            background: var(--black);
            border-radius: 0; /* Nike: sin border radius */
        }

        .home-post-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .home-post-card:hover .home-post-image {
            transform: scale(1.03);
        }

        /* Nike Overlay - Gradient bottom left */
        .home-post-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-end;
            padding: 48px;
            background: linear-gradient(to top, rgba(0,0,0,0.5) 0%, rgba(0,0,0,0) 60%);
            z-index: 2;
        }

        @media (max-width: 767px) {
            .home-post-overlay {
                padding: 32px;
            }
        }

        /* Nike Label (small text above title) */
        .home-post-label {
            font-size: 16px;
            font-weight: 500;
            color: var(--white);
            letter-spacing: 0;
            line-height: 1.5;
            margin-bottom: 8px;
            text-align: left;
        }

        @media (max-width: 767px) {
            .home-post-label {
                font-size: 14px;
            }
        }

        /* Nike Title (large text) */
        .home-post-title {
            font-size: 40px;
            font-weight: 600;
            color: var(--white);
            text-align: left;
            letter-spacing: -0.01em;
            line-height: 1.2;
            margin-bottom: 24px;
            max-width: 90%;
        }

        @media (max-width: 767px) {
            .home-post-title {
                font-size: 28px;
                margin-bottom: 20px;
            }
        }

        /* Nike CTA Button */
        .home-post-cta {
            background: var(--white);
            color: var(--black);
            border: none;
            border-radius: 24px;
            padding: 0 32px;
            font-size: 15px;
            font-weight: 600;
            font-family: var(--font-system);
            cursor: pointer;
            transition: all 0.15s ease;
            height: 48px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
            touch-action: manipulation;
        }

        @media (max-width: 767px) {
            .home-post-cta {
                padding: 0 28px;
                font-size: 15px;
                height: 48px;
            }
        }

        .home-post-cta:hover {
            background: var(--gray-200);
        }

        .home-post-cta:active {
            transform: scale(0.97);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           DESKTOP TABS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .desktop-tabs {
            display: none !important;
        }

        @media (min-width: 768px) {
            .desktop-tabs {
                display: none !important;
            }
        }

        /* User Avatar en navegaciÃ³n - REMOVED */
        .nav-user-avatar {
            display: none !important;
        }

        .desktop-tab-button {
            display: none !important;
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           BOTTOM NAVIGATION - Nike Run Club Exact Style
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           Architecture:
           - Fixed bottom, edge-to-edge white bar
           - 1px top separator (#E5E5E5)
           - 3 tabs: Home, TRIBE, Training (Profile desde avatar flotante)
           - Icon + label vertical stack
           - Active: Black (#000), weight 600, stroke-width 2.5
           - Inactive: Gray (#8E8E93), weight 500, stroke-width 2
           - NO shadows, NO rounded corners, NO background color on active
           - Safe area iOS support
           - 44x44px minimum tap target (Apple HIG)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            border-top: 1px solid var(--gray-200);
            padding: 12px 0 calc(8px + env(safe-area-inset-bottom));
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 tabs: Home, TRIBE, Training */
            z-index: var(--z-navigation);
            /* Nike: NO box-shadow, NO border-radius */
        }

        @media (min-width: 768px) {
            .bottom-nav {
                display: grid;
                max-width: 768px; /* Expandido para mejor UX desktop */
                left: 50%;
                transform: translateX(-50%);
                border-radius: 24px 24px 0 0;
                box-shadow: 0 -2px 16px rgba(0, 0, 0, 0.08);
            }
        }

        .bottom-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 8px 4px;
            background: none;
            border: none;
            color: #8E8E93; /* Nike inactive gray - exact match */
            cursor: pointer;
            transition: color 0.2s ease;
            font-family: var(--font-system);
            min-height: 56px;
            min-width: 44px;
            -webkit-tap-highlight-color: transparent;
            position: relative;
        }

        .bottom-nav-item:active {
            opacity: 0.7;
            /* Nike: NO transform scale, only opacity */
        }

        .bottom-nav-item.active {
            color: var(--black);
            /* Nike: NO background change, only color */
        }

        .bottom-nav-icon {
            width: 24px;
            height: 24px;
            stroke: currentColor;
            stroke-width: 2;
            fill: none;
            transition: stroke-width 0.2s ease;
        }

        .bottom-nav-item.active .bottom-nav-icon {
            stroke-width: 2.5; /* Slightly thicker when active */
        }

        .bottom-nav-item span {
            font-size: 13px;
            font-weight: 500;
            letter-spacing: 0.01em;
            line-height: 1.2;
            /* Nike: NO text-transform uppercase */
        }

        .bottom-nav-item.active span {
            font-weight: 600; /* Semibold when active */
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           QUICK ACTIONS BUTTON - Floating (HIDDEN - v44)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .quick-actions-fab {
            display: none; /* Hidden in v44 */
            position: fixed;
            top: 20px;
            left: 20px;
            width: 48px;
            height: 48px;
            background: var(--black);
            border: none;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1001;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transition: all var(--transition-base);
        }

        .quick-actions-fab:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        }

        .quick-actions-fab:active {
            transform: scale(0.95);
        }

        .quick-actions-fab svg {
            width: 20px;
            height: 20px;
            stroke: var(--white);
        }

        .quick-actions-fab.hidden {
            display: none;
        }

        /* Quick Actions Dropdown */
        .quick-actions-dropdown {
            position: fixed;
            top: 76px;
            left: 20px;
            background: var(--white);
            border-radius: var(--radius-lg);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            padding: var(--space-2);
            min-width: 200px;
            opacity: 0;
            transform: translateY(-8px);
            pointer-events: none;
            transition: all var(--transition-base);
            z-index: var(--z-dropdown);
        }

        .quick-actions-dropdown.active {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }

        .quick-action-item {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-2);
            background: transparent;
            border: none;
            border-radius: var(--radius-md);
            width: 100%;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            color: var(--black);
            transition: background var(--transition-fast);
            text-align: left;
        }

        .quick-action-item:hover {
            background: var(--gray-100);
        }

        .quick-action-item svg {
            width: 20px;
            height: 20px;
            stroke: var(--black);
            flex-shrink: 0;
        }

        /* User Avatar - Floating (top-right) */
        .floating-user-avatar {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid var(--gray-200);
            transition: all var(--transition-fast);
            z-index: 1001;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }

        .floating-user-avatar:hover {
            border-color: var(--black);
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        }

        .floating-user-avatar.hidden {
            display: none;
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           TAB PANELS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .tab-panel {
            display: none;
            padding: var(--space-4);
            max-width: 1200px;
            margin: 0 auto;
        }

        .tab-panel.active {
            display: block;
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           BUTTONS - Nike Style
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .btn {
            padding: 0 32px; /* Nike standard horizontal padding */
            font-family: var(--font-system);
            font-size: 15px;
            font-weight: 600; /* Nike semibold */
            border: none;
            border-radius: 24px; /* Nike pill radius */
            cursor: pointer;
            transition: all var(--transition-base);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            height: 48px; /* Mobile-optimized touch target */
            line-height: 48px;
            letter-spacing: 0;
            white-space: nowrap;
            min-width: 48px; /* Minimum touch target */
        }

        .btn-primary {
            background: var(--black);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--gray-800);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--black);
            border: 1px solid var(--gray-300); /* Nike subtle border */
        }

        .btn-secondary:hover {
            background: var(--gray-50);
            border-color: var(--black);
            transform: translateY(-1px);
        }

        .btn-large {
            padding: 0 40px; /* MÃ¡s padding para variante large */
            font-size: 16px;
            height: 48px; /* Misma altura consistente */
            line-height: 48px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn:active {
            transform: translateY(0) !important;
        }

        /* Outline button variant */
        .btn-outline {
            background: transparent;
            color: var(--black);
            border: 1px solid var(--black);
        }

        .btn-outline:hover {
            background: var(--gray-50);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RESPONSIVE ENHANCEMENTS - Mobile, Tablet, Desktop
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        /* Avatar responsive sizes */
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            transition: transform var(--transition-fast);
        }

        @media (min-width: 768px) {
            .avatar {
                width: 48px;
                height: 48px;
            }
        }

        @media (min-width: 1024px) {
            .avatar {
                width: 56px;
                height: 56px;
            }
        }

        /* Grid adaptativo - Stack vertical en mobile, 2-column en desktop */
        .responsive-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px; /* Nike mobile - 20px mÃ­nimo entre cards */
        }

        @media (min-width: 768px) {
            .responsive-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 24px; /* Nike desktop - 24px */
            }
        }

        @media (min-width: 1024px) {
            .responsive-grid {
                gap: 32px; /* Mayor espacio en pantallas grandes */
            }
        }

        /* Card containers responsive */
        .feed-card, .post-card, .coach-card {
            transition: transform var(--transition-base), box-shadow var(--transition-base);
        }

        .feed-card:hover, .post-card:hover, .coach-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ANIMATIONS & TRANSITIONS - Nike-style smooth micro-interactions
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        /* Modal entrance animation */
        @keyframes modalEnter {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal.active .modal-content,
        .mentorship-request-modal.active .mentorship-request-content {
            animation: modalEnter 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Tab switching smooth transition */
        .tab-panel {
            animation: tabFadeIn 0.2s ease;
        }

        @keyframes tabFadeIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Skeleton loader for content loading */
        .skeleton {
            background: linear-gradient(
                90deg,
                var(--gray-200) 0%,
                var(--gray-100) 50%,
                var(--gray-200) 100%
            );
            background-size: 200% 100%;
            animation: skeletonLoading 1.5s ease-in-out infinite;
            border-radius: var(--radius-md);
        }

        @keyframes skeletonLoading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }

        .skeleton-text {
            height: 16px;
            margin-bottom: var(--space-2);
        }

        .skeleton-title {
            height: 24px;
            width: 60%;
            margin-bottom: var(--space-3);
        }

        .skeleton-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
        }

        .skeleton-image {
            width: 100%;
            height: 300px;
        }

        /* Button hover states with micro-interaction */
        .btn {
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            transform: translate(-50%, -50%);
            transition: width 0.4s ease, height 0.4s ease;
        }

        .btn:active::before {
            width: 300px;
            height: 300px;
        }

        /* Input focus states */
        input[type="text"],
        input[type="email"],
        input[type="password"],
        textarea,
        select {
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--black);
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
        }

        /* Card hover elevation */
        .coach-card,
        .pack-card,
        .event-card {
            transition: all var(--transition-base);
        }

        .coach-card:hover,
        .pack-card:hover,
        .event-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        /* Image hover zoom */
        .coach-card-image,
        .pack-image,
        .event-image {
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .coach-card:hover .coach-card-image,
        .pack-card:hover .pack-image,
        .event-card:hover .event-image {
            transform: scale(1.05);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ACTIVITY INDICATORS - Spinners & Loaders (Nike Style)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .spinner {
            display: inline-block;
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: var(--white);
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        .spinner-dark {
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-top-color: var(--black);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            z-index: 1000;
            border-radius: inherit;
        }

        .loading-text {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-600);
        }

        /* Button with spinner */
        .btn.loading {
            position: relative;
            color: transparent;
            pointer-events: none;
        }

        .btn.loading::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            top: 50%;
            left: 50%;
            margin-left: -9px;
            margin-top: -9px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: var(--white);
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        .btn-secondary.loading::after {
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-top-color: var(--black);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SECTION HEADERS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
            gap: var(--space-3);
        }

        .section-header-left {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            flex: 1;
        }

        .section-header-right {
            display: flex;
            align-items: center;
            gap: 12px; /* MÃ­nimo 12px entre elementos touch */
        }

        /* Responsive para mobile */
        @media (max-width: 768px) {
            .section-header {
                flex-direction: column;
                align-items: stretch;
                gap: var(--space-3);
            }

            .section-header-left {
                width: 100%;
            }

            .section-header-right {
                width: 100%;
                justify-content: stretch;
            }

            .section-header-right .btn {
                flex: 1;
            }

            .feed-search-wrapper {
                width: 100%;
                max-width: 100%;
            }
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           FEED STYLES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .feed-filters {
            display: flex;
            gap: var(--space-1);
            margin-bottom: var(--space-5);
            border: 1.5px solid var(--gray-300);
            border-radius: var(--radius-pill);
            padding: 6px;
            background: var(--gray-50);
            overflow-x: auto;
            scrollbar-width: none;
            width: fit-content;
            max-width: 100%;
        }

        .feed-filters::-webkit-scrollbar {
            display: none;
        }

        .feed-filter-btn {
            padding: 10px 24px; /* Ya correcto para 40px */
            background: transparent;
            border: none;
            font-size: 14px;
            font-weight: 700;
            color: var(--gray-600);
            cursor: pointer;
            border-radius: 20px; /* Pill completo */
            transition: all var(--transition-base);
            white-space: nowrap;
            height: 40px; /* Altura uniforme */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .feed-filter-btn.active {
            background: var(--black);
            color: var(--white);
        }

        .feed-filter-btn:hover:not(.active) {
            background: var(--gray-200);
            color: var(--black);
        }

        /* Feed Search Bar - Exact Nike Style */
        .feed-search-container {
            margin-bottom: 0; /* Sin margin porque estÃ¡ en el header */
        }

        .feed-search-wrapper {
            position: relative;
            width: 200px; /* Ancho exacto Nike */
            max-width: 200px;
        }

        .feed-search-input {
            width: 100%;
            padding: 12px 44px 12px 44px; /* Ajustado a medidas exactas Nike */
            font-size: 15px; /* Texto mÃ¡s pequeÃ±o */
            font-weight: 400;
            border: none;
            border-radius: 20px; /* Pill exacto Nike */
            background: #1C1C1E;
            color: var(--white);
            transition: background var(--transition-base);
            font-family: var(--font-system);
            -webkit-appearance: none;
            cursor: pointer;
            height: 40px; /* Altura exacta Nike - mÃ¡s compacta */
        }

        .feed-search-input:focus {
            outline: none;
            background: #2C2C2E;
            cursor: text;
        }

        .feed-search-input::placeholder {
            color: #8E8E93;
            font-weight: 400;
        }

        .feed-search-icon {
            position: absolute;
            left: 12px; /* PosiciÃ³n exacta Nike */
            top: 50%;
            transform: translateY(-50%);
            width: 18px; /* TamaÃ±o exacto Nike */
            height: 18px;
            color: #FFFFFF; /* Blanco puro */
            pointer-events: none;
            stroke-width: 2.5;
        }

        .feed-search-clear {
            position: absolute;
            right: 12px; /* Alineado con medidas Nike */
            top: 50%;
            transform: translateY(-50%);
            background: #48484A;
            color: var(--white);
            border: none;
            width: 18px; /* Proporcional al nuevo tamaÃ±o */
            height: 18px;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            transition: all var(--transition-fast);
            opacity: 0.8;
        }

        .feed-search-clear:hover {
            opacity: 1;
            background: #636366;
        }

        .feed-search-clear.active {
            display: flex;
        }

        /* Search Filter Panel - Nike Panoramic Horizontal Layout */
        .feed-search-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 55vh;
            background: #000000;
            z-index: var(--z-overlay);
            display: none;
            flex-direction: column;
            animation: slideDown 0.25s ease;
        }

        .feed-search-panel-overlay.active {
            display: flex;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
            }
            to {
                transform: translateY(0);
            }
        }

        /* Backdrop for rest of screen */
        .feed-search-panel-overlay::after {
            content: '';
            position: fixed;
            top: 55vh;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            pointer-events: none;
            z-index: -1;
        }

        /* Search Bar Header - Compact for 55vh */
        .overlay-search-header {
            padding: var(--space-3) var(--space-4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-3);
            background: #000000;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            flex-shrink: 0;
        }

        .overlay-search-wrapper {
            position: relative;
            flex: 1;
            max-width: 600px;
        }

        .overlay-search-input {
            width: 100%;
            padding: 12px 48px;
            font-size: 15px;
            font-weight: 400;
            border: none;
            border-radius: 50px;
            background: #1a1a1a;
            color: var(--white);
            transition: background var(--transition-base);
            font-family: var(--font-system);
            -webkit-appearance: none;
        }

        .overlay-search-input:focus {
            outline: none;
            background: #222222;
        }

        .overlay-search-input::placeholder {
            color: #757575;
            font-weight: 400;
        }

        .overlay-search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            color: #757575;
            pointer-events: none;
        }

        .overlay-search-clear {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            background: transparent;
            color: #757575;
            border: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: 400;
            transition: all var(--transition-fast);
        }

        .overlay-search-clear:hover {
            color: var(--white);
        }

        .overlay-search-clear.active {
            display: flex;
        }

        .overlay-cancel-btn {
            color: var(--white);
            font-size: 15px;
            font-weight: 400;
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px 12px;
            white-space: nowrap;
            transition: opacity var(--transition-fast);
        }

        .overlay-cancel-btn:hover {
            opacity: 0.7;
        }

        /* Content Layout - Optimized for 55vh */
        .overlay-content-grid {
            display: flex;
            flex-direction: column;
            gap: var(--space-5);
            padding: var(--space-4) var(--space-4) 100px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            flex: 1;
        }

        .overlay-column {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .overlay-column-title {
            font-size: 14px;
            font-weight: 600;
            color: #757575;
            margin-bottom: var(--space-1);
            letter-spacing: 0.3px;
            text-transform: none;
        }

        .overlay-column-list {
            display: flex;
            flex-direction: column;
            gap: 2px;
            background: transparent;
            border-radius: 0;
            overflow: visible;
            border: none;
        }

        .overlay-column-item {
            padding: 12px 16px;
            background: #1a1a1a;
            border: none;
            text-align: left;
            font-size: 15px;
            font-weight: 400;
            color: #FFFFFF;
            cursor: pointer;
            transition: all var(--transition-fast);
            border-radius: 6px;
            position: relative;
        }

        .overlay-column-item:hover {
            background: #222222;
        }

        .overlay-column-item.active {
            background: #222222;
            color: #FFFFFF;
            font-weight: 500;
        }

        .overlay-column-item.active::after {
            content: 'âœ“';
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            font-weight: 600;
            color: #FFFFFF;
        }

        /* Pills Style for Archetypes - Compact */
        .overlay-pills-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .overlay-pill {
            padding: 10px 20px; /* Ajustado para 40px altura */
            background: #1a1a1a;
            border: none;
            border-radius: 20px; /* Pill completo */
            font-size: 14px;
            font-weight: 400;
            color: #FFFFFF;
            cursor: pointer;
            transition: all var(--transition-base);
            white-space: nowrap;
            height: 40px; /* Altura uniforme */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .overlay-pill:hover {
            background: #222222;
        }

        .overlay-pill.active {
            background: var(--white);
            color: var(--black);
            font-weight: 600;
        }

        /* Custom Date Inputs - Compact Inline */
        .overlay-date-inline {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        .overlay-date-inline input[type="date"] {
            flex: 1;
            padding: 8px 10px;
            border: 1px solid #2C2C2E;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 400;
            color: var(--white);
            background: #1C1C1E;
            font-family: var(--font-system);
            transition: all var(--transition-base);
        }

        .overlay-date-inline input[type="date"]:focus {
            outline: none;
            border-color: #8E8E93;
        }

        /* Bottom Action Bar - Fixed for 55vh */
        .overlay-action-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: var(--space-3) var(--space-4);
            background: #000000;
            border-top: 1px solid #1a1a1a;
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            flex-shrink: 0;
        }

        .overlay-filter-count {
            font-size: 13px;
            color: #757575;
        }

        .overlay-action-buttons {
            display: flex;
            gap: 10px;
        }

        .overlay-apply-btn {
            padding: 10px 32px; /* Ya correcto para 40px */
            background: var(--white);
            color: var(--black);
            border: none;
            border-radius: 20px; /* Pill completo */
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            height: 40px; /* Altura uniforme */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .overlay-apply-btn:hover {
            background: #e5e5e5;
            transform: scale(1.02);
        }

        .overlay-reset-btn {
            padding: 10px 24px; /* Ya correcto para 40px */
            background: transparent;
            color: #757575;
            border: 1px solid #2a2a2a;
            border-radius: 20px; /* Pill completo */
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-base);
            height: 40px; /* Altura uniforme */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .overlay-reset-btn:hover {
            color: var(--white);
            border-color: #3a3a3a;
        }

        @media (max-width: 1024px) {
            .overlay-content-grid {
                padding: var(--space-3) var(--space-3) 90px;
                gap: var(--space-4);
            }
        }

        @media (max-width: 768px) {
            .overlay-search-header {
                padding: var(--space-2) var(--space-3);
            }

            .overlay-search-input {
                font-size: 15px;
                padding: 10px 44px;
            }

            .overlay-search-icon {
                left: 16px;
                width: 16px;
                height: 16px;
            }

            .overlay-search-clear {
                right: 16px;
            }

            .overlay-content-grid {
                gap: var(--space-3);
                padding: var(--space-3) var(--space-3) 100px;
            }

            .overlay-action-bar {
                padding: var(--space-2) var(--space-3);
                flex-direction: column;
                gap: var(--space-2);
                align-items: stretch;
            }

            .overlay-action-buttons {
                width: 100%;
            }

            .overlay-apply-btn,
            .overlay-reset-btn {
                flex: 1;
            }

            .overlay-filter-count {
                text-align: center;
            }
        }

        .feed-container {
            display: flex;
            flex-direction: column;
            gap: 20px; /* Nike mobile spacing - mÃ¡s compacto */
        }

        @media (min-width: 768px) {
            .feed-container {
                gap: 24px; /* Nike desktop spacing */
            }
        }

        .feed-empty {
            text-align: center;
            padding: var(--space-8) var(--space-4);
        }

        .feed-empty-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: var(--space-2);
        }

        .feed-empty-message {
            font-size: 16px;
            color: var(--gray-600);
            line-height: 1.6;
        }

        .post-card {
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            border-radius: 0;
            overflow: hidden;
            cursor: pointer;
            transition: background var(--transition-fast);
        }

        .post-card:hover {
            background: var(--gray-50);
        }

        .post-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
        }

        .post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .post-author-info {
            flex: 1;
        }

        .post-author {
            font-size: 15px;
            font-weight: 600;
            color: var(--black);
            margin-bottom: 0;
        }

        .post-timestamp {
            font-size: 13px;
            font-weight: 400;
            color: var(--gray-500);
        }

        .post-image {
            width: 100%;
            max-height: 500px;
            object-fit: cover;
            display: block;
        }

        .post-content {
            padding: 12px 16px;
        }

        .post-text {
            font-size: 15px;
            line-height: 1.5;
            color: var(--black);
        }

        .archetype-tag {
            display: inline-block;
            padding: 4px 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background: var(--gray-100);
            color: var(--gray-700);
            border-radius: 12px;
            margin-bottom: 8px;
        }

        .post-footer {
            padding: 12px 16px 16px;
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-600);
        }

        .post-action-invite {
            cursor: pointer;
            transition: color var(--transition-fast);
            font-weight: 600;
        }

        .post-action-invite:hover {
            color: var(--black);
        }

        .post-archetypes {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 8px;
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PACKS STYLES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .packs-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px; /* Nike mobile gap - mÃ¡s compacto */
        }

        @media (min-width: 640px) {
            .packs-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 24px; /* Nike desktop gap */
            }
        }

        @media (min-width: 1024px) {
            .packs-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 24px;
            }
        }

        .pack-card {
            background: var(--white);
            border: 0.5px solid var(--gray-200);
            border-radius: var(--radius-lg);
            overflow: hidden;
            cursor: pointer;
            transition: all var(--transition-slow);
        }

        .pack-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
            border-color: var(--gray-300);
        }

        .pack-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .pack-content {
            padding: var(--space-3);
        }

        .pack-name {
            font-size: 20px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: var(--space-1);
        }

        .pack-location {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-500);
            margin-bottom: var(--space-2);
        }

        .pack-description {
            font-size: 15px;
            line-height: 1.5;
            color: var(--gray-700);
            margin-bottom: var(--space-3);
        }

        .pack-stats {
            display: flex;
            gap: var(--space-3);
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-600);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MAP STYLES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .map-filters {
            background: var(--white);
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: 0;
        }

        .map-search-container {
            position: relative;
            margin-bottom: var(--space-3);
        }

        .map-search-input {
            width: 100%;
            padding: 14px 48px 14px 16px;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius-pill);
            font-size: 15px;
            font-weight: 500;
            font-family: var(--font-system);
            color: var(--black);
            background: var(--white);
            transition: all var(--transition-fast);
        }

        .map-search-input:focus {
            outline: none;
            border-color: var(--black);
        }

        .map-search-input::placeholder {
            color: var(--gray-500);
        }

        .map-search-icon {
            position: absolute;
            right: 18px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            pointer-events: none;
            opacity: 0.5;
        }

        .filters-row {
            display: flex;
            gap: var(--space-2);
            align-items: center;
            justify-content: space-between;
        }

        .filter-pills {
            display: flex;
            gap: var(--space-2);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
            flex: 1;
        }

        .filter-pills::-webkit-scrollbar {
            display: none;
        }

        .filter-pill {
            flex-shrink: 0;
            padding: 10px 20px; /* Ya correcto para 40px */
            background: var(--white);
            border: 2px solid var(--gray-300);
            border-radius: 20px; /* Pill completo */
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-700);
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
            height: 40px; /* Altura uniforme */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .filter-pill:hover {
            border-color: var(--gray-600);
            color: var(--black);
        }

        .filter-pill.active {
            background: var(--black);
            border-color: var(--black);
            color: var(--white);
        }
        
        /* TRIBE Sections */
        /* HOME DASHBOARD STYLES */
        .home-stat-card {
            padding: var(--space-3);
            background: var(--white);
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            text-align: center;
            transition: all var(--transition-fast);
        }

        .home-stat-card:hover {
            border-color: var(--black);
            transform: translateY(-2px);
        }

        .home-stat-value {
            font-size: 32px;
            font-weight: 800;
            color: var(--black);
            line-height: 1;
        }

        .home-stat-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-600);
            margin-top: var(--space-1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .home-event-card {
            padding: var(--space-3);
            background: var(--white);
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            transition: all var(--transition-fast);
            cursor: pointer;
        }

        .home-event-card:hover {
            border-color: var(--black);
            transform: translateX(4px);
        }

        .home-quick-action {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-3);
            background: var(--white);
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-700);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .home-quick-action:hover {
            background: var(--black);
            border-color: var(--black);
            color: var(--white);
        }

        .home-quick-action svg {
            width: 24px;
            height: 24px;
        }
        
        /* TRIBE Sections */
        .tribe-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .tribe-section.active {
            display: block;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           TRIBE HEADER + NAVIGATION - Nike Minimalist Pattern
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .tribe-header-nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 24px 24px 20px;
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .tribe-header-title {
            font-size: 22px;
            font-weight: 700;
            letter-spacing: -0.02em;
            color: var(--black);
            margin: 0;
            flex-shrink: 0;
        }

        .tribe-header-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid var(--gray-200);
            transition: all var(--transition-fast);
            flex-shrink: 0;
        }

        .tribe-header-user-avatar:hover {
            border-color: var(--black);
            transform: scale(1.05);
        }

        .tribe-header-user-avatar:active {
            transform: scale(0.95);
        }

        .tribe-nav-tabs {
            display: flex;
            align-items: center;
            gap: 32px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            margin-left: 40px;
        }

        .tribe-nav-tabs::-webkit-scrollbar {
            display: none;
        }

        .tribe-nav-tab {
            padding: 0;
            background: transparent;
            border: none;
            font-size: 15px;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            transition: color var(--transition-fast);
            white-space: nowrap;
            position: relative;
        }

        .tribe-nav-tab:hover {
            color: var(--black);
        }

        .tribe-nav-tab.active {
            color: var(--black);
            font-weight: 600;
        }

        /* Mobile: Stack vertically or keep horizontal scroll */
        @media (max-width: 768px) {
            .tribe-header-nav {
                padding: 16px 16px 12px;
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .tribe-header-title {
                font-size: 20px;
            }
            
            .tribe-header-user-avatar {
                position: absolute;
                top: 16px;
                right: 16px;
                width: 36px;
                height: 36px;
            }

            .tribe-nav-tabs {
                width: 100%;
                margin-left: 0;
                gap: 24px;
                padding-bottom: 4px;
            }

            .tribe-nav-tab {
                font-size: 14px;
            }
        }


        .environment-dropdown {
            position: relative;
            flex-shrink: 0;
        }

        .environment-toggle {
            padding: 10px 20px; /* Ya correcto para 40px */
            background: var(--white);
            border: 2px solid var(--gray-300);
            border-radius: 20px; /* Pill completo */
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-700);
            cursor: pointer;
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--space-1);
            white-space: nowrap;
            height: 40px; /* Altura uniforme */
        }

        .environment-toggle:hover {
            border-color: var(--gray-600);
            color: var(--black);
        }

        .environment-toggle.active {
            border-color: var(--black);
            color: var(--black);
        }

        .dropdown-arrow {
            font-size: 12px;
            transition: transform var(--transition-fast);
        }

        .environment-toggle.open .dropdown-arrow {
            transform: rotate(180deg);
        }

        .environment-menu {
            position: absolute;
            top: calc(100% + 8px);
            right: 0;
            background: var(--white);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            padding: var(--space-1);
            min-width: 160px;
            z-index: 1100;
            display: none;
        }

        .environment-menu.open {
            display: block;
        }

        .environment-option {
            width: 100%;
            padding: 10px 16px;
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-700);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-align: left;
        }

        .environment-option:hover {
            background: var(--gray-50);
            color: var(--black);
        }

        .environment-option.active {
            background: var(--black);
            color: var(--white);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ACCESSIBILITY ENHANCEMENTS - ARIA, Focus States, Keyboard Navigation
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        /* Focus visible for keyboard navigation */
        *:focus-visible {
            outline: 2px solid var(--black);
            outline-offset: 2px;
            border-radius: var(--radius-sm);
        }

        /* Skip to main content link */
        .skip-to-main {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--black);
            color: var(--white);
            padding: 8px 16px;
            text-decoration: none;
            z-index: 10000;
            border-radius: var(--radius-sm);
        }

        .skip-to-main:focus {
            top: 8px;
            left: 8px;
        }

        /* Screen reader only content */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Focus management for modals */
        .modal.active,
        .mentorship-request-modal.active {
            outline: none;
        }

        .modal-content:focus,
        .mentorship-request-content:focus {
            outline: none;
        }

        /* Button focus states */
        button:focus-visible,
        .btn:focus-visible {
            outline: 2px solid var(--black);
            outline-offset: 2px;
        }

        /* Interactive elements must have visible focus */
        a:focus-visible,
        input:focus-visible,
        textarea:focus-visible,
        select:focus-visible {
            outline: 2px solid var(--black);
            outline-offset: 2px;
        }

        /* Tab order optimization */
        [tabindex="-1"]:focus {
            outline: none;
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PERFORMANCE OPTIMIZATIONS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        /* GPU acceleration for animations */
        .modal-content,
        .mentorship-request-content,
        .tab-panel,
        .btn,
        .coach-card,
        .pack-card,
        .event-card {
            will-change: transform;
        }

        /* Contain layout shifts */
        .feed-card,
        .post-card,
        .coach-card {
            contain: layout style paint;
        }

        /* Lazy load images optimization */
        img {
            loading: lazy; /* No funciona en CSS, pero documentamos la intenciÃ³n */
        }
        
        img[loading="lazy"] {
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        img[loading="lazy"].loaded {
            opacity: 1;
        }

        /* Force visibility for training images */
        .training-program-image img,
        .training-session-image img,
        .training-video-cover {
            opacity: 1 !important;
        }

        /* Reduce motion for users who prefer it */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
            
            /* Disable transforms that cause motion */
            .btn:hover,
            .btn:active,
            .feed-card:hover,
            .post-card:hover,
            .coach-card:hover,
            .pack-card:hover,
            .event-card:hover {
                transform: none !important;
            }
            
            /* Keep opacity changes for feedback */
            .btn:active {
                opacity: 0.8;
            }
        }


        .map-location-container {
            padding: var(--space-3) 0 0 0;
            display: flex;
            justify-content: center;
        }

        .map-location-btn {
            display: flex;
            align-items: center;
            gap: var(--space-1);
            padding: 12px 24px;
            background: var(--black);
            color: var(--white);
            border: none;
            border-radius: var(--radius-pill);
            font-size: 15px;
            font-weight: 600;
            font-family: var(--font-system);
            cursor: pointer;
            transition: all var(--transition-fast);
            box-shadow: var(--shadow-md);
        }

        .map-location-btn:hover {
            background: var(--gray-800);
            transform: translateY(-1px);
            box-shadow: var(--shadow-lg);
        }

        .map-location-btn:active {
            transform: translateY(0);
            box-shadow: var(--shadow-sm);
        }

        .location-icon {
            font-size: 18px;
        }

        .location-text {
            line-height: 1;
        }

        .map-container {
            position: relative;
            width: 100%;
            height: calc(100vh - 400px);
            min-height: 500px;
        }

        #map {
            width: 100%;
            height: 100%;
            border-radius: 0;
        }

        .marker-icon {
            width: 44px !important;
            height: 44px !important;
            background: var(--black);
            border: 3px solid var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--white);
            font-weight: 700;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-left: -22px !important;
            margin-top: -22px !important;
        }

        .marker-icon.pack {
            background: var(--black);
        }

        .marker-icon.spot {
            background: var(--gray-700);
        }

        .marker-icon.facilitator {
            background: var(--gray-800);
        }

        .marker-icon.event {
            background: var(--black);
        }

        .map-detail-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--white);
            border-top-left-radius: var(--radius-xl);
            border-top-right-radius: var(--radius-xl);
            padding: var(--space-5);
            max-height: 75vh;
            overflow-y: auto;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 9999;
            box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.15);
        }

        .map-detail-panel.active {
            transform: translateY(0);
        }

        @media (min-width: 768px) {
            .map-container {
                height: calc(100vh - 350px);
            }

            .map-detail-panel {
                position: fixed;
                top: var(--space-6);
                left: var(--space-6);
                bottom: auto;
                right: auto;
                width: 480px;
                max-height: calc(100vh - 200px);
                border-radius: var(--radius-xl);
                transform: translateX(-120%);
                padding: var(--space-6);
                z-index: 9999;
            }

            .map-detail-panel.active {
                transform: translateX(0);
            }
        }

        .detail-panel-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-3);
        }

        .detail-panel-close {
            background: none;
            border: none;
            font-size: 28px;
            color: var(--gray-600);
            cursor: pointer;
            padding: 0;
            line-height: 1;
            transition: color var(--transition-fast);
        }

        .detail-panel-close:hover {
            color: var(--black);
        }

        .detail-panel-image {
            width: 100%;
            aspect-ratio: 16/9;
            object-fit: cover;
            border-radius: var(--radius-md);
            margin-bottom: var(--space-3);
            background: var(--gray-100);
        }

        .detail-panel-category {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--gray-600);
            margin-bottom: var(--space-1);
        }

        .detail-panel-title {
            font-size: 32px;
            font-weight: 800;
            letter-spacing: -0.03em;
            line-height: 1.1;
            margin-bottom: var(--space-2);
        }

        .detail-panel-subtitle {
            font-size: 16px;
            color: var(--gray-600);
            margin-bottom: var(--space-4);
        }

        .detail-panel-info {
            margin-bottom: var(--space-4);
        }

        .detail-info-item {
            display: flex;
            gap: var(--space-2);
            padding: var(--space-2) 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .detail-info-item:last-child {
            border-bottom: none;
        }

        .detail-info-icon {
            width: 20px;
            height: 20px;
            color: var(--gray-600);
            flex-shrink: 0;
        }
        
        .detail-info-icon svg {
            width: 100%;
            height: 100%;
            stroke: currentColor;
            fill: none;
        }

        .detail-info-text {
            flex: 1;
        }

        .detail-info-label {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--gray-600);
            margin-bottom: 2px;
        }

        .detail-info-value {
            font-size: 15px;
            font-weight: 600;
            color: var(--black);
        }

        .detail-panel-description {
            font-size: 15px;
            line-height: 1.6;
            color: var(--gray-700);
            margin-bottom: var(--space-4);
        }

        .detail-panel-actions {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
            margin-top: var(--space-5);
        }

        .detail-action-btn {
            width: 100%;
            padding: 18px 32px;
            background: var(--black);
            color: var(--white);
            border: none;
            border-radius: var(--radius-pill);
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-base);
            text-transform: none;
        }

        .detail-action-btn:hover:not(:disabled) {
            background: var(--gray-900);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .detail-action-btn.secondary {
            background: var(--white);
            color: var(--black);
            border: 2px solid var(--gray-300);
        }

        .detail-action-btn.secondary:hover:not(:disabled) {
            background: var(--gray-50);
            border-color: var(--black);
        }

        .archetype-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-1);
            margin-bottom: var(--space-3);
        }

        .archetype-tag {
            padding: 6px 12px;
            background: var(--gray-100);
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-700);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MY PACKS STYLES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .my-pack-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            overflow: hidden;
            margin-bottom: var(--space-4);
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 640px) {
            .my-pack-card {
                flex-direction: row;
            }
        }

        .my-pack-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        @media (min-width: 640px) {
            .my-pack-image {
                width: 300px;
                height: auto;
            }
        }

        .my-pack-content {
            padding: var(--space-4);
            flex: 1;
        }

        .my-pack-name {
            font-size: 24px;
            font-weight: 800;
            color: var(--black);
            margin-bottom: var(--space-1);
        }

        .my-pack-location {
            font-size: 15px;
            font-weight: 600;
            color: var(--gray-500);
            margin-bottom: var(--space-2);
        }

        .my-pack-next-session {
            font-size: 16px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: var(--space-4);
            padding: var(--space-2);
            background: var(--gray-100);
            border-radius: var(--radius-sm);
            display: inline-block;
        }

        .my-pack-actions {
            display: flex;
            gap: var(--space-2);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           GUIDE SECTION - Find Your Coach (FASE 5: Mentorship & Wisdom)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .guide-header {
            margin-bottom: var(--space-6);
            text-align: center;
        }

        .guide-title {
            font-size: clamp(36px, 6vw, 56px);
            font-weight: 900;
            letter-spacing: -0.03em;
            line-height: 1.0;
            margin-bottom: var(--space-2);
        }

        .guide-subtitle {
            font-size: 18px;
            color: var(--gray-600);
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }

        .guide-filters {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
            margin-bottom: var(--space-6);
            padding: var(--space-4);
            background: var(--gray-50);
            border-radius: var(--radius-lg);
        }

        @media (min-width: 768px) {
            .guide-filters {
                flex-direction: row;
                align-items: flex-end;
            }
        }

        .guide-filter-group {
            flex: 1;
        }

        .guide-filter-label {
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--gray-700);
            margin-bottom: var(--space-1);
            display: block;
        }

        .guide-filter-select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius-pill);
            font-size: 15px;
            font-weight: 600;
            font-family: var(--font-system);
            color: var(--black);
            background: var(--white);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .guide-filter-select:focus {
            outline: none;
            border-color: var(--black);
        }

        .guide-filter-input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid var(--gray-300);
            border-radius: var(--radius-pill);
            font-size: 15px;
            font-weight: 500;
            font-family: var(--font-system);
            color: var(--black);
            background: var(--white);
            transition: all var(--transition-fast);
        }

        .guide-filter-input:focus {
            outline: none;
            border-color: var(--black);
        }

        .guide-filter-input::placeholder {
            color: var(--gray-500);
        }

        .coaches-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-4);
        }

        @media (min-width: 640px) {
            .coaches-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .coaches-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .coach-card {
            background: var(--white);
            border: 0.5px solid var(--gray-200);
            border-radius: var(--radius-lg);
            overflow: hidden;
            cursor: pointer;
            transition: all var(--transition-slow);
        }

        .coach-card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
            border-color: var(--gray-300);
        }

        .coach-card-image {
            width: 100%;
            height: 240px;
            object-fit: cover;
            background: var(--gray-100);
        }

        .coach-card-content {
            padding: var(--space-4);
        }

        .coach-card-header {
            margin-bottom: var(--space-3);
        }

        .coach-card-name {
            font-size: 22px;
            font-weight: 800;
            color: var(--black);
            margin-bottom: 4px;
            letter-spacing: -0.01em;
        }

        .coach-card-location {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-500);
            margin-bottom: var(--space-1);
        }

        .coach-card-tier {
            display: inline-block;
            padding: 6px 14px;
            background: var(--black);
            color: var(--white);
            border-radius: var(--radius-pill);
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .coach-card-bio {
            font-size: 15px;
            line-height: 1.6;
            color: var(--gray-700);
            margin-bottom: var(--space-3);
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .coach-card-specialties {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: var(--space-4);
        }

        .coach-specialty-tag {
            padding: 6px 12px;
            background: var(--gray-100);
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-700);
        }

        .coach-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: var(--space-3);
            border-top: 1px solid var(--gray-200);
        }

        .coach-card-rate {
            font-size: 18px;
            font-weight: 800;
            color: var(--black);
        }

        .coach-card-rate-period {
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-600);
        }

        .coach-card-btn {
            padding: 10px 24px; /* Ajustado para 40px */
            background: var(--black);
            color: var(--white);
            border: none;
            border-radius: 20px; /* Pill completo */
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-base);
            height: 40px; /* Altura uniforme */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .coach-card-btn:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           WISDOM LIBRARY - Long-form Content (FASE 5: Mentorship & Wisdom)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .wisdom-header {
            margin-bottom: var(--space-6);
        }

        .wisdom-title {
            font-size: clamp(32px, 5vw, 48px);
            font-weight: 900;
            letter-spacing: -0.03em;
            line-height: 1.1;
            margin-bottom: var(--space-3);
        }

        .wisdom-filters {
            display: flex;
            gap: var(--space-2);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            margin-bottom: var(--space-5);
        }

        .wisdom-filters::-webkit-scrollbar {
            display: none;
        }

        .wisdom-filter-btn {
            flex-shrink: 0;
            padding: 10px 24px; /* Ya correcto para 40px */
            background: var(--white);
            border: 2px solid var(--gray-300);
            border-radius: 20px; /* Pill completo */
            font-size: 14px;
            font-weight: 700;
            color: var(--gray-700);
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
            height: 40px; /* Altura uniforme */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .wisdom-filter-btn:hover {
            border-color: var(--gray-600);
            color: var(--black);
        }

        .wisdom-filter-btn.active {
            background: var(--black);
            border-color: var(--black);
            color: var(--white);
        }

        .wisdom-articles {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-6);
        }

        @media (min-width: 768px) {
            .wisdom-articles {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .wisdom-article-card {
            background: var(--white);
            border: 0.5px solid var(--gray-200);
            border-radius: var(--radius-lg);
            overflow: hidden;
            cursor: pointer;
            transition: all var(--transition-slow);
        }

        .wisdom-article-card:hover {
            box-shadow: var(--shadow-xl);
            transform: translateY(-4px);
            border-color: var(--gray-300);
        }

        .wisdom-article-image {
            width: 100%;
            height: 280px;
            object-fit: cover;
            background: var(--gray-100);
        }

        .wisdom-article-content {
            padding: var(--space-5);
        }

        .wisdom-article-category {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--gray-600);
            margin-bottom: var(--space-2);
        }

        .wisdom-article-title {
            font-size: 28px;
            font-weight: 900;
            letter-spacing: -0.02em;
            line-height: 1.15;
            color: var(--black);
            margin-bottom: var(--space-2);
        }

        .wisdom-article-excerpt {
            font-size: 16px;
            line-height: 1.6;
            color: var(--gray-700);
            margin-bottom: var(--space-4);
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .wisdom-article-meta {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-500);
        }

        .wisdom-article-author {
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .wisdom-article-read-time {
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           WISDOM LIBRARY STYLES
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .discussion-card {
            background: var(--white);
            border: 0.5px solid var(--gray-200);
            border-radius: var(--radius-lg);
            overflow: hidden;
            cursor: pointer;
            transition: all var(--transition-slow);
        }

        .discussion-card:hover {
            box-shadow: var(--shadow-xl);
            transform: translateY(-4px);
            border-color: var(--gray-300);
        }

        .discussion-image {
            width: 100%;
            height: 160px;
            object-fit: cover;
            background: var(--gray-100);
            display: block;
        }

        .discussion-content {
            padding: var(--space-3);
        }

        .discussion-header {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .discussion-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        .discussion-meta {
            flex: 1;
        }

        .discussion-author {
            font-size: 13px;
            font-weight: 700;
            color: var(--black);
        }

        .discussion-timestamp {
            font-size: 11px;
            font-weight: 500;
            color: var(--gray-500);
        }

        .discussion-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: var(--space-2);
        }

        .discussion-tag {
            padding: 4px 10px;
            background: var(--gray-100);
            border-radius: var(--radius-pill);
            font-size: 11px;
            font-weight: 600;
            color: var(--gray-700);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .discussion-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: var(--space-2);
            line-height: 1.25;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .discussion-excerpt {
            font-size: 14px;
            line-height: 1.5;
            color: var(--gray-600);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: var(--space-3);
        }

        .discussion-stats {
            display: flex;
            gap: var(--space-3);
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-500);
        }

        .discussion-footer {
            padding-top: var(--space-2);
            border-top: 1px solid var(--gray-200);
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-700);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .discussion-action-invite {
            cursor: pointer;
            transition: opacity var(--transition-fast);
            font-size: 12px;
            white-space: nowrap;
            font-weight: 700;
        }

        .discussion-action-invite:hover {
            opacity: 0.7;
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           WISDOM LIBRARY - Nike Editorial Design
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .wisdom-editorial-container {
            max-width: 100%;
            margin: 0 auto;
            background: var(--white);
            padding-bottom: 100px;
        }

        /* Editorial Hero - Full Width Image with Overlay Text */
        .wisdom-editorial-hero {
            position: relative;
            width: 100%;
            min-height: 500px;
            display: flex;
            align-items: flex-end;
            margin-bottom: var(--space-8);
        }

        .wisdom-editorial-hero-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .wisdom-editorial-hero-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .wisdom-editorial-hero-content {
            position: relative;
            z-index: 2;
            max-width: 800px;
            padding: var(--space-6);
            color: var(--white);
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.5) 70%, transparent 100%);
            width: 100%;
        }

        .wisdom-editorial-category {
            display: inline-block;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            padding: 6px 16px;
            background: var(--white);
            color: var(--black);
            border-radius: var(--radius-pill);
            margin-bottom: var(--space-3);
        }

        .wisdom-editorial-hero-title {
            font-size: clamp(32px, 5vw, 56px);
            font-weight: 900;
            line-height: 1.1;
            letter-spacing: -0.02em;
            margin-bottom: var(--space-3);
            color: var(--white);
        }

        .wisdom-editorial-hero-excerpt {
            font-size: 18px;
            line-height: 1.6;
            color: var(--gray-200);
            margin-bottom: var(--space-4);
            max-width: 600px;
        }

        /* Article List Section */
        .wisdom-article-list {
            padding: var(--space-6) var(--space-4);
            max-width: 1200px;
            margin: 0 auto;
        }

        .wisdom-section-title {
            font-size: 32px;
            font-weight: 900;
            letter-spacing: -0.02em;
            color: var(--black);
            margin-bottom: var(--space-6);
            text-transform: uppercase;
        }

        .wisdom-articles-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-6);
        }

        @media (min-width: 768px) {
            .wisdom-articles-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .wisdom-articles-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Article Card - Clean Nike Style */
        .wisdom-article-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            overflow: hidden;
            cursor: pointer;
            transition: all var(--transition-slow);
            display: flex;
            flex-direction: column;
        }

        .wisdom-article-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            border-color: var(--gray-300);
        }

        .wisdom-article-card-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: var(--gray-100);
            display: block;
        }

        .wisdom-article-card-content {
            padding: var(--space-4);
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        .wisdom-article-card-category {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--gray-600);
            margin-bottom: var(--space-2);
        }

        .wisdom-article-card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: var(--space-2);
            line-height: 1.3;
            letter-spacing: -0.01em;
        }

        .wisdom-article-card-excerpt {
            font-size: 15px;
            line-height: 1.6;
            color: var(--gray-600);
            margin-bottom: var(--space-3);
            flex: 1;
        }

        .wisdom-article-card-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-500);
            padding-top: var(--space-3);
            border-top: 1px solid var(--gray-200);
        }

        /* Article Detail View - Editorial Reading Experience */
        .wisdom-article-detail {
            max-width: 800px;
            margin: 0 auto;
            padding: var(--space-6) var(--space-4) var(--space-10);
            background: var(--white);
        }

        .wisdom-article-detail-header {
            margin-bottom: var(--space-6);
        }

        .wisdom-article-detail-back {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-600);
            cursor: pointer;
            margin-bottom: var(--space-4);
            transition: color var(--transition-fast);
        }

        .wisdom-article-detail-back:hover {
            color: var(--black);
        }

        .wisdom-article-detail-category {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--gray-600);
            margin-bottom: var(--space-3);
        }

        .wisdom-article-detail-title {
            font-size: clamp(32px, 5vw, 48px);
            font-weight: 900;
            line-height: 1.1;
            letter-spacing: -0.02em;
            color: var(--black);
            margin-bottom: var(--space-4);
        }

        .wisdom-article-detail-meta {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: var(--space-6);
            padding-bottom: var(--space-4);
            border-bottom: 1px solid var(--gray-200);
        }

        .wisdom-article-detail-image {
            width: 100%;
            height: auto;
            max-height: 500px;
            object-fit: cover;
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-6);
        }

        .wisdom-article-detail-content {
            font-size: 18px;
            line-height: 1.8;
            color: var(--gray-800);
        }

        .wisdom-article-detail-content h2 {
            font-size: 28px;
            font-weight: 800;
            color: var(--black);
            margin: var(--space-6) 0 var(--space-3);
            letter-spacing: -0.01em;
        }

        .wisdom-article-detail-content p {
            margin-bottom: var(--space-4);
        }

        .wisdom-article-detail-content strong {
            font-weight: 700;
            color: var(--black);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           COACH BOOKING MODAL - Nike-Inspired Design
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .booking-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .booking-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-4);
        }

        .booking-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(4px);
            z-index: 1;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .booking-modal-content {
            position: relative;
            background: var(--white);
            border-radius: var(--radius-xl);
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 2;
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(40px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 640px) {
            .booking-modal.active {
                padding: 0;
                align-items: flex-start;
            }

            .booking-modal-content {
                max-height: 100vh;
                border-radius: 0;
            }
        }

        .booking-modal-close {
            position: absolute;
            top: var(--space-3);
            right: var(--space-3);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gray-100);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all var(--transition-fast);
            z-index: 10;
        }

        .booking-modal-close:hover {
            background: var(--gray-200);
            transform: rotate(90deg);
        }

        .booking-header {
            padding: var(--space-6) var(--space-5);
            border-bottom: 1px solid var(--gray-200);
            background: var(--gray-50);
        }

        .booking-coach-info {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }

        .booking-coach-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--white);
        }

        .booking-coach-details h3 {
            font-size: 20px;
            font-weight: 800;
            color: var(--black);
            margin-bottom: 4px;
            letter-spacing: -0.01em;
        }

        .booking-coach-details p {
            font-size: 14px;
            color: var(--gray-600);
            margin: 0;
        }

        .booking-steps {
            display: flex;
            gap: var(--space-2);
            justify-content: center;
        }

        .booking-step {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--gray-200);
            border-radius: var(--radius-pill);
            font-size: 13px;
            font-weight: 700;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all var(--transition-fast);
        }

        .booking-step.active {
            background: var(--black);
            color: var(--white);
        }

        .booking-step.completed {
            background: var(--gray-700);
            color: var(--white);
        }

        .booking-step-number {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--white);
            color: var(--black);
            font-size: 11px;
            font-weight: 700;
        }

        .booking-step.active .booking-step-number {
            background: var(--white);
            color: var(--black);
        }

        .booking-step.completed .booking-step-number {
            background: var(--white);
            color: var(--gray-700);
        }

        .booking-body {
            padding: var(--space-6) var(--space-5);
            min-height: 400px;
        }

        .booking-body-step {
            display: none;
        }

        .booking-body-step.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .booking-section-title {
            font-size: 18px;
            font-weight: 800;
            color: var(--black);
            margin-bottom: var(--space-4);
            letter-spacing: -0.01em;
        }

        /* Date Picker */
        .date-picker {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: var(--space-5);
        }

        .date-picker-header {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--gray-500);
            text-align: center;
            padding: 8px 0;
            letter-spacing: 0.05em;
        }

        .date-slot {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: var(--gray-100);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-700);
        }

        .date-slot:hover:not(.disabled) {
            background: var(--gray-200);
            border-color: var(--gray-400);
        }

        .date-slot.selected {
            background: var(--black);
            color: var(--white);
            border-color: var(--black);
        }

        .date-slot.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .date-slot-day {
            font-size: 11px;
            text-transform: uppercase;
            color: var(--gray-500);
            margin-bottom: 2px;
        }

        .date-slot.selected .date-slot-day {
            color: var(--gray-300);
        }

        /* Time Slots */
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 8px;
            margin-bottom: var(--space-5);
        }

        .time-slot {
            padding: 12px 16px;
            background: var(--gray-100);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-pill);
            text-align: center;
            font-size: 15px;
            font-weight: 700;
            color: var(--gray-700);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .time-slot:hover:not(.disabled) {
            background: var(--gray-200);
            border-color: var(--gray-400);
        }

        .time-slot.selected {
            background: var(--black);
            color: var(--white);
            border-color: var(--black);
        }

        .time-slot.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Booking Form */
        .booking-form-group {
            margin-bottom: var(--space-4);
        }

        .booking-form-label {
            display: block;
            font-size: 14px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: var(--space-2);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .booking-form-select,
        .booking-form-textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-family: var(--font-system);
            font-size: 16px;
            color: var(--black);
            background: var(--white);
            transition: border-color var(--transition-fast);
        }

        .booking-form-select:focus,
        .booking-form-textarea:focus {
            outline: none;
            border-color: var(--black);
        }

        .booking-form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .booking-form-hint {
            font-size: 13px;
            color: var(--gray-500);
            margin-top: 6px;
        }

        /* Booking Summary */
        .booking-summary {
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-4);
        }

        .booking-summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .booking-summary-row:last-child {
            border-bottom: none;
            padding-top: var(--space-3);
            margin-top: var(--space-2);
            font-size: 18px;
            font-weight: 800;
        }

        .booking-summary-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-600);
        }

        .booking-summary-value {
            font-size: 14px;
            font-weight: 700;
            color: var(--black);
            text-align: right;
        }

        .booking-summary-row:last-child .booking-summary-label,
        .booking-summary-row:last-child .booking-summary-value {
            font-size: 18px;
            font-weight: 800;
            color: var(--black);
        }

        /* Booking Footer */
        .booking-footer {
            padding: var(--space-4) var(--space-5);
            border-top: 1px solid var(--gray-200);
            display: flex;
            gap: var(--space-2);
            justify-content: space-between;
            background: var(--white);
        }

        @media (max-width: 640px) {
            .booking-footer {
                flex-direction: column-reverse;
            }
        }

        .booking-btn {
            flex: 1;
            padding: 10px 24px; /* Ajustado para 40px */
            border: none;
            border-radius: 20px; /* Pill completo */
            font-family: var(--font-system);
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-fast);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            height: 40px; /* Altura uniforme */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .booking-btn-secondary {
            background: var(--gray-200);
            color: var(--black);
        }

        .booking-btn-secondary:hover:not(:disabled) {
            background: var(--gray-300);
        }

        .booking-btn-primary {
            background: var(--black);
            color: var(--white);
        }

        .booking-btn-primary:hover:not(:disabled) {
            background: var(--gray-800);
        }

        .booking-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .booking-btn.loading {
            position: relative;
            color: transparent;
            pointer-events: none;
        }

        .booking-btn.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border: 2px solid var(--white);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Confirmation State */
        .booking-confirmation {
            text-align: center;
            padding: var(--space-8) var(--space-4);
        }

        .booking-confirmation-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--space-4);
            background: var(--black);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: var(--white);
        }

        .booking-confirmation-title {
            font-size: clamp(28px, 5vw, 36px);
            font-weight: 900;
            color: var(--black);
            margin-bottom: var(--space-2);
            letter-spacing: -0.02em;
            text-transform: uppercase;
        }

        .booking-confirmation-message {
            font-size: 17px;
            line-height: 1.6;
            color: var(--gray-600);
            max-width: 400px;
            margin: 0 auto var(--space-6);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           COACH REVIEWS SYSTEM - Nike-Inspired Design
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        /* Star Rating System */
        .star-rating {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .star {
            width: 16px;
            height: 16px;
            fill: var(--gray-300);
            transition: fill var(--transition-fast);
        }

        .star.filled {
            fill: #FFC107;
        }

        .star.half {
            fill: url(#half-star-gradient);
        }

        .star-rating-large .star {
            width: 24px;
            height: 24px;
        }

        /* Coach Rating Display on Cards */
        .coach-rating {
            display: flex;
            align-items: center;
            gap: var(--space-1);
            margin-top: 6px;
        }

        .coach-rating-number {
            font-size: 14px;
            font-weight: 700;
            color: var(--gray-800);
        }

        .coach-rating-count {
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-500);
        }

        /* Coach Profile Modal */
        .coach-profile-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10001;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .coach-profile-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-4);
        }

        @media (max-width: 767px) {
            .coach-profile-modal.active {
                padding: 0;
                align-items: flex-start;
            }
        }

        .coach-profile-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(4px);
        }

        .coach-profile-content {
            position: relative;
            background: var(--white);
            border-radius: var(--radius-lg);
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }

        @media (max-width: 767px) {
            .coach-profile-content {
                max-width: 100%;
                max-height: 100vh;
                border-radius: 0;
            }
        }

        .coach-profile-close {
            position: absolute;
            top: var(--space-3);
            right: var(--space-3);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--white);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2;
            transition: all var(--transition-fast);
            box-shadow: var(--shadow-sm);
        }

        .coach-profile-close:hover {
            background: var(--gray-100);
            transform: scale(1.1);
        }

        /* Profile Header */
        .coach-profile-header {
            padding: var(--space-6);
            border-bottom: 1px solid var(--gray-200);
        }

        .coach-profile-main {
            display: flex;
            gap: var(--space-4);
            align-items: center;
            margin-bottom: var(--space-4);
        }

        @media (max-width: 640px) {
            .coach-profile-main {
                flex-direction: column;
                text-align: center;
            }
        }

        .coach-profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--white);
            box-shadow: var(--shadow-md);
        }

        .coach-profile-info {
            flex: 1;
        }

        .coach-profile-name {
            font-size: 32px;
            font-weight: 900;
            color: var(--black);
            margin-bottom: var(--space-1);
            letter-spacing: -0.02em;
        }

        .coach-profile-location {
            font-size: 16px;
            color: var(--gray-600);
            margin-bottom: var(--space-2);
        }

        .coach-profile-rating-large {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-2);
        }

        @media (max-width: 640px) {
            .coach-profile-rating-large {
                justify-content: center;
            }
        }

        .coach-profile-rating-number {
            font-size: 28px;
            font-weight: 800;
            color: var(--black);
        }

        .coach-profile-rating-count {
            font-size: 15px;
            color: var(--gray-600);
            font-weight: 600;
        }

        /* Profile Tabs */
        .coach-profile-tabs {
            display: flex;
            gap: var(--space-1);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-pill);
            padding: 4px;
            background: var(--white);
        }

        .coach-profile-tab {
            padding: 10px 24px;
            background: transparent;
            border: none;
            font-size: 15px;
            font-weight: 600;
            color: var(--gray-600);
            cursor: pointer;
            border-radius: var(--radius-pill);
            transition: all var(--transition-fast);
            white-space: nowrap;
        }

        .coach-profile-tab.active {
            background: var(--black);
            color: var(--white);
        }

        .coach-profile-tab:hover:not(.active) {
            background: var(--gray-100);
        }

        /* Profile Body */
        .coach-profile-body {
            padding: var(--space-6);
        }

        .coach-profile-section {
            display: none;
        }

        .coach-profile-section.active {
            display: block;
        }

        /* Reviews Section */
        .reviews-overview {
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            padding: var(--space-5);
            margin-bottom: var(--space-6);
            text-align: center;
        }

        .reviews-overview-rating {
            font-size: 56px;
            font-weight: 950;
            color: var(--black);
            margin-bottom: var(--space-2);
            letter-spacing: -0.04em;
        }

        .reviews-overview-label {
            font-size: 16px;
            color: var(--gray-600);
            margin-bottom: var(--space-3);
        }

        .write-review-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            padding: 12px 28px;
            background: var(--black);
            color: var(--white);
            border: none;
            border-radius: var(--radius-pill);
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-fast);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .write-review-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Review Cards */
        .reviews-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        .review-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            transition: all var(--transition-fast);
        }

        .review-card:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--gray-300);
        }

        .review-header {
            display: flex;
            gap: var(--space-3);
            margin-bottom: var(--space-3);
        }

        .review-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            background: var(--gray-200);
        }

        .review-author-info {
            flex: 1;
        }

        .review-author {
            font-size: 16px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 4px;
        }

        .review-meta {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: 13px;
            color: var(--gray-600);
        }

        .review-verified {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            color: var(--gray-700);
            font-weight: 600;
        }

        .review-content {
            font-size: 15px;
            line-height: 1.6;
            color: var(--gray-700);
            margin-bottom: var(--space-3);
        }

        .review-rating-display {
            margin-bottom: var(--space-2);
        }

        /* Empty Reviews State */
        .reviews-empty {
            text-align: center;
            padding: var(--space-10) var(--space-4);
        }

        .reviews-empty-icon {
            font-size: 48px;
            margin-bottom: var(--space-3);
        }

        .reviews-empty-title {
            font-size: 24px;
            font-weight: 800;
            color: var(--black);
            margin-bottom: var(--space-2);
        }

        .reviews-empty-message {
            font-size: 16px;
            color: var(--gray-600);
            margin-bottom: var(--space-5);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           EMPTY STATES - Nike-Inspired Design
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .empty-state {
            text-align: center;
            padding: var(--space-12) var(--space-4);
            max-width: 600px;
            margin: 0 auto;
        }

        .empty-state-visual {
            width: 80px;
            height: 80px;
            margin: 0 auto var(--space-4);
            border-radius: 50%;
            background: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
        }

        .empty-title {
            font-size: clamp(28px, 4vw, 42px);
            font-weight: 900;
            color: var(--black);
            margin-bottom: var(--space-2);
            letter-spacing: -0.03em;
            line-height: 1.1;
        }

        .empty-message {
            font-size: 17px;
            font-weight: 500;
            color: var(--gray-600);
            margin-bottom: var(--space-6);
            line-height: 1.6;
            max-width: 480px;
            margin-left: auto;
            margin-right: auto;
        }

        .empty-state-actions {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            align-items: center;
        }

        @media (min-width: 640px) {
            .empty-state-actions {
                flex-direction: row;
                justify-content: center;
            }
        }

        .empty-state-btn {
            padding: 10px 28px; /* Ajustado para 40px */
            background: var(--black);
            color: var(--white);
            border: none;
            border-radius: 20px; /* Pill completo */
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-base);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            height: 40px; /* Altura uniforme */
        }

        .empty-state-btn:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }

        .empty-state-btn.secondary {
            background: var(--white);
            color: var(--black);
            border: 2px solid var(--gray-300);
        }

        .empty-state-btn.secondary:hover {
            background: var(--gray-50);
            border-color: var(--black);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SESSION SELECTOR - Training Integration v25
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .session-selector {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: var(--space-3);
        }

        .session-selector label {
            font-size: 14px;
            font-weight: 600;
            color: var(--black);
            margin-bottom: var(--space-1);
        }

        .session-selector select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-family: var(--font-system);
            background: var(--white);
            cursor: pointer;
            transition: var(--transition-base);
        }

        .session-selector select:focus {
            outline: none;
            border-color: var(--black);
        }

        .session-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-2);
            margin-top: var(--space-2);
        }

        .day-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--black);
            color: var(--white);
            border-radius: var(--radius-pill);
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.03em;
            text-transform: uppercase;
        }

        .day-badge-flow {
            background: var(--gray-800);
        }

        .day-badge-mastery {
            background: var(--black);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PRACTICE PARTNER FINDER - Training Integration v25
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .partner-finder-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: var(--space-3);
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-base);
        }

        .partner-finder-modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .partner-finder-content {
            background: var(--white);
            border-radius: var(--radius-lg);
            max-width: 600px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
        }

        .partner-finder-header {
            padding: var(--space-5) var(--space-4) var(--space-4);
            border-bottom: 1px solid var(--gray-200);
        }

        .partner-finder-header h2 {
            font-size: 28px;
            font-weight: 900;
            letter-spacing: -0.02em;
            margin-bottom: var(--space-1);
        }

        .partner-finder-body {
            padding: var(--space-4);
        }

        .partner-card {
            display: flex;
            gap: var(--space-3);
            padding: var(--space-3);
            background: var(--gray-50);
            border-radius: var(--radius-md);
            margin-bottom: var(--space-2);
            transition: var(--transition-base);
        }

        .partner-card:hover {
            background: var(--gray-100);
            transform: translateY(-2px);
        }

        .partner-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--gray-300);
            flex-shrink: 0;
        }

        .partner-info h4 {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .partner-info p {
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: 8px;
        }

        .btn-connect {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 20px;
            background: var(--black);
            color: var(--white);
            border: none;
            border-radius: var(--radius-pill);
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition-base);
        }

        .btn-connect:hover {
            background: var(--gray-800);
            transform: translateY(-1px);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           EVENT ORGANIZATION - FASE 3 v26 - Nike Run Club Style
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .event-card {
            background: var(--white);
            border: 0.5px solid var(--gray-200);
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin-bottom: var(--space-4);
            cursor: pointer;
            transition: all var(--transition-slow);
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 640px) {
            .event-card {
                flex-direction: row;
            }
        }

        .event-card:hover {
            box-shadow: var(--shadow-xl);
            transform: translateY(-4px);
            border-color: var(--gray-300);
        }

        .event-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            background: var(--gray-100);
            flex-shrink: 0;
        }

        @media (min-width: 640px) {
            .event-image {
                width: 180px;
                height: 180px;
            }
        }

        .event-content {
            padding: var(--space-4);
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-2);
        }

        .event-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--black);
            color: var(--white);
            border-radius: var(--radius-pill);
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .event-title {
            font-size: 20px;
            font-weight: 800;
            margin-bottom: var(--space-1);
            letter-spacing: -0.02em;
            line-height: 1.2;
        }

        .event-meta {
            display: flex;
            flex-direction: column;
            gap: 6px;
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: var(--space-3);
        }

        .event-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-weight: 500;
        }

        .event-rsvp {
            display: flex;
            gap: var(--space-2);
            align-items: center;
            padding-top: var(--space-2);
            border-top: 1px solid var(--gray-200);
            margin-top: auto;
        }

        .event-rsvp-count {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-700);
        }

        .btn-rsvp {
            padding: 10px 24px; /* Ajustado para 40px */
            background: var(--black);
            color: var(--white);
            border: none;
            border-radius: 20px; /* Pill completo */
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-fast);
            margin-left: auto;
            height: 40px; /* Altura uniforme */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .btn-rsvp:hover {
            opacity: 0.85;
            transform: translateY(-1px);
        }

        .btn-rsvp.active {
            background: var(--gray-800);
        }

        .btn-rsvp.secondary {
            background: var(--white);
            color: var(--black);
            border: 1px solid var(--gray-300);
        }

        .btn-rsvp.secondary:hover {
            background: var(--gray-50);
            border-color: var(--black);
        }

        .calendar-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: var(--space-3);
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-base);
        }

        .calendar-modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .calendar-content {
            background: var(--white);
            border-radius: var(--radius-xl);
            max-width: 900px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
        }

        .calendar-header {
            padding: var(--space-6) var(--space-5) var(--space-4);
            border-bottom: 1px solid var(--gray-200);
        }

        .calendar-header h2 {
            font-size: 32px;
            font-weight: 900;
            letter-spacing: -0.03em;
            margin-bottom: var(--space-1);
        }

        .calendar-body {
            padding: var(--space-5);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .calendar-day-header {
            text-align: center;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--gray-500);
            padding: var(--space-2);
            letter-spacing: 0.05em;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 15px;
            font-weight: 600;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            min-height: 48px;
        }

        .calendar-day:hover {
            background: var(--gray-100);
        }

        .calendar-day.has-event {
            background: var(--black);
            color: var(--white);
            font-weight: 700;
        }

        .calendar-day.has-event:hover {
            background: var(--gray-800);
        }

        .calendar-day.today {
            border: 2px solid var(--black);
            font-weight: 700;
        }

        .calendar-day.today.has-event {
            border: 2px solid var(--white);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           AVAILABILITY CALENDAR - Calendly-Style (Date Picker + Time Slots)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* Mini Calendar for Date Selection */
        .mini-calendar {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-3);
        }

        .mini-calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-3);
            padding-bottom: var(--space-2);
            border-bottom: 1px solid var(--gray-200);
        }

        .mini-calendar-month {
            font-size: 16px;
            font-weight: 700;
            color: var(--black);
        }

        .mini-calendar-nav {
            display: flex;
            gap: 4px;
        }

        .mini-calendar-nav-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 14px;
            font-weight: 700;
            color: var(--gray-700);
        }

        .mini-calendar-nav-btn:hover {
            background: var(--gray-100);
            border-color: var(--gray-300);
        }

        .mini-calendar-nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .mini-calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }

        .mini-calendar-day-header {
            text-align: center;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--gray-500);
            padding: 8px 0;
            letter-spacing: 0.05em;
        }

        .mini-calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            color: var(--gray-700);
            position: relative;
        }

        .mini-calendar-day:hover:not(.disabled):not(.unavailable) {
            background: var(--gray-100);
        }

        .mini-calendar-day.today {
            font-weight: 700;
            color: var(--black);
        }

        .mini-calendar-day.selected {
            background: var(--black);
            color: var(--white);
            font-weight: 700;
        }

        .mini-calendar-day.has-availability::after {
            content: '';
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: var(--black);
            border-radius: 50%;
        }

        .mini-calendar-day.selected.has-availability::after {
            background: var(--white);
        }

        .mini-calendar-day.disabled,
        .mini-calendar-day.unavailable {
            color: var(--gray-300);
            cursor: not-allowed;
        }

        .mini-calendar-day.other-month {
            color: var(--gray-400);
        }

        /* Time Slots List */
        .availability-time-slots-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 4px;
        }

        .availability-time-slots-list::-webkit-scrollbar {
            width: 4px;
        }

        .availability-time-slots-list::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 2px;
        }

        .availability-time-slots-list::-webkit-scrollbar-thumb {
            background: var(--gray-300);
            border-radius: 2px;
        }

        .availability-time-slot-item {
            padding: 14px 16px;
            background: var(--gray-50);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            text-align: center;
            font-size: 15px;
            font-weight: 700;
            color: var(--gray-700);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .availability-time-slot-item:hover {
            background: var(--gray-100);
            border-color: var(--gray-400);
        }

        .availability-time-slot-item.selected {
            background: var(--black);
            color: var(--white);
            border-color: var(--black);
        }

        .availability-time-slot-item.booked {
            background: var(--gray-200);
            color: var(--gray-400);
            border-color: var(--gray-200);
            cursor: not-allowed;
            text-decoration: line-through;
        }

        /* Compact version for booking modal */
        .mini-calendar-compact {
            padding: var(--space-2);
        }

        .mini-calendar-compact .mini-calendar-month {
            font-size: 14px;
        }

        .mini-calendar-compact .mini-calendar-day {
            font-size: 13px;
        }

        .availability-time-slots-compact {
            max-height: 320px;
        }

        .availability-time-slots-compact .availability-time-slot-item {
            padding: 12px 14px;
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .coach-profile-section[data-section="availability"] > div:first-of-type,
            .booking-body-step[data-step="1"] > div:last-of-type {
                grid-template-columns: 1fr !important;
            }

            .availability-time-slots-list {
                max-height: 300px;
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RITUAL & CEREMONY - FASE 4 v27
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .ritual-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 11000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: var(--space-4);
            animation: fadeIn 0.6s ease;
        }

        .ritual-overlay.active {
            display: flex;
        }

        .ritual-content {
            max-width: 600px;
            width: 100%;
            text-align: center;
            color: var(--white);
            animation: scaleIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .ritual-icon {
            font-size: 80px;
            margin-bottom: var(--space-4);
            animation: pulseGlow 2s ease-in-out infinite;
        }

        .ritual-title {
            font-size: clamp(32px, 5vw, 56px);
            font-weight: 950;
            letter-spacing: -0.04em;
            line-height: 0.9;
            margin-bottom: var(--space-3);
            text-transform: uppercase;
        }

        .ritual-subtitle {
            font-size: 18px;
            font-weight: 400;
            line-height: 1.6;
            opacity: 0.9;
            margin-bottom: var(--space-6);
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .ritual-reflection {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-xl);
            padding: var(--space-5);
            margin-bottom: var(--space-6);
            backdrop-filter: blur(10px);
        }

        .ritual-reflection-text {
            font-size: 17px;
            font-weight: 400;
            line-height: 1.8;
            font-style: italic;
            opacity: 0.95;
        }

        .ritual-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: var(--space-3);
            margin-bottom: var(--space-6);
        }

        .ritual-stat {
            padding: var(--space-3);
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .ritual-stat-value {
            font-size: 32px;
            font-weight: 900;
            letter-spacing: -0.02em;
            margin-bottom: 4px;
        }

        .ritual-stat-label {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            opacity: 0.7;
        }

        .ritual-actions {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .ritual-btn {
            padding: 10px 32px; /* Ajustado para 40px */
            background: var(--white);
            color: var(--black);
            border: none;
            border-radius: 20px; /* Pill completo */
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-fast);
            height: 40px; /* Altura uniforme */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .ritual-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(255, 255, 255, 0.3);
        }

        .ritual-btn.secondary {
            background: transparent;
            color: var(--white);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .ritual-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--white);
        }

        /* Seasonal Theme Variants */
        .ritual-overlay.spring {
            background: linear-gradient(135deg, rgba(34, 139, 34, 0.95) 0%, rgba(0, 0, 0, 0.95) 100%);
        }

        .ritual-overlay.summer {
            background: linear-gradient(135deg, rgba(255, 165, 0, 0.95) 0%, rgba(0, 0, 0, 0.95) 100%);
        }

        .ritual-overlay.autumn {
            background: linear-gradient(135deg, rgba(139, 69, 19, 0.95) 0%, rgba(0, 0, 0, 0.95) 100%);
        }

        .ritual-overlay.winter {
            background: linear-gradient(135deg, rgba(70, 130, 180, 0.95) 0%, rgba(0, 0, 0, 0.95) 100%);
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulseGlow {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.05);
            }
        }

        /* Milestone Badge */
        .milestone-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: var(--radius-pill);
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: var(--space-4);
            backdrop-filter: blur(10px);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MODALS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
            padding: var(--space-4);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--white);
            border-radius: var(--radius-xl);
            max-width: 680px;
            width: 92%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            position: relative;
            padding-right: 4px;
        }

        /* Custom scrollbar - Nike style subtle */
        .modal::-webkit-scrollbar {
            width: 6px;
        }

        .modal::-webkit-scrollbar-track {
            background: transparent;
            margin: var(--space-4) 0;
        }

        .modal::-webkit-scrollbar-thumb {
            background: var(--gray-300);
            border-radius: 3px;
        }

        .modal::-webkit-scrollbar-thumb:hover {
            background: var(--gray-400);
        }

        .modal-close {
            position: absolute;
            top: var(--space-4);
            right: var(--space-4);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--white);
            border: 1px solid var(--gray-300);
            border-radius: 50%;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 20px;
            color: var(--gray-700);
            line-height: 1;
            font-weight: 300;
            z-index: 10;
        }

        .modal-close:hover {
            background: var(--black);
            color: var(--white);
            border-color: var(--black);
            transform: rotate(90deg);
        }

        .modal-close:active {
            transform: rotate(90deg) scale(0.95);
        }

        .modal-header {
            padding: var(--space-5) var(--space-4) var(--space-3);
            border-bottom: 1px solid var(--gray-200);
            position: relative;
        }

        .modal-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--black);
            padding-right: var(--space-6);
        }

        .modal-body {
            padding: var(--space-4);
        }

        .form-group {
            margin-bottom: var(--space-4);
        }

        .form-label {
            display: block;
            font-size: 15px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: var(--space-1);
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-family: var(--font-system);
            font-size: 16px;
            transition: border-color var(--transition-fast);
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--black);
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        /* Image Upload Styles - NEW v15 */
        .form-input-file {
            width: 100%;
            padding: var(--space-3);
            font-size: 15px;
            font-family: var(--font-system);
            color: var(--gray-700);
            background: var(--gray-50);
            border: 2px dashed var(--gray-300);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .form-input-file:hover {
            background: var(--gray-100);
            border-color: var(--gray-400);
        }

        .form-input-file:focus {
            outline: none;
            border-color: var(--black);
            background: var(--white);
        }

        .image-preview {
            margin-top: var(--space-3);
        }

        .image-preview-container {
            position: relative;
            display: inline-block;
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-md);
        }

        .image-preview-img {
            display: block;
            max-width: 100%;
            height: auto;
            max-height: 300px;
            object-fit: contain;
        }

        .image-preview-remove {
            position: absolute;
            top: var(--space-2);
            right: var(--space-2);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.7);
            color: var(--white);
            border: none;
            border-radius: 50%;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: background var(--transition-base);
        }

        .image-preview-remove:hover {
            background: var(--black);
        }

        .form-actions {
            display: flex;
            gap: var(--space-2);
            justify-content: flex-end;
            padding: var(--space-4);
            border-top: 1px solid var(--gray-200);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ARCHETYPE SELECTOR - NIKE STYLE (NEW v14)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .archetype-selector {
            margin-bottom: var(--space-4);
        }

        .archetype-label {
            display: block;
            font-size: 15px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: var(--space-2);
        }

        .archetype-subtitle {
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: var(--space-3);
            line-height: 1.5;
        }

        .archetype-pills {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-2);
        }

        @media (min-width: 640px) {
            .archetype-pills {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .archetype-pill {
            padding: 10px 20px; /* Ajustado para 40px */
            border: 1px solid var(--gray-300);
            border-radius: 20px; /* Pill completo */
            background: var(--white);
            color: var(--black);
            font-family: var(--font-system);
            font-size: 14px;
            font-weight: 700;
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            user-select: none;
            height: 40px; /* Altura uniforme */
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .archetype-pill:hover {
            border-color: var(--black);
            background: var(--gray-50);
        }

        .archetype-pill.active {
            background: var(--black);
            color: var(--white);
            border-color: var(--black);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           COMMENTS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .comments-section {
            margin-top: var(--space-6);
            padding: var(--space-6) var(--space-4) var(--space-4);
            border-top: 1px solid var(--gray-200);
        }

        .comments-title {
            font-size: 20px;
            font-weight: 800;
            color: var(--black);
            margin-bottom: var(--space-4);
        }

        .comment-form {
            margin-bottom: var(--space-4);
        }

        .comment-input {
            width: 100%;
            padding: 14px 18px;
            border: 1.5px solid var(--gray-300);
            border-radius: var(--radius-lg);
            font-family: var(--font-system);
            font-size: 15px;
            line-height: 1.6;
            resize: vertical;
            min-height: 100px;
            margin-bottom: var(--space-3);
            transition: all var(--transition-base);
        }

        .comment-input:focus {
            outline: none;
            border-color: var(--black);
            box-shadow: 0 0 0 1px var(--black);
        }

        .comments-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .comment-card {
            padding: var(--space-3);
            background: var(--gray-50);
            border-radius: var(--radius-md);
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-2);
        }

        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        .comment-meta {
            flex: 1;
        }

        .comment-author {
            font-size: 14px;
            font-weight: 700;
            color: var(--black);
        }

        .comment-timestamp {
            font-size: 12px;
            font-weight: 500;
            color: var(--gray-500);
        }

        .comment-delete {
            padding: 4px 12px;
            background: transparent;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-sm);
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-600);
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .comment-delete:hover {
            background: var(--gray-100);
            border-color: var(--gray-400);
        }

        .comment-text {
            font-size: 15px;
            line-height: 1.5;
            color: var(--gray-800);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           DISCUSSION DETAIL
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        #postDetailContent {
            padding: var(--space-5);
        }

        .discussion-detail-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: var(--space-3);
            margin-bottom: var(--space-5);
            padding: var(--space-5) var(--space-4) 0;
        }

        .discussion-detail-meta {
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .discussion-detail-content {
            font-size: 17px;
            line-height: 1.8;
            color: var(--gray-800);
            margin-bottom: var(--space-5);
            padding: 0 var(--space-4);
        }

        .discussion-detail-footer {
            display: flex;
            gap: var(--space-4);
            padding: var(--space-3) 0;
            border-top: 1px solid var(--gray-200);
            border-bottom: 1px solid var(--gray-200);
            font-size: 15px;
            font-weight: 600;
            color: var(--gray-600);
        }

        .discussion-stat {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .discussion-actions {
            display: flex;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-4) var(--space-5);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           TOAST NOTIFICATIONS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        #toastContainer {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            pointer-events: none;
        }

        .toast {
            background: var(--black);
            color: var(--white);
            padding: var(--space-3) var(--space-5);
            border-radius: var(--radius-lg);
            font-size: 15px;
            font-weight: 600;
            box-shadow: var(--shadow-xl);
            animation: slideUpFade 0.3s ease;
            pointer-events: auto;
        }

        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SKELETON LOADERS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .skeleton {
            background: linear-gradient(90deg, var(--gray-200) 25%, var(--gray-100) 50%, var(--gray-200) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s ease-in-out infinite;
        }

        @keyframes skeleton-loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }

        .skeleton-feed {
            display: flex;
            flex-direction: column;
            gap: var(--space-4);
        }

        .skeleton-post {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .skeleton-post-header {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            padding: var(--space-3);
        }

        .skeleton-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
        }

        .skeleton-post-meta {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .skeleton-author {
            width: 120px;
            height: 16px;
            border-radius: 4px;
        }

        .skeleton-timestamp {
            width: 80px;
            height: 14px;
            border-radius: 4px;
        }

        .skeleton-image {
            width: 100%;
            height: 300px;
        }

        .skeleton-content {
            padding: var(--space-3);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .skeleton-text {
            height: 16px;
            border-radius: 4px;
        }

        .skeleton-text:last-child {
            width: 60%;
        }

        .skeleton-footer {
            padding: var(--space-3);
            border-top: 1px solid var(--gray-200);
        }

        .skeleton-stat {
            width: 100px;
            height: 14px;
            border-radius: 4px;
        }

        .skeleton-packs-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-4);
        }

        @media (min-width: 640px) {
            .skeleton-packs-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .skeleton-packs-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .skeleton-pack {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .skeleton-pack-image {
            width: 100%;
            height: 200px;
        }

        .skeleton-pack-content {
            padding: var(--space-3);
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }

        .skeleton-pack-title {
            width: 70%;
            height: 20px;
            border-radius: 4px;
        }

        .skeleton-pack-location {
            width: 40%;
            height: 14px;
            border-radius: 4px;
        }

        .skeleton-pack-description {
            width: 100%;
            height: 14px;
            border-radius: 4px;
        }

        .skeleton-pack-stats {
            display: flex;
            gap: var(--space-3);
        }

        .skeleton-pack-stat {
            width: 80px;
            height: 14px;
            border-radius: 4px;
        }

        .skeleton-pack-button {
            width: 100%;
            height: 48px;
            border-radius: var(--radius-pill);
            margin-top: var(--space-2);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           INBOX SYSTEM - Nike Minimalist Messaging
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* Inbox List View */
        .inbox-container {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .conversation-list {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .conversation-item {
            padding: var(--space-3);
            border-bottom: 1px solid var(--gray-200);
            cursor: pointer;
            transition: background-color var(--transition-fast);
        }

        .conversation-item:hover {
            background-color: var(--gray-50);
        }

        .conversation-item:last-child {
            border-bottom: none;
        }

        .conversation-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .conversation-name {
            font-size: 17px;
            font-weight: 700;
            color: var(--black);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .conversation-badge {
            width: 8px;
            height: 8px;
            background: var(--black);
            border-radius: 50%;
        }

        .conversation-timestamp {
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-500);
        }

        .conversation-preview {
            font-size: 15px;
            font-weight: 400;
            color: var(--gray-600);
            line-height: 1.4;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .conversation-preview.unread {
            font-weight: 600;
            color: var(--black);
        }

        /* Thread View */
        .thread-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 200px);
            min-height: 500px;
        }

        .thread-header {
            padding: var(--space-3) var(--space-4);
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            gap: var(--space-3);
            background: var(--white);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .thread-back-button {
            width: 40px;
            height: 40px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 24px;
            color: var(--black);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color var(--transition-fast);
            border-radius: 50%;
        }

        .thread-back-button:hover {
            background-color: var(--gray-100);
        }

        .thread-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--black);
            flex: 1;
        }

        .thread-messages {
            flex: 1;
            overflow-y: auto;
            padding: var(--space-4);
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
            background: var(--gray-50);
        }

        .message-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .message-group.sent {
            align-items: flex-end;
        }

        .message-group.received {
            align-items: flex-start;
        }

        .message-sender {
            font-size: 13px;
            font-weight: 700;
            color: var(--gray-700);
            margin-bottom: 6px;
            letter-spacing: 0.02em;
        }

        .message-bubble {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: var(--radius-md);
            font-size: 15px;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .message-bubble.sent {
            align-self: flex-end;
            background: var(--black);
            color: var(--white);
            border-bottom-right-radius: 4px;
        }

        .message-bubble.received {
            align-self: flex-start;
            background: var(--gray-100);
            color: var(--black);
            border-bottom-left-radius: 4px;
        }

        .message-timestamp {
            font-size: 12px;
            font-weight: 500;
            color: var(--gray-500);
            margin-top: 6px;
        }

        /* Thread Input - Nike Clean Style */
        .thread-input-container {
            padding: var(--space-4);
            border-top: 1px solid var(--gray-200);
            background: var(--white);
        }

        .thread-input-wrapper {
            display: flex;
            gap: var(--space-2);
            align-items: flex-end;
        }

        .thread-input {
            flex: 1;
            padding: var(--space-2) var(--space-3);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-lg);
            font-family: var(--font-system);
            font-size: 16px;
            font-weight: 400;
            line-height: 1.5;
            resize: vertical;
            min-height: 48px;
            max-height: 120px;
            transition: border-color var(--transition-fast);
        }

        .thread-input:focus {
            outline: none;
            border-color: var(--black);
        }

        .thread-input::placeholder {
            color: var(--gray-400);
        }

        .thread-send-button {
            padding: 10px 28px;
            background: var(--black);
            color: var(--white);
            border: none;
            border-radius: var(--radius-pill);
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
        }

        .thread-send-button:hover:not(:disabled) {
            opacity: 0.85;
            transform: translateY(-1px);
        }

        .thread-send-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .input-char-count {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-500);
            text-align: right;
            margin-top: 6px;
        }

        .input-char-count.warning {
            color: #FF0000;
        }

        /* Empty States - Nike Brutal Style */
        .inbox-empty-state {
            text-align: center;
            padding: var(--space-10) var(--space-4);
        }

        .empty-state-title {
            font-size: 32px;
            font-weight: 800;
            color: var(--black);
            margin-bottom: var(--space-3);
            letter-spacing: -0.02em;
        }

        .empty-state-text {
            font-size: 17px;
            font-weight: 400;
            color: var(--gray-600);
            margin-bottom: var(--space-5);
            line-height: 1.6;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .empty-state-cta {
            display: inline-block;
            padding: 14px 40px;
            background: var(--black);
            color: var(--white);
            text-decoration: none;
            border: none;
            border-radius: var(--radius-pill);
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .empty-state-cta:hover {
            opacity: 0.85;
            transform: translateY(-1px);
        }

        /* Message Entry Points */
        .message-entry-button {
            padding: 10px 24px;
            background: var(--white);
            color: var(--black);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-pill);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            white-space: nowrap;
        }

        .message-entry-button:hover {
            background: var(--black);
            color: var(--white);
            border-color: var(--black);
        }

        /* Tier Upgrade Toast */
        .tier-toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--black);
            color: var(--white);
            padding: var(--space-3) var(--space-5);
            border-radius: var(--radius-lg);
            font-size: 15px;
            font-weight: 600;
            box-shadow: var(--shadow-xl);
            z-index: 9999;
            animation: slideUpFade 0.3s ease;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           USER PROFILE MODAL - NIKE STYLE
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           USER PROFILE MODAL - OPTIMIZED (Nike-style)
           Based on expert panel consensus: Compact modal, practice-focused, no counters
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           USER PROFILE - PHASE 2 COMPLETE REDESIGN
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .user-profile-modal {
            max-width: 600px;
            margin: 0 auto;
        }
        
        @media (min-width: 768px) {
            .user-profile-modal {
                max-width: 700px;
            }
        }

        /* PHASE 2.1: Header Section */
        .user-profile-header {
            padding: var(--space-6) var(--space-4) var(--space-5);
            text-align: center;
            border-bottom: 1px solid var(--gray-200);
        }

        .user-profile-avatar-container {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto var(--space-3);
        }

        .user-profile-avatar {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--white);
            box-shadow: var(--shadow-lg);
        }

        .user-profile-name {
            font-size: 32px;
            font-weight: 900;
            color: var(--black);
            margin-bottom: var(--space-2);
            letter-spacing: -0.03em;
            line-height: 1.1;
        }
        
        @media (min-width: 768px) {
            .user-profile-name {
                font-size: 42px;
            }
        }
        
        .user-profile-meta {
            display: flex;
            justify-content: center;
            gap: var(--space-2);
            margin-bottom: var(--space-3);
        }
        
        .tier-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 16px;
            background: var(--black);
            color: var(--white);
            border-radius: var(--radius-pill);
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }
        
        .tier-badge.tier-essential { background: var(--gray-700); }
        .tier-badge.tier-flow { background: var(--black); }
        .tier-badge.tier-mastery { background: var(--gray-800); }
        .tier-badge.tier-mentorship { background: var(--black); }
        .tier-badge.tier-coach { background: var(--black); }

        .user-profile-archetypes {
            display: flex;
            justify-content: center;
            gap: var(--space-2);
            flex-wrap: wrap;
            margin-bottom: var(--space-3);
        }
        
        .archetype-pill {
            padding: 6px 14px;
            background: var(--gray-100);
            color: var(--gray-700);
            border-radius: var(--radius-pill);
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.02em;
        }
        
        .user-profile-location {
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: var(--space-1);
        }
        
        .user-profile-member-since {
            font-size: 13px;
            color: var(--gray-500);
            margin-bottom: var(--space-3);
        }

        .user-profile-bio {
            font-size: 15px;
            line-height: 1.6;
            color: var(--gray-700);
            margin: 0 auto var(--space-4);
            max-width: 480px;
        }
        
        .user-profile-actions {
            display: flex;
            justify-content: center;
            gap: var(--space-2);
            flex-wrap: wrap;
        }
        
        .user-profile-actions .btn {
            min-width: 140px;
        }
        
        @media (min-width: 768px) {
            .user-profile-actions .btn {
                min-width: 160px;
            }
        }

        /* PHASE 5: Profile Tab Navigation */
        .profile-tab-navigation {
            display: flex;
            justify-content: center;
            gap: var(--space-1);
            margin-top: var(--space-4);
            padding: var(--space-1);
            background: var(--gray-100);
            border-radius: var(--radius-pill);
        }
        
        .profile-tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-600);
            cursor: pointer;
            transition: all var(--transition-fast);
            border-radius: var(--radius-pill);
            white-space: nowrap;
        }
        
        .profile-tab:hover {
            color: var(--black);
        }
        
        .profile-tab.active {
            background: var(--white);
            color: var(--black);
            box-shadow: var(--shadow-sm);
        }
        
        @media (max-width: 480px) {
            .profile-tab {
                padding: 8px 14px;
                font-size: 13px;
            }
        }
        
        /* Tab Content */
        #profileTabContent {
            position: relative;
        }
        
        .profile-tab-pane {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .profile-tab-pane.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content-header {
            padding: var(--space-5) var(--space-4) var(--space-3);
            text-align: center;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .tab-content-title {
            font-size: 24px;
            font-weight: 900;
            margin-bottom: var(--space-1);
            letter-spacing: -0.02em;
        }
        
        .tab-content-desc {
            font-size: 14px;
            color: var(--gray-600);
        }
        
        /* Activity Tab */
        .activity-feed {
            padding: var(--space-4);
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }
        
        .activity-post-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            overflow: hidden;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .activity-post-card:hover {
            border-color: var(--black);
            box-shadow: var(--shadow-md);
        }
        
        .activity-post-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .activity-post-content {
            padding: var(--space-3);
        }
        
        .activity-post-text {
            font-size: 15px;
            line-height: 1.6;
            color: var(--gray-700);
            margin-bottom: var(--space-2);
        }
        
        .activity-post-meta {
            font-size: 13px;
            color: var(--gray-500);
        }
        
        /* Packs Tab */
        .packs-grid {
            padding: var(--space-4);
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: var(--space-3);
        }
        
        @media (min-width: 480px) {
            .packs-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .pack-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            overflow: hidden;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .pack-card:hover {
            border-color: var(--black);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .pack-card-image {
            width: 100%;
            height: 140px;
            object-fit: cover;
        }
        
        .pack-card-content {
            padding: var(--space-3);
        }
        
        .pack-card-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: var(--space-1);
            color: var(--black);
        }
        
        .pack-card-location {
            font-size: 13px;
            color: var(--gray-600);
            margin-bottom: 4px;
        }
        
        .pack-card-members {
            font-size: 13px;
            color: var(--gray-500);
        }

        /* PHASE 2.2: Stats Cards */
        .user-profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-3);
            padding: var(--space-5) var(--space-4);
            border-bottom: 1px solid var(--gray-200);
        }
        
        @media (min-width: 480px) {
            .user-profile-stats {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .user-profile-stat-card {
            text-align: center;
            padding: var(--space-3);
            background: var(--gray-50);
            border-radius: var(--radius-md);
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 900;
            color: var(--black);
            margin-bottom: var(--space-1);
            letter-spacing: -0.02em;
        }
        
        .stat-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* PHASE 2.3-2.5: Sections */
        .user-profile-section {
            padding: var(--space-5) var(--space-4);
            border-bottom: 1px solid var(--gray-200);
        }
        
        .user-profile-section:last-child {
            border-bottom: none;
        }
        
        .section-subtitle {
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-3);
            color: var(--black);
        }
        
        /* Practice Goals */
        .practice-goals-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }
        
        .practice-goal-item {
            padding: var(--space-2) var(--space-3);
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            font-size: 14px;
            color: var(--gray-700);
            line-height: 1.5;
        }
        
        /* Recent Posts */
        .user-recent-posts {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }
        
        .user-post-mini {
            padding: var(--space-3);
            background: var(--gray-50);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .user-post-mini:hover {
            background: var(--gray-100);
        }
        
        .post-mini-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-2);
        }
        
        .post-mini-text {
            font-size: 14px;
            line-height: 1.5;
            color: var(--gray-700);
            margin-bottom: var(--space-1);
        }
        
        .post-mini-meta {
            font-size: 12px;
            color: var(--gray-500);
        }
        
        /* Active Packs */
        .user-packs-scroll {
            display: flex;
            gap: var(--space-3);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: var(--space-2);
        }
        
        .user-packs-scroll::-webkit-scrollbar {
            height: 4px;
        }
        
        .user-packs-scroll::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 2px;
        }
        
        .user-packs-scroll::-webkit-scrollbar-thumb {
            background: var(--gray-400);
            border-radius: 2px;
        }
        
        .pack-mini-card {
            flex-shrink: 0;
            width: 200px;
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .pack-mini-card:hover {
            transform: translateY(-2px);
        }
        
        .pack-mini-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: var(--radius-md);
            margin-bottom: var(--space-2);
        }
        
        .pack-mini-name {
            font-size: 15px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: var(--space-1);
            line-height: 1.3;
        }
        
        .pack-mini-members {
            font-size: 13px;
            color: var(--gray-600);
        }

        /* Legacy styles cleanup - Keep for backwards compatibility */
        .user-profile-action {
            margin-bottom: var(--space-4);
        }

        .user-profile-action .btn {
            width: 100%;
            max-width: 240px;
            margin: 0 auto;
            padding: 14px 32px;
            font-size: 15px;
            font-weight: 700;
            border-radius: var(--radius-pill);
        }

        .user-profile-journey {
            padding: 0 var(--space-4);
            margin-bottom: var(--space-2);
        }

        .user-profile-journey-item {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-1);
            padding: var(--space-1) 0;
            font-size: 14px;
            color: var(--gray-600);
        }

        .user-profile-journey-item::before {
            content: "â€¢";
            color: var(--gray-400);
            font-weight: 700;
        }

        .user-profile-journey-item:first-child::before {
            content: "";
        }

        .user-profile-tier-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            background: var(--black);
            color: var(--white);
            border-radius: var(--radius-pill);
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .user-profile-section {
            padding: var(--space-5) var(--space-4) var(--space-4);
            border-top: 1px solid var(--gray-200);
        }

        .user-profile-section-title {
            font-size: 11px;
            font-weight: 800;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--gray-500);
            margin-bottom: var(--space-4);
        }

        .user-profile-presence-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-2);
            padding: var(--space-2) 0;
            font-size: 16px;
            color: var(--gray-700);
            line-height: 1.5;
        }

        .user-profile-presence-item::before {
            content: "â€¢";
            color: var(--black);
            font-weight: 700;
            margin-top: 2px;
        }

        .user-profile-practice-item {
            display: flex;
            align-items: flex-start;
            gap: var(--space-2);
            padding: var(--space-2) 0;
            font-size: 16px;
            color: var(--gray-700);
            line-height: 1.5;
        }

        .user-profile-practice-item::before {
            content: "â€¢";
            color: var(--black);
            font-weight: 700;
            margin-top: 2px;
        }

        @media (max-width: 480px) {
            .user-profile-name {
                font-size: 32px;
            }

            .user-profile-avatar-container {
                width: 88px;
                height: 88px;
            }
        }
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           WELCOME WIZARD STYLES (v24)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .wizard-step {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .archetype-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .archetype-card.selected {
            border-color: var(--black) !important;
            background: var(--white) !important;
        }
        
        .pack-suggestion:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--black);
            box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.1);
        }
        
        .btn-outline {
            background: transparent;
            color: var(--black);
            border: 1px solid var(--gray-300);
            border-radius: 20px; /* Pill completo */
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            height: 40px; /* Altura uniforme */
        }
        
        .btn-outline:hover {
            border-color: var(--black);
            background: var(--gray-100);
        }
        
        @media (max-width: 768px) {
            #welcomeWizard .modal-content {
                max-width: 100%;
                margin: 0;
                border-radius: 0;
                max-height: 100vh;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            #wizardStep1 > div,
            #wizardStep2 > div,
            #wizardStep3 > div,
            #wizardStep4 > div,
            #wizardStep5 > div {
                padding: 20px 16px 120px 16px !important;
                min-height: 100vh;
            }
            
            /* Archetype cards mobile optimization */
            .archetype-card {
                padding: 12px !important;
                margin-bottom: 10px !important;
            }
            
            .archetype-card h3 {
                font-size: 16px !important;
                margin-bottom: 2px !important;
            }
            
            .archetype-card p {
                font-size: 13px !important;
                line-height: 1.3 !important;
            }
            
            .archetype-icon {
                font-size: 24px !important;
            }
            
            /* Hero text mobile */
            .wizard-step h1,
            .wizard-step h2 {
                font-size: 28px !important;
                line-height: 1.1 !important;
                margin-bottom: 12px !important;
            }
            
            .wizard-step p {
                font-size: 14px !important;
            }
            
            /* Fixed buttons at bottom */
            .wizard-step button {
                position: fixed !important;
                left: 16px !important;
                right: 16px !important;
                width: calc(100% - 32px) !important;
                z-index: 100 !important;
                box-shadow: 0 -4px 12px rgba(0,0,0,0.1) !important;
            }
            
            .wizard-step .btn-primary {
                bottom: 70px !important;
            }
            
            .wizard-step .btn-outline {
                bottom: 16px !important;
                margin-top: 0 !important;
            }
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PHASE 3: PRIVATE PROFILE SECTIONS CSS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        /* Edit Profile Container */
        .edit-profile-container {
            padding: var(--space-5) var(--space-4);
        }
        
        .edit-profile-title {
            font-size: 28px;
            font-weight: 900;
            margin-bottom: var(--space-5);
            text-align: center;
            letter-spacing: -0.02em;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: var(--space-4);
        }
        
        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-2);
            color: var(--black);
        }
        
        .form-input,
        .form-textarea {
            width: 100%;
            padding: 12px 16px;
            font-size: 15px;
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-md);
            font-family: var(--font-system);
            transition: all var(--transition-fast);
        }
        
        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--black);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .form-hint {
            font-size: 12px;
            color: var(--gray-500);
            margin-top: var(--space-1);
        }
        
        /* Avatar Upload */
        .avatar-upload-area {
            display: flex;
            align-items: center;
            gap: var(--space-3);
        }
        
        .avatar-preview {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--gray-200);
        }
        
        /* Goal Input Rows */
        .goal-input-row {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-2);
        }
        
        .goal-input-row .form-input {
            flex: 1;
        }
        
        .btn-icon-remove {
            width: 40px;
            height: 40px;
            border: none;
            background: var(--gray-200);
            color: var(--gray-700);
            border-radius: var(--radius-md);
            font-size: 20px;
            cursor: pointer;
            transition: all var(--transition-fast);
            flex-shrink: 0;
        }
        
        .btn-icon-remove:hover {
            background: var(--black);
            color: var(--white);
        }
        
        /* Form Sections */
        .form-section {
            margin-top: var(--space-6);
            padding-top: var(--space-5);
            border-top: 1px solid var(--gray-200);
        }
        
        .form-section-title {
            font-size: 16px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-4);
        }
        
        /* Privacy Toggles */
        .privacy-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-3);
            margin-bottom: var(--space-2);
            background: var(--gray-50);
            border-radius: var(--radius-md);
        }
        
        .privacy-toggle-info {
            flex: 1;
        }
        
        .privacy-toggle-label {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .privacy-toggle-hint {
            font-size: 13px;
            color: var(--gray-600);
        }
        
        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 28px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--gray-300);
            transition: var(--transition-base);
            border-radius: 14px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: var(--white);
            transition: var(--transition-base);
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: var(--black);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(20px);
        }
        
        /* Form Actions */
        .form-actions {
            display: flex;
            gap: var(--space-2);
            margin-top: var(--space-6);
            padding-top: var(--space-5);
            border-top: 1px solid var(--gray-200);
        }
        
        .form-actions .btn {
            flex: 1;
        }
        
        /* Bookings Container */
        .bookings-container,
        .threads-container,
        .membership-container {
            padding: var(--space-4);
        }
        
        .bookings-header,
        .threads-header,
        .membership-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-5);
        }
        
        .btn-back {
            background: none;
            border: none;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            color: var(--gray-700);
            padding: 8px;
            transition: color var(--transition-fast);
        }
        
        .btn-back:hover {
            color: var(--black);
        }
        
        .page-title {
            font-size: 28px;
            font-weight: 900;
            letter-spacing: -0.02em;
        }
        
        /* Bookings List */
        .bookings-section {
            margin-bottom: var(--space-6);
        }
        
        .bookings-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }
        
        .booking-card {
            padding: var(--space-4);
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
        }
        
        .booking-past {
            opacity: 0.6;
        }
        
        .booking-coach {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-3);
        }
        
        .booking-coach-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .booking-coach-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .booking-type {
            font-size: 13px;
            color: var(--gray-600);
        }
        
        .booking-details {
            margin-bottom: var(--space-3);
            padding: var(--space-2);
            background: var(--gray-50);
            border-radius: var(--radius-sm);
        }
        
        .booking-datetime {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .booking-duration {
            font-size: 13px;
            color: var(--gray-600);
        }
        
        .booking-actions {
            display: flex;
            gap: var(--space-2);
        }
        
        /* Threads List */
        .threads-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }
        
        .thread-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-4);
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
        }
        
        .thread-card:hover {
            border-color: var(--black);
            background: var(--gray-50);
        }
        
        .thread-info {
            flex: 1;
        }
        
        .thread-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: var(--space-1);
        }
        
        .thread-meta {
            font-size: 13px;
            color: var(--gray-600);
        }
        
        .thread-unread-badge {
            width: 28px;
            height: 28px;
            background: var(--black);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
        }
        
        /* Membership Styles */
        .current-tier-card {
            text-align: center;
            padding: var(--space-6);
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-5);
        }
        
        .tier-badge.tier-large {
            font-size: 14px;
            padding: 8px 20px;
            margin-bottom: var(--space-3);
        }
        
        .current-tier-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: var(--space-2);
        }
        
        .current-tier-desc {
            font-size: 15px;
            color: var(--gray-600);
        }
        
        .membership-section {
            margin-bottom: var(--space-5);
            padding-bottom: var(--space-5);
            border-bottom: 1px solid var(--gray-200);
        }
        
        .membership-section:last-child {
            border-bottom: none;
        }
        
        .benefits-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }
        
        .benefit-item {
            padding: var(--space-2) var(--space-3);
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            font-size: 14px;
        }
        
        .upgrade-card {
            padding: var(--space-4);
            background: var(--black);
            color: var(--white);
            border-radius: var(--radius-md);
            text-align: center;
        }
        
        .upgrade-card p {
            margin-bottom: var(--space-3);
            font-size: 15px;
        }
        
        .upgrade-card .btn-primary {
            background: var(--white);
            color: var(--black);
        }
        
        .upgrade-card .btn-primary:hover {
            background: var(--gray-100);
        }
        
        .max-tier-message {
            padding: var(--space-4);
            background: var(--gray-50);
            border-radius: var(--radius-md);
            text-align: center;
            font-size: 15px;
            color: var(--gray-700);
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: var(--space-8) var(--space-4);
            color: var(--gray-600);
        }
        
        .empty-state p {
            margin-bottom: var(--space-3);
            font-size: 15px;
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           PHASE 4: COACH-SPECIFIC SECTIONS CSS
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .coach-section {
            background: var(--gray-50);
        }
        
        /* Coach Stats Grid */
        .coach-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-3);
        }
        
        @media (min-width: 480px) {
            .coach-stats-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .coach-stat-card {
            text-align: center;
            padding: var(--space-3);
            background: var(--white);
            border-radius: var(--radius-md);
            border: 1px solid var(--gray-200);
        }
        
        .coach-stat-value {
            font-size: 24px;
            font-weight: 900;
            color: var(--black);
            margin-bottom: var(--space-1);
            letter-spacing: -0.02em;
        }
        
        .coach-stat-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Specialties & Info */
        .coach-specialties {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
            margin-bottom: var(--space-4);
        }
        
        .specialty-tag {
            padding: 8px 16px;
            background: var(--white);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-pill);
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-700);
        }
        
        .coach-info-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-3);
            margin-bottom: var(--space-4);
        }
        
        .coach-info-item {
            padding: var(--space-3);
            background: var(--white);
            border-radius: var(--radius-md);
            border: 1px solid var(--gray-200);
        }
        
        .coach-info-label {
            display: block;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--gray-600);
            margin-bottom: var(--space-1);
        }
        
        .coach-info-value {
            display: block;
            font-size: 18px;
            font-weight: 700;
            color: var(--black);
        }
        
        .coach-certifications {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
        }
        
        .certification-badge {
            padding: var(--space-2) var(--space-3);
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            font-size: 13px;
            font-weight: 600;
            color: var(--gray-700);
        }
        
        /* Reviews Section */
        .rating-summary {
            margin-bottom: var(--space-4);
            padding: var(--space-4);
            background: var(--white);
            border-radius: var(--radius-md);
            text-align: center;
        }
        
        .rating-average {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-1);
        }
        
        .rating-number {
            font-size: 48px;
            font-weight: 900;
            letter-spacing: -0.03em;
            line-height: 1;
        }
        
        .rating-stars {
            font-size: 24px;
            color: var(--black);
            letter-spacing: 2px;
        }
        
        .rating-count {
            font-size: 13px;
            color: var(--gray-600);
        }
        
        .reviews-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }
        
        .review-card {
            padding: var(--space-4);
            background: var(--white);
            border-radius: var(--radius-md);
            border: 1px solid var(--gray-200);
        }
        
        .review-header {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-3);
        }
        
        .review-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .review-author-info {
            flex: 1;
        }
        
        .review-author {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .review-rating {
            font-size: 14px;
            color: var(--black);
        }
        
        .review-date {
            font-size: 12px;
            color: var(--gray-500);
        }
        
        .review-text {
            font-size: 14px;
            line-height: 1.6;
            color: var(--gray-700);
        }
        
        /* Availability Preview */
        .availability-preview {
            padding: var(--space-4);
            background: var(--white);
            border-radius: var(--radius-md);
            border: 1px solid var(--gray-200);
        }
        
        .availability-info {
            margin-bottom: var(--space-3);
        }
        
        .availability-status {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: var(--space-1);
        }
        
        .next-available {
            font-size: 13px;
            color: var(--gray-600);
        }
        
        /* Mentorships Summary */
        .mentorships-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-4);
            background: var(--white);
            border-radius: var(--radius-md);
            border: 1px solid var(--gray-200);
        }
        
        .mentorship-stat {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .mentorship-stat-value {
            font-size: 28px;
            font-weight: 900;
            letter-spacing: -0.02em;
        }
        
        .mentorship-stat-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Mentorships Container (for viewMyMentorships) */
        .mentorships-container {
            padding: var(--space-4);
        }
        
        .mentorships-header {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-5);
        }
        
        .mentorships-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }
        
        .mentorship-card {
            padding: var(--space-4);
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
        }
        
        .mentorship-student {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            margin-bottom: var(--space-3);
        }
        
        .mentorship-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .mentorship-student-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .mentorship-focus {
            font-size: 13px;
            color: var(--gray-600);
        }
        
        .mentorship-progress {
            display: flex;
            gap: var(--space-4);
            padding: var(--space-3);
            background: var(--gray-50);
            border-radius: var(--radius-sm);
            margin-bottom: var(--space-3);
        }
        
        .mentorship-actions {
            display: flex;
            gap: var(--space-2);
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           LOADING SKELETONS - API Integration v29 (PASO 4a)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        /* Skeleton Animation */
        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }

        .skeleton {
            background: linear-gradient(
                90deg,
                var(--gray-100) 0%,
                var(--gray-200) 50%,
                var(--gray-100) 100%
            );
            background-size: 1000px 100%;
            animation: shimmer 2s infinite linear;
            border-radius: var(--radius-sm);
        }

        /* Skeleton Coach Card */
        .skeleton-coach-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            display: flex;
            flex-direction: column;
            gap: var(--space-3);
        }

        .skeleton-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
        }

        .skeleton-text {
            height: 16px;
            border-radius: var(--radius-sm);
        }

        .skeleton-text-lg {
            height: 24px;
            width: 60%;
        }

        .skeleton-text-md {
            height: 20px;
            width: 80%;
        }

        .skeleton-text-sm {
            height: 14px;
            width: 40%;
        }

        .skeleton-button {
            height: 48px;
            width: 100%;
            border-radius: var(--radius-pill);
        }

        /* Skeleton Grid Layout */
        .skeleton-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: var(--space-4);
        }

        @media (min-width: 768px) {
            .skeleton-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .skeleton-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid var(--gray-200);
            border-top-color: var(--black);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-spinner-lg {
            width: 48px;
            height: 48px;
            border-width: 4px;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: var(--space-3);
            z-index: 10;
        }

        .loading-overlay-text {
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-600);
        }

        /* Error State */
        .error-state {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            text-align: center;
        }

        .error-state-icon {
            font-size: 48px;
            margin-bottom: var(--space-3);
        }

        .error-state-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--black);
            margin-bottom: var(--space-2);
        }

        .error-state-message {
            font-size: 15px;
            color: var(--gray-600);
            margin-bottom: var(--space-4);
            line-height: 1.6;
        }

        .error-state-actions {
            display: flex;
            gap: var(--space-2);
            justify-content: center;
            flex-wrap: wrap;
        }

        /* Retry Button */
        .retry-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            padding: 12px 24px;
            background: var(--black);
            color: var(--white);
            border: none;
            border-radius: var(--radius-pill);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
        }

        .retry-btn:hover {
            background: var(--gray-800);
            transform: translateY(-2px);
        }

        .retry-btn:active {
            transform: translateY(0);
        }

        .retry-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           TRAINING TAB v1 - Nike Run Club Inspired Styling
           Complete implementation with white-dominant design, full-photo cards
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           AUTHENTICATION GATE
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .training-auth-gate {
            padding: var(--space-12) var(--space-4);
            text-align: center;
            min-height: calc(100vh - 120px);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .training-auth-content {
            max-width: 480px;
            margin: 0 auto;
        }

        .training-auth-title {
            font-size: clamp(48px, 10vw, 72px);
            font-weight: 900;
            letter-spacing: -0.03em;
            margin-bottom: var(--space-3);
            line-height: 0.95;
        }

        .training-auth-subtitle {
            font-size: 18px;
            color: var(--gray-600);
            margin-bottom: var(--space-6);
            line-height: 1.5;
        }

        .training-auth-buttons {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            align-items: center; /* Center buttons */
        }

        .training-auth-buttons .btn {
            min-width: 160px; /* More compact like Nike */
            max-width: 280px;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           PROGRAM SELECTION VIEW
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .training-program-selection {
            padding: var(--space-4) 0;
        }

        .training-header {
            padding: 0 var(--space-4) var(--space-4) var(--space-4);
        }

        .training-main-title {
            font-size: clamp(32px, 8vw, 48px);
            font-weight: 900;
            letter-spacing: -0.02em;
            margin-bottom: var(--space-1);
        }

        .training-subtitle {
            font-size: 16px;
            color: var(--gray-600);
        }

        /* Program Cards - Full-width photo cards with overlay */
        .training-program-card {
            margin-bottom: var(--space-6);
            border-radius: 0; /* No border-radius in mobile, Nike style */
            overflow: hidden;
            background: var(--white);
        }

        .training-program-image {
            position: relative;
            width: 100%;
            aspect-ratio: 16 / 9;
            overflow: hidden;
        }

        .training-program-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .training-program-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: var(--space-4);
            background: linear-gradient(180deg, transparent 0%, rgba(0,0,0,0.85) 100%);
            color: var(--white);
        }

        .training-program-badge {
            display: inline-block;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.05em;
            padding: 4px 12px;
            background: rgba(255,255,255,0.2);
            border-radius: 12px;
            margin-bottom: var(--space-2);
        }

        .training-program-title {
            font-size: clamp(28px, 6vw, 36px);
            font-weight: 900;
            letter-spacing: -0.02em;
            margin-bottom: var(--space-1);
            line-height: 1.1;
        }

        .training-program-meta {
            font-size: 14px;
            opacity: 0.9;
        }

        .training-program-lock {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .training-lock-content {
            text-align: center;
            color: var(--white);
        }

        .training-lock-icon {
            width: 48px;
            height: 48px;
            margin-bottom: var(--space-2);
            opacity: 0.8;
        }

        .training-lock-text {
            font-size: 16px;
            font-weight: 600;
        }

        .training-program-details {
            padding: var(--space-4);
            text-align: center; /* Center content */
        }

        .training-program-details .btn {
            /* Buttons fit to content, Nike-compact */
            min-width: 160px;
        }

        .training-program-description {
            font-size: 16px;
            line-height: 1.6;
            color: var(--gray-700);
            margin-bottom: var(--space-4);
            text-align: left; /* Keep description left-aligned */
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ACTIVE PROGRAM VIEW
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .training-active-program {
            padding: var(--space-2) 0;
        }

        .training-active-header {
            padding: 0 var(--space-4) var(--space-4) var(--space-4);
        }

        .training-back-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--space-1);
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: var(--gray-700);
            cursor: pointer;
            padding: 0;
            margin-bottom: var(--space-3);
            transition: color var(--transition-fast);
        }

        .training-back-btn:hover {
            color: var(--black);
        }

        .training-back-btn svg {
            width: 20px;
            height: 20px;
        }

        .training-active-title {
            font-size: clamp(24px, 6vw, 32px);
            font-weight: 900;
            letter-spacing: -0.02em;
            margin-bottom: var(--space-2);
        }

        .training-active-progress {
            margin-top: var(--space-3);
        }

        .training-progress-text {
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }

        .training-progress-divider {
            opacity: 0.5;
        }

        .training-progress-bar {
            width: 100%;
            height: 4px;
            background: var(--gray-200);
            border-radius: 2px;
            overflow: hidden;
        }

        .training-progress-fill {
            height: 100%;
            background: var(--black);
            border-radius: 2px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Today's Session Hero Card */
        .training-session-hero {
            margin: 0 0 var(--space-6) 0;
            cursor: pointer;
        }

        .training-session-image {
            position: relative;
            width: 100%;
            aspect-ratio: 16 / 9;
            overflow: hidden;
            border-radius: 0;
        }

        .training-session-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: transform 0.3s ease;
        }

        .training-session-hero:hover .training-session-image img {
            transform: scale(1.02);
        }

        .training-session-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: var(--space-4);
            background: linear-gradient(180deg, transparent 30%, rgba(0,0,0,0.9) 100%);
            color: var(--white);
        }

        .training-session-label {
            display: block;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            opacity: 0.8;
            margin-bottom: var(--space-1);
        }

        .training-session-title {
            font-size: clamp(24px, 5vw, 32px);
            font-weight: 900;
            letter-spacing: -0.02em;
            margin-bottom: var(--space-1);
            line-height: 1.1;
        }

        .training-session-meta {
            font-size: 14px;
            opacity: 0.9;
        }

        .training-continue-btn {
            margin: var(--space-4) auto 0 auto; /* Centered */
            display: block;
            /* Width auto-fits to content */
        }

        /* Week Overview */
        .training-week-overview {
            padding: var(--space-6) var(--space-4);
            border-top: 1px solid var(--gray-200);
        }

        .training-week-title {
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--gray-600);
            margin-bottom: var(--space-3);
        }

        .training-week-days {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-2);
        }

        .training-day-item {
            text-align: center;
            padding: var(--space-2);
            border-radius: var(--radius-sm);
            background: var(--gray-50);
        }

        .training-day-number {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-500);
            margin-bottom: var(--space-1);
        }

        .training-day-status {
            width: 32px;
            height: 32px;
            margin: 0 auto;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .training-day-item.completed .training-day-status {
            background: var(--black);
            color: var(--white);
        }

        .training-day-item.current .training-day-status {
            background: var(--black);
            color: var(--white);
            animation: pulse 2s ease-in-out infinite;
        }

        .training-day-item.locked .training-day-status {
            background: transparent;
            border: 2px solid var(--gray-300);
            color: var(--gray-400);
        }

        .training-day-label {
            font-size: 11px;
            color: var(--gray-500);
            margin-top: var(--space-1);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        /* Milestone Section */
        .training-milestone {
            padding: var(--space-4);
            background: var(--gray-50);
            margin: 0 var(--space-4) var(--space-6) var(--space-4);
            border-radius: var(--radius-md);
        }

        .training-milestone-label {
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--gray-600);
            margin-bottom: var(--space-1);
        }

        .training-milestone-text {
            font-size: 16px;
            font-weight: 600;
            color: var(--black);
        }

        /* Recent Sessions */
        .training-recent-section {
            padding: 0 var(--space-4) var(--space-6) var(--space-4);
            border-top: 1px solid var(--gray-200);
            padding-top: var(--space-4);
        }

        .training-recent-toggle {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: none;
            border: none;
            padding: var(--space-2) 0;
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--gray-600);
            transition: color var(--transition-fast);
        }

        .training-recent-toggle:hover {
            color: var(--black);
        }

        .training-toggle-icon {
            transition: transform var(--transition-base);
        }

        .training-recent-toggle.active .training-toggle-icon {
            transform: rotate(180deg);
        }

        .training-recent-list {
            padding-top: var(--space-3);
        }

        .training-recent-item {
            padding: var(--space-2) 0;
            font-size: 14px;
            color: var(--gray-700);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .training-recent-item::before {
            content: "â€¢";
            margin-right: var(--space-2);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           SESSION DETAIL VIEW
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .training-session-detail {
            min-height: 100vh;
            padding-bottom: 120px;
        }

        .training-detail-header {
            padding: var(--space-4);
            border-bottom: 1px solid var(--gray-200);
        }

        .training-detail-content {
            padding: var(--space-4);
        }

        .training-detail-label {
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--gray-600);
            margin-bottom: var(--space-2);
        }

        .training-detail-title {
            font-size: clamp(28px, 7vw, 42px);
            font-weight: 900;
            letter-spacing: -0.03em;
            line-height: 1.1;
            margin-bottom: var(--space-2);
        }

        .training-detail-meta {
            font-size: 14px;
            color: var(--gray-600);
            margin-bottom: var(--space-6);
        }

        /* Video Container */
        .training-video-container {
            margin-bottom: var(--space-6);
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .training-video-placeholder {
            position: relative;
            width: 100%;
            aspect-ratio: 16 / 9;
            overflow: hidden;
            cursor: pointer;
        }

        .training-video-cover {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .training-video-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4); /* Dark overlay */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: background var(--transition-fast);
        }

        .training-video-placeholder:hover .training-video-overlay {
            background: rgba(0, 0, 0, 0.6); /* Darker on hover */
        }

        .training-play-icon {
            color: var(--white);
            margin-bottom: var(--space-2);
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.3));
        }

        .training-video-text {
            font-size: 14px;
            font-weight: 700;
            letter-spacing: 0.05em;
            color: var(--white);
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* Session Content Sections */
        .training-detail-section {
            margin-bottom: var(--space-6);
        }

        .training-detail-section-title {
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--gray-600);
            margin-bottom: var(--space-3);
        }

        .training-detail-text {
            font-size: 16px;
            line-height: 1.6;
            color: var(--gray-700);
        }

        .training-structure-list {
            list-style: none;
            padding: 0;
        }

        .training-structure-list li {
            padding: var(--space-2) 0;
            font-size: 16px;
            line-height: 1.6;
            color: var(--gray-700);
            border-bottom: 1px solid var(--gray-100);
        }

        .training-structure-list li:last-child {
            border-bottom: none;
        }

        /* Detail Footer (Fixed Complete Button) */
        .training-detail-footer {
            position: fixed;
            bottom: 80px;
            left: 0;
            right: 0;
            padding: var(--space-4);
            background: linear-gradient(180deg, transparent 0%, var(--white) 20%);
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .training-detail-footer .btn {
            width: 100%;
            max-width: 400px;
        }

        .training-detail-warning {
            text-align: center;
            font-size: 12px;
            color: var(--gray-500);
            margin-top: var(--space-2);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           COMPLETION MODAL
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .training-completion-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: var(--space-4);
        }

        .training-completion-content {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: var(--space-6);
            max-width: 480px;
            width: 100%;
        }

        .training-completion-title {
            font-size: clamp(28px, 6vw, 36px);
            font-weight: 900;
            text-align: center;
            margin-bottom: var(--space-2);
        }

        .training-completion-message {
            text-align: center;
            font-size: 16px;
            font-style: italic;
            color: var(--gray-700);
            margin-bottom: var(--space-6);
        }

        .training-observation-section {
            margin-bottom: var(--space-6);
        }

        .training-observation-label {
            display: block;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: var(--gray-600);
            margin-bottom: var(--space-2);
        }

        .training-observation-input {
            width: 100%;
            padding: var(--space-3);
            border: 1px solid var(--gray-300);
            border-radius: var(--radius-sm);
            font-family: var(--font-system);
            font-size: 16px;
            line-height: 1.5;
            resize: vertical;
            transition: border-color var(--transition-fast);
        }

        .training-observation-input:focus {
            outline: none;
            border-color: var(--black);
        }

        .training-completion-buttons {
            display: flex;
            gap: var(--space-2);
        }

        .training-completion-buttons .btn {
            flex: 1;
            pointer-events: auto;
            cursor: pointer;
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           CELEBRATION SCREEN (Day 48)
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .training-celebration {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--black);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: var(--space-6);
        }

        .training-celebration-content {
            text-align: center;
            max-width: 600px;
        }

        .training-celebration-program {
            font-size: 18px;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            opacity: 0.7;
            margin-bottom: var(--space-2);
        }

        .training-celebration-title {
            font-size: clamp(56px, 12vw, 96px);
            font-weight: 900;
            letter-spacing: -0.04em;
            line-height: 0.9;
            margin-bottom: var(--space-3);
        }

        .training-celebration-days {
            font-size: clamp(32px, 8vw, 56px);
            font-weight: 700;
            margin-bottom: var(--space-6);
            opacity: 0.8;
        }

        .training-celebration-message {
            font-size: 18px;
            font-style: italic;
            line-height: 1.6;
            opacity: 0.9;
            margin-bottom: var(--space-8);
        }

        .training-celebration-buttons {
            display: flex;
            flex-direction: column;
            gap: var(--space-2);
            align-items: center; /* Center buttons */
        }

        .training-celebration-buttons .btn {
            min-width: 200px; /* Slightly larger for celebration */
            max-width: 320px;
        }

        .training-celebration-buttons .btn-primary {
            background: var(--white);
            color: var(--black);
        }

        .training-celebration-buttons .btn-primary:hover {
            background: var(--gray-200);
        }

        .training-celebration-buttons .btn-outline {
            border-color: var(--white);
            color: var(--white);
        }

        .training-celebration-buttons .btn-outline:hover {
            background: rgba(255,255,255,0.1);
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           RESPONSIVE ADJUSTMENTS
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        @media (min-width: 768px) {
            .training-program-selection,
            .training-active-program,
            .training-session-detail {
                max-width: 720px;
                margin: 0 auto;
            }

            .training-week-days {
                gap: var(--space-3);
            }

            .training-session-image,
            .training-program-image {
                border-radius: var(--radius-md);
            }

            .training-program-card {
                border-radius: var(--radius-md); /* Rounded corners only on desktop */
            }

            .training-continue-btn {
                max-width: 240px; /* Nike compact */
                margin: var(--space-4) auto 0 auto;
            }
        }

        @media (min-width: 1024px) {
            .training-program-selection,
            .training-active-program,
            .training-session-detail {
                max-width: 860px;
            }
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           STRIPE PAYMENT MODAL - Nike Brutal Minimalism
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           UPGRADE MODAL - Nike Brutal Minimalism + Mobile-First
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .upgrade-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0; /* Full bleed on mobile */
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .upgrade-modal-backdrop {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85); /* Darker Nike overlay */
            backdrop-filter: blur(8px);
        }

        .upgrade-modal-content {
            position: relative;
            background: var(--white);
            width: 100%;
            height: 100%; /* Full height on mobile */
            max-height: none;
            overflow-y: auto;
            border-radius: 0; /* Sharp corners - Nike style */
            padding: var(--space-8) var(--space-4); /* More vertical breathing room */
        }

        .upgrade-modal-close {
            position: absolute;
            top: var(--space-4);
            right: var(--space-4);
            background: transparent;
            border: none;
            font-size: 32px;
            font-weight: 300;
            color: var(--black);
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-base);
            line-height: 1;
            z-index: 10;
        }

        .upgrade-modal-close:hover {
            transform: rotate(90deg);
            opacity: 0.6;
        }

        .upgrade-modal-header {
            text-align: left; /* Left-aligned - Nike style */
            margin-bottom: var(--space-8); /* More space */
            max-width: 600px; /* Constrain for readability */
        }

        .upgrade-modal-title {
            font-family: var(--font-system);
            font-size: 36px; /* Bigger, bolder */
            font-weight: 700;
            letter-spacing: -0.02em;
            color: var(--black);
            margin: 0 0 var(--space-3) 0;
            text-transform: uppercase;
            line-height: 1.1;
        }

        .upgrade-modal-subtitle {
            font-family: var(--font-system);
            font-size: 18px; /* Larger subtitle */
            font-weight: 400;
            color: var(--gray-600);
            margin: 0;
            line-height: 1.5;
        }

        .upgrade-modal-body {
            display: grid;
            grid-template-columns: 1fr; /* Stacked on mobile */
            gap: var(--space-6); /* More breathing room */
            margin-bottom: var(--space-8);
        }

        .upgrade-tier-card {
            background: var(--white);
            border: 2px solid var(--gray-200); /* Thicker border */
            padding: var(--space-6);
            transition: all var(--transition-base);
        }

        .upgrade-tier-card:hover {
            border-color: var(--black);
            transform: translateY(-2px); /* Subtle lift */
        }

        .upgrade-tier-header {
            margin-bottom: var(--space-6); /* More space */
        }

        .upgrade-tier-name {
            font-family: var(--font-system);
            font-size: 28px; /* Bigger */
            font-weight: 700;
            letter-spacing: -0.01em;
            color: var(--black);
            margin: 0 0 var(--space-2) 0;
            text-transform: uppercase;
        }

        .upgrade-tier-price {
            display: flex;
            align-items: baseline;
            gap: 6px;
            margin-bottom: var(--space-2);
        }

        .upgrade-tier-amount {
            font-family: var(--font-system);
            font-size: 48px; /* Much bigger pricing */
            font-weight: 700;
            letter-spacing: -0.03em;
            color: var(--black);
            line-height: 1;
        }

        .upgrade-tier-period {
            font-family: var(--font-system);
            font-size: 18px;
            font-weight: 400;
            color: var(--gray-600);
        }

        .upgrade-tier-features {
            margin-bottom: var(--space-6);
            padding-top: var(--space-4);
            border-top: 1px solid var(--gray-200); /* Top border instead of individual borders */
        }

        .upgrade-feature {
            font-family: var(--font-system);
            font-size: 16px; /* Slightly bigger */
            font-weight: 400;
            color: var(--gray-700);
            padding: var(--space-2) 0; /* Less padding */
            line-height: 1.6;
        }

        .upgrade-feature:last-child {
            border-bottom: none;
        }

        .upgrade-tier-button {
            margin-top: 0; /* Remove extra margin */
            height: 40px; /* Standard HUDEN button height */
            line-height: 40px;
            font-size: 15px; /* Standard font size */
            font-weight: 500; /* Standard weight */
        }

        .upgrade-requirement {
            font-family: var(--font-system);
            font-size: 14px;
            font-weight: 400;
            color: var(--gray-500);
            text-align: center;
            margin: var(--space-3) 0 0 0;
        }

        .upgrade-modal-footer {
            text-align: center;
            padding-top: var(--space-6);
            border-top: 1px solid var(--gray-200);
        }

        .upgrade-footer-note {
            font-family: var(--font-system);
            font-size: 14px;
            font-weight: 400;
            color: var(--gray-600);
            margin: 0;
        }

        /* Desktop: Side-by-side cards */
        @media (min-width: 768px) {
            .upgrade-modal {
                padding: var(--space-4); /* Add padding on desktop */
            }

            .upgrade-modal-content {
                height: auto; /* Auto height on desktop */
                max-height: 90vh;
                border-radius: 8px; /* Subtle rounding on desktop */
                padding: var(--space-8) var(--space-7);
                max-width: 1100px; /* Max width for desktop */
            }

            .upgrade-modal-body {
                grid-template-columns: 1fr 1fr;
                gap: var(--space-6);
            }

            .upgrade-modal-title {
                font-size: 48px; /* Even bigger on desktop */
            }

            .upgrade-modal-subtitle {
                font-size: 20px;
            }

            .upgrade-modal-header {
                text-align: center; /* Center on desktop */
                max-width: 100%;
            }
        }

        /* Large Desktop: More breathing room */
        @media (min-width: 1024px) {
            .upgrade-modal-content {
                padding: var(--space-10) var(--space-8);
            }

            .upgrade-tier-card {
                padding: var(--space-7);
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SCHEDULE CONFIGURATION MODAL (v46 - Custom Training Schedule)
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .schedule-config-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: var(--space-4);
        }

        .schedule-config-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .schedule-config-header {
            padding: var(--space-6);
            border-bottom: 1px solid var(--gray-200);
        }

        .schedule-config-header h2 {
            font-size: 24px;
            font-weight: 700;
            margin: 0;
        }

        .schedule-config-body {
            padding: var(--space-6);
        }

        .schedule-section {
            margin-bottom: var(--space-6);
        }

        .schedule-label {
            display: block;
            font-size: 13px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--gray-600);
            margin-bottom: var(--space-3);
        }

        .frequency-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: var(--space-2);
        }

        .frequency-btn {
            background: white;
            border: 2px solid var(--gray-300);
            border-radius: 12px;
            padding: var(--space-4);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .frequency-btn:hover {
            border-color: var(--gray-900);
        }

        .frequency-btn.active {
            background: var(--gray-900);
            border-color: var(--gray-900);
            color: white;
        }

        .frequency-number {
            font-size: 32px;
            font-weight: 700;
            line-height: 1;
        }

        .frequency-text {
            font-size: 12px;
            font-weight: 400;
            opacity: 0.7;
        }

        .frequency-note {
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            opacity: 0.5;
            position: absolute;
            bottom: 8px;
        }

        .frequency-btn.active .frequency-note {
            opacity: 0.8;
        }

        .day-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: var(--space-2);
        }

        .day-btn {
            background: white;
            border: 2px solid var(--gray-300);
            border-radius: 12px;
            padding: var(--space-3);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .day-btn:hover {
            border-color: var(--gray-900);
        }

        .day-btn.active {
            background: var(--gray-900);
            border-color: var(--gray-900);
            color: white;
        }

        .day-btn.disabled {
            opacity: 0.3;
            cursor: not-allowed;
            pointer-events: none;
        }

        .day-abbr {
            font-size: 14px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .day-name {
            font-size: 11px;
            font-weight: 400;
            opacity: 0.7;
        }

        .day-btn.active .day-name {
            opacity: 0.9;
        }

        .schedule-helper {
            font-size: 13px;
            color: var(--gray-600);
            margin-top: var(--space-2);
            text-align: center;
        }

        .schedule-info {
            background: var(--gray-100);
            border-radius: 12px;
            padding: var(--space-4);
            margin-bottom: var(--space-4);
        }

        .schedule-info-text {
            font-size: 15px;
            text-align: center;
            margin: 0;
        }

        .schedule-actions {
            display: flex;
            gap: var(--space-3);
            margin-top: var(--space-6);
        }

        .schedule-actions .btn {
            flex: 1;
        }

        @media (max-width: 768px) {
            .frequency-options {
                grid-template-columns: repeat(3, 1fr);
            }

            .day-selector {
                grid-template-columns: repeat(4, 1fr);
            }

            .frequency-btn {
                padding: var(--space-3);
            }

            .frequency-number {
                font-size: 24px;
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CUSTOM MODAL SYSTEM (v48 - Replace Native Dialogs)
           Nike-inspired brutal minimalism
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        .custom-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            padding: var(--space-4);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .custom-modal-overlay.show {
            opacity: 1;
        }

        .custom-modal {
            background: white;
            border-radius: 0;
            width: 100%;
            max-width: 440px;
            transform: scale(0.95);
            transition: transform 0.2s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .custom-modal-overlay.show .custom-modal {
            transform: scale(1);
        }

        .custom-modal-header {
            padding: var(--space-6) var(--space-6) var(--space-4) var(--space-6);
        }

        .custom-modal-title {
            font-size: 20px;
            font-weight: 700;
            letter-spacing: -0.01em;
            margin: 0;
            color: var(--black);
            text-transform: uppercase;
        }

        .custom-modal-body {
            padding: 0 var(--space-6) var(--space-6) var(--space-6);
        }

        .custom-modal-message {
            font-size: 15px;
            line-height: 1.5;
            color: rgba(0, 0, 0, 0.85);
            margin: 0;
            white-space: pre-line;
        }

        .custom-modal-actions {
            padding: var(--space-4) var(--space-6) var(--space-6) var(--space-6);
            display: flex;
            gap: var(--space-3);
        }

        .custom-modal-actions .btn {
            flex: 1;
            min-height: 48px;
            font-size: 15px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .custom-modal-actions .btn-primary {
            background: var(--black);
            color: white;
        }

        .custom-modal-actions .btn-primary:hover {
            background: rgba(0, 0, 0, 0.85);
        }

        .custom-modal-actions .btn-secondary {
            background: var(--gray-200);
            color: var(--black);
        }

        .custom-modal-actions .btn-secondary:hover {
            background: var(--gray-300);
        }

        /* Responsive */
        @media (max-width: 640px) {
            .custom-modal {
                max-width: 100%;
                width: calc(100% - 32px);
            }

            .custom-modal-actions {
                flex-direction: column;
            }

            .custom-modal-actions .btn {
                width: 100%;
            }
        }


    </style>
</head>
<body>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         WISDOM LIBRARY THRESHOLD - SACRED SPACE ENTRANCE
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         ROLE SELECTOR - TESTING TOOL (Ctrl+R)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    
    <div class="role-selector-overlay" id="roleSelectorOverlay">
        <div class="role-selector-panel">
            <div class="role-selector-header">
                <div class="role-selector-title">Testing Mode</div>
                <div class="role-selector-subtitle">Switch user tier for development</div>
            </div>

            <div class="role-selector-current">
                <div class="role-selector-current-label">Current Tier</div>
                <div class="role-selector-current-value" id="currentTierDisplay">FLOW</div>
            </div>

            <div class="role-selector-buttons">
                <button class="role-selector-button" data-tier="essential" onclick="switchRole('essential')">
                    <span class="role-selector-button-tier">Essential</span>
                    <span class="role-selector-button-desc">Basic access</span>
                </button>
                <button class="role-selector-button" data-tier="flow" onclick="switchRole('flow')">
                    <span class="role-selector-button-tier">Flow</span>
                    <span class="role-selector-button-desc">Pack chat enabled</span>
                </button>
                <button class="role-selector-button" data-tier="mastery" onclick="switchRole('mastery')">
                    <span class="role-selector-button-tier">Mastery</span>
                    <span class="role-selector-button-desc">Full DM access</span>
                </button>
                <button class="role-selector-button" data-tier="mentorship" onclick="switchRole('mentorship')">
                    <span class="role-selector-button-tier">Mentorship</span>
                    <span class="role-selector-button-desc">Premium mentorship access</span>
                </button>
                <button class="role-selector-button" data-tier="coach" onclick="switchRole('coach')">
                    <span class="role-selector-button-tier">Coach</span>
                    <span class="role-selector-button-desc">Full platform access</span>
                </button>
            </div>

            <div class="role-selector-footer">
                <div class="role-selector-hint">Press <strong>Ctrl+R</strong> or <strong>ESC</strong> to close</div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         VIDEO CALL INTERFACE - Full Screen (v31)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="video-call-container" id="videoCallContainer">
        <div class="video-grid single" id="videoGrid">
            <div class="video-participant">
                <video id="localVideo" autoplay muted playsinline></video>
                <div class="participant-info">
                    <span class="participant-name">You</span>
                    <span class="participant-status" id="localMicStatus"></span>
                </div>
            </div>
            <div class="video-participant" id="remoteVideoWrapper" style="display: none;">
                <video id="remoteVideo" autoplay playsinline></video>
                <div class="participant-info">
                    <span class="participant-name" id="remoteName">Coach</span>
                    <span class="participant-status" id="remoteMicStatus"></span>
                </div>
            </div>
        </div>
        <div class="video-controls">
            <button class="video-control-btn" id="toggleMicBtn" aria-label="Toggle microphone">ğŸ¤</button>
            <button class="video-control-btn" id="toggleVideoBtn" aria-label="Toggle camera">ğŸ“¹</button>
            <button class="video-control-btn danger" id="endCallBtn" aria-label="End call">ğŸ“</button>
            <button class="video-control-btn" id="toggleScreenBtn" aria-label="Share screen">ğŸ–¥ï¸</button>
            <button class="video-control-btn" id="toggleChatBtn" aria-label="Open chat">ğŸ’¬</button>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         VIDEO BOOKING MODAL - Schedule Remote Session (v31)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="video-booking-modal" id="videoBookingModal">
        <div class="video-booking-content">
            <button class="modal-close" id="closeBookingModal" aria-label="Close">Ã—</button>
            <div class="video-booking-header">
                <h2 class="video-booking-title">Book Video Session</h2>
                <p class="video-booking-subtitle">Schedule a remote 1-on-1 with your coach</p>
            </div>
            <div class="video-booking-body">
                <div class="booking-form-group">
                    <label class="booking-form-label" for="coachSelect">Coach</label>
                    <select class="booking-form-select" id="coachSelect">
                        <option value="">Select a coach</option>
                        <option value="coach1">Sarah Chen â€“ Movement Specialist</option>
                        <option value="coach2">Marcus Silva â€“ Somatic Coach</option>
                        <option value="coach3">Elena Rodriguez â€“ Integration Guide</option>
                    </select>
                </div>
                <div class="booking-form-group">
                    <label class="booking-form-label" for="sessionDate">Date</label>
                    <input type="date" class="booking-form-input" id="sessionDate" min="">
                </div>
                <div class="booking-form-group">
                    <label class="booking-form-label">Available Times (CET)</label>
                    <div class="time-slots-grid" id="timeSlotsGrid">
                        <button class="time-slot-btn" data-time="09:00">09:00</button>
                        <button class="time-slot-btn" data-time="10:00">10:00</button>
                        <button class="time-slot-btn" data-time="11:00">11:00</button>
                        <button class="time-slot-btn" data-time="14:00">14:00</button>
                        <button class="time-slot-btn" data-time="15:00">15:00</button>
                        <button class="time-slot-btn" data-time="16:00">16:00</button>
                        <button class="time-slot-btn" data-time="17:00">17:00</button>
                        <button class="time-slot-btn" data-time="18:00">18:00</button>
                    </div>
                </div>
                <div class="booking-form-group">
                    <label class="booking-form-label" for="sessionType">Session Type</label>
                    <select class="booking-form-select" id="sessionType">
                        <option value="intro">Introductory Session (30 min)</option>
                        <option value="regular">Regular Session (60 min)</option>
                        <option value="intensive">Intensive Session (90 min)</option>
                    </select>
                </div>
                <div class="booking-form-group">
                    <label class="booking-form-label" for="sessionNotes">Session Focus (Optional)</label>
                    <textarea class="booking-form-textarea" id="sessionNotes" placeholder="What would you like to work on?"></textarea>
                </div>
                <div class="booking-summary" id="bookingSummary" style="display: none;">
                    <div class="booking-summary-title">Session Summary</div>
                    <div class="booking-summary-item">
                        <span class="booking-summary-label">Coach</span>
                        <span class="booking-summary-value" id="summaryCoach">â€“</span>
                    </div>
                    <div class="booking-summary-item">
                        <span class="booking-summary-label">Date & Time</span>
                        <span class="booking-summary-value" id="summaryDateTime">â€“</span>
                    </div>
                    <div class="booking-summary-item">
                        <span class="booking-summary-label">Duration</span>
                        <span class="booking-summary-value" id="summaryDuration">â€“</span>
                    </div>
                </div>
                <div style="display: flex; gap: var(--space-2); margin-top: var(--space-4);">
                    <button class="btn btn-secondary" id="cancelBookingBtn" style="flex: 1;">Cancel</button>
                    <button class="btn btn-primary" id="confirmBookingBtn" style="flex: 1;" disabled>Confirm Booking</button>
                </div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         MENTORSHIP REQUEST MODAL (v32)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="mentorship-request-modal" id="mentorshipRequestModal">
        <div class="mentorship-request-content">
            <button class="modal-close" id="closeMentorshipRequest" aria-label="Close">Ã—</button>
            
            <div class="mentorship-request-header">
                <h2 class="mentorship-request-title">Request Mentorship</h2>
                <p class="mentorship-request-subtitle">
                    Begin a 3-month journey of embodied practice and somatic inquiry
                </p>
            </div>
            
            <div class="mentorship-request-body">
                <!-- Coach Info -->
                <div class="request-coach-card" id="requestCoachCard">
                    <img src="https://images.unsplash.com/photo-1568602471122-7832951cc4c5?w=400&q=80" 
                         alt="Coach" class="request-coach-avatar" id="requestCoachAvatar">
                    <div class="request-coach-info">
                        <div class="request-coach-name" id="requestCoachName">Marcus Rivera</div>
                        <div class="request-coach-details" id="requestCoachDetails">
                            Barcelona, Spain Â· Outdoor & Trauma-Informed
                        </div>
                    </div>
                </div>

                <!-- About You -->
                <div class="request-section">
                    <h3 class="request-section-title">About Your Practice</h3>
                    <p class="request-section-description">
                        Help your mentor understand where you are in your journey
                    </p>
                    
                    <div class="request-form-group">
                        <label class="request-form-label" for="currentExperience">
                            Current Experience Level
                        </label>
                        <select class="request-form-select" id="currentExperience">
                            <option value="">Select experience level</option>
                            <option value="beginner">Beginner â€“ New to natural movement</option>
                            <option value="intermediate">Intermediate â€“ 6+ months regular practice</option>
                            <option value="advanced">Advanced â€“ 2+ years consistent practice</option>
                        </select>
                    </div>

                    <div class="request-form-group">
                        <label class="request-form-label" for="practiceHistory">
                            Movement Background
                        </label>
                        <p class="request-form-hint">
                            Previous training, injuries, current limitations, what draws you to this work
                        </p>
                        <textarea class="request-form-textarea" id="practiceHistory" 
                                  placeholder="Share your movement history and what brings you to seek mentorship..."></textarea>
                    </div>
                </div>

                <!-- Goals & Intentions -->
                <div class="request-section">
                    <h3 class="request-section-title">Your Intentions</h3>
                    
                    <div class="request-form-group">
                        <label class="request-form-label" for="mentorshipGoals">
                            What do you hope to tribe in this mentorship?
                        </label>
                        <p class="request-form-hint">
                            Focus on questions and curiosities rather than specific outcomes
                        </p>
                        <textarea class="request-form-textarea" id="mentorshipGoals" 
                                  placeholder="What questions are alive in your practice right now?"></textarea>
                    </div>

                    <div class="request-form-group">
                        <label class="request-form-label">Areas of Focus (select all that apply)</label>
                        <div class="request-checkbox-group">
                            <label class="request-checkbox-item">
                                <input type="checkbox" name="focus" value="groundwork">
                                <span class="request-checkbox-label">Groundwork & Floor Movement</span>
                            </label>
                            <label class="request-checkbox-item">
                                <input type="checkbox" name="focus" value="suspension">
                                <span class="request-checkbox-label">Suspension & Hanging</span>
                            </label>
                            <label class="request-checkbox-item">
                                <input type="checkbox" name="focus" value="integration">
                                <span class="request-checkbox-label">Integration & Daily Practice</span>
                            </label>
                            <label class="request-checkbox-item">
                                <input type="checkbox" name="focus" value="trauma">
                                <span class="request-checkbox-label">Trauma-Informed Exploration</span>
                            </label>
                            <label class="request-checkbox-item">
                                <input type="checkbox" name="focus" value="outdoor">
                                <span class="request-checkbox-label">Outdoor & Natural Environments</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Availability & Commitment -->
                <div class="request-section">
                    <h3 class="request-section-title">Availability & Commitment</h3>
                    
                    <div class="request-form-group">
                        <label class="request-form-label" for="sessionFrequency">
                            Preferred Session Frequency
                        </label>
                        <select class="request-form-select" id="sessionFrequency">
                            <option value="">Select frequency</option>
                            <option value="weekly">Weekly (12 sessions over 3 months)</option>
                            <option value="biweekly">Bi-weekly (6 sessions over 3 months)</option>
                            <option value="flexible">Flexible schedule</option>
                        </select>
                    </div>

                    <div class="request-form-group">
                        <label class="request-form-label" for="timezone">Your Timezone</label>
                        <input type="text" class="request-form-input" id="timezone" 
                               placeholder="e.g., CET, EST, PST">
                    </div>

                    <div class="request-form-group">
                        <label class="request-form-label" for="bestTimes">
                            Best Times for Sessions
                        </label>
                        <input type="text" class="request-form-input" id="bestTimes" 
                               placeholder="e.g., Weekday mornings, Weekend afternoons">
                    </div>
                </div>

                <!-- Commitment Agreement -->
                <div class="commitment-box">
                    <h4 class="commitment-box-title">Mentorship Commitment</h4>
                    <ul class="commitment-box-list">
                        <li>3-month journey (renewable by mutual agreement)</li>
                        <li>Regular 1-on-1 sessions via video call</li>
                        <li>Async support between sessions</li>
                        <li>Practice assignments and reflection prompts</li>
                        <li>Access to private mentorship threads</li>
                        <li>Recording of sessions for personal review</li>
                    </ul>
                </div>

                <!-- Investment -->
                <div class="investment-summary">
                    <div class="investment-summary-row">
                        <span class="investment-summary-label">Duration</span>
                        <span class="investment-summary-value">3 Months</span>
                    </div>
                    <div class="investment-summary-row">
                        <span class="investment-summary-label">Session Type</span>
                        <span class="investment-summary-value" id="sessionTypeDisplay">Weekly 1-on-1</span>
                    </div>
                    <div class="investment-summary-row">
                        <span class="investment-summary-label">Video Platform</span>
                        <span class="investment-summary-value">Zoom (link provided)</span>
                    </div>
                    <div class="investment-summary-row investment-total">
                        <span>Investment</span>
                        <span id="investmentAmount">â‚¬750</span>
                    </div>
                </div>

                <!-- Actions -->
                <div class="request-actions">
                    <button class="btn btn-secondary" id="cancelMentorshipRequest" style="flex: 1;">
                        Cancel
                    </button>
                    <button class="btn btn-primary" id="submitMentorshipRequest" style="flex: 2;">
                        Submit Request
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         WELCOME WIZARD - ONBOARDING FLOW (v24)
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    
    <div id="welcomeWizard" class="modal-overlay" style="display: none; z-index: 10000;">
        <div class="modal-content" style="max-width: 720px; padding: 0; overflow: hidden;">
            
            <!-- Progress Bar -->
            <div style="background: var(--gray-200); height: 4px; width: 100%;">
                <div id="wizardProgress" style="background: var(--black); height: 100%; width: 20%; transition: width 0.3s ease;"></div>
            </div>
            
            <!-- Step 1: Welcome -->
            <div id="wizardStep1" class="wizard-step" style="display: block;">
                <div style="padding: 64px 48px; text-align: center;">
                    <div style="width: 80px; height: 80px; background: var(--black); border-radius: 50%; margin: 0 auto 32px; display: flex; align-items: center; justify-content: center;">
                        <svg width="40" height="40" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="50" r="30" stroke="#FFFFFF" stroke-width="6" fill="none"/>
                            <circle cx="50" cy="50" r="18" stroke="#FFFFFF" stroke-width="6" fill="none"/>
                            <circle cx="50" cy="50" r="8" fill="#FFFFFF"/>
                        </svg>
                    </div>
                    
                    <h2 style="font-size: 36px; font-weight: 900; letter-spacing: -0.03em; margin-bottom: 16px;">Welcome to TRIBE</h2>
                    <p style="font-size: 18px; color: var(--gray-600); margin-bottom: 48px; max-width: 500px; margin-left: auto; margin-right: auto;">
                        This is not a fitness app. This is not about performance.
                    </p>
                    
                    <div style="background: var(--gray-100); padding: 32px; border-radius: 16px; text-align: left; margin-bottom: 48px;">
                        <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 16px;">The HUDEN Philosophy</h3>
                        <p style="font-size: 15px; line-height: 1.7; color: var(--gray-700); margin-bottom: 12px;">
                            <strong>Observe</strong> without fixing.<br>
                            <strong>Stay Present</strong> with what is.<br>
                            <strong>Find Balance</strong> between instinct, sensation, and thought.
                        </p>
                        <p style="font-size: 15px; line-height: 1.7; color: var(--gray-700);">
                            TRIBE is where practitioners gatherâ€”not to compete, but to move together, share reflections, and honor each other's journey.
                        </p>
                    </div>
                    
                    <button onclick="nextWizardStep()" class="btn-primary" style="width: 100%; padding: 18px; font-size: 16px;">
                        Begin Your Journey
                    </button>
                </div>
            </div>
            
            <!-- Step 2: Archetype Selection -->
            <div id="wizardStep2" class="wizard-step" style="display: none;">
                <div style="padding: 48px;">
                    <h2 style="font-size: 32px; font-weight: 900; letter-spacing: -0.03em; margin-bottom: 12px;">Discover Your Archetypes</h2>
                    <p style="font-size: 16px; color: var(--gray-600); margin-bottom: 32px;">
                        Select the movement patterns that call to you. You can choose multiple.
                    </p>
                    
                    <div id="archetypeSelection" style="display: grid; gap: 16px; margin-bottom: 48px;">
                        <!-- Gorilla -->
                        <div class="archetype-card" data-archetype="gorilla" onclick="toggleArchetype('gorilla')" style="background: var(--gray-100); padding: 24px; border-radius: 12px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s ease;">
                            <div style="display: flex; align-items: center; gap: 16px;">
                                <div class="archetype-icon" style="font-size: 32px;">ğŸ¦</div>
                                <div style="flex: 1;">
                                    <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">Gorilla</h3>
                                    <p style="font-size: 14px; color: var(--gray-600);">Power & Ground â€” Strength, stability, rooted presence</p>
                                </div>
                                <div class="archetype-check" style="display: none; font-size: 24px; font-weight: 700;">âœ“</div>
                            </div>
                        </div>
                        
                        <!-- Gibbon -->
                        <div class="archetype-card" data-archetype="gibbon" onclick="toggleArchetype('gibbon')" style="background: var(--gray-100); padding: 24px; border-radius: 12px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s ease;">
                            <div style="display: flex; align-items: center; gap: 16px;">
                                <div class="archetype-icon" style="font-size: 32px;">ğŸ’</div>
                                <div style="flex: 1;">
                                    <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">Gibbon</h3>
                                    <p style="font-size: 14px; color: var(--gray-600);">Flow & Suspension â€” Grace, swinging, aerial fluidity</p>
                                </div>
                                <div class="archetype-check" style="display: none; font-size: 24px; font-weight: 700;">âœ“</div>
                            </div>
                        </div>
                        
                        <!-- Orangutan -->
                        <div class="archetype-card" data-archetype="orangutan" onclick="toggleArchetype('orangutan')" style="background: var(--gray-100); padding: 24px; border-radius: 12px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s ease;">
                            <div style="display: flex; align-items: center; gap: 16px;">
                                <div class="archetype-icon" style="font-size: 32px;">ğŸ¦§</div>
                                <div style="flex: 1;">
                                    <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">Orangutan</h3>
                                    <p style="font-size: 14px; color: var(--gray-600);">Integration & Core â€” Balance, coordination, adaptive movement</p>
                                </div>
                                <div class="archetype-check" style="display: none; font-size: 24px; font-weight: 700;">âœ“</div>
                            </div>
                        </div>
                        
                        <!-- Chimpanzee -->
                        <div class="archetype-card" data-archetype="chimpanzee" onclick="toggleArchetype('chimpanzee')" style="background: var(--gray-100); padding: 24px; border-radius: 12px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s ease;">
                            <div style="display: flex; align-items: center; gap: 16px;">
                                <div class="archetype-icon" style="font-size: 32px;">ğŸµ</div>
                                <div style="flex: 1;">
                                    <h3 style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">Chimpanzee</h3>
                                    <p style="font-size: 14px; color: var(--gray-600);">Play & Explosiveness â€” Joy, agility, spontaneous movement</p>
                                </div>
                                <div class="archetype-check" style="display: none; font-size: 24px; font-weight: 700;">âœ“</div>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="nextWizardStep()" class="btn-primary" style="width: 100%; padding: 18px; font-size: 16px;">
                        Continue
                    </button>
                    <button onclick="prevWizardStep()" class="btn-outline" style="width: 100%; margin-top: 12px; padding: 16px; font-size: 14px;">
                        Back
                    </button>
                </div>
            </div>
            
            <!-- Step 3: Profile Setup -->
            <div id="wizardStep3" class="wizard-step" style="display: none;">
                <div style="padding: 48px;">
                    <h2 style="font-size: 32px; font-weight: 900; letter-spacing: -0.03em; margin-bottom: 12px;">Create Your Profile</h2>
                    <p style="font-size: 16px; color: var(--gray-600); margin-bottom: 32px;">
                        Share who you are with the tribe.
                    </p>
                    
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">Display Name</label>
                        <input id="wizardName" type="text" placeholder="Your name" class="input-field" style="width: 100%; padding: 14px 16px; border: 1px solid var(--gray-300); border-radius: 8px; font-size: 16px;">
                    </div>
                    
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">Location</label>
                        <input id="wizardLocation" type="text" placeholder="City, Country" class="input-field" style="width: 100%; padding: 14px 16px; border: 1px solid var(--gray-300); border-radius: 8px; font-size: 16px;">
                    </div>
                    
                    <div style="margin-bottom: 32px;">
                        <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">Personal Statement</label>
                        <textarea id="wizardBio" placeholder="Why are you here? What are you exploring in your practice?" class="input-field" style="width: 100%; padding: 14px 16px; border: 1px solid var(--gray-300); border-radius: 8px; font-size: 16px; min-height: 120px; resize: vertical;"></textarea>
                        <p style="font-size: 13px; color: var(--gray-500); margin-top: 8px; font-style: italic;">
                            This is about your practice, not your achievements.
                        </p>
                    </div>
                    
                    <button onclick="nextWizardStep()" class="btn-primary" style="width: 100%; padding: 18px; font-size: 16px;">
                        Continue
                    </button>
                    <button onclick="prevWizardStep()" class="btn-outline" style="width: 100%; margin-top: 12px; padding: 16px; font-size: 14px;">
                        Back
                    </button>
                </div>
            </div>
            
            <!-- Step 4: Practice Focus -->
            <div id="wizardStep4" class="wizard-step" style="display: none;">
                <div style="padding: 48px;">
                    <h2 style="font-size: 32px; font-weight: 900; letter-spacing: -0.03em; margin-bottom: 12px;">Your Practice Focus</h2>
                    <p style="font-size: 16px; color: var(--gray-600); margin-bottom: 32px;">
                        What are you currently working with? (Optional)
                    </p>
                    
                    <div style="margin-bottom: 24px;">
                        <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">Current Path</label>
                        <select id="wizardPath" class="input-field" style="width: 100%; padding: 14px 16px; border: 1px solid var(--gray-300); border-radius: 8px; font-size: 16px;">
                            <option value="">Select your path...</option>
                            <option value="essential">Essential Path (Months 1-3)</option>
                            <option value="flow">Flow Path (Months 4-6)</option>
                            <option value="mastery">Mastery Path (Months 7-12)</option>
                            <option value="free">Free Practice</option>
                        </select>
                    </div>
                    
                    <div style="margin-bottom: 32px;">
                        <label style="display: block; font-size: 14px; font-weight: 600; margin-bottom: 8px;">What I'm exploring</label>
                        <textarea id="wizardExploring" placeholder="Fear, balance, presence, community..." class="input-field" style="width: 100%; padding: 14px 16px; border: 1px solid var(--gray-300); border-radius: 8px; font-size: 16px; min-height: 100px; resize: vertical;"></textarea>
                    </div>
                    
                    <button onclick="nextWizardStep()" class="btn-primary" style="width: 100%; padding: 18px; font-size: 16px;">
                        Continue
                    </button>
                    <button onclick="prevWizardStep()" class="btn-outline" style="width: 100%; margin-top: 12px; padding: 16px; font-size: 14px;">
                        Back
                    </button>
                </div>
            </div>
            
            <!-- Step 5: First Pack Suggestion -->
            <div id="wizardStep5" class="wizard-step" style="display: none;">
                <div style="padding: 48px;">
                    <h2 style="font-size: 32px; font-weight: 900; letter-spacing: -0.03em; margin-bottom: 12px;">Find Your Pack</h2>
                    <p style="font-size: 16px; color: var(--gray-600); margin-bottom: 32px;">
                        Packs are local tribes where you'll train, gather, and grow together.
                    </p>
                    
                    <div id="suggestedPacks" style="display: grid; gap: 16px; margin-bottom: 48px;">
                        <!-- Packs will be dynamically loaded -->
                    </div>
                    
                    <button onclick="completeWizard()" class="btn-primary" style="width: 100%; padding: 18px; font-size: 16px;">
                        Enter TRIBE
                    </button>
                    <button onclick="skipPacks()" class="btn-outline" style="width: 100%; margin-top: 12px; padding: 16px; font-size: 14px;">
                        Skip for Now
                    </button>
                </div>
            </div>
            
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         RITUAL & CEREMONY SYSTEM - FASE 4 v27
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    
    <div id="ritualOverlay" class="ritual-overlay">
        <div class="ritual-content">
            <div id="ritualIcon" class="ritual-icon">ğŸ”¥</div>
            <div id="ritualBadge" class="milestone-badge"></div>
            <h1 id="ritualTitle" class="ritual-title"></h1>
            <p id="ritualSubtitle" class="ritual-subtitle"></p>
            
            <div id="ritualReflection" class="ritual-reflection" style="display: none;">
                <p class="ritual-reflection-text" id="ritualReflectionText"></p>
            </div>
            
            <div id="ritualStats" class="ritual-stats" style="display: none;"></div>
            
            <div class="ritual-actions">
                <button class="ritual-btn" onclick="closeRitual()">Continue Journey</button>
                <button class="ritual-btn secondary" onclick="shareRitual()">Share This Moment</button>
            </div>
        </div>
    </div>

    <!-- HERO SECTION -->
    <div class="hero-section">
        <!-- Hero Carousel Container -->
        <div class="hero-carousel" id="heroCarousel">
            <img src="https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?w=1920&q=80" alt="Hero background" class="hero-background hero-slide active" data-index="0">
            <img src="https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=1920&q=80" alt="Hero background" class="hero-background hero-slide" data-index="1">
            <img src="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=1920&q=80" alt="Hero background" class="hero-background hero-slide" data-index="2">
        </div>
        
        <!-- Hero Content (Fijo) -->
        <div class="hero-content hero-content-centered">
            <h1 class="hero-title" id="heroTitle">HUDEN</h1>
            <div class="hero-subtitle" id="heroSubtitle">School of conscious movement</div>
            <button class="hero-cta" onclick="openModal('joinModal')">Join</button>
        </div>
        
        <!-- Pause Button - Bottom Right (Ultra minimal) -->
        <button class="hero-pause-btn" id="heroPauseBtn" onclick="toggleHeroCarousel()" aria-label="Pause carousel">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
        </button>
    </div>

    <!-- HOME TAB -->
    <div id="homeTab" class="tab-panel active">
        <!-- Nike Horizontal Carousel -->
        <section class="nike-carousel-section">
            <div class="nike-carousel-header">
                <h2 class="nike-carousel-title">Technical design, refined for everyday.</h2>
                <div class="nike-carousel-nav">
                    <button class="nike-carousel-nav-btn" onclick="scrollCarousel(-1)" aria-label="Previous">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 18l-6-6 6-6"/>
                        </svg>
                    </button>
                    <button class="nike-carousel-nav-btn" onclick="scrollCarousel(1)" aria-label="Next">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 18l6-6-6-6"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="nike-carousel-track-container">
                <div class="nike-carousel-track" id="nikeCarouselTrack">
                    <!-- Item 1 -->
                    <div class="nike-carousel-item" onclick="openArticle('running-retro')">
                        <img src="https://images.unsplash.com/photo-1465447142348-e9952c393450?w=600&q=85" alt="Running retro" class="nike-carousel-item-image">
                        <span class="nike-carousel-item-label">Running retro</span>
                    </div>
                    
                    <!-- Item 2 -->
                    <div class="nike-carousel-item" onclick="openArticle('look-football')">
                        <img src="https://images.unsplash.com/photo-1461896836934-ffe607ba8211?w=600&q=85" alt="Look of Football" class="nike-carousel-item-image">
                        <span class="nike-carousel-item-label">Look of Football</span>
                    </div>
                    
                    <!-- Item 3 -->
                    <div class="nike-carousel-item" onclick="openArticle('all-conditions')">
                        <img src="https://images.unsplash.com/photo-1483721310020-03333e577078?w=600&q=85" alt="All Conditions Gear" class="nike-carousel-item-image">
                        <span class="nike-carousel-item-label">All Conditions Gear</span>
                    </div>
                    
                    <!-- Item 4 -->
                    <div class="nike-carousel-item" onclick="openArticle('urban-style')">
                        <img src="https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=600&q=85" alt="Urban Style" class="nike-carousel-item-image">
                        <span class="nike-carousel-item-label">Urban Style</span>
                    </div>
                    
                    <!-- Item 5 -->
                    <div class="nike-carousel-item" onclick="openArticle('performance-wear')">
                        <img src="https://images.unsplash.com/photo-1556906781-9a412961c28c?w=600&q=85" alt="Performance Wear" class="nike-carousel-item-image">
                        <span class="nike-carousel-item-label">Performance Wear</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Grid de Posts debajo del Hero - Nike Design -->
        <div class="home-posts-grid">
            <!-- Card 1: Winter Training -->
            <article class="home-post-card" onclick="openArticle('winter-training')">
                <img src="https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=1200&q=85" alt="Winter Training" class="home-post-image">
                <div class="home-post-overlay">
                    <p class="home-post-label">For cold days</p>
                    <h3 class="home-post-title">Primal Winter Movement</h3>
                    <button class="home-post-cta">Explore</button>
                </div>
            </article>

            <!-- Card 2: Natural Strength -->
            <article class="home-post-card" onclick="openArticle('natural-strength')">
                <img src="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=1200&q=85" alt="Natural Strength" class="home-post-image">
                <div class="home-post-overlay">
                    <p class="home-post-label">Build foundation</p>
                    <h3 class="home-post-title">Natural Strength</h3>
                    <button class="home-post-cta">Explore</button>
                </div>
            </article>

            <!-- Card 3: Ground Flow -->
            <article class="home-post-card" onclick="openArticle('ground-flow')">
                <img src="https://images.unsplash.com/photo-1518611012118-696072aa579a?w=1200&q=85" alt="Ground Flow" class="home-post-image">
                <div class="home-post-overlay">
                    <p class="home-post-label">Connect to earth</p>
                    <h3 class="home-post-title">Ground Flow Practice</h3>
                    <button class="home-post-cta">Explore</button>
                </div>
            </article>

            <!-- Card 4: Outdoor Movement -->
            <article class="home-post-card" onclick="openArticle('outdoor-movement')">
                <img src="https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?w=1200&q=85" alt="Outdoor Movement" class="home-post-image">
                <div class="home-post-overlay">
                    <p class="home-post-label">Nature as gym</p>
                    <h3 class="home-post-title">Wild Training</h3>
                    <button class="home-post-cta">Explore</button>
                </div>
            </article>
        </div>
    </div>

    <!-- TRIBE TAB (MASTER) -->
    <div id="tribeTab" class="tab-panel">
        
        <!-- TRIBE Header with Navigation - Nike Style -->
        <div class="tribe-header-nav">
            <h2 class="tribe-header-title">TRIBE</h2>
            <nav class="tribe-nav-tabs">
                <button class="tribe-nav-tab active" onclick="switchTRIBESection('feed')" id="tabFeed">
                    Feed
                </button>
                <button class="tribe-nav-tab" onclick="switchTRIBESection('map')" id="tabMap">
                    Map
                </button>
                <button class="tribe-nav-tab" onclick="switchTRIBESection('packs')" id="tabPacks">
                    Packs
                </button>
                <button class="tribe-nav-tab" onclick="switchTRIBESection('guide')" id="tabGuide">
                    Guide
                </button>
                <button class="tribe-nav-tab" onclick="switchTRIBESection('wisdom-library')" id="tabWisdomLibrary">
                    Wisdom Library
                </button>
            </nav>
            <img 
                id="tribeHeaderAvatar" 
                class="tribe-header-user-avatar" 
                src="" 
                alt="Your profile"
                onclick="openUserProfileFromHeader()"
                aria-label="Open your profile">
        </div>
        
        <!-- TRIBE Content Container -->
        <div id="tribeContent">
            
            <!-- FEED SECTION (User Posts) -->
            <div id="tribeFeedSection" class="tribe-section active">
                <div style="background: var(--white);">
                    <!-- Feed Container -->
                    <div id="feedContainer" style="display: flex; flex-direction: column; gap: 0;">
                        <!-- Posts will be loaded here -->
                    </div>
                </div>
            </div>
            
            <!-- MAP SECTION -->
            <div id="tribeMapSection" class="tribe-section active">
                <div class="section-header" style="margin-top: var(--space-2);">
                    <h3 style="font-size: 18px; font-weight: 700;">Movement Spaces Near You</h3>
                    <button class="btn btn-outline" onclick="openPartnerFinder()" style="display: inline-flex; align-items: center; gap: 8px;">
                        Find Partners
                    </button>
                </div>
                
                <!-- Map Filters -->
                <div class="map-filters">
                    <!-- Search Input -->
                    <div class="map-search-container">
                        <input 
                            type="text" 
                            id="mapSearch" 
                            class="map-search-input" 
                            placeholder="Search packs, spots, location..."
                            autocomplete="off">
                        <span class="map-search-icon">ğŸ”</span>
                    </div>

                    <!-- Type Filters + Environment Dropdown -->
                    <div class="filters-row">
                        <div class="filter-pills" id="typeFilters">
                            <button class="filter-pill active" data-type="all">All</button>
                            <button class="filter-pill" data-type="pack">Packs</button>
                            <button class="filter-pill" data-type="spot">Spots</button>
                            <button class="filter-pill" data-type="facilitator">Facilitators</button>
                            <button class="filter-pill" data-type="event">Events</button>
                        </div>
                        
                        <div class="environment-dropdown">
                            <button class="environment-toggle" id="environmentToggle">
                                <span id="environmentLabel">Environment</span>
                                <span class="dropdown-arrow">â–¾</span>
                            </button>
                            <div class="environment-menu" id="environmentMenu">
                                <button class="environment-option active" data-environment="all">All</button>
                                <button class="environment-option" data-environment="urban">Urban</button>
                                <button class="environment-option" data-environment="natural">Natural</button>
                                <button class="environment-option" data-environment="hybrid">Hybrid</button>
                            </div>
                        </div>
                    </div>

                    <!-- My Location Button -->
                    <div class="map-location-container">
                        <button class="map-location-btn" id="myLocationBtn" onclick="MapService.centerOnUserLocation()" aria-label="Center on my location">
                            <span class="location-icon">ğŸ“</span>
                            <span class="location-text">My Location</span>
                        </button>
                    </div>
                </div>

                <!-- Map Container -->
                <div class="map-container">
                    <div id="map"></div>

                    <!-- Detail Panel -->
                    <div class="map-detail-panel" id="mapDetailPanel">
                        <div class="detail-panel-header">
                            <div></div>
                            <button type="button" class="detail-panel-close" onclick="closeMapDetail()" aria-label="Close">&times;</button>
                        </div>
                        <div id="mapDetailContent"></div>
                    </div>
                </div>
            </div>
            
            <!-- PACKS SECTION -->
            <div id="tribePacksSection" class="tribe-section">
                <div class="section-header" style="margin-top: var(--space-2);">
                    <h3 style="font-size: 18px; font-weight: 700;">Packs Near You</h3>
                    <button class="btn btn-primary" onclick="openModal('newPackModal')">
                        Create Pack
                    </button>
                </div>
                <div class="packs-grid" id="packsContainer">
                    <!-- Packs will be dynamically loaded -->
                </div>
            </div>
            
            <!-- WISDOM LIBRARY SECTION -->
            
            <!-- GUIDE SECTION -->
            <div id="tribeGuideSection" class="tribe-section">
                <div class="guide-header">
                    <h3 style="font-size: 18px; font-weight: 700;">Find Your Guide</h3>
                    <p style="font-size: 14px; color: var(--gray-600); margin-top: var(--space-1);">Connect with certified HUDEN coaches for 1-on-1 sessions, group training, or mentorship.</p>
                </div>

                <div class="guide-filters">
                    <div class="guide-filter-group">
                        <label class="guide-filter-label">Search</label>
                        <input 
                            type="text" 
                            class="guide-filter-input" 
                            id="coachSearchInput"
                            placeholder="Search by name or location..."
                            oninput="filterCoaches()">
                    </div>
                    <div class="guide-filter-group">
                        <label class="guide-filter-label">Level</label>
                        <select class="guide-filter-select" id="coachLevelFilter" onchange="filterCoaches()">
                            <option value="all">All Levels</option>
                            <option value="coach">Coach Certified</option>
                            <option value="mentorship">Mentorship</option>
                            <option value="mastery">Mastery</option>
                        </select>
                    </div>
                    <div class="guide-filter-group">
                        <label class="guide-filter-label">Specialty</label>
                        <select class="guide-filter-select" id="coachSpecialtyFilter" onchange="filterCoaches()">
                            <option value="all">All Specialties</option>
                            <option value="outdoor">Outdoor Practice</option>
                            <option value="urban">Urban Training</option>
                            <option value="trauma">Trauma-Informed</option>
                            <option value="coaching">Coach Training</option>
                        </select>
                    </div>
                </div>

                <!-- Coaches Grid -->
                <div class="coaches-grid" id="coachesGrid">
                    <!-- Coaches will be rendered here by renderCoaches() -->
                </div>
            </div>
            
            <!-- WISDOM LIBRARY SECTION -->
            <div id="tribeWisdomLibrarySection" class="tribe-section">
                <div id="wisdomContainer">
                    <!-- Wisdom Library content will load here dynamically -->
                </div>
            </div>
            
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         TRAINING TAB v1 - Complete Implementation
         Hybrid Approach: Full UI + Visual tier locks (no real payments yet)
         Nike Run Club inspired design
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="trainingTab" class="tab-panel">
        
        <!-- AUTHENTICATION GATE (non-registered users) -->
        <div id="trainingAuthGate" class="training-auth-gate" style="display: none;">
            <div class="training-auth-content">
                <h1 class="training-auth-title">START YOUR JOURNEY</h1>
                <p class="training-auth-subtitle">Choose your path and begin conscious movement practice.</p>
                <div class="training-auth-buttons">
                    <button class="btn btn-primary btn-large" onclick="showAuthModal('signup')">Create Account</button>
                    <button class="btn btn-outline btn-large" onclick="showAuthModal('login')">Sign In</button>
                </div>
            </div>
        </div>

        <!-- PROGRAM SELECTION VIEW (user has no active enrollment) -->
        <div id="trainingProgramSelection" class="training-program-selection" style="display: none;">
            <div class="training-header">
                <h2 class="training-main-title">TRAINING</h2>
                <p class="training-subtitle">Choose your path</p>
            </div>

            <!-- Essential Path Card -->
            <div class="training-program-card" data-program="essential">
                <div class="training-program-image">
                    <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1200&q=80" alt="Essential Path - Natural Movement" loading="lazy">
                    <div class="training-program-overlay">
                        <span class="training-program-badge">FREE</span>
                        <h3 class="training-program-title">ESSENTIAL PATH</h3>
                        <p class="training-program-meta">48 days Â· 4 Archetypes Â· Observer Role</p>
                    </div>
                </div>
                <div class="training-program-details">
                    <p class="training-program-description">Learn to observe without fixing. Develop natural movement intelligence through 48 days of presence.</p>
                    <button class="btn btn-primary btn-large" onclick="enrollInProgram('essential')">START ESSENTIAL</button>
                </div>
            </div>

            <!-- Flow Path Card -->
            <div class="training-program-card" data-program="flow" id="flowProgramCard">
                <div class="training-program-image">
                    <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=1200&q=80" alt="Flow Path - Dynamic Movement" loading="lazy">
                    <div class="training-program-overlay">
                        <span class="training-program-badge">â‚¬29/MONTH</span>
                        <h3 class="training-program-title">FLOW PATH</h3>
                        <p class="training-program-meta">48 days Â· 3 Archetypes Â· Participant Role</p>
                    </div>
                    <div class="training-program-lock" id="flowLockOverlay" style="display: none;">
                        <div class="training-lock-content">
                            <svg class="training-lock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                            </svg>
                            <p class="training-lock-text">Subscribe to unlock</p>
                        </div>
                    </div>
                </div>
                <div class="training-program-details">
                    <p class="training-program-description">Build fluidity through dynamic sequences. Progress from 10% to 40% autonomy across sensory, relational, and vertical practice.</p>
                    <button class="btn btn-outline btn-large" onclick="upgradeToFlow()" id="flowUpgradeBtn">UPGRADE TO FLOW</button>
                </div>
            </div>

            <!-- Mastery Path Card -->
            <div class="training-program-card" data-program="mastery" id="masteryProgramCard">
                <div class="training-program-image">
                    <img src="https://images.unsplash.com/photo-1551632811-561732d1e306?w=1200&q=80" alt="Mastery Path - Autonomous Practice" loading="lazy">
                    <div class="training-program-overlay">
                        <span class="training-program-badge">â‚¬49/MONTH</span>
                        <h3 class="training-program-title">MASTERY PATH</h3>
                        <p class="training-program-meta">48 days Â· 90% Autonomy Â· Pack Creator Role</p>
                    </div>
                    <div class="training-program-lock" id="masteryLockOverlay" style="display: none;">
                        <div class="training-lock-content">
                            <svg class="training-lock-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                            </svg>
                            <p class="training-lock-text">Subscribe to unlock</p>
                        </div>
                    </div>
                </div>
                <div class="training-program-details">
                    <p class="training-program-description">Maximum autonomy. Minimal structure. Create your own practice and lead others into movement.</p>
                    <button class="btn btn-outline btn-large" onclick="upgradeToMastery()" id="masteryUpgradeBtn" disabled>UPGRADE TO MASTERY</button>
                </div>
            </div>
        </div>

        <!-- ACTIVE PROGRAM VIEW (user is enrolled in a program) -->
        <div id="trainingActiveProgram" class="training-active-program" style="display: none;">
            <!-- Program Header -->
            <div class="training-active-header">
                <button class="training-back-btn" onclick="returnToProgramSelection()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                    <span>Programs</span>
                </button>
                <h2 class="training-active-title" id="activeProgramTitle">ESSENTIAL PATH</h2>
                <div class="training-active-progress">
                    <p class="training-progress-text">
                        <span id="currentDayDisplay">Day 1 of 48</span>
                        <span class="training-progress-divider">Â·</span>
                        <span id="currentWeekDisplay">Week 1, Day 1</span>
                    </p>
                    <div class="training-progress-bar">
                        <div class="training-progress-fill" id="trainingProgressFill" style="width: 2%;"></div>
                    </div>
                </div>
            </div>

            <!-- Today's Session Card (Hero) -->
            <div class="training-session-hero" id="todaySessionCard" style="cursor: pointer;" onclick="openSessionDetail()">
                <div class="training-session-image">
                    <img id="todaySessionImage" src="https://images.unsplash.com/photo-1518611012118-696072aa579a?w=1200&q=85" alt="Today's Session" loading="lazy">
                    <div class="training-session-overlay">
                        <span class="training-session-label">TODAY</span>
                        <h3 class="training-session-title" id="todaySessionTitle">Your First Session</h3>
                        <p class="training-session-meta" id="todaySessionMeta">45 min Â· Gorilla</p>
                    </div>
                </div>
            </div>

            <!-- CONTINUE Button (Independent, outside card) -->
            <div style="padding: 0 var(--space-3) var(--space-4);">
                <button 
                    class="btn btn-primary btn-large" 
                    onclick="console.log('ğŸ”µ CONTINUE clicked'); openSessionDetail();"
                    style="width: 100%; max-width: 100%;">
                    CONTINUE
                </button>
            </div>

            <!-- This Week Overview -->
            <div class="training-week-overview">
                <h3 class="training-week-title">THIS WEEK</h3>
                <div class="training-week-days" id="trainingWeekDays">
                    <!-- Days will be dynamically inserted -->
                </div>
            </div>

            <!-- Next Milestone -->
            <div class="training-milestone" id="trainingMilestone">
                <p class="training-milestone-label">NEXT MILESTONE</p>
                <p class="training-milestone-text" id="milestoneText">Week 4 Ritual Â· Day 16</p>
            </div>

            <!-- Recent Sessions (Collapsible) -->
            <div class="training-recent-section">
                <button class="training-recent-toggle" onclick="toggleRecentSessions()" id="recentSessionsToggle">
                    <span>RECENT SESSIONS</span>
                    <svg class="training-toggle-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>
                <div class="training-recent-list" id="recentSessionsList" style="display: none;">
                    <!-- Recent sessions will be dynamically inserted -->
                </div>
            </div>
        </div>

        <!-- SESSION DETAIL VIEW -->
        <div id="trainingSessionDetail" class="training-session-detail" style="display: none; background: var(--white);">
            <!-- Video Player (HERO - Edge-to-edge, no borders) -->
            <div class="training-video-container" style="margin: 0; padding: 0; position: relative; width: 100%;">
                <!-- Minimal Back Button (Floating, top-left) -->
                <button 
                    class="training-back-btn" 
                    onclick="closeSessionDetail()" 
                    style="
                        position: absolute; 
                        top: var(--space-2); 
                        left: var(--space-2); 
                        z-index: 200;
                        background: rgba(0,0,0,0.4);
                        backdrop-filter: blur(20px);
                        border: none;
                        border-radius: var(--radius-pill);
                        padding: 8px 12px;
                        display: flex;
                        align-items: center;
                        gap: 4px;
                        font-size: 14px;
                        font-weight: 600;
                        color: var(--white);
                        cursor: pointer;
                        transition: var(--transition-fast);
                    "
                    onmouseover="this.style.background='rgba(0,0,0,0.6)'"
                    onmouseout="this.style.background='rgba(0,0,0,0.4)'">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                        <polyline points="15 18 9 12 15 6"></polyline>
                    </svg>
                    <span style="font-size: 15px;">Back</span>
                </button>

                <!-- Video Placeholder -->
                <div 
                    class="training-video-placeholder" 
                    id="sessionVideoPlaceholder" 
                    onclick="playSessionVideo()" 
                    style="
                        cursor: pointer; 
                        width: 100%; 
                        height: 65vh; 
                        position: relative;
                        overflow: hidden;
                    ">
                    <img 
                        class="training-video-cover" 
                        id="sessionVideoCover" 
                        src="https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1200&q=85" 
                        alt="Session video cover" 
                        style="
                            width: 100%; 
                            height: 100%; 
                            object-fit: cover;
                            display: block;
                        ">
                    <div 
                        class="training-video-overlay" 
                        style="
                            position: absolute; 
                            inset: 0; 
                            display: flex; 
                            flex-direction: column; 
                            align-items: center; 
                            justify-content: center; 
                            background: rgba(0,0,0,0.2);
                            transition: var(--transition-base);
                        "
                        onmouseover="this.style.background='rgba(0,0,0,0.3)'"
                        onmouseout="this.style.background='rgba(0,0,0,0.2)'">
                        <svg 
                            class="training-play-icon" 
                            width="88" 
                            height="88" 
                            viewBox="0 0 24 24" 
                            fill="white" 
                            style="
                                margin-bottom: var(--space-3); 
                                filter: drop-shadow(0 8px 24px rgba(0,0,0,0.3));
                                transition: var(--transition-base);
                            ">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        <p 
                            class="training-video-text" 
                            style="
                                color: white; 
                                font-size: 18px; 
                                font-weight: 700; 
                                text-transform: uppercase; 
                                letter-spacing: 0.15em; 
                                text-shadow: 0 2px 12px rgba(0,0,0,0.4);
                            ">PLAY SESSION</p>
                    </div>
                </div>
                
                <!-- Real video player -->
                <div 
                    id="sessionVideoPlayer" 
                    style="
                        display: none; 
                        width: 100%; 
                        height: 65vh; 
                        background: var(--black); 
                        overflow: hidden;
                    ">
                    <iframe 
                        id="sessionVideoIframe" 
                        width="100%" 
                        height="100%" 
                        src="" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                        allowfullscreen
                        style="border: none;">
                    </iframe>
                </div>
            </div>

            <!-- Session Content (Below video - Nike clean layout) -->
            <div class="training-detail-content" style="padding: var(--space-5) var(--space-4) var(--space-8);">
                <!-- Day Label -->
                <div 
                    class="training-detail-label" 
                    id="sessionDayLabel" 
                    style="
                        font-size: 12px; 
                        font-weight: 700; 
                        letter-spacing: 0.12em; 
                        text-transform: uppercase;
                        opacity: 0.5; 
                        margin-bottom: var(--space-2);
                    ">DAY 1</div>
                
                <!-- Title (Nike brutal typography) -->
                <h1 
                    class="training-detail-title" 
                    id="sessionDetailTitle" 
                    style="
                        font-size: clamp(36px, 9vw, 56px); 
                        font-weight: 900; 
                        letter-spacing: -0.03em; 
                        line-height: 0.95; 
                        text-transform: uppercase;
                        margin-bottom: var(--space-2);
                    ">YOUR FIRST SESSION</h1>
                
                <!-- Meta (Lightweight) -->
                <p 
                    class="training-detail-meta" 
                    id="sessionDetailMeta" 
                    style="
                        font-size: 16px; 
                        font-weight: 400;
                        opacity: 0.6; 
                        margin-bottom: var(--space-6);
                    ">Week 1 Â· 45 min Â· Gorilla</p>

                <!-- Session Overview -->
                <div class="training-detail-section" style="margin-bottom: var(--space-5);">
                    <h3 
                        class="training-detail-section-title" 
                        style="
                            font-size: 13px; 
                            font-weight: 700; 
                            letter-spacing: 0.08em; 
                            text-transform: uppercase; 
                            margin-bottom: var(--space-3); 
                            opacity: 0.7;
                        ">OVERVIEW</h3>
                    <p 
                        class="training-detail-text" 
                        id="sessionOverview" 
                        style="
                            font-size: 17px; 
                            line-height: 1.6; 
                            font-weight: 400;
                            opacity: 0.85;
                        ">
                        Today you'll explore quadrupedal movement across uneven terrain. Notice your body's intelligence.
                    </p>
                </div>

                <!-- Session Structure -->
                <div class="training-detail-section" style="margin-bottom: var(--space-8);">
                    <h3 
                        class="training-detail-section-title" 
                        style="
                            font-size: 13px; 
                            font-weight: 700; 
                            letter-spacing: 0.08em; 
                            text-transform: uppercase; 
                            margin-bottom: var(--space-3); 
                            opacity: 0.7;
                        ">STRUCTURE</h3>
                    <ul class="training-structure-list" id="sessionStructure" style="list-style: none; padding: 0; margin: 0;">
                        <li style="font-size: 16px; line-height: 1.8; margin-bottom: var(--space-2); opacity: 0.85;">
                            <strong style="font-weight: 700;">Warm-up (10 min):</strong> Floor breathing, body scan, gentle rolling
                        </li>
                        <li style="font-size: 16px; line-height: 1.8; margin-bottom: var(--space-2); opacity: 0.85;">
                            <strong style="font-weight: 700;">Practice (30 min):</strong> Quadrupedal exploration, bear crawls, ground transitions
                        </li>
                        <li style="font-size: 16px; line-height: 1.8; opacity: 0.85;">
                            <strong style="font-weight: 700;">Cool-down (5 min):</strong> Seated breathing, reflection
                        </li>
                    </ul>
                </div>

                <!-- Complete Session Button (Fixed at bottom) -->
                <div class="training-detail-footer" style="padding-bottom: var(--space-6);">
                    <button class="btn btn-primary btn-large" onclick="completeSession()" style="width: 100%; max-width: 400px;">COMPLETE SESSION</button>
                    <p class="training-detail-warning" style="font-size: 13px; opacity: 0.6; margin-top: var(--space-2);">âš ï¸ Mark complete only after finishing</p>
                </div>
            </div>
        </div>

        <!-- COMPLETION MODAL -->
        <div id="trainingCompletionModal" class="training-completion-modal" style="display: none;">
            <div class="training-completion-content">
                <h2 class="training-completion-title">DAY <span id="completedDayNumber">1</span> COMPLETE</h2>
                <p class="training-completion-message" id="completionMessage">"You observed without fixing."</p>
                
                <div class="training-observation-section">
                    <label class="training-observation-label">YOUR OBSERVATION (Optional)</label>
                    <textarea 
                        class="training-observation-input" 
                        id="sessionObservationInput"
                        placeholder="What did you notice today?"
                        rows="4"
                    ></textarea>
                    
                    <!-- Share to Feed Option -->
                    <label class="training-share-checkbox" style="display: flex; align-items: center; gap: 12px; margin-top: 16px; cursor: pointer;">
                        <input type="checkbox" id="shareToFeedCheckbox" style="width: 20px; height: 20px; cursor: pointer;">
                        <span style="font-size: 15px; font-weight: 400; color: var(--gray-700);">Share this session to Feed</span>
                    </label>
                </div>

                <div class="training-completion-buttons">
                    <button class="btn btn-outline" onclick="skipObservation()">Skip</button>
                    <button class="btn btn-primary" onclick="saveObservation()">Save & Continue</button>
                </div>
            </div>
        </div>

        <!-- DAY 48 CELEBRATION (Full Screen) -->
        <div id="trainingCelebration" class="training-celebration" style="display: none;">
            <div class="training-celebration-content">
                <h2 class="training-celebration-program" id="celebrationProgramName">ESSENTIAL PATH</h2>
                <h1 class="training-celebration-title">COMPLETE</h1>
                <p class="training-celebration-days">48 DAYS</p>
                <p class="training-celebration-message" id="celebrationMessage">
                    "You learned to feel. The movement correct emerges from feeling correctly."
                </p>
                <div class="training-celebration-buttons">
                    <button class="btn btn-primary btn-large" onclick="startNextProgram()" id="celebrationNextBtn">START FLOW PATH</button>
                    <button class="btn btn-outline btn-large" onclick="closeCelebration()">Return to Training</button>
                </div>
            </div>
        </div>

    </div>

    <!-- PROFILE TAB -->
    <div id="profileTab" class="tab-panel">
        <div class="section-header">
            <h2 class="section-title">Profile</h2>
        </div>
        
        <div style="padding: var(--space-4); text-align: center;">
            <button class="btn btn-primary btn-large" onclick="openMyProfile()" style="width: 100%; max-width: 300px;">
                View My Profile
            </button>
            <button class="btn btn-outline" onclick="switchTab('inbox')" style="width: 100%; max-width: 300px; margin-top: var(--space-2);">
                Messages
            </button>
        </div>
    </div>

    <!-- INBOX TAB (accessible from Profile) -->
    <div id="inboxTab" class="tab-panel">
        <div class="section-header">
            <h2 class="section-title">Inbox</h2>
        </div>

        <div class="inbox-container">
            <div class="conversation-list" id="conversationList" style="display: none;">
                <!-- Conversations will be dynamically inserted here -->
            </div>

            <div class="inbox-empty-state" id="inboxEmptyState" style="display: none;">
                <h3 class="empty-state-title">No Conversations Yet</h3>
                <p class="empty-state-text">Start a conversation by messaging someone from the feed or opening your pack chat.</p>
                <button class="empty-state-cta" onclick="switchTab('packs')">Open Pack Chat</button>
            </div>
        </div>
    </div>

    <!-- THREAD VIEW TAB -->
    <div id="threadTab" class="tab-panel">
        <div class="thread-container">
            <div class="thread-header">
                <button class="thread-back-button" onclick="backToInbox()" aria-label="Back to Inbox">â†</button>
                <h2 class="thread-title" id="threadTitle">Conversation</h2>
            </div>

            <div class="thread-messages" id="threadMessages">
                <!-- Messages will be dynamically inserted here -->
            </div>

            <div class="thread-input-container">
                <div class="thread-input-wrapper">
                    <textarea 
                        id="threadInput" 
                        class="thread-input" 
                        placeholder="Type a message..." 
                        maxlength="1000"
                        rows="1"></textarea>
                    <button class="thread-send-button" onclick="sendMessage()">Send</button>
                </div>
                <div class="input-char-count" id="charCount">0 / 1000</div>
            </div>
        </div>
    </div>

    <!-- GUIDE TAB - Find Your Coach (FASE 5: Mentorship & Wisdom) -->
    <div id="guideTab" class="tab-panel">
        <div class="guide-header">
            <h1 class="guide-title">Find Your Guide</h1>
            <p class="guide-subtitle">Connect with certified HUDEN coaches for 1-on-1 sessions, group training, or mentorship.</p>
        </div>

        <div class="guide-filters">
            <div class="guide-filter-group">
                <label class="guide-filter-label">Search</label>
                <input 
                    type="text" 
                    class="guide-filter-input" 
                    id="coachSearchInput"
                    placeholder="Search by name or location..."
                    oninput="filterCoaches()">
            </div>
            <div class="guide-filter-group">
                <label class="guide-filter-label">Level</label>
                <select class="guide-filter-select" id="coachLevelFilter" onchange="filterCoaches()">
                    <option value="all">All Levels</option>
                    <option value="coach">Coach Certified</option>
                    <option value="mentorship">Mentorship</option>
                    <option value="mastery">Mastery</option>
                </select>
            </div>
            <div class="guide-filter-group">
                <label class="guide-filter-label">Specialty</label>
                <select class="guide-filter-select" id="coachSpecialtyFilter" onchange="filterCoaches()">
                    <option value="all">All Specialties</option>
                    <option value="outdoor">Outdoor Practice</option>
                    <option value="urban">Urban Training</option>
                    <option value="trauma">Trauma-Informed</option>
                    <option value="coaching">Coach Training</option>
                </select>
            </div>
        </div>

        <!-- Coaches Grid -->
        <div class="coaches-grid" id="coachesGrid">
            <!-- Coaches will be rendered here by renderCoaches() -->
        </div>

        <!-- Loading State (PASO 4b) -->
        <div id="coachesLoadingState" class="skeleton-grid" style="display: none;">
            <!-- Skeleton Coach Card 1 -->
            <div class="skeleton-coach-card">
                <div class="skeleton skeleton-avatar"></div>
                <div class="skeleton skeleton-text-lg"></div>
                <div class="skeleton skeleton-text-md"></div>
                <div class="skeleton skeleton-text"></div>
                <div class="skeleton skeleton-text"></div>
                <div class="skeleton skeleton-button"></div>
            </div>
            <!-- Skeleton Coach Card 2 -->
            <div class="skeleton-coach-card">
                <div class="skeleton skeleton-avatar"></div>
                <div class="skeleton skeleton-text-lg"></div>
                <div class="skeleton skeleton-text-md"></div>
                <div class="skeleton skeleton-text"></div>
                <div class="skeleton skeleton-text"></div>
                <div class="skeleton skeleton-button"></div>
            </div>
            <!-- Skeleton Coach Card 3 -->
            <div class="skeleton-coach-card">
                <div class="skeleton skeleton-avatar"></div>
                <div class="skeleton skeleton-text-lg"></div>
                <div class="skeleton skeleton-text-md"></div>
                <div class="skeleton skeleton-text"></div>
                <div class="skeleton skeleton-text"></div>
                <div class="skeleton skeleton-button"></div>
            </div>
        </div>

        <!-- Error State (PASO 4b) -->
        <div id="coachesErrorState" class="error-state" style="display: none;">
            <div class="error-state-icon">âš ï¸</div>
            <h3 class="error-state-title">Failed to Load Coaches</h3>
            <p class="error-state-message">
                We couldn't retrieve the coach list. This might be a temporary connection issue.
            </p>
            <div class="error-state-actions">
                <button class="retry-btn" onclick="renderCoaches()">
                    <span>ğŸ”„</span>
                    <span>Try Again</span>
                </button>
                <button class="btn-ghost btn-small" onclick="clearCoachFilters()">
                    Clear Filters
                </button>
            </div>
        </div>

        <!-- Empty State -->
        <div id="coachesEmptyState" class="empty-state" style="display: none;">
            <div class="empty-state-visual">ğŸ§­</div>
            <h2 class="empty-title">No Coaches Found</h2>
            <p class="empty-message">Try adjusting your filters to find the perfect guide for your journey.</p>
            <div class="empty-state-actions">
                <button class="empty-state-btn" onclick="clearCoachFilters()">Clear Filters</button>
            </div>
        </div>

        <!-- My Mentorships Section (Coach View Only) -->
        <div id="myMentorshipsSection" style="display: none; margin-top: 80px;">
            <div class="guide-header" style="border-top: 1px solid var(--gray-200); padding-top: 64px;">
                <h2 class="section-title">My Mentorships</h2>
                <p class="guide-subtitle">Active mentorship requests and ongoing 1-on-1 journeys</p>
            </div>

            <!-- Active Mentorships -->
            <div class="active-mentorships" id="activeMentorshipsList">
                <!-- Example Active Mentorship -->
                <div class="mentorship-card">
                    <div class="mentorship-card-header">
                        <div class="mentorship-participant">
                            <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&q=80" 
                                 alt="Student" class="mentorship-avatar">
                            <div class="mentorship-participant-info">
                                <h4>Ana Martinez</h4>
                                <div class="mentorship-participant-role">Mastery Â· 3 months</div>
                            </div>
                        </div>
                        <span class="mentorship-status active">Active</span>
                    </div>

                    <div class="mentorship-meta">
                        <div class="mentorship-meta-item">
                            <span class="mentorship-meta-label">Started</span>
                            <span class="mentorship-meta-value">Oct 1, 2025</span>
                        </div>
                        <div class="mentorship-meta-item">
                            <span class="mentorship-meta-label">Sessions</span>
                            <span class="mentorship-meta-value">8/12 completed</span>
                        </div>
                        <div class="mentorship-meta-item">
                            <span class="mentorship-meta-label">Next Session</span>
                            <span class="mentorship-meta-value">Nov 3, 10:00</span>
                        </div>
                        <div class="mentorship-meta-item">
                            <span class="mentorship-meta-label">Focus</span>
                            <span class="mentorship-meta-value">Suspension work</span>
                        </div>
                    </div>

                    <div class="mentorship-actions">
                        <button class="btn btn-primary btn-small video-link-btn" 
                                onclick="window.open('https://zoom.us/j/example', '_blank')">
                            Join Video Call
                        </button>
                        <button class="btn btn-ghost btn-small" onclick="showToast('Session notes feature coming soon')">
                            Session Notes
                        </button>
                        <button class="btn btn-ghost btn-small" onclick="showToast('Private thread feature coming soon')">
                            Private Thread
                        </button>
                    </div>
                </div>

                <!-- Pending Request -->
                <div class="mentorship-card">
                    <div class="mentorship-card-header">
                        <div class="mentorship-participant">
                            <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&q=80" 
                                 alt="Student" class="mentorship-avatar">
                            <div class="mentorship-participant-info">
                                <h4>David Park</h4>
                                <div class="mentorship-participant-role">Flow Â· New request</div>
                            </div>
                        </div>
                        <span class="mentorship-status pending">Pending</span>
                    </div>

                    <div class="mentorship-meta">
                        <div class="mentorship-meta-item">
                            <span class="mentorship-meta-label">Requested</span>
                            <span class="mentorship-meta-value">Oct 28, 2025</span>
                        </div>
                        <div class="mentorship-meta-item">
                            <span class="mentorship-meta-label">Experience</span>
                            <span class="mentorship-meta-value">Intermediate</span>
                        </div>
                        <div class="mentorship-meta-item">
                            <span class="mentorship-meta-label">Frequency</span>
                            <span class="mentorship-meta-value">Weekly</span>
                        </div>
                        <div class="mentorship-meta-item">
                            <span class="mentorship-meta-label">Investment</span>
                            <span class="mentorship-meta-value">â‚¬900</span>
                        </div>
                    </div>

                    <div class="mentorship-actions">
                        <button class="btn btn-primary btn-small" onclick="acceptMentorshipRequest('david-park')">
                            Accept Request
                        </button>
                        <button class="btn btn-ghost btn-small" onclick="showToast('View details feature coming soon')">
                            View Details
                        </button>
                        <button class="btn btn-ghost btn-small" onclick="showToast('Decline request feature coming soon')">
                            Decline
                        </button>
                    </div>
                </div>
            </div>

            <!-- Empty State -->
            <div id="mentorshipsEmptyState" style="display: none; text-align: center; padding: 80px 32px;">
                <div style="font-size: 64px; opacity: 0.3; margin-bottom: 24px;">ğŸ¤</div>
                <h3 style="font-size: 24px; font-weight: 700; margin-bottom: 16px;">No Active Mentorships</h3>
                <p style="font-size: 15px; color: var(--gray-600);">
                    Mentorship requests from students will appear here
                </p>
            </div>
        </div>
    </div>

    <!-- QUICK ACTIONS FLOATING BUTTON -->
    <button class="quick-actions-fab" id="quickActionsFab" onclick="toggleQuickActionsDropdown()" aria-label="Quick Actions">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
        </svg>
    </button>

    <!-- QUICK ACTIONS DROPDOWN -->
    <div class="quick-actions-dropdown" id="quickActionsDropdown">
        <button class="quick-action-item" onclick="handleQuickAction('newPost')">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            <span>New Post</span>
        </button>
        
        <button class="quick-action-item" onclick="handleQuickAction('findPack')">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            <span>Find Pack</span>
        </button>
        
        <button class="quick-action-item" onclick="handleQuickAction('startTraining')">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            <span>Start Training</span>
        </button>
        
        <button class="quick-action-item" onclick="handleQuickAction('findCoach')">
            <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            <span>Find Coach</span>
        </button>
    </div>

    <!-- FLOATING USER AVATAR -->
    <img 
        src="https://i.pravatar.cc/150?img=12" 
        alt="User profile" 
        class="floating-user-avatar"
        id="floatingUserAvatar"
        onclick="openMyProfile()"
        aria-label="View your profile">

    <!-- BOTTOM NAVIGATION - Nike Run Club Style -->
    <div class="bottom-nav" role="navigation" aria-label="Main navigation">
        <button 
            class="bottom-nav-item active" 
            id="bottomNavHome" 
            onclick="switchTab('home')"
            role="tab"
            aria-selected="true"
            aria-controls="homeTab"
            aria-label="Home">
            <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
            <span>Home</span>
        </button>
        
        <button 
            class="bottom-nav-item" 
            id="bottomNavTRIBE" 
            onclick="switchTab('tribe')"
            role="tab"
            aria-selected="false"
            aria-controls="tribeTab"
            aria-label="TRIBE">
            <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            <span>TRIBE</span>
        </button>
        
        <button 
            class="bottom-nav-item" 
            id="bottomNavTraining" 
            onclick="switchTab('training')"
            role="tab"
            aria-selected="false"
            aria-controls="trainingTab"
            aria-label="Training">
            <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            <span>Training</span>
        </button>
    </div>

    <!-- TOAST CONTAINER -->
    <div id="toastContainer"></div>

    <!-- NEW POST MODAL -->
    <div class="modal-overlay" id="newPostModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">New Post</h2>
                <button type="button" class="modal-close" onclick="closeModal('newPostModal')" aria-label="Close">Ã—</button>
            </div>
            <form class="modal-body" onsubmit="submitNewPost(event)">
                <div class="form-group">
                    <label class="form-label">Post Content</label>
                    <textarea id="postContent" class="form-textarea" placeholder="Share your thoughts..." required></textarea>
                </div>
                
                <!-- ARCHETYPE SELECTOR (NEW v14) -->
                <div class="archetype-selector">
                    <label class="archetype-label">Movement Archetype</label>
                    <p class="archetype-subtitle">Tag your post with the movement patterns you tribed (select one or more)</p>
                    <div class="archetype-pills">
                        <button type="button" class="archetype-pill" data-archetype="Gorilla" onclick="toggleArchetype(this)">
                            Gorilla
                        </button>
                        <button type="button" class="archetype-pill" data-archetype="Gibbon" onclick="toggleArchetype(this)">
                            Gibbon
                        </button>
                        <button type="button" class="archetype-pill" data-archetype="Orangutan" onclick="toggleArchetype(this)">
                            Orangutan
                        </button>
                        <button type="button" class="archetype-pill" data-archetype="Chimpanzee" onclick="toggleArchetype(this)">
                            Chimpanzee
                        </button>
                    </div>
                </div>
                
                <!-- SESSION SELECTOR (NEW v25 - Training Integration) -->
                <div class="session-selector">
                    <label class="form-label">Link to Training Session (optional)</label>
                    <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 12px;">Connect this reflection to a specific day in your practice journey</p>
                    <div class="session-grid">
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-size: 13px; color: var(--gray-600);">Path</label>
                            <select id="postSessionPath" onchange="updateSessionDays()">
                                <option value="">None</option>
                                <option value="flow">Flow Path</option>
                                <option value="mastery">Mastery Path</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-size: 13px; color: var(--gray-600);">Day</label>
                            <select id="postSessionDay" disabled>
                                <option value="">Select path first</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Image (optional)</label>
                    <input type="file" id="postImageFile" class="form-input-file" accept="image/*" onchange="previewPostImage(event)">
                    <div id="postImagePreview" class="image-preview"></div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Publish</button>
                </div>
            </form>
        </div>
    </div>

    <!-- COACH PROFILE MODAL -->
    <div class="coach-profile-modal" id="coachProfileModal">
        <div class="coach-profile-overlay" onclick="closeCoachProfileModal()"></div>
        <div class="coach-profile-content">
            <button class="coach-profile-close" onclick="closeCoachProfileModal()" aria-label="Close coach profile">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>

            <!-- Header -->
            <div class="coach-profile-header">
                <div class="coach-profile-main">
                    <img id="profileCoachAvatar" src="" alt="" class="coach-profile-avatar">
                    <div class="coach-profile-info">
                        <h2 class="coach-profile-name" id="profileCoachName"></h2>
                        <div class="coach-profile-location" id="profileCoachLocation"></div>
                        <div class="coach-profile-rating-large">
                            <div class="star-rating star-rating-large" id="profileStarRating"></div>
                            <span class="coach-profile-rating-number" id="profileRatingNumber"></span>
                            <span class="coach-profile-rating-count" id="profileRatingCount"></span>
                        </div>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="coach-profile-tabs">
                    <button class="coach-profile-tab active" data-tab="about" onclick="switchCoachProfileTab('about')">
                        About
                    </button>
                    <button class="coach-profile-tab" data-tab="reviews" onclick="switchCoachProfileTab('reviews')">
                        Reviews <span id="profileReviewsTabCount"></span>
                    </button>
                    <button class="coach-profile-tab" data-tab="availability" onclick="switchCoachProfileTab('availability')">
                        Availability
                    </button>
                </div>
            </div>

            <!-- Body -->
            <div class="coach-profile-body">
                <!-- About Tab -->
                <div class="coach-profile-section active" data-section="about">
                    <h3 style="font-size: 20px; font-weight: 800; margin-bottom: var(--space-3);">About</h3>
                    <p id="profileCoachBio" style="font-size: 16px; line-height: 1.6; color: var(--gray-700); margin-bottom: var(--space-4);"></p>
                    
                    <h4 style="font-size: 18px; font-weight: 700; margin-bottom: var(--space-3);">Specialties</h4>
                    <div id="profileCoachSpecialties" style="display: flex; flex-wrap: wrap; gap: var(--space-2); margin-bottom: var(--space-5);"></div>
                    
                    <h4 style="font-size: 18px; font-weight: 700; margin-bottom: var(--space-3);">Session Rate</h4>
                    <p style="font-size: 28px; font-weight: 800; color: var(--black); margin-bottom: var(--space-2);">
                        â‚¬<span id="profileCoachRate"></span> <span style="font-size: 16px; font-weight: 600; color: var(--gray-600);">/session</span>
                    </p>
                    <button class="btn btn-primary btn-large" style="width: 100%;" onclick="openBookingFromProfile()">
                        Book Session
                    </button>
                </div>

                <!-- Reviews Tab -->
                <div class="coach-profile-section" data-section="reviews">
                    <div class="reviews-overview">
                        <div class="reviews-overview-rating" id="reviewsOverviewRating"></div>
                        <div class="star-rating star-rating-large" id="reviewsOverviewStars" style="justify-content: center; margin-bottom: var(--space-2);"></div>
                        <div class="reviews-overview-label" id="reviewsOverviewLabel"></div>
                        <button class="write-review-btn" onclick="showNotification('Write Review', 'Review system coming soon in production!')">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Write Review
                        </button>
                    </div>

                    <div class="reviews-list" id="reviewsList"></div>
                </div>

                <!-- Availability Tab -->
                <div class="coach-profile-section" data-section="availability">
                    <h3 style="font-size: 20px; font-weight: 800; margin-bottom: var(--space-3);">Book a Session</h3>
                    <p style="font-size: 16px; line-height: 1.6; color: var(--gray-700); margin-bottom: var(--space-5);">
                        Select a date and time for your session.
                    </p>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-5);">
                        <!-- Date Picker Column -->
                        <div>
                            <h4 style="font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--gray-500); margin-bottom: var(--space-3);">Select Date</h4>
                            
                            <!-- Mini Calendar -->
                            <div id="availabilityMiniCalendar" class="mini-calendar">
                                <!-- Generated by JS -->
                            </div>
                        </div>

                        <!-- Time Slots Column -->
                        <div>
                            <h4 style="font-size: 14px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--gray-500); margin-bottom: var(--space-3);" id="availableTimesLabel">Select Time</h4>
                            
                            <div id="availabilityTimeSlots" class="availability-time-slots-list">
                                <div style="padding: var(--space-4); text-align: center; color: var(--gray-500);">
                                    Select a date to view available times
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Book Button -->
                    <button class="btn btn-primary btn-large" style="width: 100%; margin-top: var(--space-5);" 
                            onclick="bookSelectedSlot()" id="bookSelectedSlotBtn" disabled>
                        Continue to Booking
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW PACK MODAL -->
    <div class="modal-overlay" id="newPackModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Create Pack</h2>
                <button type="button" class="modal-close" onclick="closeModal('newPackModal')" aria-label="Close">Ã—</button>
            </div>
            <form class="modal-body" onsubmit="submitNewPack(event)">
                <div class="form-group">
                    <label class="form-label">Pack Name</label>
                    <input type="text" class="form-input" placeholder="Urban Flow Collective" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-input" placeholder="Brooklyn, New York" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" placeholder="Describe your pack..." required></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Create Pack</button>
                </div>
            </form>
        </div>
    </div>

    <!-- NEW DISCUSSION MODAL -->
    <div class="modal-overlay" id="newDiscussionModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Start Discussion</h2>
                <button type="button" class="modal-close" onclick="closeModal('newDiscussionModal')" aria-label="Close">Ã—</button>
            </div>
            <form class="modal-body" onsubmit="submitNewDiscussion(event)">
                <div class="form-group">
                    <label class="form-label">Discussion Title</label>
                    <input type="text" class="form-input" placeholder="What's on your mind?" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Content</label>
                    <textarea class="form-textarea" placeholder="Share your thoughts..." required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Image (optional)</label>
                    <input type="file" id="discussionImageFile" class="form-input-file" accept="image/*" onchange="previewDiscussionImage(event)">
                    <div id="discussionImagePreview" class="image-preview"></div>
                </div>
                <div class="form-group">
                    <label class="form-label">Tags (comma-separated)</label>
                    <input type="text" class="form-input" placeholder="movement, practice, philosophy">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Start Discussion</button>
                </div>
            </form>
        </div>
    </div>

    <!-- DISCUSSION DETAIL MODAL -->
    <div class="modal-overlay" id="discussionDetailModal">
        <div class="modal">
            <button class="modal-close" onclick="closeModal('discussionDetailModal')" aria-label="Close">Ã—</button>
            <div id="discussionDetailContent"></div>
        </div>
    </div>

    <!-- PACK DETAIL MODAL -->
    <div class="modal-overlay pack-detail-modal" id="packDetailModal">
        <div class="modal">
            <button class="modal-close" onclick="closeModal('packDetailModal')" aria-label="Close">Ã—</button>
            <div id="packDetailContent"></div>
        </div>
    </div>

    <!-- POST DETAIL MODAL -->
    <div class="modal-overlay post-detail-modal" id="postDetailModal">
        <div class="modal">
            <button class="modal-close" onclick="closeModal('postDetailModal')" aria-label="Close">Ã—</button>
            <div id="postDetailContent"></div>
        </div>
    </div>

    <!-- USER PROFILE MODAL -->
    <div class="modal-overlay" id="userProfileModal">
        <div class="modal user-profile-modal">
            <button class="modal-close" onclick="closeModal('userProfileModal')" aria-label="Close">Ã—</button>
            <div id="userProfileContent"></div>
        </div>
    </div>

    <!-- PRACTICE PARTNER FINDER MODAL (NEW v25 - Training Integration) -->
    <!-- SCHEDULE CONFIGURATION MODAL (v46 - Custom Training Schedule) -->
    <div class="schedule-config-modal" id="scheduleConfigModal" style="display: none;">
        <div class="schedule-config-content">
            <div class="schedule-config-header">
                <h2>Configure Your Training Schedule</h2>
                <p style="font-size: 14px; color: var(--gray-600); margin-top: 8px;">Choose how many days per week you want to train</p>
            </div>
            
            <div class="schedule-config-body">
                <!-- Frequency Selection -->
                <div class="schedule-section">
                    <label class="schedule-label">Training Frequency</label>
                    <div class="frequency-options">
                        <button class="frequency-btn" data-days="3" onclick="selectFrequency(3)">
                            <span class="frequency-number">3</span>
                            <span class="frequency-text">Days/Week</span>
                            <span class="frequency-note">Recommended</span>
                        </button>
                        <button class="frequency-btn" data-days="4" onclick="selectFrequency(4)">
                            <span class="frequency-number">4</span>
                            <span class="frequency-text">Days/Week</span>
                        </button>
                        <button class="frequency-btn" data-days="5" onclick="selectFrequency(5)">
                            <span class="frequency-number">5</span>
                            <span class="frequency-text">Days/Week</span>
                        </button>
                        <button class="frequency-btn" data-days="6" onclick="selectFrequency(6)">
                            <span class="frequency-number">6</span>
                            <span class="frequency-text">Days/Week</span>
                        </button>
                        <button class="frequency-btn" data-days="7" onclick="selectFrequency(7)">
                            <span class="frequency-number">7</span>
                            <span class="frequency-text">Days/Week</span>
                            <span class="frequency-note">Daily Practice</span>
                        </button>
                    </div>
                </div>

                <!-- Day Selection -->
                <div class="schedule-section" id="daySelectionSection" style="display: none;">
                    <label class="schedule-label">Select Your Training Days</label>
                    <div class="day-selector">
                        <button class="day-btn" data-day="1" onclick="toggleDay(1)">
                            <span class="day-abbr">MON</span>
                            <span class="day-name">Monday</span>
                        </button>
                        <button class="day-btn" data-day="2" onclick="toggleDay(2)">
                            <span class="day-abbr">TUE</span>
                            <span class="day-name">Tuesday</span>
                        </button>
                        <button class="day-btn" data-day="3" onclick="toggleDay(3)">
                            <span class="day-abbr">WED</span>
                            <span class="day-name">Wednesday</span>
                        </button>
                        <button class="day-btn" data-day="4" onclick="toggleDay(4)">
                            <span class="day-abbr">THU</span>
                            <span class="day-name">Thursday</span>
                        </button>
                        <button class="day-btn" data-day="5" onclick="toggleDay(5)">
                            <span class="day-abbr">FRI</span>
                            <span class="day-name">Friday</span>
                        </button>
                        <button class="day-btn" data-day="6" onclick="toggleDay(6)">
                            <span class="day-abbr">SAT</span>
                            <span class="day-name">Saturday</span>
                        </button>
                        <button class="day-btn" data-day="0" onclick="toggleDay(0)">
                            <span class="day-abbr">SUN</span>
                            <span class="day-name">Sunday</span>
                        </button>
                    </div>
                    <p class="schedule-helper" id="scheduleHelper">Select your preferred training days</p>
                </div>

                <!-- Program Duration Info -->
                <div class="schedule-info" id="scheduleInfo" style="display: none;">
                    <p class="schedule-info-text">
                        <span id="programDaysText">48 days</span> at 
                        <span id="frequencyText">3 days/week</span> = 
                        <strong id="durationText">16 weeks</strong>
                    </p>
                </div>

                <!-- Action Buttons -->
                <div class="schedule-actions">
                    <button class="btn btn-outline" onclick="closeScheduleConfig()">Cancel</button>
                    <button class="btn btn-primary" id="startProgramBtn" onclick="confirmScheduleAndEnroll()" disabled>
                        Start Program
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- CUSTOM MODAL SYSTEM (v48 - Replace Native Dialogs) -->
    <div class="custom-modal-overlay" id="customModalOverlay" style="display: none;">
        <div class="custom-modal" id="customModal" role="dialog" aria-modal="true" aria-labelledby="customModalTitle">
            <div class="custom-modal-header">
                <h2 class="custom-modal-title" id="customModalTitle"></h2>
            </div>
            <div class="custom-modal-body">
                <p class="custom-modal-message" id="customModalMessage"></p>
            </div>
            <div class="custom-modal-actions" id="customModalActions">
                <!-- Buttons will be inserted here dynamically -->
            </div>
        </div>
    </div>

    <div class="partner-finder-modal" id="partnerFinderModal">
        <div class="partner-finder-content">
            <div class="partner-finder-header">
                <h2>Find Practice Partners</h2>
                <p style="font-size: 14px; color: var(--gray-600); margin-top: 8px;">Connect with practitioners on the same training day</p>
                <button class="modal-close" onclick="closePartnerFinder()" style="position: absolute; top: 24px; right: 24px;">Ã—</button>
            </div>
            <div class="partner-finder-body">
                <div class="session-selector" style="margin-bottom: var(--space-4);">
                    <label class="form-label">Your Current Session</label>
                    <div class="session-grid">
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-size: 13px; color: var(--gray-600);">Path</label>
                            <select id="partnerSearchPath" onchange="updatePartnerSearchDays()">
                                <option value="">Select path</option>
                                <option value="flow">Flow Path</option>
                                <option value="mastery">Mastery Path</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-size: 13px; color: var(--gray-600);">Day</label>
                            <select id="partnerSearchDay" onchange="findPartners()" disabled>
                                <option value="">Select path first</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div id="partnerResults">
                    <div style="text-align: center; padding: var(--space-8) var(--space-4); color: var(--gray-500);">
                        <p style="font-size: 16px;">Select your path and day to find partners</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- EVENT CREATION MODAL (NEW v26 - Event Organization) -->
    <div class="modal-overlay" id="eventModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Create Training Event</h2>
                <button type="button" class="modal-close" onclick="closeModal('eventModal')" aria-label="Close">Ã—</button>
            </div>
            <form class="modal-body" onsubmit="submitNewEvent(event)">
                <div class="form-group">
                    <label class="form-label">Event Title</label>
                    <input type="text" id="eventTitle" class="form-input" placeholder="Sunday Morning Flow" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Pack</label>
                    <select id="eventPack" class="form-input" required>
                        <option value="">Select pack...</option>
                    </select>
                </div>
                <div class="session-grid">
                    <div class="form-group">
                        <label class="form-label">Date</label>
                        <input type="date" id="eventDate" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Time</label>
                        <input type="time" id="eventTime" class="form-input" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" id="eventLocation" class="form-input" placeholder="Central Park, North Meadow" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="eventDescription" class="form-textarea" placeholder="What will we practice together?" required></textarea>
                </div>
                <div class="session-selector">
                    <label class="form-label">Link to Training Path (optional)</label>
                    <div class="session-grid">
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-size: 13px; color: var(--gray-600);">Path</label>
                            <select id="eventSessionPath" onchange="updateEventSessionDays()">
                                <option value="">None</option>
                                <option value="flow">Flow Path</option>
                                <option value="mastery">Mastery Path</option>
                            </select>
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 4px; font-size: 13px; color: var(--gray-600);">Day</label>
                            <select id="eventSessionDay" disabled>
                                <option value="">Select path first</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Create Event</button>
                </div>
            </form>
        </div>
    </div>

    <!-- PACK CALENDAR MODAL (NEW v26 - Event Organization) -->
    <div class="calendar-modal" id="calendarModal">
        <div class="calendar-content">
            <div class="calendar-header">
                <h2>Pack Calendar</h2>
                <p style="font-size: 14px; color: var(--gray-600); margin-top: 8px;">Training events and gatherings</p>
                <button class="modal-close" onclick="closeCalendar()" style="position: absolute; top: 24px; right: 24px;">Ã—</button>
            </div>
            <div class="calendar-body">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-4);">
                    <h3 id="calendarMonth" style="font-size: 20px; font-weight: 700;"></h3>
                    <div style="display: flex; gap: var(--space-1);">
                        <button onclick="previousMonth()" class="btn btn-outline" style="padding: 8px 16px;">â†</button>
                        <button onclick="nextMonth()" class="btn btn-outline" style="padding: 8px 16px;">â†’</button>
                    </div>
                </div>
                <div class="calendar-grid">
                    <div class="calendar-day-header">Sun</div>
                    <div class="calendar-day-header">Mon</div>
                    <div class="calendar-day-header">Tue</div>
                    <div class="calendar-day-header">Wed</div>
                    <div class="calendar-day-header">Thu</div>
                    <div class="calendar-day-header">Fri</div>
                    <div class="calendar-day-header">Sat</div>
                </div>
                <div id="calendarDays" class="calendar-grid"></div>
                <div id="calendarEvents" style="margin-top: var(--space-4);"></div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         COACH BOOKING MODAL
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="booking-modal" id="bookingModal">
        <div class="booking-modal-overlay" onclick="closeBookingModal()"></div>
        <div class="booking-modal-content">
            <button class="booking-modal-close" onclick="closeBookingModal()" aria-label="Close booking modal">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>

            <!-- Header with Coach Info -->
            <div class="booking-header">
                <div class="booking-coach-info">
                    <img id="bookingCoachAvatar" src="" alt="" class="booking-coach-avatar">
                    <div class="booking-coach-details">
                        <h3 id="bookingCoachName"></h3>
                        <p id="bookingCoachLocation"></p>
                    </div>
                </div>

                <!-- Step Indicator -->
                <div class="booking-steps">
                    <div class="booking-step active" data-step="1">
                        <span class="booking-step-number">1</span>
                        <span class="booking-step-label">Date & Time</span>
                    </div>
                    <div class="booking-step" data-step="2">
                        <span class="booking-step-number">2</span>
                        <span class="booking-step-label">Details</span>
                    </div>
                    <div class="booking-step" data-step="3">
                        <span class="booking-step-number">3</span>
                        <span class="booking-step-label">Confirm</span>
                    </div>
                </div>
            </div>

            <!-- Body - Step 1: Date & Time -->
            <div class="booking-body">
                <div class="booking-body-step active" data-step="1">
                    <h3 class="booking-section-title">Select Date & Time</h3>
                    
                    <p style="font-size: 14px; color: var(--gray-600); margin-bottom: var(--space-4);">
                        Choose your preferred session date and time.
                    </p>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-4);">
                        <!-- Date Picker Column -->
                        <div>
                            <h4 style="font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--gray-500); margin-bottom: var(--space-2);">Select Date</h4>
                            
                            <!-- Mini Calendar -->
                            <div id="bookingMiniCalendar" class="mini-calendar mini-calendar-compact">
                                <!-- Generated by JS -->
                            </div>
                        </div>

                        <!-- Time Slots Column -->
                        <div>
                            <h4 style="font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; color: var(--gray-500); margin-bottom: var(--space-2);" id="bookingAvailableTimesLabel">Select Time</h4>
                            
                            <div id="bookingTimeSlotsList" class="availability-time-slots-list availability-time-slots-compact">
                                <div style="padding: var(--space-3); text-align: center; color: var(--gray-500); font-size: 13px;">
                                    Select a date to view available times
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Session Details -->
                <div class="booking-body-step" data-step="2">
                    <h3 class="booking-section-title">Session Details</h3>

                    <div class="booking-form-group">
                        <label class="booking-form-label" for="sessionType">Session Type</label>
                        <select class="booking-form-select" id="sessionType">
                            <option value="">Select session type...</option>
                            <option value="intro">Introduction Session (30 min) - First time</option>
                            <option value="regular">Regular Session (60 min) - Standard practice</option>
                            <option value="deep">Deep Dive Session (90 min) - Extended work</option>
                        </select>
                        <p class="booking-form-hint">Choose the session format that fits your needs.</p>
                    </div>

                    <div class="booking-form-group">
                        <label class="booking-form-label" for="sessionLocation">Location</label>
                        <select class="booking-form-select" id="sessionLocation">
                            <option value="">Select location...</option>
                            <option value="online">Online (Video Call)</option>
                            <option value="in-person">In-Person</option>
                        </select>
                        <p class="booking-form-hint">Video call link will be sent after booking confirmation.</p>
                    </div>

                    <div class="booking-form-group">
                        <label class="booking-form-label" for="sessionGoals">Goals & Focus Areas</label>
                        <textarea 
                            class="booking-form-textarea" 
                            id="sessionGoals" 
                            placeholder="What would you like to work on? Any specific movements, challenges, or areas of focus?"
                            rows="4"
                        ></textarea>
                        <p class="booking-form-hint">Help your coach prepare for your session.</p>
                    </div>

                    <div class="booking-form-group">
                        <label class="booking-form-label" for="sessionNotes">Special Requirements (Optional)</label>
                        <textarea 
                            class="booking-form-textarea" 
                            id="sessionNotes" 
                            placeholder="Any injuries, limitations, or other information your coach should know?"
                            rows="3"
                        ></textarea>
                    </div>
                </div>

                <!-- Step 3: Confirmation -->
                <div class="booking-body-step" data-step="3">
                    <h3 class="booking-section-title">Booking Summary</h3>

                    <div class="booking-summary">
                        <div class="booking-summary-row">
                            <span class="booking-summary-label">Coach</span>
                            <span class="booking-summary-value" id="summaryCoachName"></span>
                        </div>
                        <div class="booking-summary-row">
                            <span class="booking-summary-label">Date & Time</span>
                            <span class="booking-summary-value" id="summaryDateTime"></span>
                        </div>
                        <div class="booking-summary-row">
                            <span class="booking-summary-label">Session Type</span>
                            <span class="booking-summary-value" id="summarySessionType"></span>
                        </div>
                        <div class="booking-summary-row">
                            <span class="booking-summary-label">Location</span>
                            <span class="booking-summary-value" id="summaryLocation"></span>
                        </div>
                        <div class="booking-summary-row">
                            <span class="booking-summary-label">Total Price</span>
                            <span class="booking-summary-value" id="summaryPrice"></span>
                        </div>
                    </div>

                    <p style="font-size: 14px; color: var(--gray-600); line-height: 1.6;">
                        By confirming this booking, you agree to our cancellation policy. 
                        You'll receive a confirmation email with all session details and payment instructions.
                    </p>
                </div>

                <!-- Confirmation Screen (shown after successful booking) -->
                <div class="booking-body-step" data-step="4">
                    <div class="booking-confirmation">
                        <div class="booking-confirmation-icon">âœ“</div>
                        <h3 class="booking-confirmation-title">BOOKING CONFIRMED</h3>
                        <p class="booking-confirmation-message">
                            Your session has been successfully booked. You'll receive a confirmation email shortly with all the details.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Footer with Navigation Buttons -->
            <div class="booking-footer">
                <button 
                    class="booking-btn booking-btn-secondary" 
                    id="bookingBackBtn" 
                    onclick="previousBookingStep()"
                    style="display: none;">
                    Back
                </button>
                <button 
                    class="booking-btn booking-btn-primary" 
                    id="bookingNextBtn" 
                    onclick="nextBookingStep()"
                    disabled>
                    Next
                </button>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // HUDEN TRIBE v29 - JAVASCRIPT WITH API INTEGRATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // API CONFIGURATION & SERVICE LAYER - PASO 4a: API SETUP
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        /**
         * API Configuration Object
         * Toggle useMock to switch between mock data and real API calls
         */
        const API_CONFIG = {
            baseURL: 'https://api.huden.movement/v1',
            timeout: 10000,
            useMock: true, // â† SET TO FALSE FOR PRODUCTION
            retryAttempts: 3,
            retryDelay: 1000,
            endpoints: {
                coaches: '/coaches',
                coachById: '/coaches/:id',
                coachReviews: '/coaches/:id/reviews',
                coachAvailability: '/coaches/:id/availability',
                bookings: '/bookings',
                reviews: '/reviews'
            }
        };

        /**
         * Coach API Service Class
         * Handles all API communication for coaches
         */
        class CoachAPI {
            constructor(config) {
                this.config = config;
                this.baseURL = config.baseURL;
                this.useMock = config.useMock;
                this.timeout = config.timeout;
            }

            /**
             * Generic request method with retry logic
             */
            async request(endpoint, options = {}) {
                const url = `${this.baseURL}${endpoint}`;
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), this.timeout);

                try {
                    const response = await fetch(url, {
                        ...options,
                        signal: controller.signal,
                        headers: {
                            'Content-Type': 'application/json',
                            ...options.headers
                        }
                    });

                    clearTimeout(timeoutId);

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status} ${response.statusText}`);
                    }

                    return await response.json();
                } catch (error) {
                    clearTimeout(timeoutId);
                    throw error;
                }
            }

            /**
             * Retry request with exponential backoff
             */
            async retryRequest(fn, attempts = this.config.retryAttempts) {
                for (let i = 0; i < attempts; i++) {
                    try {
                        return await fn();
                    } catch (error) {
                        if (i === attempts - 1) throw error;
                        await this.sleep(this.config.retryDelay * (i + 1));
                        console.log(`Retry attempt ${i + 1}/${attempts}`);
                    }
                }
            }

            /**
             * Sleep utility for retry delays
             */
            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            /**
             * Fetch all coaches with optional filters
             */
            async fetchCoaches(filters = {}) {
                if (this.useMock) {
                    console.log('[COACH API] Using mock data (useMock = true)');
                    return mockCoaches; // Will use existing mock data
                }

                console.log('[COACH API] Fetching from real API...', filters);

                try {
                    const queryParams = new URLSearchParams(filters).toString();
                    const endpoint = queryParams 
                        ? `${this.config.endpoints.coaches}?${queryParams}`
                        : this.config.endpoints.coaches;

                    const response = await this.retryRequest(() => 
                        this.request(endpoint)
                    );

                    return response.data.map(coach => this.adaptCoachFromAPI(coach));
                } catch (error) {
                    console.error('[COACH API] Failed to fetch coaches:', error);
                    toast('Failed to load coaches. Showing cached data.', 'error');
                    return mockCoaches; // Fallback to mock data
                }
            }

            /**
             * Fetch single coach by ID
             */
            async fetchCoachById(id) {
                if (this.useMock) {
                    console.log(`[COACH API] Using mock data for coach ID: ${id}`);
                    return mockCoaches.find(c => c.id === id);
                }

                console.log(`[COACH API] Fetching coach ID: ${id}`);

                try {
                    const endpoint = this.config.endpoints.coachById.replace(':id', id);
                    const response = await this.retryRequest(() => 
                        this.request(endpoint)
                    );

                    return this.adaptCoachFromAPI(response.data);
                } catch (error) {
                    console.error('[COACH API] Failed to fetch coach:', error);
                    toast('Failed to load coach profile.', 'error');
                    return mockCoaches.find(c => c.id === id); // Fallback
                }
            }

            /**
             * Fetch coach reviews
             */
            async fetchCoachReviews(coachId) {
                if (this.useMock) {
                    console.log(`[COACH API] Using mock reviews for coach ID: ${coachId}`);
                    const coach = mockCoaches.find(c => c.id === coachId);
                    return coach?.reviews || [];
                }

                console.log(`[COACH API] Fetching reviews for coach ID: ${coachId}`);

                try {
                    const endpoint = this.config.endpoints.coachReviews.replace(':id', coachId);
                    const response = await this.retryRequest(() => 
                        this.request(endpoint)
                    );

                    return response.data;
                } catch (error) {
                    console.error('[COACH API] Failed to fetch reviews:', error);
                    const coach = mockCoaches.find(c => c.id === coachId);
                    return coach?.reviews || [];
                }
            }

            /**
             * Fetch coach availability
             */
            async fetchCoachAvailability(coachId) {
                if (this.useMock) {
                    console.log(`[COACH API] Using mock availability for coach ID: ${coachId}`);
                    return {
                        available: true,
                        nextAvailableDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]
                    };
                }

                console.log(`[COACH API] Fetching availability for coach ID: ${coachId}`);

                try {
                    const endpoint = this.config.endpoints.coachAvailability.replace(':id', coachId);
                    const response = await this.retryRequest(() => 
                        this.request(endpoint)
                    );

                    return response.data;
                } catch (error) {
                    console.error('[COACH API] Failed to fetch availability:', error);
                    return { available: false };
                }
            }

            /**
             * Create booking
             */
            async createBooking(bookingData) {
                if (this.useMock) {
                    console.log('[COACH API] Mock booking created:', bookingData);
                    return {
                        success: true,
                        bookingId: `MOCK-${Date.now()}`,
                        status: 'confirmed',
                        message: 'Booking created successfully (MOCK)'
                    };
                }

                console.log('[COACH API] Creating booking:', bookingData);

                try {
                    const response = await this.retryRequest(() =>
                        this.request(this.config.endpoints.bookings, {
                            method: 'POST',
                            body: JSON.stringify(this.adaptBookingToAPI(bookingData))
                        })
                    );

                    return response.data;
                } catch (error) {
                    console.error('[COACH API] Failed to create booking:', error);
                    throw error;
                }
            }

            /**
             * Submit review
             */
            async submitReview(reviewData) {
                if (this.useMock) {
                    console.log('[COACH API] Mock review submitted:', reviewData);
                    return {
                        success: true,
                        reviewId: `REVIEW-${Date.now()}`,
                        message: 'Review submitted successfully (MOCK)'
                    };
                }

                console.log('[COACH API] Submitting review:', reviewData);

                try {
                    const response = await this.retryRequest(() =>
                        this.request(this.config.endpoints.reviews, {
                            method: 'POST',
                            body: JSON.stringify(this.adaptReviewToAPI(reviewData))
                        })
                    );

                    return response.data;
                } catch (error) {
                    console.error('[COACH API] Failed to submit review:', error);
                    throw error;
                }
            }

            /**
             * DATA ADAPTERS - Transform API responses to internal format
             */

            /**
             * Adapt coach data from API format to internal format
             */
            adaptCoachFromAPI(apiCoach) {
                return {
                    id: apiCoach.id,
                    name: apiCoach.name,
                    location: apiCoach.location,
                    tier: apiCoach.tier || 'coach',
                    image: apiCoach.image_url || 'https://i.pravatar.cc/300',
                    bio: apiCoach.bio,
                    specialties: apiCoach.specialties || [],
                    rate: apiCoach.rate,
                    currency: apiCoach.currency || 'EUR',
                    available: apiCoach.available !== false,
                    rating: apiCoach.rating || 0,
                    reviewCount: apiCoach.review_count || 0,
                    reviews: apiCoach.reviews || [],
                    timezone: apiCoach.timezone || 'UTC'
                };
            }

            /**
             * Adapt booking data to API format
             */
            adaptBookingToAPI(booking) {
                return {
                    coach_id: booking.coachId,
                    date: booking.date,
                    time: booking.time,
                    session_type: booking.sessionType,
                    location: booking.location,
                    goals: booking.goals,
                    notes: booking.notes || '',
                    user_timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
                };
            }

            /**
             * Adapt review data to API format
             */
            adaptReviewToAPI(review) {
                return {
                    coach_id: review.coachId,
                    rating: review.rating,
                    comment: review.comment,
                    session_date: review.sessionDate,
                    user_name: review.userName || 'Anonymous'
                };
            }
        }

        /**
         * Initialize Coach API instance
         */
        const coachAPI = new CoachAPI(API_CONFIG);

        // Log API mode on startup
        console.log(`
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ COACH API INITIALIZED - PASO 4a: API SETUP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Mode: ${API_CONFIG.useMock ? 'MOCK DATA (Development)' : 'REAL API (Production)'}
Base URL: ${API_CONFIG.baseURL}
Timeout: ${API_CONFIG.timeout}ms
Retry Attempts: ${API_CONFIG.retryAttempts}

To switch to production API:
1. Set API_CONFIG.useMock = false
2. Configure API_CONFIG.baseURL to your production endpoint
3. Test all endpoints thoroughly

Current endpoints:
${Object.entries(API_CONFIG.endpoints).map(([key, val]) => `  - ${key}: ${val}`).join('\n')}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        `);


        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PERFORMANCE MONITORING & TESTING TOOLS - PASO 4c
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        /**
         * Performance Monitor
         * Tracks API call timing and success rates
         */
        class PerformanceMonitor {
            constructor() {
                this.metrics = {
                    apiCalls: [],
                    totalCalls: 0,
                    successfulCalls: 0,
                    failedCalls: 0,
                    averageResponseTime: 0,
                    cacheHits: 0
                };
            }

            /**
             * Start timing an API call
             */
            startTimer(endpoint) {
                return {
                    endpoint,
                    startTime: performance.now()
                };
            }

            /**
             * Record completed API call
             */
            recordCall(timer, success, fromCache = false) {
                const duration = performance.now() - timer.startTime;
                
                this.metrics.apiCalls.push({
                    endpoint: timer.endpoint,
                    duration,
                    success,
                    fromCache,
                    timestamp: new Date().toISOString()
                });

                this.metrics.totalCalls++;
                if (success) {
                    this.metrics.successfulCalls++;
                } else {
                    this.metrics.failedCalls++;
                }
                
                if (fromCache) {
                    this.metrics.cacheHits++;
                }

                // Calculate average response time (last 10 calls)
                const recentCalls = this.metrics.apiCalls.slice(-10);
                this.metrics.averageResponseTime = 
                    recentCalls.reduce((sum, call) => sum + call.duration, 0) / recentCalls.length;

                console.log(`[PERF] ${timer.endpoint} - ${duration.toFixed(2)}ms - ${success ? 'âœ“' : 'âœ—'} ${fromCache ? '(cached)' : ''}`);
            }

            /**
             * Get performance report
             */
            getReport() {
                const successRate = this.metrics.totalCalls > 0 
                    ? (this.metrics.successfulCalls / this.metrics.totalCalls * 100).toFixed(1)
                    : 0;
                
                const cacheRate = this.metrics.totalCalls > 0
                    ? (this.metrics.cacheHits / this.metrics.totalCalls * 100).toFixed(1)
                    : 0;

                return {
                    ...this.metrics,
                    successRate: `${successRate}%`,
                    cacheRate: `${cacheRate}%`,
                    averageResponseTime: `${this.metrics.averageResponseTime.toFixed(2)}ms`
                };
            }

            /**
             * Print report to console
             */
            printReport() {
                const report = this.getReport();
                console.log(`
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š PERFORMANCE REPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Total API Calls: ${report.totalCalls}
Successful: ${report.successfulCalls} (${report.successRate})
Failed: ${report.failedCalls}
Cache Hits: ${report.cacheHits} (${report.cacheRate})
Average Response Time: ${report.averageResponseTime}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                `);
            }

            /**
             * Reset metrics
             */
            reset() {
                this.metrics = {
                    apiCalls: [],
                    totalCalls: 0,
                    successfulCalls: 0,
                    failedCalls: 0,
                    averageResponseTime: 0,
                    cacheHits: 0
                };
                console.log('[PERF] Metrics reset');
            }
        }


        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PERFORMANCE UTILITIES - Debounce, Throttle, Lazy Loading
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        /**
         * Debounce function - delays execution until after wait time
         */
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        /**
         * Throttle function - limits execution frequency
         */
        function throttle(func, limit) {
            let inThrottle;
            return function(...args) {
                if (!inThrottle) {
                    func.apply(this, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        }

        /**
         * Lazy Load Images
         * Implements Intersection Observer for efficient image loading
         */
        class LazyLoader {
            constructor() {
                this.observer = null;
                this.init();
            }

            init() {
                if ('IntersectionObserver' in window) {
                    this.observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                const img = entry.target;
                                this.loadImage(img);
                                this.observer.unobserve(img);
                            }
                        });
                    }, {
                        rootMargin: '50px 0px',
                        threshold: 0.01
                    });
                } else {
                    // Fallback for older browsers
                    this.loadAllImages();
                }
            }

            loadImage(img) {
                if (img.dataset.src) {
                    img.src = img.dataset.src;
                    img.classList.add('loaded');
                    img.removeAttribute('data-src');
                }
            }

            loadAllImages() {
                document.querySelectorAll('img[data-src]').forEach(img => {
                    this.loadImage(img);
                });
            }

            observe(element) {
                if (this.observer && element) {
                    this.observer.observe(element);
                }
            }

            observeAll() {
                document.querySelectorAll('img[data-src]').forEach(img => {
                    this.observe(img);
                });
            }
        }

        // Initialize lazy loader
        const lazyLoader = new LazyLoader();

        /**
         * Memoization helper for expensive calculations
         */
        function memoize(fn) {
            const cache = new Map();
            return function(...args) {
                const key = JSON.stringify(args);
                if (cache.has(key)) {
                    return cache.get(key);
                }
                const result = fn.apply(this, args);
                cache.set(key, result);
                return result;
            };
        }

        /**
         * Request Animation Frame throttle for smooth scrolling
         */
        function rafThrottle(fn) {
            let running = false;
            return function(...args) {
                if (running) return;
                running = true;
                requestAnimationFrame(() => {
                    fn.apply(this, args);
                    running = false;
                });
            };
        }


        /**
         * Network Simulator
         * Simulates various network conditions for testing
         */
        class NetworkSimulator {
            constructor() {
                this.enabled = false;
                this.delay = 1000; // ms
                this.failureRate = 0; // 0-1 (0 = never fail, 1 = always fail)
                this.packetLoss = 0; // 0-1 (0 = no loss, 1 = total loss)
            }

            /**
             * Enable network simulation
             */
            enable(options = {}) {
                this.enabled = true;
                this.delay = options.delay || 1000;
                this.failureRate = options.failureRate || 0;
                this.packetLoss = options.packetLoss || 0;
                
                console.log(`[NETWORK SIM] Enabled - Delay: ${this.delay}ms, Failure Rate: ${this.failureRate * 100}%`);
            }

            /**
             * Disable network simulation
             */
            disable() {
                this.enabled = false;
                console.log('[NETWORK SIM] Disabled');
            }

            /**
             * Simulate slow network
             */
            simulateSlow() {
                this.enable({ delay: 3000, failureRate: 0.1, packetLoss: 0.05 });
            }

            /**
             * Simulate fast network (5G)
             */
            simulateFast() {
                this.enable({ delay: 100, failureRate: 0.01, packetLoss: 0 });
            }

            /**
             * Simulate offline
             */
            simulateOffline() {
                this.enable({ delay: 0, failureRate: 1, packetLoss: 1 });
            }

            /**
             * Apply network conditions to a request
             */
            async apply(fn) {
                if (!this.enabled) {
                    return await fn();
                }

                // Simulate delay
                if (this.delay > 0) {
                    await new Promise(resolve => setTimeout(resolve, this.delay));
                }

                // Simulate packet loss
                if (Math.random() < this.packetLoss) {
                    throw new Error('Network Error: Packet loss');
                }

                // Simulate failure
                if (Math.random() < this.failureRate) {
                    throw new Error('Network Error: Request failed');
                }

                return await fn();
            }
        }

        /**
         * API Testing Utilities
         * Helper functions for testing API integration
         */
        class APITestingUtils {
            constructor(api, perfMonitor, networkSim) {
                this.api = api;
                this.perfMonitor = perfMonitor;
                this.networkSim = networkSim;
            }

            /**
             * Test all API endpoints
             */
            async testAllEndpoints() {
                console.log('[API TEST] Starting comprehensive endpoint test...');
                
                const results = {
                    fetchCoaches: null,
                    fetchCoachById: null,
                    fetchCoachReviews: null,
                    createBooking: null
                };

                // Test fetchCoaches
                try {
                    const timer = this.perfMonitor.startTimer('fetchCoaches');
                    await this.api.fetchCoaches();
                    this.perfMonitor.recordCall(timer, true);
                    results.fetchCoaches = 'PASS âœ“';
                } catch (error) {
                    results.fetchCoaches = `FAIL âœ— - ${error.message}`;
                }

                // Test fetchCoachById
                try {
                    const timer = this.perfMonitor.startTimer('fetchCoachById');
                    await this.api.fetchCoachById(1);
                    this.perfMonitor.recordCall(timer, true);
                    results.fetchCoachById = 'PASS âœ“';
                } catch (error) {
                    results.fetchCoachById = `FAIL âœ— - ${error.message}`;
                }

                // Test fetchCoachReviews
                try {
                    const timer = this.perfMonitor.startTimer('fetchCoachReviews');
                    await this.api.fetchCoachReviews(1);
                    this.perfMonitor.recordCall(timer, true);
                    results.fetchCoachReviews = 'PASS âœ“';
                } catch (error) {
                    results.fetchCoachReviews = `FAIL âœ— - ${error.message}`;
                }

                // Test createBooking
                try {
                    const timer = this.perfMonitor.startTimer('createBooking');
                    await this.api.createBooking({
                        coachId: 1,
                        date: '2025-03-15',
                        time: '14:00',
                        sessionType: 'regular',
                        location: 'online',
                        goals: 'Test booking',
                        notes: 'Automated test'
                    });
                    this.perfMonitor.recordCall(timer, true);
                    results.createBooking = 'PASS âœ“';
                } catch (error) {
                    results.createBooking = `FAIL âœ— - ${error.message}`;
                }

                console.log(`
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ§ª API ENDPOINT TEST RESULTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
fetchCoaches:       ${results.fetchCoaches}
fetchCoachById:     ${results.fetchCoachById}
fetchCoachReviews:  ${results.fetchCoachReviews}
createBooking:      ${results.createBooking}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                `);

                return results;
            }

            /**
             * Test error scenarios
             */
            async testErrorScenarios() {
                console.log('[API TEST] Testing error scenarios...');
                
                // Test with network failure
                this.networkSim.simulateOffline();
                
                try {
                    await this.api.fetchCoaches();
                    console.log('âœ— Error scenario test FAILED - Should have thrown error');
                } catch (error) {
                    console.log('âœ“ Error scenario test PASSED - Error caught correctly:', error.message);
                }

                this.networkSim.disable();
            }

            /**
             * Test retry logic
             */
            async testRetryLogic() {
                console.log('[API TEST] Testing retry logic...');
                
                // Simulate flaky network
                this.networkSim.enable({ delay: 500, failureRate: 0.7 });
                
                try {
                    const timer = this.perfMonitor.startTimer('retryTest');
                    await this.api.fetchCoaches();
                    this.perfMonitor.recordCall(timer, true);
                    console.log('âœ“ Retry logic test PASSED - Request succeeded after retries');
                } catch (error) {
                    console.log('â„¹ Retry logic test - Request failed after all retries:', error.message);
                }

                this.networkSim.disable();
            }
        }

        // Initialize testing tools
        const perfMonitor = new PerformanceMonitor();
        const networkSim = new NetworkSimulator();
        const apiTestUtils = new APITestingUtils(coachAPI, perfMonitor, networkSim);

        // Expose testing tools globally for console access
        window.hudenDevTools = {
            api: coachAPI,
            perf: perfMonitor,
            network: networkSim,
            test: apiTestUtils,
            
            // Quick test commands
            testAll: () => apiTestUtils.testAllEndpoints(),
            testErrors: () => apiTestUtils.testErrorScenarios(),
            testRetry: () => apiTestUtils.testRetryLogic(),
            perfReport: () => perfMonitor.printReport(),
            resetPerf: () => perfMonitor.reset(),
            
            // Network presets
            slow: () => networkSim.simulateSlow(),
            fast: () => networkSim.simulateFast(),
            offline: () => networkSim.simulateOffline(),
            networkOff: () => networkSim.disable(),
            
            // Toggle mock mode
            useMock: () => {
                API_CONFIG.useMock = true;
                console.log('[DEV TOOLS] Mock mode enabled');
            },
            useReal: () => {
                API_CONFIG.useMock = false;
                console.log('[DEV TOOLS] Real API mode enabled');
            },
            
            help: () => {
                console.log(`
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ› ï¸  HUDEN DEV TOOLS - Available Commands
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TESTING:
  hudenDevTools.testAll()      - Test all API endpoints
  hudenDevTools.testErrors()   - Test error scenarios
  hudenDevTools.testRetry()    - Test retry logic

PERFORMANCE:
  hudenDevTools.perfReport()   - Show performance report
  hudenDevTools.resetPerf()    - Reset performance metrics

NETWORK SIMULATION:
  hudenDevTools.slow()         - Simulate slow network (3G)
  hudenDevTools.fast()         - Simulate fast network (5G)
  hudenDevTools.offline()      - Simulate offline mode
  hudenDevTools.networkOff()   - Disable network simulation

MODE TOGGLE:
  hudenDevTools.useMock()      - Use mock data (development)
  hudenDevTools.useReal()      - Use real API (production)

DIRECT ACCESS:
  hudenDevTools.api            - CoachAPI instance
  hudenDevTools.perf           - PerformanceMonitor instance
  hudenDevTools.network        - NetworkSimulator instance

EXAMPLE USAGE:
  hudenDevTools.slow()         // Enable slow network
  await renderCoaches()        // Test with slow network
  hudenDevTools.perfReport()   // Check performance
  hudenDevTools.networkOff()   // Disable simulation
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                `);
            }
        };

        // Log dev tools availability
        console.log(`
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ› ï¸  DEV TOOLS AVAILABLE - PASO 4c: TESTING & POLISH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Type: hudenDevTools.help()

Quick commands:
  hudenDevTools.testAll()      - Test all endpoints
  hudenDevTools.perfReport()   - Performance report
  hudenDevTools.slow()         - Simulate slow network
  hudenDevTools.offline()      - Simulate offline mode
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        `);


        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // AUTHENTICATION & TIERS
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function getUserTier() {
            // Fallback to 'flow' (lowercase) if not set
            return localStorage.getItem('userTier') || 'flow';
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // ROLE SELECTOR - TESTING TOOL (Ctrl+R)
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function toggleRoleSelector() {
            const overlay = document.getElementById('roleSelectorOverlay');
            const isActive = overlay.classList.contains('active');
            
            if (isActive) {
                overlay.classList.remove('active');
            } else {
                overlay.classList.add('active');
                updateRoleSelectorUI();
            }
        }

        function switchRole(tier) {
            // Update localStorage FIRST
            localStorage.setItem('userTier', tier);
            
            console.log(`[switchRole] Changed to tier: ${tier}`);
            
            // Update UI
            updateRoleSelectorUI();
            
            // Show toast notification
            toast(`Switched to ${tier.toUpperCase()} tier`);
            
            // Reload current tab to apply new permissions (this will call loadWisdomLibrary if needed)
            if (currentTab) {
                console.log(`[switchRole] Reloading tab: ${currentTab}`);
                switchTab(currentTab);
            }
            
            // Close selector after short delay
            setTimeout(() => {
                toggleRoleSelector();
            }, 500);
            
            logEvent('role_switched', { tier });
        }

        function updateRoleSelectorUI() {
            const currentTier = getUserTier();
            
            // Update current tier display
            document.getElementById('currentTierDisplay').textContent = currentTier.toUpperCase();
            
            // Update button states
            document.querySelectorAll('.role-selector-button').forEach(btn => {
                const btnTier = btn.getAttribute('data-tier');
                if (btnTier === currentTier) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        // Keyboard shortcut: Ctrl+R to toggle Role Selector
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'r') {
                e.preventDefault();
                toggleRoleSelector();
            }
            
            // ESC also closes Role Selector
            if (e.key === 'Escape') {
                const roleSelectorOverlay = document.getElementById('roleSelectorOverlay');
                if (roleSelectorOverlay && roleSelectorOverlay.classList.contains('active')) {
                    toggleRoleSelector();
                }
            }
        });

        // Close Role Selector on overlay click
        document.addEventListener('DOMContentLoaded', () => {
            const overlay = document.getElementById('roleSelectorOverlay');
            if (overlay) {
                overlay.addEventListener('click', (e) => {
                    if (e.target.id === 'roleSelectorOverlay') {
                        toggleRoleSelector();
                    }
                });
            }
        });

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // TOAST NOTIFICATIONS - WITH STACKING PREVENTION
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function toast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            
            // Remove any existing toasts to prevent stacking
            const existingToasts = container.querySelectorAll('.toast');
            existingToasts.forEach(t => t.remove());
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            
            // Add ARIA attributes for accessibility
            toast.setAttribute('role', 'status');
            toast.setAttribute('aria-live', 'polite');
            toast.setAttribute('aria-atomic', 'true');
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
            
            logEvent('toast_shown', { message, type });
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // PUSH NOTIFICATIONS SYSTEM (v46 - Web Push API)
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        const PushNotifications = {
            permission: 'default',
            enabled: false,
            
            async init() {
                // Check if browser supports notifications
                if (!('Notification' in window)) {
                    console.log('âŒ Push notifications not supported in this browser');
                    return false;
                }
                
                this.permission = Notification.permission;
                this.enabled = localStorage.getItem('pushNotificationsEnabled') === 'true';
                
                console.log(`âœ“ Push notifications initialized (Permission: ${this.permission}, Enabled: ${this.enabled})`);
                
                // Auto-request permission if user has training schedule but hasn't decided
                const hasSchedule = this.hasActiveSchedule();
                if (hasSchedule && this.permission === 'default') {
                    setTimeout(() => {
                        this.promptPermission();
                    }, 3000); // Wait 3 seconds after page load
                }
                
                // Schedule notifications if enabled
                if (this.enabled && this.permission === 'granted') {
                    this.scheduleDailyCheck();
                }
                
                return true;
            },
            
            hasActiveSchedule() {
                const progress = getUserTrainingProgress();
                return progress.essential?.enrolled || progress.flow?.enrolled || progress.mastery?.enrolled;
            },
            
            async promptPermission() {
                if (this.permission === 'granted') {
                    this.enabled = true;
                    localStorage.setItem('pushNotificationsEnabled', 'true');
                    toast('Training reminders enabled');
                    this.scheduleDailyCheck();
                    return true;
                }
                
                if (this.permission === 'denied') {
                    console.log('âŒ Notification permission denied');
                    return false;
                }
                
                // Show custom prompt first
                const userWants = await CustomModal.confirm(
                    "TRAINING REMINDERS",
                    "Enable notifications to receive:\n" +
                    "â€¢ Training day reminders\n" +
                    "â€¢ Session notifications\n" +
                    "â€¢ Rest day celebrations\n" +
                    "â€¢ Milestone achievements\n\n" +
                    "You can disable this anytime in settings.",
                    { confirmText: 'Enable', cancelText: 'Not Now' }
                );
                
                if (!userWants) {
                    console.log('User declined notification prompt');
                    return false;
                }
                
                // Request browser permission
                try {
                    this.permission = await Notification.requestPermission();
                    
                    if (this.permission === 'granted') {
                        this.enabled = true;
                        localStorage.setItem('pushNotificationsEnabled', 'true');
                        
                        // Show test notification
                        this.send({
                            title: 'Training Reminders Enabled',
                            body: 'You will receive notifications for your training days',
                            icon: '/favicon.ico',
                            tag: 'welcome'
                        });
                        
                        toast('Training reminders enabled');
                        this.scheduleDailyCheck();
                        return true;
                    } else {
                        console.log('âŒ Notification permission denied');
                        return false;
                    }
                } catch (error) {
                    console.error('Error requesting notification permission:', error);
                    return false;
                }
            },
            
            send(options) {
                if (this.permission !== 'granted') {
                    console.log('âš ï¸ Cannot send notification - permission not granted');
                    return null;
                }
                
                const defaults = {
                    icon: '/favicon.ico',
                    badge: '/favicon.ico',
                    vibrate: [200, 100, 200],
                    requireInteraction: false
                };
                
                const notification = new Notification(options.title, {
                    ...defaults,
                    ...options
                });
                
                // Close notification after 10 seconds if not interacted with
                if (!options.requireInteraction) {
                    setTimeout(() => notification.close(), 10000);
                }
                
                // Handle click
                notification.onclick = () => {
                    window.focus();
                    notification.close();
                    if (options.onClick) options.onClick();
                };
                
                console.log(`âœ“ Notification sent: ${options.title}`);
                logEvent('notification_sent', { title: options.title, tag: options.tag });
                
                return notification;
            },
            
            scheduleDailyCheck() {
                // Check every hour if today is a training day
                setInterval(() => {
                    this.checkTrainingDay();
                }, 60 * 60 * 1000); // Every 1 hour
                
                // Also check immediately
                this.checkTrainingDay();
            },
            
            checkTrainingDay() {
                if (!this.enabled || this.permission !== 'granted') return;
                
                const progress = getUserTrainingProgress();
                const today = new Date();
                const currentHour = today.getHours();
                
                // Only send morning reminders (8-10 AM)
                if (currentHour < 8 || currentHour > 10) return;
                
                // Check if already sent today
                const lastSent = localStorage.getItem('lastTrainingReminderDate');
                const todayStr = today.toISOString().split('T')[0];
                if (lastSent === todayStr) return;
                
                // Check each active program
                ['essential', 'flow', 'mastery'].forEach(programKey => {
                    if (!progress[programKey]?.enrolled) return;
                    
                    const isTrainingDay = isTodayTrainingDay(programKey);
                    if (isTrainingDay) {
                        const currentDay = progress[programKey].currentDay;
                        const programName = programKey.charAt(0).toUpperCase() + programKey.slice(1);
                        
                        this.send({
                            title: `${programName} Path - Day ${currentDay}`,
                            body: 'Today is your training day. Your body is ready.',
                            tag: 'training-day',
                            requireInteraction: false,
                            onClick: () => {
                                if (typeof switchTab === 'function') {
                                    switchTab('training');
                                }
                            }
                        });
                        
                        localStorage.setItem('lastTrainingReminderDate', todayStr);
                    }
                });
            },
            
            notifySessionComplete(programKey, day) {
                if (!this.enabled || this.permission !== 'granted') return;
                
                const programName = programKey.charAt(0).toUpperCase() + programKey.slice(1);
                
                // Check if milestone
                if (day === 48 || day === 96) {
                    this.send({
                        title: `${programName} Path Complete`,
                        body: `Congratulations! You completed all ${day} days. Transformation achieved.`,
                        tag: 'milestone',
                        requireInteraction: true
                    });
                } else if (day % 12 === 0) {
                    // Every 12 days (about 3 weeks at 3x/week)
                    this.send({
                        title: `Day ${day} Complete`,
                        body: `Another milestone reached on ${programName} Path. Keep moving.`,
                        tag: 'progress'
                    });
                } else {
                    this.send({
                        title: 'Session Complete',
                        body: `${programName} Day ${day} finished. Well done.`,
                        tag: 'session-complete'
                    });
                }
            },
            
            notifyRestDay() {
                if (!this.enabled || this.permission !== 'granted') return;
                
                this.send({
                    title: 'Rest Day',
                    body: 'Today is for recovery. Rest is practice.',
                    tag: 'rest-day'
                });
            },
            
            notifyNewMessage(packName) {
                if (!this.enabled || this.permission !== 'granted') return;
                
                this.send({
                    title: `New message in ${packName}`,
                    body: 'A pack member shared something',
                    tag: 'pack-message',
                    onClick: () => {
                        if (typeof switchTab === 'function') {
                            switchTab('tribe');
                        }
                    }
                });
            },
            
            notifyEventInvite(eventTitle) {
                if (!this.enabled || this.permission !== 'granted') return;
                
                this.send({
                    title: 'Event Invitation',
                    body: `You're invited to: ${eventTitle}`,
                    tag: 'event-invite',
                    requireInteraction: true,
                    onClick: () => {
                        if (typeof switchTab === 'function') {
                            switchTab('tribe');
                        }
                    }
                });
            },
            
            disable() {
                this.enabled = false;
                localStorage.setItem('pushNotificationsEnabled', 'false');
                toast('Training reminders disabled');
                console.log('âœ“ Push notifications disabled');
            },
            
            enable() {
                if (this.permission === 'granted') {
                    this.enabled = true;
                    localStorage.setItem('pushNotificationsEnabled', 'true');
                    this.scheduleDailyCheck();
                    toast('Training reminders enabled');
                    console.log('âœ“ Push notifications enabled');
                } else {
                    this.promptPermission();
                }
            }
        };

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // CUSTOM MODAL SYSTEM (v48 - Replace Native Dialogs)
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        const CustomModal = {
            overlay: null,
            modal: null,
            resolveCallback: null,
            
            init() {
                this.overlay = document.getElementById('customModalOverlay');
                this.modal = document.getElementById('customModal');
                
                // ESC key to close
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.overlay.style.display === 'flex') {
                        this.close(false);
                    }
                });
                
                // Click outside to close (only for non-critical modals)
                this.overlay.addEventListener('click', (e) => {
                    if (e.target === this.overlay && !this.modal.dataset.critical) {
                        this.close(false);
                    }
                });
                
                console.log('âœ“ Custom Modal System initialized');
            },
            
            /**
             * Show confirmation dialog (replaces window.confirm)
             */
            confirm(title, message, options = {}) {
                const defaults = {
                    confirmText: 'Confirm',
                    cancelText: 'Cancel',
                    type: 'default',
                    critical: false
                };
                
                const config = { ...defaults, ...options };
                
                return new Promise((resolve) => {
                    this.resolveCallback = resolve;
                    
                    document.getElementById('customModalTitle').textContent = title;
                    document.getElementById('customModalMessage').textContent = message;
                    
                    this.modal.className = 'custom-modal';
                    if (config.type !== 'default') {
                        this.modal.classList.add(`modal-${config.type}`);
                    }
                    
                    if (config.critical) {
                        this.modal.dataset.critical = 'true';
                    } else {
                        delete this.modal.dataset.critical;
                    }
                    
                    const actionsContainer = document.getElementById('customModalActions');
                    actionsContainer.innerHTML = `
                        <button class="btn btn-secondary" onclick="CustomModal.close(false)">
                            ${config.cancelText}
                        </button>
                        <button class="btn btn-primary" onclick="CustomModal.close(true)" autofocus>
                            ${config.confirmText}
                        </button>
                    `;
                    
                    this.show();
                });
            },
            
            /**
             * Show alert dialog (replaces window.alert)
             */
            alert(title, message, options = {}) {
                const defaults = {
                    okText: 'OK',
                    type: 'default'
                };
                
                const config = { ...defaults, ...options };
                
                return new Promise((resolve) => {
                    this.resolveCallback = resolve;
                    
                    document.getElementById('customModalTitle').textContent = title;
                    document.getElementById('customModalMessage').textContent = message;
                    
                    this.modal.className = 'custom-modal';
                    if (config.type !== 'default') {
                        this.modal.classList.add(`modal-${config.type}`);
                    }
                    
                    delete this.modal.dataset.critical;
                    
                    const actionsContainer = document.getElementById('customModalActions');
                    actionsContainer.innerHTML = `
                        <button class="btn btn-primary" onclick="CustomModal.close(true)" autofocus>
                            ${config.okText}
                        </button>
                    `;
                    
                    this.show();
                });
            },
            
            show() {
                this.overlay.style.display = 'flex';
                setTimeout(() => {
                    this.overlay.classList.add('show');
                }, 10);
                
                setTimeout(() => {
                    const firstButton = this.modal.querySelector('button[autofocus]');
                    if (firstButton) firstButton.focus();
                }, 250);
            },
            
            close(result) {
                this.overlay.classList.remove('show');
                setTimeout(() => {
                    this.overlay.style.display = 'none';
                    if (this.resolveCallback) {
                        this.resolveCallback(result);
                        this.resolveCallback = null;
                    }
                }, 200);
            }
        };

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // ANALYTICS LOGGING
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function logEvent(eventName, data = {}) {
            console.log(`[ANALYTICS] ${eventName}`, data);
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // TAB SWITCHING - WITH ARIA ATTRIBUTES
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        let currentTab = null; // Track current tab for cleanup
        
        function switchTab(tabName) {
            // Cleanup previous tab if needed
            if (currentTab === 'map' && tabName !== 'map') {
                // Leaving map tab - cancel debounces and cleanup listeners
                if (typeof MapService !== 'undefined' && MapService.cleanup) {
                    MapService.cleanup();
                }
            }
            
            currentTab = tabName;
            
            // Remove active class from all tabs and nav items
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // Update ARIA attributes for desktop tabs
            document.querySelectorAll('.desktop-tab-button').forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-selected', 'false');
            });
            
            // Update ARIA attributes for bottom nav
            document.querySelectorAll('.bottom-nav-item').forEach(btn => {
                btn.classList.remove('active');
                btn.setAttribute('aria-selected', 'false');
            });
            
            // Add active class to selected tab and corresponding nav items
            const tabPanel = document.getElementById(`${tabName}Tab`);
            if (tabPanel) {
                tabPanel.classList.add('active');
            } else {
                console.warn(`Tab panel not found: ${tabName}Tab`);
                return; // Exit early if tab doesn't exist
            }
            
            // Update desktop tab
            const desktopTab = document.getElementById(`desktop${tabName.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join('')}Tab`);
            if (desktopTab) {
                desktopTab.classList.add('active');
                desktopTab.setAttribute('aria-selected', 'true');
            }
            
            // Update bottom nav
            const bottomNav = document.getElementById(`bottomNav${tabName.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join('')}`);
            if (bottomNav) {
                bottomNav.classList.add('active');
                bottomNav.setAttribute('aria-selected', 'true');
            }
            
            // Update Hero Section dynamically
            const heroSection = document.querySelector('.hero-section');
            const heroTitle = document.getElementById('heroTitle');
            const heroSubtitle = document.getElementById('heroSubtitle');
            
            if (tabName === 'tribe' || tabName === 'thread' || tabName === 'inbox' || tabName === 'training') {
                // Hide main hero for TRIBE, Thread View, Inbox, and Training
                heroSection.style.display = 'none';
            } else {
                // Show and update main hero
                heroSection.style.display = 'block';
                
                // Get hero content container
                const heroContentContainer = document.querySelector('.hero-content');
                const heroCTA = document.querySelector('.hero-cta');
                const floatingAvatar = document.getElementById('floatingUserAvatar');
                
                // Update hero content based on tab
                const heroContent = {
                    'home': {
                        title: 'HUDEN',
                        subtitle: 'School of conscious movement',
                        image: 'https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?w=1920&q=80'
                    },
                    'tribe': {
                        title: 'TRIBE',
                        subtitle: 'Discover packs, events, and coaches',
                        image: 'https://images.unsplash.com/photo-1552196563-55cd4e45efb3?w=1920&q=80'
                    },
                    'map': {
                        title: 'MAP',
                        subtitle: 'Find movement spaces near you',
                        image: 'https://images.unsplash.com/photo-1524661135-423995f22d0b?w=1920&q=80'
                    },
                    'training': {
                        title: 'TRAINING',
                        subtitle: 'Your personal practice space',
                        image: 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=1920&q=80'
                    },
                    'profile': {
                        title: 'PROFILE',
                        subtitle: 'Your HUDEN identity',
                        image: 'https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=1920&q=80'
                    },
                    'guide': {
                        title: 'GUIDE',
                        subtitle: 'Find your coach, deepen your practice',
                        image: 'https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=1920&q=80'
                    }
                };
                
                const content = heroContent[tabName];
                if (content) {
                    heroTitle.textContent = content.title;
                    heroSubtitle.textContent = content.subtitle;
                    
                    // Update hero background image
                    const heroBackground = document.querySelector('.hero-background');
                    if (heroBackground && content.image) {
                        heroBackground.src = content.image;
                        heroBackground.alt = `${content.title} background`;
                    }
                    
                    // Avatar visibility control: 
                    // - Hidden in home and training
                    // - Fixed in header for tribe (non-floating)
                    if (tabName === 'home' || tabName === 'training') {
                        if (floatingAvatar) floatingAvatar.style.display = 'none';
                    } else if (tabName === 'tribe') {
                        if (floatingAvatar) {
                            floatingAvatar.style.display = 'block';
                            floatingAvatar.style.position = 'absolute'; // Fixed in section header, not floating
                            floatingAvatar.style.top = '24px';
                            floatingAvatar.style.right = '24px';
                        }
                    } else {
                        if (floatingAvatar) {
                            floatingAvatar.style.display = 'block';
                            floatingAvatar.style.position = 'fixed'; // Keep floating in other tabs
                        }
                    }
                    
                    // Apply centered style and show CTA only for Home
                    if (tabName === 'home') {
                        heroContentContainer.classList.add('hero-content-centered');
                        if (heroCTA) heroCTA.style.display = 'block';
                        startHeroCarousel(); // Start carousel in Home
                    } else {
                        heroContentContainer.classList.remove('hero-content-centered');
                        if (heroCTA) heroCTA.style.display = 'none';
                        stopHeroCarousel(); // Stop carousel when leaving Home
                    }
                }
            }
            
            // Update URL hash
            window.location.hash = `tribe/${tabName}`;
            
            // Load content based on tab
            switch(tabName) {
                case 'home':
                    // Load HOME dashboard
                    loadHome();
                    break;
                case 'tribe':
                    // Load Feed section by default (first pill)
                    if (!window._tribeSectionOverride) {
                        setTimeout(() => {
                            switchTRIBESection('feed');
                        }, 100);
                    }
                    // Reset the flag
                    window._tribeSectionOverride = false;
                    
                    // Update TRIBE header avatar with current user
                    const tribeAvatar = document.getElementById('tribeHeaderAvatar');
                    if (tribeAvatar) {
                        const currentUser = getCurrentUser();
                        if (currentUser) {
                            tribeAvatar.src = currentUser.avatar;
                            tribeAvatar.alt = currentUser.name;
                        }
                    }
                    break;
                case 'guide':
                    renderCoaches();
                    break;
                case 'packs':
                    loadPacks();
                    break;
                case 'map':
                    loadMap();
                    // Invalidate map size to prevent rendering issues
                    if (map) {
                        setTimeout(() => {
                            map.invalidateSize();
                        }, 100);
                    }
                    break;
                case 'my-packs':
                    loadMyPacks();
                    break;
                case 'inbox':
                    loadInbox();
                    break;
                case 'thread':
                    // Thread view loaded separately by openThread()
                    break;
                case 'training':
                    // Initialize Training tab content
                    initializeTrainingTab();
                    break;
            }
            
            // Control Quick Actions FAB visibility
            const fab = document.getElementById('quickActionsFab');
            if (fab) {
                if (tabName === 'profile') {
                    fab.classList.add('hidden');
                } else {
                    fab.classList.remove('hidden');
                }
            }
            
            // Control Floating Avatar visibility
            const avatar = document.getElementById('floatingUserAvatar');
            if (avatar) {
                if (tabName === 'profile') {
                    avatar.classList.add('hidden');
                } else {
                    avatar.classList.remove('hidden');
                }
            }
            
            // Load HUDEN curated images after tab switch
            if (typeof loadHudenImages === 'function') {
                setTimeout(() => loadHudenImages(), 100);
            }
            
            logEvent('tab_switched', { tabName });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INBOX SYSTEM - Messaging & Conversations
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // Global state
        let currentUserId = 'user_current'; // Current logged-in user
        let currentUserTier = getUserTier(); // Use fallback function
        let currentConversationId = null;
        let currentConversationType = null; // 'dm' or 'pack'
        let lastMessageTime = 0;
        const RATE_LIMIT_MS = 2000; // 2 seconds between messages - GLOBAL RATE LIMIT

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // localStorage Helpers
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function getConversations() {
            const stored = localStorage.getItem('hudenConversations');
            return stored ? JSON.parse(stored) : [];
        }

        function saveConversations(conversations) {
            localStorage.setItem('hudenConversations', JSON.stringify(conversations));
        }

        function getMessages(conversationId) {
            const stored = localStorage.getItem(`hudenMessages_${conversationId}`);
            return stored ? JSON.parse(stored) : [];
        }

        function saveMessages(conversationId, messages) {
            localStorage.setItem(`hudenMessages_${conversationId}`, JSON.stringify(messages));
        }

        function getLastRead(conversationId, userId) {
            const stored = localStorage.getItem(`hudenLastRead_${conversationId}_${userId}`);
            return stored ? parseInt(stored) : 0;
        }

        function setLastRead(conversationId, userId, timestamp) {
            localStorage.setItem(`hudenLastRead_${conversationId}_${userId}`, timestamp.toString());
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Permission System
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        const INBOX_PERMISSIONS = {
            'essential': {
                canSendDM: false,
                canReceiveDM: false,
                canSendPack: false,
                canReceivePack: false,
                maxConversations: 0
            },
            'flow': {
                canSendDM: false,
                canReceiveDM: true,
                canSendPack: true,
                canReceivePack: true,
                maxConversations: 5
            },
            'mastery': {
                canSendDM: true,
                canReceiveDM: true,
                canSendPack: true,
                canReceivePack: true,
                maxConversations: 20,
                canLeadPack: true
            },
            'mentorship': {
                canSendDM: true,
                canReceiveDM: true,
                canSendPack: true,
                canReceivePack: true,
                maxConversations: 50,
                canLeadPack: true,
                canSendAnnouncements: false
            },
            'coach': {
                canSendDM: true,
                canReceiveDM: true,
                canSendPack: true,
                canReceivePack: true,
                maxConversations: -1, // unlimited
                canLeadPack: true,
                canSendAnnouncements: true
            }
        };

        function checkInboxPermissions(action, conversationType) {
            const tier = currentUserTier.toLowerCase();
            const perms = INBOX_PERMISSIONS[tier] || INBOX_PERMISSIONS['flow'];
            
            if (action === 'send_dm') {
                return perms.canSendDM;
            } else if (action === 'send_pack') {
                return perms.canSendPack;
            } else if (action === 'create_conversation') {
                const currentCount = getConversations().length;
                return perms.maxConversations === -1 || currentCount < perms.maxConversations;
            } else if (action === 'announcement') {
                return perms.canSendAnnouncements;
            }
            
            return false;
        }

        function showTierToast(message) {
            const toast = document.createElement('div');
            toast.className = 'tier-toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Initialize Inbox System
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function initInboxSystem() {
            // Check if we need to populate mock data
            const conversations = getConversations();
            
            if (conversations.length === 0) {
                // Create mock conversations
                const mockConversations = createMockConversations();
                saveConversations(mockConversations);
                
                // Create mock messages for each conversation
                mockConversations.forEach(conv => {
                    const mockMessages = createMockMessages(conv.id, conv.type);
                    saveMessages(conv.id, mockMessages);
                });
            }

            // Set up tier switcher (for testing)
            if (window.location.search.includes('debug')) {
                console.log('[DEBUG] INBOX Debug Mode Active');
                console.log('Current Tier:', currentUserTier);
                console.log('Permissions:', INBOX_PERMISSIONS[currentUserTier.toLowerCase()]);
            }

            // Update unread badges
            updateUnreadBadges();

            // Set up char counter
            const threadInput = document.getElementById('threadInput');
            if (threadInput) {
                threadInput.addEventListener('input', updateCharCount);
            }
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Mock Data Creation
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function createMockConversations() {
            const tier = currentUserTier.toLowerCase();
            const isMastery = ['mastery', 'mentorship', 'coach'].includes(tier);
            
            const conversations = [
                {
                    id: 'conv_pack_1',
                    type: 'pack',
                    packId: 'pack_1',
                    packName: 'Urban Warriors',
                    participants: ['user_sarah', 'user_mike', 'user_current', 'user_emma'],
                    lastMessage: 'See you all at the session tomorrow!',
                    lastMessageTime: Date.now() - 3600000, // 1 hour ago
                    lastSender: 'user_sarah',
                    leaderId: 'user_sarah'
                },
                {
                    id: 'conv_pack_2',
                    type: 'pack',
                    packId: 'pack_2',
                    packName: 'Outdoor TRIBErs',
                    participants: ['user_alex', 'user_lisa', 'user_current', 'user_james'],
                    lastMessage: 'Great session today everyone!',
                    lastMessageTime: Date.now() - 86400000, // 1 day ago
                    lastSender: 'user_alex',
                    leaderId: 'user_alex'
                }
            ];

            // Add DM if Mastery+
            if (isMastery) {
                conversations.push({
                    id: 'conv_dm_sarah',
                    type: 'dm',
                    participantId: 'user_sarah',
                    participantName: 'Sarah Chen',
                    lastMessage: 'Thanks for the tips! Really helpful.',
                    lastMessageTime: Date.now() - 7200000, // 2 hours ago
                    lastSender: 'user_sarah'
                });
            }

            // Add Pack Chat that user leads (if Mastery+)
            if (isMastery) {
                conversations.push({
                    id: 'conv_pack_3',
                    type: 'pack',
                    packId: 'pack_3',
                    packName: 'Movement Lab',
                    participants: ['user_current', 'user_tom', 'user_maria'],
                    lastMessage: 'Next session: Friday at 6pm',
                    lastMessageTime: Date.now() - 43200000, // 12 hours ago
                    lastSender: 'user_current',
                    leaderId: 'user_current' // User leads this pack
                });
            }

            return conversations;
        }

        function createMockMessages(conversationId, type) {
            const baseTime = Date.now() - 86400000; // Start from 1 day ago
            
            if (type === 'dm') {
                return [
                    {
                        id: 'msg_1',
                        conversationId,
                        senderId: 'user_current',
                        senderName: 'You',
                        text: 'Hey! I really enjoyed the workshop yesterday.',
                        timestamp: baseTime + 3600000,
                        read: true
                    },
                    {
                        id: 'msg_2',
                        conversationId,
                        senderId: 'user_sarah',
                        senderName: 'Sarah Chen',
                        text: 'Thank you! It was great having you there.',
                        timestamp: baseTime + 7200000,
                        read: true
                    },
                    {
                        id: 'msg_3',
                        conversationId,
                        senderId: 'user_current',
                        senderName: 'You',
                        text: 'I have a question about the breathing technique you showed.',
                        timestamp: baseTime + 10800000,
                        read: true
                    },
                    {
                        id: 'msg_4',
                        conversationId,
                        senderId: 'user_sarah',
                        senderName: 'Sarah Chen',
                        text: 'Thanks for the tips! Really helpful.',
                        timestamp: baseTime + 75600000, // Most recent
                        read: false
                    }
                ];
            } else {
                // Pack chat messages
                return [
                    {
                        id: 'msg_pack_1',
                        conversationId,
                        senderId: 'user_sarah',
                        senderName: 'Sarah Chen',
                        text: 'Looking forward to tomorrow\'s session!',
                        timestamp: baseTime + 43200000,
                        read: true
                    },
                    {
                        id: 'msg_pack_2',
                        conversationId,
                        senderId: 'user_mike',
                        senderName: 'Mike Torres',
                        text: 'Same here! What time are we starting?',
                        timestamp: baseTime + 50400000,
                        read: true
                    },
                    {
                        id: 'msg_pack_3',
                        conversationId,
                        senderId: 'user_sarah',
                        senderName: 'Sarah Chen',
                        text: 'See you all at the session tomorrow!',
                        timestamp: baseTime + 82800000,
                        read: false
                    }
                ];
            }
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Load Inbox View
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function loadInbox() {
            const conversationList = document.getElementById('conversationList');
            const emptyState = document.getElementById('inboxEmptyState');
            const conversations = getConversations();

            conversationList.innerHTML = '';

            if (conversations.length === 0) {
                emptyState.style.display = 'block';
                conversationList.style.display = 'none';
                return;
            }

            emptyState.style.display = 'none';
            conversationList.style.display = 'flex';

            // Sort by last message time
            conversations.sort((a, b) => b.lastMessageTime - a.lastMessageTime);

            conversations.forEach(conv => {
                const item = createConversationItem(conv);
                conversationList.appendChild(item);
            });
        }

        function createConversationItem(conv) {
            const div = document.createElement('div');
            div.className = 'conversation-item';
            div.onclick = () => openThread(conv.id);

            // Calculate unread
            const messages = getMessages(conv.id);
            const lastRead = getLastRead(conv.id, currentUserId);
            const unreadCount = messages.filter(m => m.timestamp > lastRead && m.senderId !== currentUserId).length;

            // Format timestamp
            const timeAgo = formatTimeAgo(conv.lastMessageTime);

            // Display name
            let displayName = conv.type === 'dm' ? conv.participantName : conv.packName;

            div.innerHTML = `
                <div class="conversation-item-header">
                    <div class="conversation-name">
                        ${displayName}
                        ${unreadCount > 0 ? '<span class="conversation-badge"></span>' : ''}
                    </div>
                    <div class="conversation-timestamp">${timeAgo}</div>
                </div>
                <div class="conversation-preview ${unreadCount > 0 ? 'unread' : ''}">
                    ${conv.lastMessage || 'No messages yet'}
                </div>
            `;

            return div;
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Open Thread View
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function openThread(conversationId) {
            const conversations = getConversations();
            const conversation = conversations.find(c => c.id === conversationId);
            
            if (!conversation) return;

            currentConversationId = conversationId;
            currentConversationType = conversation.type;

            // Update title
            const title = conversation.type === 'dm' ? conversation.participantName : conversation.packName;
            document.getElementById('threadTitle').textContent = title;

            // Load messages
            loadThreadMessages();

            // Mark as read
            setLastRead(conversationId, currentUserId, Date.now());
            updateUnreadBadges();

            // Switch to thread tab
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById('threadTab').classList.add('active');

            // Update hash
            window.location.hash = `tribe/inbox/thread/${conversationId}`;
        }

        function loadThreadMessages() {
            const messagesContainer = document.getElementById('threadMessages');
            const messages = getMessages(currentConversationId);

            messagesContainer.innerHTML = '';

            if (messages.length === 0) {
                // Empty thread state
                messagesContainer.innerHTML = `
                    <div class="empty-state">
                        <h3 class="empty-title">No Messages Yet</h3>
                        <p class="empty-message">Start the conversation by sending a message.</p>
                    </div>
                `;
                return;
            }

            messages.forEach(msg => {
                const messageEl = createMessageElement(msg);
                messagesContainer.appendChild(messageEl);
            });

            // Scroll to bottom with delay for rendering
            setTimeout(() => {
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 50);
        }

        function createMessageElement(msg) {
            const isSent = msg.senderId === currentUserId;
            const div = document.createElement('div');
            div.className = 'message-group ' + (isSent ? 'sent' : 'received');

            // For pack chat, show sender name (except for own messages)
            const showSender = currentConversationType === 'pack' && !isSent;

            div.innerHTML = `
                ${showSender ? `<div class="message-sender">${msg.senderName}</div>` : ''}
                <div class="message-bubble ${isSent ? 'sent' : 'received'}">
                    ${escapeHtml(msg.text)}
                </div>
                <div class="message-timestamp">${formatTime(msg.timestamp)}</div>
            `;

            return div;
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Send Message - WITH GLOBAL RATE LIMIT & AUTO-SCROLL
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function sendMessage() {
            const input = document.getElementById('threadInput');
            const text = input.value.trim();

            if (!text) return;

            // Check permissions
            if (currentConversationType === 'dm' && !checkInboxPermissions('send_dm')) {
                showTierToast('Upgrade to Mastery to send direct messages');
                return;
            }

            if (currentConversationType === 'pack' && !checkInboxPermissions('send_pack')) {
                showTierToast('Upgrade to Flow or higher to send pack messages');
                return;
            }

            // GLOBAL RATE LIMIT CHECK
            const now = Date.now();
            if (now - lastMessageTime < RATE_LIMIT_MS) {
                showTierToast('Please wait a moment before sending another message');
                return;
            }

            // Max length check (already handled by textarea maxlength, but double-check)
            if (text.length > 1000) {
                showTierToast('Message too long (max 1000 characters)');
                return;
            }

            // Create message
            const messages = getMessages(currentConversationId);
            const newMessage = {
                id: `msg_${Date.now()}`,
                conversationId: currentConversationId,
                senderId: currentUserId,
                senderName: 'You',
                text: text,
                timestamp: now,
                read: true
            };

            // Check for [ANNOUNCEMENT] prefix
            if (text.startsWith('[ANNOUNCEMENT]')) {
                const conversations = getConversations();
                const conv = conversations.find(c => c.id === currentConversationId);
                
                // Only pack leaders can send announcements
                if (conv && conv.type === 'pack' && conv.leaderId !== currentUserId) {
                    showTierToast('Only pack leaders can send announcements');
                    return;
                }
            }

            messages.push(newMessage);
            saveMessages(currentConversationId, messages);

            // Update conversation last message
            const conversations = getConversations();
            const conv = conversations.find(c => c.id === currentConversationId);
            if (conv) {
                conv.lastMessage = text;
                conv.lastMessageTime = now;
                conv.lastSender = currentUserId;
                saveConversations(conversations);
            }

            // Clear input
            input.value = '';
            updateCharCount();

            // Reload messages
            loadThreadMessages();

            // Update GLOBAL rate limit
            lastMessageTime = now;

            logEvent('message_sent', { 
                conversationId: currentConversationId, 
                type: currentConversationType 
            });
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Navigation
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function backToInbox() {
            currentConversationId = null;
            currentConversationType = null;
            switchTab('inbox');
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Unread Badges
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function updateUnreadBadges() {
            const conversations = getConversations();
            let totalUnread = 0;

            conversations.forEach(conv => {
                const messages = getMessages(conv.id);
                const lastRead = getLastRead(conv.id, currentUserId);
                const unread = messages.filter(m => m.timestamp > lastRead && m.senderId !== currentUserId).length;
                totalUnread += unread;
            });

            // Update inbox tab badge (if > 0)
            // For simplicity, we'll just log it. You can add visual badge to nav if needed.
            if (totalUnread > 0) {
                console.log(`[INBOX] ${totalUnread} unread messages`);
            }
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Entry Points - Message Buttons
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function openDM(userId, userName) {
            // Check permissions
            if (!checkInboxPermissions('send_dm')) {
                showTierToast('Upgrade to Mastery to send direct messages');
                return;
            }

            // Check if conversation exists
            let conversations = getConversations();
            let conv = conversations.find(c => c.type === 'dm' && c.participantId === userId);

            if (!conv) {
                // Create new conversation
                if (!checkInboxPermissions('create_conversation')) {
                    const tier = currentUserTier.toLowerCase();
                    const perms = INBOX_PERMISSIONS[tier] || INBOX_PERMISSIONS['flow'];
                    showTierToast(`Conversation limit reached (${perms.maxConversations}). Upgrade to increase.`);
                    return;
                }

                conv = {
                    id: `conv_dm_${userId}`,
                    type: 'dm',
                    participantId: userId,
                    participantName: userName,
                    lastMessage: '',
                    lastMessageTime: Date.now(),
                    lastSender: currentUserId
                };
                conversations.push(conv);
                saveConversations(conversations);
                saveMessages(conv.id, []);
            }

            openThread(conv.id);
        }

        function openPackChat(packId, packName) {
            // Check permissions
            if (!checkInboxPermissions('send_pack')) {
                showTierToast('Upgrade to Flow or higher to use pack chat');
                return;
            }

            // Check if conversation exists
            let conversations = getConversations();
            let conv = conversations.find(c => c.type === 'pack' && c.packId === packId);

            if (!conv) {
                // Create new pack conversation
                if (!checkInboxPermissions('create_conversation')) {
                    const tier = currentUserTier.toLowerCase();
                    const perms = INBOX_PERMISSIONS[tier] || INBOX_PERMISSIONS['flow'];
                    showTierToast(`Conversation limit reached (${perms.maxConversations}). Upgrade to increase.`);
                    return;
                }

                conv = {
                    id: `conv_pack_${packId}`,
                    type: 'pack',
                    packId: packId,
                    packName: packName,
                    participants: [currentUserId],
                    lastMessage: '',
                    lastMessageTime: Date.now(),
                    lastSender: currentUserId,
                    leaderId: 'user_leader' // Set appropriate leader
                };
                conversations.push(conv);
                saveConversations(conversations);
                saveMessages(conv.id, []);
            }

            openThread(conv.id);
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Utilities
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function updateCharCount() {
            const input = document.getElementById('threadInput');
            const counter = document.getElementById('charCount');
            const length = input.value.length;
            
            counter.textContent = `${length} / 1000`;
            
            if (length > 900) {
                counter.classList.add('warning');
            } else {
                counter.classList.remove('warning');
            }
        }

        function formatTimeAgo(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            
            if (seconds < 60) return 'Just now';
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
            if (seconds < 604800) return `${Math.floor(seconds / 86400)}d ago`;
            return new Date(timestamp).toLocaleDateString();
        }

        function formatTime(timestamp) {
            return new Date(timestamp).toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit' 
            });
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // Tier Switcher (Testing Only)
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function switchUserTier(tier) {
            currentUserTier = tier;
            localStorage.setItem('userTier', tier);
            console.log(`Switched to tier: ${tier}`);
            console.log('Permissions:', INBOX_PERMISSIONS[tier.toLowerCase()]);
            
            // Reload inbox to reflect new permissions
            if (document.getElementById('inboxTab').classList.contains('active')) {
                loadInbox();
            }
        }

        // Expose for console testing
        window.switchUserTier = switchUserTier;
        window.openDM = openDM;
        window.openPackChat = openPackChat;
        
        // PHASE 4 TEST HELPER: Switch between users to test coach profile
        window.switchToCoach = function() {
            CURRENT_USER_ID = 'user2'; // Marcus Torres (Coach)
            showToast('Switched to Marcus Torres (Coach)');
            console.log('Current user:', getCurrentUser());
        };
        
        window.switchToFlow = function() {
            CURRENT_USER_ID = 'user1'; // Sarah Chen (Flow)
            showToast('Switched to Sarah Chen (Flow)');
            console.log('Current user:', getCurrentUser());
        };
        
        window.switchToMastery = function() {
            CURRENT_USER_ID = 'user3'; // Emma Rodriguez (Mastery)
            showToast('Switched to Emma Rodriguez (Mastery)');
            console.log('Current user:', getCurrentUser());
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // USER PROFILE DATA MODEL - PHASE 1 COMPLETE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        const USER_PROFILE_SCHEMA = {
            // Basic Info
            id: 'string',
            name: 'string',
            avatar: 'url',
            bio: 'string (max 280 chars)',
            location: 'string',
            memberSince: 'timestamp',
            
            // Movement Identity
            archetypes: ['Gorilla', 'Gibbon', 'Orangutan', 'Chimpanzee'],
            practiceGoals: ['string array, max 5'],
            specialties: ['string array, coach only'],
            
            // Stats (calculated)
            stats: {
                posts: 0,
                comments: 0,
                packs: 0,
                sessions: 0,
                milestones: 0,
                connections: 0
            },
            
            // Privacy Settings
            privacy: {
                showLocation: true,
                showActivity: true,
                showPacks: true,
                allowMessages: true
            },
            
            // Tier & Access
            tier: 'essential|flow|mastery|mentorship|coach',
            
            // Coach-specific (if tier === 'coach')
            coachInfo: {
                rate: 0,
                yearsExperience: 0,
                certifications: [],
                averageRating: 0,
                totalSessions: 0,
                activeMentorships: 0,
                responseTime: 'string',
                reviews: []
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // USER CONTEXT SYSTEM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        let CURRENT_USER_ID = 'user1'; // Simulates logged-in user
        
        function getCurrentUser() {
            const users = getUserProfiles();
            return users[CURRENT_USER_ID] || null;
        }
        
        function isViewingOwnProfile(profileUserId) {
            return CURRENT_USER_ID === profileUserId;
        }
        
        function canViewPrivateSection(section, profileUserId, viewerTier) {
            // Own profile: see everything
            if (isViewingOwnProfile(profileUserId)) return true;
            
            // Other profiles: tier-based permissions
            const tierLevels = {
                'essential': 1,
                'flow': 2,
                'mastery': 3,
                'mentorship': 4,
                'coach': 5
            };
            
            const permissions = {
                'bookings': ['mentorship', 'coach'],
                'coachDashboard': ['coach']
            };
            
            if (permissions[section]) {
                return permissions[section].includes(viewerTier);
            }
            
            return false;
        }
        
        function canSendMessage(targetUserId) {
            const users = getUserProfiles();
            const targetUser = users[targetUserId];
            if (!targetUser) return false;
            
            // Check privacy settings
            if (!targetUser.privacy.allowMessages) return false;
            
            // Check tier permissions (Flow+ can message)
            const currentUser = getCurrentUser();
            const tierLevels = {
                'essential': 1,
                'flow': 2,
                'mastery': 3,
                'mentorship': 4,
                'coach': 5
            };
            
            return tierLevels[currentUser.tier] >= 2;
        }
        
        function getUserProfiles() {
            const stored = localStorage.getItem('hudenUserProfiles');
            if (stored) return JSON.parse(stored);
            
            // Initialize with mock data
            const profiles = {
                'user1': {
                    id: 'user1',
                    name: 'Sarah Chen',
                    avatar: 'https://i.pravatar.cc/150?img=1',
                    bio: 'Movement coach exploring urban flow and natural patterns. Based in Brooklyn.',
                    location: 'Brooklyn, NY',
                    memberSince: '2024-01-15',
                    archetypes: ['Gibbon', 'Chimpanzee'],
                    practiceGoals: [
                        'Master handstand progression',
                        'Build consistent morning practice',
                        'Lead pack sessions weekly'
                    ],
                    specialties: [],
                    stats: {
                        posts: 12,
                        comments: 45,
                        packs: 3,
                        sessions: 0,
                        milestones: 5,
                        connections: 0
                    },
                    privacy: {
                        showLocation: true,
                        showActivity: true,
                        showPacks: true,
                        allowMessages: true
                    },
                    tier: 'flow'
                },
                'user2': {
                    id: 'user2',
                    name: 'Marcus Torres',
                    avatar: 'https://i.pravatar.cc/150?img=2',
                    bio: 'Certified coach helping people reconnect with their primal movement intelligence.',
                    location: 'Austin, TX',
                    memberSince: '2023-06-20',
                    archetypes: ['Orangutan', 'Gorilla'],
                    practiceGoals: [
                        'Expand coaching practice',
                        'Develop new workshop formats'
                    ],
                    specialties: ['Mobility', 'Strength', 'Urban Movement'],
                    stats: {
                        posts: 24,
                        comments: 89,
                        packs: 2,
                        sessions: 156,
                        milestones: 12,
                        connections: 0
                    },
                    privacy: {
                        showLocation: true,
                        showActivity: true,
                        showPacks: true,
                        allowMessages: true
                    },
                    tier: 'coach',
                    coachInfo: {
                        rate: 75,
                        yearsExperience: 8,
                        certifications: ['HUDEN Certified Coach', 'MovNat Level 3'],
                        averageRating: 4.9,
                        totalSessions: 156,
                        activeMentorships: 3,
                        responseTime: '< 2 hours',
                        reviews: [
                            {
                                id: 'rev1',
                                author: 'Emma Rodriguez',
                                avatar: 'https://i.pravatar.cc/150?img=3',
                                rating: 5,
                                date: '2024-10-15',
                                text: 'Marcus completely transformed my approach to movement. His coaching is intuitive, patient, and deeply impactful.'
                            },
                            {
                                id: 'rev2',
                                author: 'James Kim',
                                avatar: 'https://i.pravatar.cc/150?img=4',
                                rating: 5,
                                date: '2024-09-28',
                                text: 'Best investment in my practice. Marcus helps you discover patterns you never knew existed.'
                            }
                        ]
                    }
                },
                'user3': {
                    id: 'user3',
                    name: 'Emma Rodriguez',
                    avatar: 'https://i.pravatar.cc/150?img=3',
                    bio: 'Finding strength through softness. Mobility and mindfulness.',
                    location: 'Portland, OR',
                    memberSince: '2024-03-10',
                    archetypes: ['Chimpanzee'],
                    practiceGoals: [
                        'Deepen flexibility practice',
                        'Connect with local pack'
                    ],
                    specialties: [],
                    stats: {
                        posts: 8,
                        comments: 23,
                        packs: 1,
                        sessions: 0,
                        milestones: 2,
                        connections: 0
                    },
                    privacy: {
                        showLocation: true,
                        showActivity: true,
                        showPacks: true,
                        allowMessages: true
                    },
                    tier: 'mastery'
                }
            };
            
            localStorage.setItem('hudenUserProfiles', JSON.stringify(profiles));
            return profiles;
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // MOCK DATA
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        const MOCK_DATA = {
            posts: [
                {
                    id: 1,
                    author: 'Sarah Chen',
                    avatar: 'https://i.pravatar.cc/150?img=1',
                    timestamp: '2 hours ago',
                    text: 'Just finished an incredible sunrise flow session at the park. The way early morning movement shifts your entire day is pure magic. Who else practices at dawn?',
                    image: 'https://images.unsplash.com/photo-1506126613408-eca07ce68773?w=600&q=80',
                    archetypes: ['Gibbon'],
                    comments: []
                },
                {
                    id: 2,
                    author: 'Marcus Torres',
                    avatar: 'https://i.pravatar.cc/150?img=2',
                    timestamp: '5 hours ago',
                    text: 'Reminder: Your body is smarter than your mind. Today I tried to push through fatigue and my body said no. Listen to the wisdom in your tissues.',
                    image: null,
                    archetypes: ['Orangutan'],
                    comments: []
                },
                {
                    id: 3,
                    author: 'Emma Rodriguez',
                    avatar: 'https://i.pravatar.cc/150?img=3',
                    timestamp: '1 day ago',
                    text: 'Three months into my movement practice and I can finally touch my toes without bending my knees. Small wins are still wins. Progress over perfection.',
                    image: 'https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=600&q=80',
                    archetypes: ['Chimpanzee'],
                    comments: []
                },
                {
                    id: 4,
                    author: 'James Kim',
                    avatar: 'https://i.pravatar.cc/150?img=4',
                    timestamp: '1 day ago',
                    text: 'Spent the afternoon teaching movement basics to my kids. Watching them discover what their bodies can do reminded me why we do this work.',
                    image: null,
                    archetypes: ['Chimpanzee'],
                    comments: []
                },
                {
                    id: 5,
                    author: 'Nadia Patel',
                    avatar: 'https://i.pravatar.cc/150?img=5',
                    timestamp: '2 days ago',
                    text: 'The secret to consistent practice? Make it so simple you can\'t say no. Five minutes of intentional movement beats zero minutes of perfect form.',
                    image: 'https://images.unsplash.com/photo-1518611012118-696072aa579a?w=600&q=80',
                    archetypes: ['Gorilla'],
                    comments: []
                }
            ],
            packs: [
                {
                    id: 1,
                    name: 'Urban Flow Collective',
                    location: 'Brooklyn, New York',
                    image: 'https://images.unsplash.com/photo-1517838277536-f5f99be501cd?w=600&q=80',
                    description: 'Weekly Sunday morning sessions exploring natural movement in urban environments. All levels welcome.',
                    members: 24,
                    nextSession: 'Sunday 8:00 AM',
                    focus: 'Urban parkour, natural movement',
                    leader: 'Marcus'
                },
                {
                    id: 2,
                    name: 'Coastal Movement',
                    location: 'Santa Monica, California',
                    image: 'https://images.unsplash.com/photo-1505142468610-359e7d316be0?w=600&q=80',
                    description: 'Beach training combining barefoot movement, mobility work, and ocean-based practices.',
                    members: 18,
                    nextSession: 'Saturday 7:00 AM',
                    focus: 'Beach training, barefoot movement',
                    leader: 'Sarah'
                },
                {
                    id: 3,
                    name: 'Forest Tribe',
                    location: 'Portland, Oregon',
                    image: 'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=600&q=80',
                    description: 'Nature-based movement practice in Forest Park. Reconnect with your primal movement patterns.',
                    members: 32,
                    nextSession: 'Thursday 6:30 PM',
                    focus: 'Forest movement, natural terrain',
                    leader: 'Emma'
                },
                {
                    id: 4,
                    name: 'Rooftop Warriors',
                    location: 'Chicago, Illinois',
                    image: 'https://images.unsplash.com/photo-1519501025264-65ba15a82390?w=600&q=80',
                    description: 'High-intensity movement sessions on Chicago rooftops. City views meet functional fitness.',
                    members: 15,
                    nextSession: 'Tuesday 7:00 PM',
                    focus: 'Rooftop training, functional fitness',
                    leader: 'James'
                },
                {
                    id: 5,
                    name: 'Morning Movers',
                    location: 'Austin, Texas',
                    image: 'https://images.unsplash.com/photo-1506126613408-eca07ce68773?w=600&q=80',
                    description: 'Sunrise movement sessions at Zilker Park. Start your day with intentional movement.',
                    members: 28,
                    nextSession: 'Daily 6:00 AM',
                    focus: 'Morning practice, mobility',
                    leader: 'Nadia'
                }
            ],
            discussions: [
                {
                    id: 'disc-1',
                    author: 'Current User',
                    avatar: 'https://i.pravatar.cc/150?img=10',
                    timestamp: new Date().toISOString(),
                    title: 'Welcome to TRIBE',
                    content: 'This is your space to share, learn, and grow. Connect with the community and explore all the features.',
                    tags: ['welcome', 'community'],
                    comments: [],
                    views: 1
                }
            ]
        };

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // LOCALSTORAGE HELPERS
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function getDiscussions() {
            const stored = localStorage.getItem('hudenDiscussions');
            return stored ? JSON.parse(stored) : MOCK_DATA.discussions;
        }

        function saveDiscussions(discussions) {
            localStorage.setItem('hudenDiscussions', JSON.stringify(discussions));
        }

        function getPostComments(postId) {
            const stored = localStorage.getItem(`hudenPostComments_${postId}`);
            return stored ? JSON.parse(stored) : [];
        }

        function savePostComments(postId, comments) {
            localStorage.setItem(`hudenPostComments_${postId}`, JSON.stringify(comments));
        }

        function getJoinedPacks() {
            const stored = localStorage.getItem('hudenJoinedPacks');
            return stored ? JSON.parse(stored) : [];
        }

        function saveJoinedPacks(packIds) {
            localStorage.setItem('hudenJoinedPacks', JSON.stringify(packIds));
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // HOME DASHBOARD FUNCTIONS
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function loadHome() {
            // Home is now minimal - just hero
            // Future: Load corporate HUDEN posts here
            logEvent('home_loaded');
        }
        
        function loadHomeStats() {
            // Get user posts count
            const userPosts = MOCK_DATA.posts.filter(p => p.userId === getCurrentUser().id);
            document.getElementById('homeStatPosts').textContent = userPosts.length;
            
            // Get total resonance
            const totalResonance = userPosts.reduce((sum, post) => sum + post.likes, 0);
            document.getElementById('homeStatResonance').textContent = totalResonance;
            
            // Get joined packs count
            const joinedPacks = getJoinedPacks();
            document.getElementById('homeStatPacks').textContent = joinedPacks.length;
            
            // Get practice days (mock - 28 days streak)
            document.getElementById('homeStatDays').textContent = 28;
        }
        
        function loadHomeMyPacks() {
            const container = document.getElementById('homeMyPacks');
            const joinedPackIds = getJoinedPacks();
            const myPacks = MOCK_DATA.packs.filter(pack => joinedPackIds.includes(pack.id)).slice(0, 3); // Show max 3
            
            if (myPacks.length === 0) {
                container.innerHTML = `
                    <div style="padding: var(--space-4); text-align: center; color: var(--gray-600); background: var(--gray-50); border-radius: 12px; border: 2px dashed var(--gray-300);">
                        <p style="margin: 0; font-size: 14px;">You haven't joined any packs yet.</p>
                        <button class="btn btn-primary" style="margin-top: var(--space-2);" onclick="switchTab('tribe'); setTimeout(() => switchTRIBESection('packs'), 100);">
                            Find Your Pack
                        </button>
                    </div>
                `;
            } else {
                container.innerHTML = myPacks.map(pack => `
                    <div class="home-event-card" onclick="viewPackDetail('${pack.id}')">
                        <div style="display: flex; gap: var(--space-3); align-items: center;">
                            <img src="${pack.image}" alt="${pack.name}" style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover;">
                            <div style="flex: 1;">
                                <h4 style="font-size: 14px; font-weight: 700; margin: 0;">${pack.name}</h4>
                                <p style="font-size: 12px; color: var(--gray-600); margin: 4px 0 0 0;">${pack.members} members â€¢ ${pack.location}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // FEED FUNCTIONS
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function loadFeed(filterArchetype = 'All') {
            const container = document.getElementById('feedContainer');
            const tier = getUserTier().toLowerCase();
            const canComment = ['flow', 'mastery', 'mentorship', 'coach'].includes(tier);

            setTimeout(() => {
                container.innerHTML = '';

                // Combine mock posts with localStorage training posts
                const trainingPosts = JSON.parse(localStorage.getItem('feedPosts') || '[]');
                const allPosts = [...trainingPosts, ...MOCK_DATA.posts];
                
                // Sort by timestamp (newest first)
                allPosts.sort((a, b) => {
                    const timeA = a.timestamp || 0;
                    const timeB = b.timestamp || 0;
                    return timeB - timeA;
                });

                // Filter posts by archetype or Today's Practice
                let filteredPosts;
                if (filterArchetype === 'Today') {
                    // Filter for training session posts
                    filteredPosts = allPosts.filter(post => post.session || post.type === 'training_session');
                } else if (filterArchetype === 'All') {
                    filteredPosts = allPosts;
                } else {
                    filteredPosts = allPosts.filter(post => 
                        post.archetypes && post.archetypes.includes(filterArchetype));
                }

                // Show empty state if no posts match filter
                if (filteredPosts.length === 0) {
                    const filterName = filterArchetype === 'Today' ? "Today's Practice" : filterArchetype;
                    container.innerHTML = `
                        <div class="feed-empty">
                            <h3 class="feed-empty-title">No posts in ${filterName}</h3>
                            <p class="feed-empty-message">There are no posts in this category yet. Try selecting a different filter.</p>
                        </div>
                    `;
                    return;
                }

                filteredPosts.forEach(post => {
                    const postCard = document.createElement('div');
                    postCard.className = post.type === 'event' ? 'event-card' : 'post-card';
                    postCard.onclick = () => showPostDetail(post.id);
                    
                    // Render Event Card (NEW v26)
                    if (post.type === 'event' && post.event) {
                        const event = post.event;
                        const isRSVP = event.rsvps && event.rsvps.includes('You');
                        
                        postCard.innerHTML = `
                            <div class="event-header">
                                <span class="event-badge">Training Session</span>
                                ${event.session ? `
                                    <span class="day-badge day-badge-${event.session.path}">
                                        ${event.session.path === 'flow' ? 'FLOW' : 'MASTERY'} DAY ${event.session.day}
                                    </span>
                                ` : ''}
                            </div>
                            <h3 class="event-title">${event.title}</h3>
                            <div class="event-meta">
                                <span class="event-meta-item">${new Date(event.date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })} at ${event.time}</span>
                                <span class="event-meta-item">${event.location}</span>
                                <span class="event-meta-item">${event.pack}</span>
                            </div>
                            <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 16px;">${event.description}</p>
                            <div class="event-rsvp">
                                <span class="event-rsvp-count">${event.rsvps.length} going</span>
                                <button class="btn-rsvp ${isRSVP ? 'active' : ''}" 
                                        onclick="event.stopPropagation(); toggleRSVP(${event.id})">
                                    ${isRSVP ? 'Going' : 'RSVP'}
                                </button>
                            </div>
                        `;
                        container.appendChild(postCard);
                        return;
                    }
                    
                    // Render Training Session Post (NEW)
                    if (post.type === 'training_session' && post.trainingData) {
                        const training = post.trainingData;
                        const timeAgo = formatTimeAgo(post.timestamp);
                        
                        // Get comments for this post
                        const storedComments = getPostComments(post.id);
                        const totalComments = (post.comments?.length || 0) + storedComments.length;
                        
                        postCard.innerHTML = `
                            <div class="post-header">
                                <img 
                                    src="${post.userAvatar}" 
                                    alt="${post.userName}" 
                                    class="post-avatar"
                                    onclick="event.stopPropagation();"
                                    style="cursor: pointer;">
                                <div class="post-author-info">
                                    <div class="post-author">${post.userName}</div>
                                    <div class="post-timestamp">${timeAgo}</div>
                                </div>
                            </div>
                            <div class="post-content">
                                <div style="margin-bottom: 12px;">
                                    <span class="day-badge day-badge-${training.program}" style="background: var(--black); color: var(--white); padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; display: inline-block;">
                                        ${training.programName.toUpperCase()} Â· DAY ${training.day}
                                    </span>
                                </div>
                                <h4 style="font-size: 16px; font-weight: 600; margin: 0 0 8px 0; color: var(--black);">${training.sessionTitle}</h4>
                                <p class="post-text">${post.content}</p>
                            </div>
                            <div class="post-footer">
                                <span class="post-action-invite">${totalComments > 0 ? 'Active discussion â†’' : 'Start the conversation â†’'}</span>
                            </div>
                        `;
                        
                        container.appendChild(postCard);
                        return;
                    }
                    
                    // Render Regular Post
                    const storedComments = getPostComments(post.id);
                    const totalComments = post.comments.length + storedComments.length;
                    
                    postCard.innerHTML = `
                        <div class="post-header">
                            <img 
                                src="${post.avatar}" 
                                alt="${post.author}" 
                                class="post-avatar"
                                onclick="event.stopPropagation(); showUserProfile('${post.author}', '${post.avatar}', ${post.id})"
                                style="cursor: pointer;">
                            <div class="post-author-info">
                                <div class="post-author">${post.author}</div>
                                <div class="post-timestamp">${post.timestamp}</div>
                            </div>
                        </div>
                        ${post.image ? `<img src="${post.image}" alt="Post image" class="post-image">` : ''}
                        <div class="post-content">
                            ${post.session ? `
                                <div style="margin-bottom: 12px;">
                                    <span class="day-badge day-badge-${post.session.path}">
                                        ${post.session.path === 'flow' ? 'FLOW' : 'MASTERY'} DAY ${post.session.day}
                                    </span>
                                </div>
                            ` : ''}
                            ${post.archetypes && post.archetypes.length > 0 ? `
                                <div class="post-archetypes">
                                    ${post.archetypes.map(arch => `<span class="archetype-tag">${arch}</span>`).join('')}
                                </div>
                            ` : ''}
                            <p class="post-text">${post.text}</p>
                        </div>
                        <div class="post-footer">
                            <span class="post-action-invite">${totalComments > 0 ? 'Active discussion â†’' : 'Start the conversation â†’'}</span>
                        </div>
                    `;
                    
                    container.appendChild(postCard);
                });

                logEvent('feed_loaded', { filter: filterArchetype });
            }, 300);
        }

        function formatTimeAgo(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            if (days < 7) return `${days}d ago`;
            return new Date(timestamp).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function filterFeed(archetype) {
            // Update active filter button
            document.querySelectorAll('.feed-filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.feed-filter-btn[data-filter="${archetype}"]`).classList.add('active');
            
            // Save filter to sessionStorage
            sessionStorage.setItem('hudenFeedFilter', archetype);
            
            // Reload feed with filter
            loadFeed(archetype);
            
            logEvent('feed_filtered', { archetype });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // NIKE-STYLE SEARCH OVERLAY - v33
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        let searchState = {
            searchTerm: '',
            dateRange: 'all',
            customFrom: null,
            customTo: null,
            sortOrder: 'newest',
            activeArchetypeFilter: 'All'
        };

        // Overlay Control
        function openSearchPanel() {
            const overlay = document.getElementById('searchPanelOverlay');
            const overlayInput = document.getElementById('overlaySearchInput');
            const feedInput = document.getElementById('feedSearchInput');
            
            // Sync search term from feed to overlay
            overlayInput.value = feedInput.value;
            if (overlayInput.value) {
                document.getElementById('overlaySearchClear').classList.add('active');
            }
            
            // Update filter count
            updateOverlayFilterCount();
            
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Focus on overlay search input
            setTimeout(() => overlayInput.focus(), 100);
            
            logEvent('search_overlay_opened');
        }

        function closeSearchPanel() {
            const overlay = document.getElementById('searchPanelOverlay');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
            logEvent('search_overlay_closed');
        }

        // Tab Switching
        function switchOverlayTab(tabName) {
            // Update nav items
            document.querySelectorAll('.overlay-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.overlay-nav-item[data-tab="${tabName}"]`).classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.overlay-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(`overlayTab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`).classList.add('active');
        }

        // Search Input Handler (Overlay)
        function handleOverlaySearch() {
            const input = document.getElementById('overlaySearchInput');
            const clearBtn = document.getElementById('overlaySearchClear');
            
            searchState.searchTerm = input.value.trim();
            
            if (searchState.searchTerm) {
                clearBtn.classList.add('active');
            } else {
                clearBtn.classList.remove('active');
            }
        }

        function clearOverlaySearch() {
            document.getElementById('overlaySearchInput').value = '';
            document.getElementById('overlaySearchClear').classList.remove('active');
            searchState.searchTerm = '';
        }

        // Archetype Selection
        function selectOverlayArchetype(archetype) {
            searchState.activeArchetypeFilter = archetype;
            
            document.querySelectorAll('.overlay-pill[data-archetype]').forEach(pill => {
                pill.classList.remove('active');
            });
            document.querySelector(`.overlay-pill[data-archetype="${archetype}"]`).classList.add('active');
        }

        // Date Range Selection
        function selectOverlayDateRange(range) {
            searchState.dateRange = range;
            
            document.querySelectorAll('.overlay-column-item[data-range]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.overlay-column-item[data-range="${range}"]`).classList.add('active');
        }

        // Sort Selection
        function selectOverlaySort(order) {
            searchState.sortOrder = order;
            
            document.querySelectorAll('.overlay-filter-btn[data-sort]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.overlay-filter-btn[data-sort="${order}"]`).classList.add('active');
        }

        // Apply and Close
        function applyFiltersAndClose() {
            // Sync search term from overlay to feed input
            const overlayInput = document.getElementById('overlaySearchInput');
            const feedInput = document.getElementById('feedSearchInput');
            feedInput.value = overlayInput.value;
            
            if (feedInput.value) {
                document.getElementById('feedSearchClear').classList.add('active');
            } else {
                document.getElementById('feedSearchClear').classList.remove('active');
            }
            
            applyAllFilters();
            updateActiveFiltersDisplay();
            updateOverlayFilterCount();
            closeSearchPanel();
            
            // Show toast with filter count
            const filterCount = getActiveFilterCount();
            if (filterCount > 0) {
                showToast(`${filterCount} filter${filterCount > 1 ? 's' : ''} applied`);
            }
        }

        function updateOverlayFilterCount() {
            const countElement = document.getElementById('overlayFilterCount');
            const count = getActiveFilterCount();
            
            if (count === 0) {
                countElement.textContent = 'No filters applied';
            } else {
                countElement.textContent = `${count} filter${count > 1 ? 's' : ''} active`;
            }
        }

        function getActiveFilterCount() {
            let count = 0;
            if (searchState.activeArchetypeFilter !== 'All') count++;
            if (searchState.dateRange !== 'all') count++;
            if (searchState.sortOrder !== 'newest') count++;
            if (searchState.searchTerm) count++;
            return count;
        }

        // Reset All
        function resetAllFiltersFromOverlay() {
            // Reset search state
            searchState = {
                searchTerm: '',
                dateRange: 'all',
                customFrom: null,
                customTo: null,
                sortOrder: 'newest',
                activeArchetypeFilter: 'All'
            };
            
            // Reset UI
            document.getElementById('overlaySearchInput').value = '';
            document.getElementById('overlaySearchClear').classList.remove('active');
            document.getElementById('feedSearchInput').value = '';
            document.getElementById('feedSearchClear').classList.remove('active');
            
            selectOverlayArchetype('All');
            selectOverlayDateRange('all');
            selectOverlaySort('newest');
            
            applyAllFilters();
            updateActiveFiltersDisplay();
            closeSearchPanel();
            
            showToast('All filters cleared');
        }

        // Feed Search Input Handler (small bar)
        function handleFeedSearch() {
            const input = document.getElementById('feedSearchInput');
            const clearBtn = document.getElementById('feedSearchClear');
            
            searchState.searchTerm = input.value.trim();
            
            if (searchState.searchTerm) {
                clearBtn.classList.add('active');
            } else {
                clearBtn.classList.remove('active');
            }
        }

        function clearFeedSearch() {
            document.getElementById('feedSearchInput').value = '';
            document.getElementById('feedSearchClear').classList.remove('active');
            searchState.searchTerm = '';
            applyAllFilters();
            updateActiveFiltersDisplay();
        }

        // Active Filters Display
        function updateActiveFiltersDisplay() {
            const container = document.getElementById('feedActiveFilters');
            const hasActiveFilters = getActiveFilterCount() > 0;
            
            if (!hasActiveFilters) {
                container.classList.remove('active');
                container.innerHTML = '';
                return;
            }
            
            container.classList.add('active');
            container.innerHTML = '';
            
            if (searchState.activeArchetypeFilter !== 'All') {
                container.innerHTML += `
                    <div class="feed-active-filter-tag">
                        ${searchState.activeArchetypeFilter}
                        <button class="feed-active-filter-remove" onclick="removeArchetypeFilter()">Ã—</button>
                    </div>
                `;
            }
            
            if (searchState.dateRange !== 'all') {
                let dateLabel = '';
                switch (searchState.dateRange) {
                    case 'today': dateLabel = 'Last 24 Hours'; break;
                    case '3days': dateLabel = 'Last 3 Days'; break;
                    case 'week': dateLabel = 'Last 7 Days'; break;
                    case '2weeks': dateLabel = 'Last 2 Weeks'; break;
                    case 'month': dateLabel = 'Last 30 Days'; break;
                    case '3months': dateLabel = 'Last 3 Months'; break;
                }
                container.innerHTML += `
                    <div class="feed-active-filter-tag">
                        ${dateLabel}
                        <button class="feed-active-filter-remove" onclick="removeDateFilter()">Ã—</button>
                    </div>
                `;
            }
            
            if (searchState.sortOrder !== 'newest') {
                container.innerHTML += `
                    <div class="feed-active-filter-tag">
                        Oldest First
                        <button class="feed-active-filter-remove" onclick="removeSortFilter()">Ã—</button>
                    </div>
                `;
            }
            
            if (searchState.searchTerm) {
                container.innerHTML += `
                    <div class="feed-active-filter-tag">
                        "${searchState.searchTerm}"
                        <button class="feed-active-filter-remove" onclick="clearFeedSearch()">Ã—</button>
                    </div>
                `;
            }
        }

        // Remove Individual Filters
        function removeArchetypeFilter() {
            searchState.activeArchetypeFilter = 'All';
            selectOverlayArchetype('All');
            applyAllFilters();
            updateActiveFiltersDisplay();
        }

        function removeDateFilter() {
            searchState.dateRange = 'all';
            searchState.customFrom = null;
            searchState.customTo = null;
            selectOverlayDateRange('all');
            applyAllFilters();
            updateActiveFiltersDisplay();
        }

        function removeSortFilter() {
            searchState.sortOrder = 'newest';
            selectOverlaySort('newest');
            applyAllFilters();
            updateActiveFiltersDisplay();
        }

        function resetAllFilters() {
            resetAllFiltersFromOverlay();
        }

        function applyAllFilters() {
            const container = document.getElementById('feedContainer');
            const tier = getUserTier().toLowerCase();
            
            // Start with all posts
            let posts = [...MOCK_DATA.posts];
            
            // 1. Apply archetype filter
            if (searchState.activeArchetypeFilter === 'Today') {
                posts = posts.filter(post => post.session);
            } else if (searchState.activeArchetypeFilter !== 'All') {
                posts = posts.filter(post => 
                    post.archetypes && post.archetypes.includes(searchState.activeArchetypeFilter));
            }
            
            // 2. Apply search term filter
            if (searchState.searchTerm) {
                const term = searchState.searchTerm.toLowerCase();
                posts = posts.filter(post => {
                    const textMatch = post.text.toLowerCase().includes(term);
                    const authorMatch = post.author.toLowerCase().includes(term);
                    const archetypeMatch = post.archetypes && post.archetypes.some(a => 
                        a.toLowerCase().includes(term));
                    return textMatch || authorMatch || archetypeMatch;
                });
            }
            
            // 3. Apply date range filter
            if (searchState.dateRange !== 'all') {
                const now = new Date();
                let startDate;
                
                switch (searchState.dateRange) {
                    case 'today':
                        startDate = new Date(now);
                        startDate.setHours(startDate.getHours() - 24);
                        break;
                    case '3days':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 3);
                        break;
                    case 'week':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 7);
                        break;
                    case '2weeks':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 14);
                        break;
                    case 'month':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 30);
                        break;
                    case '3months':
                        startDate = new Date(now);
                        startDate.setDate(startDate.getDate() - 90);
                        break;
                }
                
                posts = posts.filter(post => {
                    const postDate = parsePostDate(post.timestamp);
                    return postDate >= startDate;
                });
            }
            
            // 4. Apply sort order
            posts.sort((a, b) => {
                const dateA = parsePostDate(a.timestamp);
                const dateB = parsePostDate(b.timestamp);
                return searchState.sortOrder === 'newest' ? dateB - dateA : dateA - dateB;
            });
            
            // Render filtered posts
            renderFilteredPosts(posts, container, tier);
            
            logEvent('feed_search', { 
                term: searchState.searchTerm, 
                dateRange: searchState.dateRange,
                results: posts.length 
            });
        }

        function parsePostDate(timestamp) {
            // Parse various timestamp formats
            // Examples: "2 hours ago", "Yesterday", "Oct 28", "Oct 15, 2024"
            const now = new Date();
            
            if (timestamp.includes('ago')) {
                const value = parseInt(timestamp);
                if (timestamp.includes('minute')) {
                    return new Date(now.getTime() - value * 60000);
                } else if (timestamp.includes('hour')) {
                    return new Date(now.getTime() - value * 3600000);
                } else if (timestamp.includes('day')) {
                    return new Date(now.getTime() - value * 86400000);
                }
            } else if (timestamp === 'Yesterday') {
                const yesterday = new Date(now);
                yesterday.setDate(yesterday.getDate() - 1);
                return yesterday;
            } else if (timestamp.includes(',')) {
                // Format: "Oct 28, 2024"
                return new Date(timestamp);
            } else {
                // Format: "Oct 28" - assume current year
                return new Date(`${timestamp}, ${now.getFullYear()}`);
            }
            
            return now;
        }

        function renderFilteredPosts(posts, container, tier) {
            const canComment = ['flow', 'mastery', 'mentorship', 'coach'].includes(tier);
            
            container.innerHTML = '';
            
            if (posts.length === 0) {
                container.innerHTML = `
                    <div class="feed-empty">
                        <h3 class="feed-empty-title">No posts found</h3>
                        <p class="feed-empty-message">Try adjusting your search or filters to find more posts.</p>
                    </div>
                `;
                return;
            }
            
            posts.forEach(post => {
                const postCard = document.createElement('div');
                postCard.className = post.type === 'event' ? 'event-card' : 'post-card';
                postCard.onclick = () => showPostDetail(post.id);
                
                // Render Event Card
                if (post.type === 'event' && post.event) {
                    const event = post.event;
                    const isRSVP = event.rsvps && event.rsvps.includes('You');
                    
                    postCard.innerHTML = `
                        <div class="event-header">
                            <span class="event-badge">Training Session</span>
                            ${event.session ? `
                                <span class="day-badge day-badge-${event.session.path}">
                                    ${event.session.path === 'flow' ? 'FLOW' : 'MASTERY'} DAY ${event.session.day}
                                </span>
                            ` : ''}
                        </div>
                        <h3 class="event-title">${event.title}</h3>
                        <div class="event-meta">
                            <span class="event-meta-item">${new Date(event.date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })} at ${event.time}</span>
                            <span class="event-meta-item">${event.location}</span>
                            <span class="event-meta-item">${event.pack}</span>
                        </div>
                        <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 16px;">${event.description}</p>
                        <div class="event-rsvp">
                            <span class="event-rsvp-count">${event.rsvps.length} going</span>
                            <button class="btn-rsvp ${isRSVP ? 'active' : ''}" 
                                    onclick="event.stopPropagation(); toggleRSVP(${event.id})">
                                ${isRSVP ? 'Going' : 'RSVP'}
                            </button>
                        </div>
                    `;
                    container.appendChild(postCard);
                    return;
                }
                
                // Render Regular Post
                const storedComments = getPostComments(post.id);
                const totalComments = post.comments.length + storedComments.length;
                
                postCard.innerHTML = `
                    <div class="post-header">
                        <img 
                            src="${post.avatar}" 
                            alt="${post.author}" 
                            class="post-avatar"
                            onclick="event.stopPropagation(); showUserProfile('${post.author}', '${post.avatar}', ${post.id})"
                            style="cursor: pointer;">
                        <div class="post-author-info">
                            <div class="post-author">${post.author}</div>
                            <div class="post-timestamp">${post.timestamp}</div>
                        </div>
                    </div>
                    ${post.image ? `<img src="${post.image}" alt="Post image" class="post-image">` : ''}
                    <div class="post-content">
                        ${post.session ? `
                            <div style="margin-bottom: 12px;">
                                <span class="day-badge day-badge-${post.session.path}">
                                    ${post.session.path === 'flow' ? 'FLOW' : 'MASTERY'} DAY ${post.session.day}
                                </span>
                            </div>
                        ` : ''}
                        ${post.archetypes && post.archetypes.length > 0 ? `
                            <div class="post-archetypes">
                                ${post.archetypes.map(arch => `<span class="archetype-tag">${arch}</span>`).join('')}
                            </div>
                        ` : ''}
                        <p class="post-text">${post.text}</p>
                    </div>
                    <div class="post-footer">
                        <span class="post-action-invite">${totalComments > 0 ? 'Active discussion â†’' : 'Start the conversation â†’'}</span>
                    </div>
                `;
                
                container.appendChild(postCard);
            });
        }

        // Update filterFeed to store archetype filter
        const originalFilterFeed = filterFeed;
        function filterFeed(archetype) {
            searchState.activeArchetypeFilter = archetype;
            
            // If search is active, apply all filters instead of just loading feed
            if (searchState.searchTerm || searchState.dateRange !== 'all') {
                // Update active filter button
                document.querySelectorAll('.feed-filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`.feed-filter-btn[data-filter="${archetype}"]`).classList.add('active');
                
                sessionStorage.setItem('hudenFeedFilter', archetype);
                applyAllFilters();
                logEvent('feed_filtered', { archetype });
            } else {
                originalFilterFeed(archetype);
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function showPostDetail(postId) {
            const post = MOCK_DATA.posts.find(p => p.id === postId);
            if (!post) return;

            const modal = document.getElementById('postDetailModal');
            const content = document.getElementById('postDetailContent');
            const tier = getUserTier().toLowerCase();
            const canComment = ['flow', 'mastery', 'mentorship', 'coach'].includes(tier);
            
            const storedComments = getPostComments(postId);
            const allComments = [...post.comments, ...storedComments];
            
            content.innerHTML = `
                <div class="discussion-detail-header">
                    <div class="discussion-detail-meta" style="cursor: pointer;" onclick="showUserProfile('${post.author}', '${post.avatar}', ${post.id})">
                        <img src="${post.avatar}" alt="${post.author}" class="discussion-avatar">
                        <div class="discussion-meta">
                            <div class="discussion-author">${post.author}</div>
                            <div class="discussion-timestamp">${post.timestamp}</div>
                        </div>
                    </div>
                </div>
                ${post.image ? `<img src="${post.image}" alt="Post image" style="width: 100%; max-height: 400px; object-fit: cover;">` : ''}
                <div class="discussion-detail-content">${post.text}</div>
                ${post.archetypes && post.archetypes.length > 0 ? `
                    <div style="padding: 0 var(--space-4); margin-bottom: var(--space-3);">
                        <div style="display: flex; flex-wrap: wrap; gap: var(--space-1);">
                            ${post.archetypes.map(arch => `<span class="archetype-tag">${arch}</span>`).join('')}
                        </div>
                    </div>
                ` : ''}
                <div class="discussion-detail-footer">
                    <span class="discussion-stat">${allComments.length} comments</span>
                </div>
                ${canComment ? `
                    <div class="comments-section">
                        <h3 class="comments-title">Comments</h3>
                        <form class="comment-form" onsubmit="addPostComment(event, ${postId})">
                            <textarea class="comment-input" placeholder="Add a comment..." required></textarea>
                            <button type="submit" class="btn btn-primary">Post Comment</button>
                        </form>
                        <div class="comments-list" id="postComments${postId}">
                            ${allComments.map((comment, idx) => `
                                <div class="comment-card">
                                    <div class="comment-header">
                                        <img src="${comment.avatar}" alt="${comment.author}" class="comment-avatar">
                                        <div class="comment-meta">
                                            <div class="comment-author">${comment.author}</div>
                                            <div class="comment-timestamp">${comment.timestamp}</div>
                                        </div>
                                        ${comment.author === 'Current User' ? `<button class="comment-delete" onclick="deletePostComment(${postId}, ${idx})">Delete</button>` : ''}
                                    </div>
                                    <p class="comment-text">${comment.text}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `;
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            logEvent('post_detail_opened', { postId });
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // USER PROFILE FUNCTION
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        // Helper function to open current user's profile from TRIBE header avatar
        function openUserProfileFromHeader() {
            const currentUser = getCurrentUser();
            if (currentUser) {
                showUserProfile(currentUser.name, currentUser.avatar, currentUser.id);
                logEvent('profile_opened_from_tribe_header');
            }
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PHASE 2: PUBLIC PROFILE UI - COMPLETE REDESIGN
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function showUserProfile(userName, userAvatar, userId) {
            const modal = document.getElementById('userProfileModal');
            const content = document.getElementById('userProfileContent');
            
            // Get user data from profiles
            const users = getUserProfiles();
            const userProfile = users[userId] || {
                id: userId,
                name: userName,
                avatar: userAvatar,
                bio: 'Movement practitioner exploring natural patterns.',
                location: 'Unknown',
                memberSince: '2024-01-01',
                archetypes: ['Gibbon'],
                practiceGoals: [],
                stats: { posts: 0, comments: 0, packs: 0, sessions: 0, milestones: 0, connections: 0 },
                privacy: { showLocation: true, showActivity: true, showPacks: true, allowMessages: true },
                tier: 'flow'
            };
            
            const currentUser = getCurrentUser();
            const isOwnProfile = isViewingOwnProfile(userId);
            const canMessage = canSendMessage(userId);
            
            // Calculate real stats from MOCK_DATA
            const userPosts = MOCK_DATA.posts.filter(p => p.author === userName);
            userProfile.stats.posts = userPosts.length;
            
            let commentCount = 0;
            MOCK_DATA.posts.forEach(post => {
                const stored = getPostComments(post.id);
                commentCount += stored.filter(c => c.author === userName).length;
            });
            userProfile.stats.comments = commentCount;
            
            // User packs (mock)
            const userPacksCount = MOCK_DATA.packs.filter((p, i) => i < 3).length;
            userProfile.stats.packs = userPacksCount;
            
            // PHASE 2.1: Header Section
            const archetypesList = userProfile.archetypes.join(' Â· ');
            const memberDuration = calculateMemberDuration(userProfile.memberSince);
            
            // PHASE 5: Store current profile data for tab navigation
            window.currentProfileData = {
                userId,
                userName,
                userAvatar,
                userProfile,
                userPosts,
                userPacksCount,
                isOwnProfile,
                canMessage
            };
            
            content.innerHTML = `
                <!-- PHASE 2.1: HEADER SECTION -->
                <div class="user-profile-header">
                    <div class="user-profile-avatar-container">
                        <img src="${userProfile.avatar}" alt="${userProfile.name}" class="user-profile-avatar">
                    </div>
                    <h2 class="user-profile-name">${userProfile.name}</h2>
                    
                    <div class="user-profile-meta">
                        <span class="tier-badge tier-${userProfile.tier}">${userProfile.tier.toUpperCase()}</span>
                    </div>
                    
                    ${userProfile.archetypes.length > 0 ? `
                        <div class="user-profile-archetypes">
                            ${userProfile.archetypes.map(a => `<span class="archetype-pill">${a}</span>`).join('')}
                        </div>
                    ` : ''}
                    
                    ${userProfile.privacy.showLocation && userProfile.location ? `
                        <div class="user-profile-location">${userProfile.location}</div>
                    ` : ''}
                    
                    <div class="user-profile-member-since">Member since ${memberDuration}</div>
                    
                    ${userProfile.bio ? `
                        <p class="user-profile-bio">${userProfile.bio}</p>
                    ` : ''}
                    
                    <!-- PHASE 5.1: Profile Navigation Tabs -->
                    <div class="profile-tab-navigation">
                        <button class="profile-tab active" data-tab="overview" onclick="switchProfileTab('overview')">
                            Overview
                        </button>
                        <button class="profile-tab" data-tab="activity" onclick="switchProfileTab('activity')">
                            Activity
                        </button>
                        <button class="profile-tab" data-tab="packs" onclick="switchProfileTab('packs')">
                            Packs
                        </button>
                        ${userProfile.tier === 'coach' ? `
                            <button class="profile-tab" data-tab="reviews" onclick="switchProfileTab('reviews')">
                                Reviews
                            </button>
                        ` : ''}
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="user-profile-actions">
                        ${isOwnProfile ? `
                            <button class="btn btn-primary" onclick="editProfile('${userId}')">
                                Edit Profile
                            </button>
                        ` : canMessage ? `
                            <button class="btn btn-primary" onclick="openDM('${userId}', '${userName.replace(/'/g, "\\'")}'); closeModal('userProfileModal')">
                                Message
                            </button>
                        ` : ''}
                        
                        ${isOwnProfile ? `
                            <button class="btn btn-ghost" onclick="showMembershipInfo('${userId}')">
                                Membership
                            </button>
                            <button class="btn btn-ghost" onclick="showMyBookings('${userId}')">
                                Bookings
                            </button>
                        ` : ''}
                    </div>
                </div>
                
                <!-- PHASE 5: Tab Content Container -->
                <div id="profileTabContent">
                
                <!-- Tab: Overview (default) -->
                <div class="profile-tab-pane active" data-tab-content="overview">
                
                <!-- PHASE 2.2: STATS CARDS -->
                <div class="user-profile-stats">
                    <div class="user-profile-stat-card">
                        <div class="stat-value">${userProfile.stats.posts}</div>
                        <div class="stat-label">Posts</div>
                    </div>
                    <div class="user-profile-stat-card">
                        <div class="stat-value">${userProfile.stats.comments}</div>
                        <div class="stat-label">Comments</div>
                    </div>
                    <div class="user-profile-stat-card">
                        <div class="stat-value">${userProfile.stats.packs}</div>
                        <div class="stat-label">Packs</div>
                    </div>
                    ${['mentorship', 'coach'].includes(userProfile.tier) ? `
                        <div class="user-profile-stat-card">
                            <div class="stat-value">${userProfile.stats.connections}</div>
                            <div class="stat-label">Connections</div>
                        </div>
                    ` : ''}
                </div>
                
                <!-- PHASE 2.3: PRACTICE GOALS -->
                ${userProfile.practiceGoals.length > 0 ? `
                    <div class="user-profile-section">
                        <h3 class="section-subtitle">Practice Goals</h3>
                        <div class="practice-goals-list">
                            ${userProfile.practiceGoals.map(goal => `
                                <div class="practice-goal-item">${goal}</div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                
                <!-- PHASE 2.4: RECENT ACTIVITY -->
                ${userProfile.privacy.showActivity && userPosts.length > 0 ? `
                    <div class="user-profile-section">
                        <h3 class="section-subtitle">Recent Posts</h3>
                        <div class="user-recent-posts">
                            ${userPosts.slice(0, 5).map(post => `
                                <div class="user-post-mini" onclick="viewPostDetail(${post.id})">
                                    ${post.image ? `
                                        <img src="${post.image}" alt="Post" class="post-mini-image">
                                    ` : ''}
                                    <div class="post-mini-text">${post.text.substring(0, 120)}${post.text.length > 120 ? '...' : ''}</div>
                                    <div class="post-mini-meta">${post.timestamp}</div>
                                </div>
                            `).join('')}
                        </div>
                        ${userPosts.length > 5 ? `
                            <button class="btn btn-ghost btn-small" style="width: 100%; margin-top: var(--space-2);">
                                View All Posts
                            </button>
                        ` : ''}
                    </div>
                ` : ''}
                
                <!-- PHASE 2.5: ACTIVE PACKS -->
                ${userProfile.privacy.showPacks && userPacksCount > 0 ? `
                    <div class="user-profile-section">
                        <h3 class="section-subtitle">Active Packs</h3>
                        <div class="user-packs-scroll">
                            ${MOCK_DATA.packs.slice(0, Math.min(6, userPacksCount)).map(pack => `
                                <div class="pack-mini-card" onclick="viewPackDetail(${pack.id})">
                                    <img src="${pack.image}" alt="${pack.name}" class="pack-mini-image">
                                    <div class="pack-mini-name">${pack.name}</div>
                                    <div class="pack-mini-members">${pack.members} members</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                
                <!-- PHASE 4: COACH-SPECIFIC FEATURES -->
                ${userProfile.tier === 'coach' && userProfile.coachInfo ? `
                    <!-- PHASE 4.1: Coach Badge & Public Info (Already in header with specialties) -->
                    
                    <!-- PHASE 4.2: Coach Stats Dashboard -->
                    <div class="user-profile-section coach-section">
                        <h3 class="section-subtitle">Coach Performance</h3>
                        <div class="coach-stats-grid">
                            <div class="coach-stat-card">
                                <div class="coach-stat-value">${userProfile.coachInfo.totalSessions}</div>
                                <div class="coach-stat-label">Sessions</div>
                            </div>
                            <div class="coach-stat-card">
                                <div class="coach-stat-value">${userProfile.coachInfo.averageRating.toFixed(1)} â˜…</div>
                                <div class="coach-stat-label">Rating</div>
                            </div>
                            <div class="coach-stat-card">
                                <div class="coach-stat-value">${userProfile.coachInfo.activeMentorships}</div>
                                <div class="coach-stat-label">Active Students</div>
                            </div>
                            <div class="coach-stat-card">
                                <div class="coach-stat-value">${userProfile.coachInfo.responseTime}</div>
                                <div class="coach-stat-label">Response Time</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Specialties & Rate -->
                    <div class="user-profile-section coach-section">
                        <h3 class="section-subtitle">Expertise</h3>
                        <div class="coach-specialties">
                            ${userProfile.coachInfo.specialties.map(spec => `
                                <span class="specialty-tag">${spec}</span>
                            `).join('')}
                        </div>
                        <div class="coach-info-row">
                            <div class="coach-info-item">
                                <span class="coach-info-label">Rate</span>
                                <span class="coach-info-value">â‚¬${userProfile.coachInfo.rate}/hour</span>
                            </div>
                            <div class="coach-info-item">
                                <span class="coach-info-label">Experience</span>
                                <span class="coach-info-value">${userProfile.coachInfo.yearsExperience} years</span>
                            </div>
                        </div>
                        ${userProfile.coachInfo.certifications.length > 0 ? `
                            <div class="coach-certifications">
                                ${userProfile.coachInfo.certifications.map(cert => `
                                    <div class="certification-badge">${cert}</div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- PHASE 4.3: Reviews Section -->
                    ${userProfile.coachInfo.reviews && userProfile.coachInfo.reviews.length > 0 ? `
                        <div class="user-profile-section coach-section">
                            <h3 class="section-subtitle">Reviews (${userProfile.coachInfo.reviews.length})</h3>
                            
                            <!-- Rating Breakdown -->
                            <div class="rating-summary">
                                <div class="rating-average">
                                    <div class="rating-number">${userProfile.coachInfo.averageRating.toFixed(1)}</div>
                                    <div class="rating-stars">${'â˜…'.repeat(Math.round(userProfile.coachInfo.averageRating))}${'â˜†'.repeat(5 - Math.round(userProfile.coachInfo.averageRating))}</div>
                                    <div class="rating-count">${userProfile.coachInfo.reviews.length} reviews</div>
                                </div>
                            </div>
                            
                            <!-- Reviews List -->
                            <div class="reviews-list">
                                ${userProfile.coachInfo.reviews.slice(0, 5).map(review => `
                                    <div class="review-card">
                                        <div class="review-header">
                                            <img src="${review.avatar}" alt="${review.author}" class="review-avatar">
                                            <div class="review-author-info">
                                                <div class="review-author">${review.author}</div>
                                                <div class="review-rating">${'â˜…'.repeat(review.rating)}${'â˜†'.repeat(5 - review.rating)}</div>
                                            </div>
                                            <div class="review-date">${new Date(review.date).toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}</div>
                                        </div>
                                        <p class="review-text">${review.text}</p>
                                    </div>
                                `).join('')}
                            </div>
                            
                            ${userProfile.coachInfo.reviews.length > 5 ? `
                                <button class="btn btn-ghost btn-small" style="width: 100%; margin-top: var(--space-2);">
                                    View All Reviews
                                </button>
                            ` : ''}
                        </div>
                    ` : ''}
                    
                    <!-- PHASE 4.4: Availability Calendar (Preview) -->
                    ${!isOwnProfile ? `
                        <div class="user-profile-section coach-section">
                            <h3 class="section-subtitle">Book a Session</h3>
                            <div class="availability-preview">
                                <div class="availability-info">
                                    <div class="availability-status">Usually responds in ${userProfile.coachInfo.responseTime}</div>
                                    <div class="next-available">Next available: Tomorrow 10:00 AM</div>
                                </div>
                                <button class="btn btn-primary" onclick="bookCoachSession('${userId}')">
                                    Schedule Session
                                </button>
                            </div>
                        </div>
                    ` : ''}
                    
                    <!-- PHASE 4.5: My Mentorships (Coach own profile only) -->
                    ${isOwnProfile ? `
                        <div class="user-profile-section coach-section">
                            <h3 class="section-subtitle">My Mentorships</h3>
                            <div class="mentorships-summary">
                                <div class="mentorship-stat">
                                    <span class="mentorship-stat-value">${userProfile.coachInfo.activeMentorships}</span>
                                    <span class="mentorship-stat-label">Active Students</span>
                                </div>
                                <button class="btn btn-ghost" onclick="viewMyMentorships('${userId}')">
                                    Manage Students
                                </button>
                            </div>
                        </div>
                    ` : ''}
                ` : ''}
                
                </div>
                <!-- End Tab: Overview -->
                
                <!-- Tab: Activity -->
                <div class="profile-tab-pane" data-tab-content="activity">
                    <div class="tab-content-header">
                        <h3 class="tab-content-title">Activity</h3>
                        <p class="tab-content-desc">Posts and contributions</p>
                    </div>
                    
                    ${userProfile.privacy.showActivity && userPosts.length > 0 ? `
                        <div class="activity-feed">
                            ${userPosts.map(post => `
                                <div class="activity-post-card" onclick="viewPostDetail(${post.id})">
                                    ${post.image ? `
                                        <img src="${post.image}" alt="Post" class="activity-post-image">
                                    ` : ''}
                                    <div class="activity-post-content">
                                        <div class="activity-post-text">${post.text}</div>
                                        <div class="activity-post-meta">
                                            ${post.timestamp}
                                            ${post.archetypes.length > 0 ? ` Â· ${post.archetypes.join(', ')}` : ''}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="empty-state">
                            <p>No activity to display</p>
                        </div>
                    `}
                </div>
                <!-- End Tab: Activity -->
                
                <!-- Tab: My Packs -->
                <div class="profile-tab-pane" data-tab-content="packs">
                    <div class="tab-content-header">
                        <h3 class="tab-content-title">My Packs</h3>
                        <p class="tab-content-desc">${isOwnProfile ? 'Packs you belong to' : 'Packs this user belongs to'}</p>
                    </div>
                    
                    ${userProfile.privacy.showPacks && userPacksCount > 0 ? `
                        <div class="packs-grid">
                            ${MOCK_DATA.packs.slice(0, userPacksCount).map(pack => `
                                <div class="pack-card" onclick="viewPackDetail(${pack.id})">
                                    <img src="${pack.image}" alt="${pack.name}" class="pack-card-image">
                                    <div class="pack-card-content">
                                        <h4 class="pack-card-name">${pack.name}</h4>
                                        <div class="pack-card-location">${pack.location}</div>
                                        <div class="pack-card-members">${pack.members} members</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="empty-state">
                            <p>${isOwnProfile ? 'You haven\'t joined any packs yet' : 'This user hasn\'t joined any packs yet'}</p>
                        </div>
                    `}
                </div>
                <!-- End Tab: My Packs -->
                
                <!-- Tab: Reviews (Coach only) -->
                ${userProfile.tier === 'coach' && userProfile.coachInfo ? `
                    <div class="profile-tab-pane" data-tab-content="reviews">
                        <div class="tab-content-header">
                            <h3 class="tab-content-title">Reviews</h3>
                            <p class="tab-content-desc">${userProfile.coachInfo.averageRating.toFixed(1)} â˜… average from ${userProfile.coachInfo.reviews.length} reviews</p>
                        </div>
                        
                        ${userProfile.coachInfo.reviews.length > 0 ? `
                            <div class="reviews-list">
                                ${userProfile.coachInfo.reviews.map(review => `
                                    <div class="review-card">
                                        <div class="review-header">
                                            <img src="${review.avatar}" alt="${review.author}" class="review-avatar">
                                            <div class="review-author-info">
                                                <div class="review-author">${review.author}</div>
                                                <div class="review-rating">${'â˜…'.repeat(review.rating)}${'â˜†'.repeat(5 - review.rating)}</div>
                                            </div>
                                            <div class="review-date">${new Date(review.date).toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}</div>
                                        </div>
                                        <p class="review-text">${review.text}</p>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="empty-state">
                                <p>No reviews yet</p>
                            </div>
                        `}
                    </div>
                ` : ''}
                <!-- End Tab: Reviews -->
                
                </div>
                <!-- End Tab Content Container -->
            `;
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            logEvent('user_profile_opened', { userName, userId });
        }
        
        function calculateMemberDuration(memberSince) {
            const start = new Date(memberSince);
            const now = new Date();
            const months = Math.floor((now - start) / (1000 * 60 * 60 * 24 * 30));
            
            if (months < 1) return 'less than a month';
            if (months === 1) return '1 month';
            if (months < 12) return `${months} months`;
            
            const years = Math.floor(months / 12);
            const remainingMonths = months % 12;
            if (remainingMonths === 0) return `${years} ${years === 1 ? 'year' : 'years'}`;
            return `${years} ${years === 1 ? 'year' : 'years'}, ${remainingMonths} ${remainingMonths === 1 ? 'month' : 'months'}`;
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PHASE 5: PROFILE TAB NAVIGATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function switchProfileTab(tabName) {
            // Remove active from all tabs
            const tabs = document.querySelectorAll('.profile-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Add active to clicked tab
            const activeTab = document.querySelector(`.profile-tab[data-tab="${tabName}"]`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
            
            // Hide all tab panes
            const panes = document.querySelectorAll('.profile-tab-pane');
            panes.forEach(pane => pane.classList.remove('active'));
            
            // Show selected tab pane
            const activePane = document.querySelector(`.profile-tab-pane[data-tab-content="${tabName}"]`);
            if (activePane) {
                activePane.classList.add('active');
            }
            
            // Update URL hash (optional deep linking)
            // window.location.hash = `profile-${tabName}`;
            
            logEvent('profile_tab_switched', { tab: tabName });
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PHASE 3: PRIVATE PROFILE SECTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function editProfile(userId) {
            const users = getUserProfiles();
            const user = users[userId];
            if (!user) return;
            
            const modal = document.getElementById('userProfileModal');
            const content = document.getElementById('userProfileContent');
            
            content.innerHTML = `
                <div class="edit-profile-container">
                    <h2 class="edit-profile-title">Edit Profile</h2>
                    
                    <form id="editProfileForm" onsubmit="saveProfileChanges(event, '${userId}')">
                        <!-- Avatar Upload -->
                        <div class="form-group">
                            <label class="form-label">Profile Photo</label>
                            <div class="avatar-upload-area">
                                <img src="${user.avatar}" alt="${user.name}" id="avatarPreview" class="avatar-preview">
                                <div style="display: flex; flex-direction: column; gap: var(--space-2);">
                                    <input type="file" id="avatarInput" accept="image/*" style="display: none;" onchange="previewAvatar(event)">
                                    <button type="button" class="btn btn-ghost btn-small" onclick="document.getElementById('avatarInput').click()">
                                        Change Photo
                                    </button>
                                    <button type="button" class="btn btn-ghost btn-small" onclick="removeAvatar()" style="display: none;" id="removeAvatarBtn">
                                        Remove Photo
                                    </button>
                                </div>
                            </div>
                            <p style="font-size: 12px; color: var(--gray-600); margin-top: var(--space-2);">
                                JPG, PNG or GIF. Max 5MB.
                            </p>
                        </div>
                        
                        <!-- Bio -->
                        <div class="form-group">
                            <label class="form-label" for="bioInput">Bio (max 280 characters)</label>
                            <textarea 
                                id="bioInput" 
                                class="form-textarea" 
                                maxlength="280" 
                                rows="4"
                                placeholder="Tell the community about your practice..."
                            >${user.bio || ''}</textarea>
                            <div class="form-hint"><span id="bioCount">${(user.bio || '').length}</span>/280</div>
                        </div>
                        
                        <!-- Location -->
                        <div class="form-group">
                            <label class="form-label" for="locationInput">Location</label>
                            <input 
                                type="text" 
                                id="locationInput" 
                                class="form-input" 
                                value="${user.location || ''}"
                                placeholder="City, Country"
                            >
                        </div>
                        
                        <!-- Practice Goals -->
                        <div class="form-group">
                            <label class="form-label">Practice Goals (max 5)</label>
                            <div id="practiceGoalsEditor">
                                ${user.practiceGoals.map((goal, i) => `
                                    <div class="goal-input-row">
                                        <input type="text" class="form-input" value="${goal}" data-goal-index="${i}">
                                        <button type="button" class="btn-icon-remove" onclick="removeGoal(${i})">Ã—</button>
                                    </div>
                                `).join('')}
                                ${user.practiceGoals.length < 5 ? `
                                    <button type="button" class="btn btn-ghost btn-small" onclick="addGoalInput()">
                                        + Add Goal
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- PHASE 3.1: Privacy Settings -->
                        <div class="form-section">
                            <h3 class="form-section-title">Privacy Settings</h3>
                            
                            <div class="privacy-toggle">
                                <div class="privacy-toggle-info">
                                    <div class="privacy-toggle-label">Show Location</div>
                                    <div class="privacy-toggle-hint">Display your location on your profile</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="privacyLocation" ${user.privacy.showLocation ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="privacy-toggle">
                                <div class="privacy-toggle-info">
                                    <div class="privacy-toggle-label">Show Activity</div>
                                    <div class="privacy-toggle-hint">Show your posts and comments</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="privacyActivity" ${user.privacy.showActivity ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="privacy-toggle">
                                <div class="privacy-toggle-info">
                                    <div class="privacy-toggle-label">Show Packs</div>
                                    <div class="privacy-toggle-hint">Display your active packs</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="privacyPacks" ${user.privacy.showPacks ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            
                            <div class="privacy-toggle">
                                <div class="privacy-toggle-info">
                                    <div class="privacy-toggle-label">Allow Messages</div>
                                    <div class="privacy-toggle-hint">Let others send you direct messages</div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="privacyMessages" ${user.privacy.allowMessages ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="form-actions">
                            <button type="button" class="btn btn-ghost" onclick="showUserProfile('${user.name}', '${user.avatar}', '${userId}')">
                                Cancel
                            </button>
                            <button type="submit" class="btn btn-primary">
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            // Bio character counter
            const bioInput = document.getElementById('bioInput');
            const bioCount = document.getElementById('bioCount');
            bioInput.addEventListener('input', () => {
                bioCount.textContent = bioInput.value.length;
            });
        }
        
        function addGoalInput() {
            const editor = document.getElementById('practiceGoalsEditor');
            const currentGoals = editor.querySelectorAll('.goal-input-row').length;
            
            if (currentGoals >= 5) {
                showToast('Maximum 5 goals allowed');
                return;
            }
            
            const newGoal = document.createElement('div');
            newGoal.className = 'goal-input-row';
            newGoal.innerHTML = `
                <input type="text" class="form-input" placeholder="New practice goal..." data-goal-index="${currentGoals}">
                <button type="button" class="btn-icon-remove" onclick="removeGoal(${currentGoals})">Ã—</button>
            `;
            
            const addButton = editor.querySelector('.btn-ghost');
            if (addButton) {
                editor.insertBefore(newGoal, addButton);
            } else {
                editor.appendChild(newGoal);
            }
        }
        
        function removeGoal(index) {
            const editor = document.getElementById('practiceGoalsEditor');
            const goals = editor.querySelectorAll('.goal-input-row');
            if (goals[index]) {
                goals[index].remove();
                
                // Show add button if under 5 goals
                if (editor.querySelectorAll('.goal-input-row').length < 5) {
                    const addBtn = editor.querySelector('.btn-ghost');
                    if (!addBtn) {
                        const btn = document.createElement('button');
                        btn.type = 'button';
                        btn.className = 'btn btn-ghost btn-small';
                        btn.textContent = '+ Add Goal';
                        btn.onclick = addGoalInput;
                        editor.appendChild(btn);
                    }
                }
            }
        }
        
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AVATAR UPLOAD SYSTEM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        let pendingAvatarFile = null;
        
        function previewAvatar(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Validate file type
            const validTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                showToast('Please select a valid image (JPG, PNG, GIF, or WebP)');
                return;
            }
            
            // Validate file size (5MB max)
            const maxSize = 5 * 1024 * 1024; // 5MB in bytes
            if (file.size > maxSize) {
                showToast('Image must be less than 5MB');
                return;
            }
            
            // Store file for later upload
            pendingAvatarFile = file;
            
            // Preview image
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('avatarPreview');
                if (preview) {
                    preview.src = e.target.result;
                }
                
                // Show remove button
                const removeBtn = document.getElementById('removeAvatarBtn');
                if (removeBtn) {
                    removeBtn.style.display = 'block';
                }
            };
            reader.readAsDataURL(file);
            
            logEvent('avatar_preview', { fileName: file.name, fileSize: file.size });
        }
        
        function removeAvatar() {
            const currentUser = getCurrentUser();
            const users = getUserProfiles();
            const user = users[currentUser.id];
            
            if (!user) return;
            
            // Reset to default avatar
            const defaultAvatar = 'https://i.ibb.co/2W4zjBp/default-avatar.jpg';
            
            const preview = document.getElementById('avatarPreview');
            if (preview) {
                preview.src = defaultAvatar;
            }
            
            // Clear pending file
            pendingAvatarFile = null;
            
            // Update user profile immediately
            user.avatar = defaultAvatar;
            localStorage.setItem('hudenUserProfiles', JSON.stringify(users));
            
            // Hide remove button
            const removeBtn = document.getElementById('removeAvatarBtn');
            if (removeBtn) {
                removeBtn.style.display = 'none';
            }
            
            // Clear file input
            const fileInput = document.getElementById('avatarInput');
            if (fileInput) {
                fileInput.value = '';
            }
            
            showToast('Avatar removed');
            logEvent('avatar_removed');
        }
        
        async function uploadAvatarToImgBB(file) {
            const apiKey = '8d4e3f7a1c9b2d6e5f8a7c9b3d2e1f4a'; // Replace with your ImgBB API key
            const formData = new FormData();
            formData.append('image', file);
            
            try {
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error('Upload failed');
                }
                
                const data = await response.json();
                
                if (data.success) {
                    return data.data.url;
                } else {
                    throw new Error('Upload failed');
                }
            } catch (error) {
                console.error('ImgBB upload error:', error);
                throw error;
            }
        }
        
        function saveProfileChanges(event, userId) {
            event.preventDefault();
            
            const users = getUserProfiles();
            const user = users[userId];
            if (!user) return;
            
            // Show loading state
            const submitBtn = event.target.querySelector('button[type="submit"]');
            const originalBtnText = submitBtn ? submitBtn.textContent : '';
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.textContent = 'Saving...';
            }
            
            // Handle avatar upload if there's a pending file
            if (pendingAvatarFile) {
                showToast('Uploading avatar...');
                
                uploadAvatarToImgBB(pendingAvatarFile)
                    .then(avatarUrl => {
                        // Update user avatar
                        user.avatar = avatarUrl;
                        
                        // Clear pending file
                        pendingAvatarFile = null;
                        
                        // Continue with rest of profile update
                        completeProfileSave(user, userId, submitBtn, originalBtnText);
                    })
                    .catch(error => {
                        console.error('Avatar upload failed:', error);
                        showToast('Avatar upload failed. Using local preview.');
                        
                        // Save with current preview if upload fails
                        const preview = document.getElementById('avatarPreview');
                        if (preview && preview.src.startsWith('data:')) {
                            user.avatar = preview.src;
                        }
                        
                        pendingAvatarFile = null;
                        completeProfileSave(user, userId, submitBtn, originalBtnText);
                    });
            } else {
                // No avatar change, just save other fields
                completeProfileSave(user, userId, submitBtn, originalBtnText);
            }
        }
        
        function completeProfileSave(user, userId, submitBtn, originalBtnText) {
            // Get form values
            const bio = document.getElementById('bioInput').value;
            const location = document.getElementById('locationInput').value;
            
            // Get practice goals
            const goalInputs = document.querySelectorAll('#practiceGoalsEditor .form-input');
            const goals = Array.from(goalInputs)
                .map(input => input.value.trim())
                .filter(goal => goal.length > 0);
            
            // Get privacy settings
            const privacy = {
                showLocation: document.getElementById('privacyLocation').checked,
                showActivity: document.getElementById('privacyActivity').checked,
                showPacks: document.getElementById('privacyPacks').checked,
                allowMessages: document.getElementById('privacyMessages').checked
            };
            
            // Update user profile
            user.bio = bio;
            user.location = location;
            user.practiceGoals = goals;
            user.privacy = privacy;
            
            // Save to localStorage
            const users = getUserProfiles();
            users[userId] = user;
            localStorage.setItem('hudenUserProfiles', JSON.stringify(users));
            
            // Restore button state
            if (submitBtn) {
                submitBtn.disabled = false;
                submitBtn.textContent = originalBtnText;
            }
            
            // Show success and reload profile
            showToast('Profile updated successfully');
            setTimeout(() => {
                showUserProfile(user.name, user.avatar, userId);
            }, 500);
            
            logEvent('profile_updated', { userId, hasAvatar: !!user.avatar });
        }
        
        // PHASE 3.2: My Bookings Section (for own profile)
        function showMyBookings(userId) {
            const modal = document.getElementById('userProfileModal');
            const content = document.getElementById('userProfileContent');
            
            // Mock bookings data
            const upcomingBookings = [
                {
                    id: 'book1',
                    coachName: 'Marcus Torres',
                    coachAvatar: 'https://i.pravatar.cc/150?img=2',
                    date: '2024-11-15',
                    time: '10:00 AM',
                    duration: '60 min',
                    type: 'Mentorship Session',
                    status: 'confirmed'
                }
            ];
            
            const pastBookings = [
                {
                    id: 'book2',
                    coachName: 'Marcus Torres',
                    coachAvatar: 'https://i.pravatar.cc/150?img=2',
                    date: '2024-10-28',
                    time: '10:00 AM',
                    duration: '60 min',
                    type: 'Mentorship Session',
                    status: 'completed'
                }
            ];
            
            content.innerHTML = `
                <div class="bookings-container">
                    <div class="bookings-header">
                        <button class="btn-back" onclick="showUserProfile('${getCurrentUser().name}', '${getCurrentUser().avatar}', '${userId}')">
                            â† Back
                        </button>
                        <h2 class="page-title">My Bookings</h2>
                    </div>
                    
                    <!-- Upcoming -->
                    <div class="bookings-section">
                        <h3 class="section-subtitle">Upcoming Sessions</h3>
                        ${upcomingBookings.length > 0 ? `
                            <div class="bookings-list">
                                ${upcomingBookings.map(booking => `
                                    <div class="booking-card">
                                        <div class="booking-coach">
                                            <img src="${booking.coachAvatar}" alt="${booking.coachName}" class="booking-coach-avatar">
                                            <div>
                                                <div class="booking-coach-name">${booking.coachName}</div>
                                                <div class="booking-type">${booking.type}</div>
                                            </div>
                                        </div>
                                        <div class="booking-details">
                                            <div class="booking-datetime">${new Date(booking.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })} at ${booking.time}</div>
                                            <div class="booking-duration">${booking.duration}</div>
                                        </div>
                                        <div class="booking-actions">
                                            <button class="btn btn-ghost btn-small" onclick="rescheduleBooking('${booking.id}')">Reschedule</button>
                                            <button class="btn btn-ghost btn-small" onclick="cancelBooking('${booking.id}')">Cancel</button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="empty-state">
                                <p>No upcoming sessions scheduled</p>
                            </div>
                        `}
                    </div>
                    
                    <!-- Past -->
                    <div class="bookings-section">
                        <h3 class="section-subtitle">Past Sessions</h3>
                        ${pastBookings.length > 0 ? `
                            <div class="bookings-list">
                                ${pastBookings.map(booking => `
                                    <div class="booking-card booking-past">
                                        <div class="booking-coach">
                                            <img src="${booking.coachAvatar}" alt="${booking.coachName}" class="booking-coach-avatar">
                                            <div>
                                                <div class="booking-coach-name">${booking.coachName}</div>
                                                <div class="booking-type">${booking.type}</div>
                                            </div>
                                        </div>
                                        <div class="booking-details">
                                            <div class="booking-datetime">${new Date(booking.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="empty-state">
                                <p>No past sessions</p>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }
        
        function rescheduleBooking(bookingId) {
            showToast('Reschedule feature - Coming soon');
        }
        
        async function cancelBooking(bookingId) {
            const confirmed = await CustomModal.confirm(
                'Cancel Booking',
                'Are you sure you want to cancel this booking?',
                { 
                    confirmText: 'Cancel Booking', 
                    cancelText: 'Keep Booking'
                }
            );
            
            if (confirmed) {
                showToast('Booking cancelled');
            }
        }
        
        
        // PHASE 3.4: Membership Info
        function showMembershipInfo(userId) {
            const user = getUserProfiles()[userId];
            const modal = document.getElementById('userProfileModal');
            const content = document.getElementById('userProfileContent');
            
            const tierBenefits = {
                'essential': ['Community Feed', 'Pack Discovery', 'Basic Inbox'],
                'flow': ['All Essential features', 'Direct Messaging', 'Event RSVPs', 'Training Integration'],
                'mastery': ['All Flow features', 'Priority Support', 'Advanced Analytics'],
                'mentorship': ['All Mastery features', 'Coach Booking', 'Private Threads', 'Priority Mentorship'],
                'coach': ['All Mentorship features', 'Coach Dashboard', 'Student Management', 'Revenue Tools']
            };
            
            const nextTier = {
                'essential': 'flow',
                'flow': 'mastery',
                'mastery': 'mentorship',
                'mentorship': 'coach',
                'coach': null
            };
            
            content.innerHTML = `
                <div class="membership-container">
                    <div class="membership-header">
                        <button class="btn-back" onclick="showUserProfile('${user.name}', '${user.avatar}', '${userId}')">
                            â† Back
                        </button>
                        <h2 class="page-title">Membership</h2>
                    </div>
                    
                    <!-- Current Tier -->
                    <div class="current-tier-card">
                        <div class="tier-badge tier-${user.tier} tier-large">${user.tier.toUpperCase()}</div>
                        <h3 class="current-tier-title">Current Plan</h3>
                        <p class="current-tier-desc">You have full access to all ${user.tier} features</p>
                    </div>
                    
                    <!-- Benefits -->
                    <div class="membership-section">
                        <h3 class="section-subtitle">Your Benefits</h3>
                        <div class="benefits-list">
                            ${tierBenefits[user.tier].map(benefit => `
                                <div class="benefit-item">${benefit}</div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- Upgrade CTA -->
                    ${nextTier[user.tier] ? `
                        <div class="membership-section">
                            <h3 class="section-subtitle">Upgrade to ${nextTier[user.tier].toUpperCase()}</h3>
                            <div class="upgrade-card">
                                <p>Unlock ${tierBenefits[nextTier[user.tier]].filter(b => !tierBenefits[user.tier].includes(b))[0]}</p>
                                <button class="btn btn-primary" onclick="showUpgradeModal('${nextTier[user.tier]}')">
                                    Upgrade Now
                                </button>
                            </div>
                        </div>
                    ` : `
                        <div class="membership-section">
                            <div class="max-tier-message">
                                You're on the highest tier with full platform access
                            </div>
                        </div>
                    `}
                    
                    <!-- Billing (Placeholder) -->
                    <div class="membership-section">
                        <h3 class="section-subtitle">Billing</h3>
                        <button class="btn btn-ghost" onclick="showToast('Billing portal - Coming soon')">
                            Manage Billing
                        </button>
                    </div>
                </div>
            `;
        }
        
        function showUpgradeModal(tier) {
            showToast(`Upgrade to ${tier} - Coming soon`);
        }
        
        function viewPostDetail(postId) {
            showToast('Post detail view - Coming soon');
        }
        
        // Helper to close map detail panel
        function closeMapDetailPanel() {
            const mapPanel = document.getElementById('mapDetailPanel');
            if (mapPanel && mapPanel.classList.contains('active')) {
                mapPanel.classList.remove('active');
            }
        }
        
        function viewPackDetail(packId) {
            // CRITICAL: Close map detail panel first if it's open
            closeMapDetailPanel();
            
            // Check if we're already in tribe tab
            const currentTab = document.getElementById('tribeTab');
            const isTRIBEActive = currentTab && currentTab.classList.contains('active');
            
            if (!isTRIBEActive) {
                // Set flag to prevent auto-loading map section
                window._tribeSectionOverride = true;
                // We're in a different tab, need to switch to tribe first
                switchTab('tribe');
            }
            
            // Now switch to packs section (with longer delay to ensure panel is closed)
            setTimeout(() => {
                switchTRIBESection('packs');
                // Scroll to top after switching
                window.scrollTo({ top: 0, behavior: 'smooth' });
                showToast(`Viewing pack: ${packId}`);
            }, isTRIBEActive ? 100 : 200);
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PHASE 4: COACH HELPER FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function bookCoachSession(coachId) {
            closeModal('userProfileModal');
            showToast('Opening booking flow...');
            // In production: navigate to booking calendar
            setTimeout(() => {
                navigateToTab('guide');
            }, 500);
        }
        
        function viewMyMentorships(coachId) {
            const modal = document.getElementById('userProfileModal');
            const content = document.getElementById('userProfileContent');
            const user = getUserProfiles()[coachId];
            
            // Mock mentorships
            const activeMentorships = [
                {
                    id: 'ment1',
                    studentName: 'Emma Rodriguez',
                    studentAvatar: 'https://i.pravatar.cc/150?img=3',
                    startDate: '2024-09-15',
                    sessionsCompleted: 4,
                    nextSession: '2024-11-05',
                    focus: 'Flexibility & Mobility'
                }
            ];
            
            content.innerHTML = `
                <div class="mentorships-container">
                    <div class="mentorships-header">
                        <button class="btn-back" onclick="showUserProfile('${user.name}', '${user.avatar}', '${coachId}')">
                            â† Back
                        </button>
                        <h2 class="page-title">My Students</h2>
                    </div>
                    
                    ${activeMentorships.length > 0 ? `
                        <div class="mentorships-list">
                            ${activeMentorships.map(ment => `
                                <div class="mentorship-card">
                                    <div class="mentorship-student">
                                        <img src="${ment.studentAvatar}" alt="${ment.studentName}" class="mentorship-avatar">
                                        <div>
                                            <div class="mentorship-student-name">${ment.studentName}</div>
                                            <div class="mentorship-focus">${ment.focus}</div>
                                        </div>
                                    </div>
                                    <div class="mentorship-progress">
                                        <div class="mentorship-stat">
                                            <span class="mentorship-stat-label">Sessions</span>
                                            <span class="mentorship-stat-value">${ment.sessionsCompleted}</span>
                                        </div>
                                        <div class="mentorship-stat">
                                            <span class="mentorship-stat-label">Next Session</span>
                                            <span class="mentorship-stat-value">${new Date(ment.nextSession).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>
                                        </div>
                                    </div>
                                    <div class="mentorship-actions">
                                        <button class="btn btn-primary btn-small" onclick="openDM('user3', '${ment.studentName}')">Message</button>
                                        <button class="btn btn-ghost btn-small" onclick="showToast('Session notes - Coming soon')">Notes</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div class="empty-state">
                            <p>No active mentorships</p>
                        </div>
                    `}
                </div>
            `;
        }


        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // CURRENT USER PROFILE - For nav avatar
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function showCurrentUserProfile() {
            // Get current logged-in user from system
            const currentUser = getCurrentUser();
            
            if (!currentUser) {
                showToast('User profile not found');
                return;
            }
            
            // Show profile with correct user data
            showUserProfile(currentUser.name, currentUser.avatar, currentUser.id);
        }

        function addPostComment(event, postId) {
            event.preventDefault();
            const form = event.target;
            const text = form.querySelector('textarea').value;
            
            const comments = getPostComments(postId);
            comments.push({
                author: 'Current User',
                avatar: 'https://i.pravatar.cc/150?img=10',
                timestamp: 'Just now',
                text: text
            });
            savePostComments(postId, comments);
            
            form.reset();
            showPostDetail(postId);
            
            // Reload feed to update comment counter in feed cards
            const currentFilter = sessionStorage.getItem('hudenFeedFilter') || 'All';
            loadFeed(currentFilter);
            
            toast('Comment added');
            logEvent('post_comment_added', { postId });
        }

        function deletePostComment(postId, commentIdx) {
            const comments = getPostComments(postId);
            comments.splice(commentIdx - MOCK_DATA.posts.find(p => p.id === postId).comments.length, 1);
            savePostComments(postId, comments);
            showPostDetail(postId);
            
            // Reload feed to update comment counter in feed cards
            const currentFilter = sessionStorage.getItem('hudenFeedFilter') || 'All';
            loadFeed(currentFilter);
            
            toast('Comment deleted');
            logEvent('post_comment_deleted', { postId });
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // ARCHETYPE SELECTOR FUNCTIONS (NEW v14)
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function toggleArchetype(button) {
            button.classList.toggle('active');
            logEvent('archetype_toggled', {
                archetype: button.dataset.archetype,
                active: button.classList.contains('active')
            });
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // IMAGE UPLOAD FUNCTIONS - NEW v15
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        let selectedImageFile = null;
        let selectedImageDataURL = null;

        function previewPostImage(event) {
            const file = event.target.files[0];
            
            if (!file) {
                clearPostImagePreview();
                return;
            }

            // Validate file type
            if (!file.type.startsWith('image/')) {
                toast('Please select a valid image file');
                event.target.value = '';
                clearPostImagePreview();
                return;
            }

            // Validate file size (max 10MB)
            const maxSize = 10 * 1024 * 1024;
            if (file.size > maxSize) {
                toast('Image size must be less than 10MB');
                event.target.value = '';
                clearPostImagePreview();
                return;
            }

            // Store file reference
            selectedImageFile = file;

            // Create preview
            const reader = new FileReader();
            reader.onload = async function(e) {
                // Compress image before storing (same as discussions)
                const compressedDataURL = await compressImage(e.target.result, 1200, 0.7);
                selectedImageDataURL = compressedDataURL;
                
                const previewContainer = document.getElementById('postImagePreview');
                previewContainer.innerHTML = `
                    <div class="image-preview-container">
                        <img src="${compressedDataURL}" alt="Preview" class="image-preview-img">
                        <button type="button" class="image-preview-remove" onclick="clearPostImagePreview()" title="Remove image">
                            Ã—
                        </button>
                    </div>
                `;
            };
            reader.readAsDataURL(file);
        }

        function clearPostImagePreview() {
            selectedImageFile = null;
            selectedImageDataURL = null;
            document.getElementById('postImageFile').value = '';
            document.getElementById('postImagePreview').innerHTML = '';
        }

        // Image compression utility (shared by posts and discussions)
        function compressImage(dataURL, maxWidth = 1200, quality = 0.8) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    let width = img.width;
                    let height = img.height;

                    // Calculate new dimensions maintaining aspect ratio
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }

                    canvas.width = width;
                    canvas.height = height;

                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);

                    // Convert to JPEG with quality compression
                    resolve(canvas.toDataURL('image/jpeg', quality));
                };
                img.src = dataURL;
            });
        }

        // Discussion Image Upload Functions
        let selectedDiscussionImageFile = null;
        let selectedDiscussionImageDataURL = null;

        function previewDiscussionImage(event) {
            console.log('previewDiscussionImage called');
            const file = event.target.files[0];
            console.log('File:', file);
            
            if (!file) {
                clearDiscussionImagePreview();
                return;
            }

            // Validate file type
            if (!file.type.startsWith('image/')) {
                toast('Please select a valid image file');
                event.target.value = '';
                clearDiscussionImagePreview();
                return;
            }

            // Validate file size (max 10MB)
            const maxSize = 10 * 1024 * 1024;
            if (file.size > maxSize) {
                toast('Image size must be less than 10MB');
                event.target.value = '';
                clearDiscussionImagePreview();
                return;
            }

            // Store file reference
            selectedDiscussionImageFile = file;
            console.log('File stored, reading as DataURL...');

            // Create preview
            const reader = new FileReader();
            reader.onload = async function(e) {
                // Compress image before storing
                console.log('Original image size:', e.target.result.length);
                const compressedDataURL = await compressImage(e.target.result, 1200, 0.7);
                console.log('Compressed image size:', compressedDataURL.length);
                console.log('Compression ratio:', ((1 - compressedDataURL.length / e.target.result.length) * 100).toFixed(1) + '%');
                
                selectedDiscussionImageDataURL = compressedDataURL;
                
                const previewContainer = document.getElementById('discussionImagePreview');
                previewContainer.innerHTML = `
                    <div class="image-preview-container">
                        <img src="${compressedDataURL}" alt="Preview" class="image-preview-img">
                        <button type="button" class="image-preview-remove" onclick="clearDiscussionImagePreview()" title="Remove image">
                            Ã—
                        </button>
                    </div>
                `;
                console.log('Preview rendered with compressed image');
            };
            reader.readAsDataURL(file);
        }

        function clearDiscussionImagePreview() {
            selectedDiscussionImageFile = null;
            selectedDiscussionImageDataURL = null;
            document.getElementById('discussionImageFile').value = '';
            document.getElementById('discussionImagePreview').innerHTML = '';
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // FEED FUNCTIONS
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function submitNewPost(event) {
            event.preventDefault();
            
            const content = document.getElementById('postContent').value;
            
            // Get selected archetypes (NEW v14)
            const selectedArchetypes = Array.from(document.querySelectorAll('.archetype-pill.active'))
                .map(pill => pill.dataset.archetype);
            
            // Get session data (NEW v25 - Training Integration)
            const sessionPath = document.getElementById('postSessionPath').value;
            const sessionDay = document.getElementById('postSessionDay').value;
            
            // Create new post object
            const newPost = {
                id: Date.now(),
                author: 'You',
                avatar: 'https://i.pravatar.cc/150?img=1',
                timestamp: 'Just now',
                text: content,
                image: selectedImageDataURL || null,
                archetype: selectedArchetypes.length > 0 ? selectedArchetypes[0] : null,
                archetypes: selectedArchetypes,
                session: sessionPath && sessionDay ? {
                    path: sessionPath,
                    day: parseInt(sessionDay)
                } : null,
                comments: [],
                shares: 0
            };
            
            // Add to feed (at the beginning)
            MOCK_DATA.posts.unshift(newPost);
            
            // Reload feed to show new post
            loadFeed();
            
            // Check for milestones (NEW v27 - Ritual & Ceremony)
            checkMilestones();
            
            // Prepare message
            let message = 'Post published to feed';
            if (selectedImageFile) {
                message += ' with image';
            }
            if (selectedArchetypes.length > 0) {
                message += ` with ${selectedArchetypes.join(', ')} tags`;
            }
            if (sessionPath && sessionDay) {
                message += ` linked to ${sessionPath.charAt(0).toUpperCase() + sessionPath.slice(1)} Day ${sessionDay}`;
            }
            
            toast(message);
            
            // Clear form and reset archetypes
            document.getElementById('postContent').value = '';
            document.querySelectorAll('.archetype-pill').forEach(pill => {
                pill.classList.remove('active');
            });
            
            // Clear session selectors (NEW v25)
            document.getElementById('postSessionPath').value = '';
            document.getElementById('postSessionDay').value = '';
            document.getElementById('postSessionDay').disabled = true;
            
            // Clear image preview
            clearPostImagePreview();
            
            closeModal('newPostModal');
            logEvent('post_created', {
                hasImage: !!selectedImageFile,
                archetypes: selectedArchetypes,
                session: sessionPath && sessionDay ? `${sessionPath}-${sessionDay}` : null,
                imageSize: selectedImageFile ? selectedImageFile.size : 0,
                imageType: selectedImageFile ? selectedImageFile.type : null
            });
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // TRAINING INTEGRATION FUNCTIONS (NEW v25)
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function updateSessionDays() {
            const pathSelect = document.getElementById('postSessionPath');
            const daySelect = document.getElementById('postSessionDay');
            const path = pathSelect.value;
            
            daySelect.innerHTML = '<option value="">Select day...</option>';
            
            if (path === 'flow') {
                // Flow Path: 48 days
                for (let i = 1; i <= 48; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `Day ${i}`;
                    daySelect.appendChild(option);
                }
                daySelect.disabled = false;
            } else if (path === 'mastery') {
                // Mastery Path: 96 days
                for (let i = 1; i <= 96; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `Day ${i}`;
                    daySelect.appendChild(option);
                }
                daySelect.disabled = false;
            } else {
                daySelect.disabled = true;
            }
        }
        
        function openPartnerFinder() {
            const modal = document.getElementById('partnerFinderModal');
            modal.classList.add('active');
            
            // Pre-fill with user's current session if available
            const userProfile = JSON.parse(localStorage.getItem('hudenUserProfile') || '{}');
            if (userProfile.currentSession) {
                document.getElementById('partnerSearchPath').value = userProfile.currentSession.path || '';
                updatePartnerSearchDays();
                document.getElementById('partnerSearchDay').value = userProfile.currentSession.day || '';
                findPartners();
            }
            
            logEvent('partner_finder_opened');
        }
        
        function closePartnerFinder() {
            const modal = document.getElementById('partnerFinderModal');
            modal.classList.remove('active');
            logEvent('partner_finder_closed');
        }
        
        function updatePartnerSearchDays() {
            const pathSelect = document.getElementById('partnerSearchPath');
            const daySelect = document.getElementById('partnerSearchDay');
            const path = pathSelect.value;
            
            daySelect.innerHTML = '<option value="">Select day...</option>';
            
            if (path === 'flow') {
                for (let i = 1; i <= 48; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `Day ${i}`;
                    daySelect.appendChild(option);
                }
                daySelect.disabled = false;
            } else if (path === 'mastery') {
                for (let i = 1; i <= 96; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `Day ${i}`;
                    daySelect.appendChild(option);
                }
                daySelect.disabled = false;
            } else {
                daySelect.disabled = true;
            }
        }
        
        function findPartners() {
            const path = document.getElementById('partnerSearchPath').value;
            const day = document.getElementById('partnerSearchDay').value;
            const resultsContainer = document.getElementById('partnerResults');
            
            if (!path || !day) {
                resultsContainer.innerHTML = `
                    <div style="text-align: center; padding: var(--space-8) var(--space-4); color: var(--gray-500);">
                        <p style="font-size: 16px;">Select your path and day to find partners</p>
                    </div>
                `;
                return;
            }
            
            // Mock: Find posts with same session
            const matchingPosts = MOCK_DATA.posts.filter(post => 
                post.session && 
                post.session.path === path && 
                post.session.day === parseInt(day)
            );
            
            if (matchingPosts.length === 0) {
                resultsContainer.innerHTML = `
                    <div style="text-align: center; padding: var(--space-8) var(--space-4);">
                        <p style="font-size: 18px; font-weight: 700; margin-bottom: 8px;">No partners found</p>
                        <p style="font-size: 14px; color: var(--gray-600);">Be the first to share about ${path.charAt(0).toUpperCase() + path.slice(1)} Day ${day}</p>
                        <button class="btn btn-primary" onclick="closePartnerFinder(); openModal('newPostModal')" style="margin-top: 16px;">
                            Share Your Practice
                        </button>
                    </div>
                `;
                return;
            }
            
            // Render matching partners
            resultsContainer.innerHTML = `
                <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 16px;">
                    ${matchingPosts.length} ${matchingPosts.length === 1 ? 'practitioner' : 'practitioners'} on ${path.charAt(0).toUpperCase() + path.slice(1)} Day ${day}
                </p>
                ${matchingPosts.map(post => `
                    <div class="partner-card">
                        <img src="${post.avatar}" alt="${post.author}" class="partner-avatar">
                        <div class="partner-info">
                            <h4>${post.author}</h4>
                            <p>${post.text.substring(0, 80)}${post.text.length > 80 ? '...' : ''}</p>
                            <button class="btn-connect" onclick="showPostDetail(${post.id}); closePartnerFinder();">
                                View Reflection
                            </button>
                        </div>
                    </div>
                `).join('')}
            `;
            
            logEvent('partners_found', { path, day, count: matchingPosts.length });
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // EVENT ORGANIZATION FUNCTIONS (NEW v26 - FASE 3)
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        let currentCalendarMonth = new Date().getMonth();
        let currentCalendarYear = new Date().getFullYear();
        
        function updateEventSessionDays() {
            const pathSelect = document.getElementById('eventSessionPath');
            const daySelect = document.getElementById('eventSessionDay');
            const path = pathSelect.value;
            
            daySelect.innerHTML = '<option value="">Select day...</option>';
            
            if (path === 'flow') {
                for (let i = 1; i <= 48; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `Day ${i}`;
                    daySelect.appendChild(option);
                }
                daySelect.disabled = false;
            } else if (path === 'mastery') {
                for (let i = 1; i <= 96; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = `Day ${i}`;
                    daySelect.appendChild(option);
                }
                daySelect.disabled = false;
            } else {
                daySelect.disabled = true;
            }
        }
        
        function submitNewEvent(event) {
            event.preventDefault();
            
            const title = document.getElementById('eventTitle').value;
            const pack = document.getElementById('eventPack').value;
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const location = document.getElementById('eventLocation').value;
            const description = document.getElementById('eventDescription').value;
            const sessionPath = document.getElementById('eventSessionPath').value;
            const sessionDay = document.getElementById('eventSessionDay').value;
            
            const newEvent = {
                id: Date.now(),
                type: 'event',
                title: title,
                pack: pack,
                date: date,
                time: time,
                location: location,
                description: description,
                session: sessionPath && sessionDay ? {
                    path: sessionPath,
                    day: parseInt(sessionDay)
                } : null,
                organizer: 'You',
                rsvps: [],
                createdAt: new Date().toISOString()
            };
            
            // Store event in localStorage
            const events = JSON.parse(localStorage.getItem('hudenEvents') || '[]');
            events.push(newEvent);
            localStorage.setItem('hudenEvents', JSON.stringify(events));
            
            // Add event card to feed
            MOCK_DATA.posts.unshift({
                id: newEvent.id,
                type: 'event',
                author: 'You',
                avatar: 'https://i.pravatar.cc/150?img=1',
                timestamp: 'Just now',
                event: newEvent,
                comments: []
            });
            
            loadFeed();
            
            let message = 'Event created';
            if (sessionPath && sessionDay) {
                message += ` linked to ${sessionPath.charAt(0).toUpperCase() + sessionPath.slice(1)} Day ${sessionDay}`;
            }
            toast(message);
            
            // Clear form
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventLocation').value = '';
            document.getElementById('eventDescription').value = '';
            document.getElementById('eventSessionPath').value = '';
            document.getElementById('eventSessionDay').value = '';
            document.getElementById('eventSessionDay').disabled = true;
            
            closeModal('eventModal');
            logEvent('event_created', { hasSession: !!(sessionPath && sessionDay) });
        }
        
        function toggleRSVP(eventId) {
            const events = JSON.parse(localStorage.getItem('hudenEvents') || '[]');
            const event = events.find(e => e.id === eventId);
            
            if (!event) return;
            
            const userId = 'You'; // Mock user ID
            const index = event.rsvps.indexOf(userId);
            
            if (index > -1) {
                event.rsvps.splice(index, 1);
                toast('RSVP removed');
            } else {
                event.rsvps.push(userId);
                toast('RSVP confirmed');
            }
            
            localStorage.setItem('hudenEvents', JSON.stringify(events));
            
            // Update feed display
            loadFeed();
            
            logEvent('rsvp_toggled', { eventId, status: index > -1 ? 'removed' : 'confirmed' });
        }
        
        function openCalendar() {
            const modal = document.getElementById('calendarModal');
            modal.classList.add('active');
            renderCalendar();
            logEvent('calendar_opened');
        }
        
        function closeCalendar() {
            const modal = document.getElementById('calendarModal');
            modal.classList.remove('active');
            logEvent('calendar_closed');
        }
        
        function previousMonth() {
            currentCalendarMonth--;
            if (currentCalendarMonth < 0) {
                currentCalendarMonth = 11;
                currentCalendarYear--;
            }
            renderCalendar();
        }
        
        function nextMonth() {
            currentCalendarMonth++;
            if (currentCalendarMonth > 11) {
                currentCalendarMonth = 0;
                currentCalendarYear++;
            }
            renderCalendar();
        }
        
        function renderCalendar() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            
            document.getElementById('calendarMonth').textContent = 
                `${monthNames[currentCalendarMonth]} ${currentCalendarYear}`;
            
            const firstDay = new Date(currentCalendarYear, currentCalendarMonth, 1).getDay();
            const daysInMonth = new Date(currentCalendarYear, currentCalendarMonth + 1, 0).getDate();
            
            const daysContainer = document.getElementById('calendarDays');
            daysContainer.innerHTML = '';
            
            const events = JSON.parse(localStorage.getItem('hudenEvents') || '[]');
            const today = new Date();
            
            // Empty cells before first day
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                daysContainer.appendChild(emptyDay);
            }
            
            // Days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day';
                dayCell.textContent = day;
                
                const dateStr = `${currentCalendarYear}-${String(currentCalendarMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const hasEvent = events.some(e => e.date === dateStr);
                
                if (hasEvent) {
                    dayCell.classList.add('has-event');
                }
                
                if (today.getDate() === day && 
                    today.getMonth() === currentCalendarMonth && 
                    today.getFullYear() === currentCalendarYear) {
                    dayCell.classList.add('today');
                }
                
                dayCell.onclick = () => showEventsForDate(dateStr);
                daysContainer.appendChild(dayCell);
            }
            
            // Show events for current month
            showEventsForMonth();
        }
        
        function showEventsForMonth() {
            const events = JSON.parse(localStorage.getItem('hudenEvents') || '[]');
            const eventsContainer = document.getElementById('calendarEvents');
            
            const monthEvents = events.filter(e => {
                const eventDate = new Date(e.date);
                return eventDate.getMonth() === currentCalendarMonth && 
                       eventDate.getFullYear() === currentCalendarYear;
            });
            
            if (monthEvents.length === 0) {
                eventsContainer.innerHTML = `
                    <div style="text-align: center; padding: var(--space-4); color: var(--gray-600);">
                        <p>No events this month</p>
                        <button class="btn btn-primary" onclick="closeCalendar(); openModal('eventModal')" style="margin-top: 16px;">
                            Create Event
                        </button>
                    </div>
                `;
                return;
            }
            
            eventsContainer.innerHTML = `
                <h3 style="font-size: 20px; font-weight: 800; margin-bottom: 24px; letter-spacing: -0.02em;">Upcoming Events</h3>
                ${monthEvents.map(event => `
                    <div class="event-card">
                        <img src="https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=400&h=400&fit=crop" 
                             alt="${event.title}" 
                             class="event-image">
                        <div class="event-content">
                            <div class="event-header">
                                <span class="event-badge">Training Session</span>
                            </div>
                            <h4 class="event-title">${event.title}</h4>
                            <div class="event-meta">
                                <span class="event-meta-item">ğŸ“… ${new Date(event.date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })} at ${event.time}</span>
                                <span class="event-meta-item">ğŸ“ ${event.location}</span>
                            </div>
                            <div class="event-rsvp">
                                <span class="event-rsvp-count">${event.rsvps.length} going</span>
                                <button class="btn-rsvp ${event.rsvps.includes('You') ? 'active' : ''}" 
                                        onclick="event.stopPropagation(); toggleRSVP(${event.id})">
                                    ${event.rsvps.includes('You') ? 'Going âœ“' : 'RSVP'}
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('')}
            `;
        }
        
        function showEventsForDate(dateStr) {
            const events = JSON.parse(localStorage.getItem('hudenEvents') || '[]');
            const dayEvents = events.filter(e => e.date === dateStr);
            
            if (dayEvents.length > 0) {
                showEventsForMonth();
            }
        }
        
        function populateEventPackSelect() {
            const select = document.getElementById('eventPack');
            select.innerHTML = '<option value="">Select pack...</option>';
            
            MOCK_DATA.packs.forEach(pack => {
                const option = document.createElement('option');
                option.value = pack.name;
                option.textContent = pack.name;
                select.appendChild(option);
            });
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // RITUAL & CEREMONY SYSTEM - FASE 4 v27
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        const MILESTONES = {
            FIRST_POST: {
                icon: 'âœ¨',
                badge: 'First Step',
                title: 'First Reflection',
                subtitle: 'You\'ve shared your first reflection with the tribe. Every journey begins with presence.',
                reflection: 'The path reveals itself not through perfection, but through showing up.'
            },
            WEEK_ONE: {
                icon: 'ğŸŒ±',
                badge: 'Week 1',
                title: 'One Week',
                subtitle: 'Seven days of practice. You\'re building momentum, not milestones.',
                reflection: 'Consistency is not about never missing. It\'s about always returning.'
            },
            MONTH_ONE: {
                icon: 'ğŸŒ¿',
                badge: 'Month 1',
                title: 'First Month',
                subtitle: 'Thirty days of observation. You\'re learning to feel, not achieve.',
                reflection: 'A month is not a destination. It\'s a deepening of awareness.',
                stats: true
            },
            FLOW_COMPLETE: {
                icon: 'ğŸŒŠ',
                badge: 'Flow Path Complete',
                title: 'Flow Complete',
                subtitle: '48 days of dedicated practice. You\'ve moved through water, finding your rhythm.',
                reflection: 'Completion is not an ending. It\'s the moment you realize you were never broken to begin with.',
                stats: true,
                ceremony: true
            },
            MASTERY_COMPLETE: {
                icon: 'â›°ï¸',
                badge: 'Mastery Path Complete',
                title: 'Mastery Complete',
                subtitle: '96 days of transformation. You\'ve learned that mastery is not controlâ€”it\'s surrender.',
                reflection: 'The master is simply someone who shows up when no one is watching.',
                stats: true,
                ceremony: true
            },
            FIRST_PACK: {
                icon: 'ğŸ¤',
                badge: 'Pack Member',
                title: 'Found Your Pack',
                subtitle: 'You\'ve joined your first tribe. Movement is better together.',
                reflection: 'Alone we move fast. Together we move far.'
            },
            SEASONAL_SPRING: {
                icon: 'ğŸŒ¸',
                badge: 'Spring Transition',
                title: 'Spring Emerges',
                subtitle: 'New growth begins. What will you plant in this season?',
                reflection: 'Spring reminds us: everything that seems dead is just resting.',
                seasonal: 'spring'
            },
            SEASONAL_SUMMER: {
                icon: 'â˜€ï¸',
                badge: 'Summer Transition',
                title: 'Summer Burns',
                subtitle: 'Heat intensifies. What will you sustain through fire?',
                reflection: 'Summer teaches us: growth requires both light and shadow.',
                seasonal: 'summer'
            },
            SEASONAL_AUTUMN: {
                icon: 'ğŸ‚',
                badge: 'Autumn Transition',
                title: 'Autumn Releases',
                subtitle: 'Leaves fall. What will you let go of this season?',
                reflection: 'Autumn whispers: sometimes the bravest act is releasing.',
                seasonal: 'autumn'
            },
            SEASONAL_WINTER: {
                icon: 'â„ï¸',
                badge: 'Winter Transition',
                title: 'Winter Rests',
                subtitle: 'Darkness deepens. What will you tend in stillness?',
                reflection: 'Winter knows: the seed must die before the flower blooms.',
                seasonal: 'winter'
            }
        };

        function checkMilestones() {
            const milestones = JSON.parse(localStorage.getItem('hudenMilestones') || '{}');
            const userProfile = JSON.parse(localStorage.getItem('hudenUserProfile') || '{}');
            const posts = JSON.parse(localStorage.getItem('hudenPosts') || '[]');
            const joinedPacks = getJoinedPacks();
            
            const now = new Date();
            const joinedDate = userProfile.joinedDate ? new Date(userProfile.joinedDate) : null;
            
            // Check First Post
            if (!milestones.FIRST_POST && posts.length === 1) {
                showRitual('FIRST_POST');
                markMilestone('FIRST_POST');
                return;
            }
            
            // Check Week One
            if (joinedDate && !milestones.WEEK_ONE) {
                const daysSinceJoin = Math.floor((now - joinedDate) / (1000 * 60 * 60 * 24));
                if (daysSinceJoin >= 7) {
                    showRitual('WEEK_ONE');
                    markMilestone('WEEK_ONE');
                    return;
                }
            }
            
            // Check Month One
            if (joinedDate && !milestones.MONTH_ONE) {
                const daysSinceJoin = Math.floor((now - joinedDate) / (1000 * 60 * 60 * 24));
                if (daysSinceJoin >= 30) {
                    showRitual('MONTH_ONE');
                    markMilestone('MONTH_ONE');
                    return;
                }
            }
            
            // Check First Pack
            if (!milestones.FIRST_PACK && joinedPacks.length === 1) {
                showRitual('FIRST_PACK');
                markMilestone('FIRST_PACK');
                return;
            }
            
            // Check Path Completions (placeholder - would need actual path tracking)
            // These would be triggered when user marks a path as complete
            
            // Check Seasonal Transitions
            checkSeasonalTransition();
        }

        function checkSeasonalTransition() {
            const lastSeason = localStorage.getItem('hudenLastSeason');
            const currentMonth = new Date().getMonth();
            let currentSeason = '';
            let milestoneKey = '';
            
            // Determine current season (Northern Hemisphere)
            if (currentMonth >= 2 && currentMonth <= 4) {
                currentSeason = 'spring';
                milestoneKey = 'SEASONAL_SPRING';
            } else if (currentMonth >= 5 && currentMonth <= 7) {
                currentSeason = 'summer';
                milestoneKey = 'SEASONAL_SUMMER';
            } else if (currentMonth >= 8 && currentMonth <= 10) {
                currentSeason = 'autumn';
                milestoneKey = 'SEASONAL_AUTUMN';
            } else {
                currentSeason = 'winter';
                milestoneKey = 'SEASONAL_WINTER';
            }
            
            if (lastSeason !== currentSeason) {
                localStorage.setItem('hudenLastSeason', currentSeason);
                
                // Only show if not first time (to avoid showing on app load)
                if (lastSeason) {
                    setTimeout(() => {
                        showRitual(milestoneKey);
                    }, 2000);
                }
            }
        }

        function markMilestone(milestoneKey) {
            const milestones = JSON.parse(localStorage.getItem('hudenMilestones') || '{}');
            milestones[milestoneKey] = {
                achieved: true,
                date: new Date().toISOString()
            };
            localStorage.setItem('hudenMilestones', JSON.stringify(milestones));
            logEvent('milestone_achieved', { milestone: milestoneKey });
        }

        function showRitual(milestoneKey) {
            const milestone = MILESTONES[milestoneKey];
            if (!milestone) return;
            
            const overlay = document.getElementById('ritualOverlay');
            const icon = document.getElementById('ritualIcon');
            const badge = document.getElementById('ritualBadge');
            const title = document.getElementById('ritualTitle');
            const subtitle = document.getElementById('ritualSubtitle');
            const reflectionDiv = document.getElementById('ritualReflection');
            const reflectionText = document.getElementById('ritualReflectionText');
            const statsDiv = document.getElementById('ritualStats');
            
            // Set content
            icon.textContent = milestone.icon;
            badge.textContent = milestone.badge;
            title.textContent = milestone.title;
            subtitle.textContent = milestone.subtitle;
            
            // Set reflection
            if (milestone.reflection) {
                reflectionDiv.style.display = 'block';
                reflectionText.textContent = milestone.reflection;
            } else {
                reflectionDiv.style.display = 'none';
            }
            
            // Set stats if applicable
            if (milestone.stats) {
                statsDiv.style.display = 'grid';
                const userProfile = JSON.parse(localStorage.getItem('hudenUserProfile') || '{}');
                const posts = JSON.parse(localStorage.getItem('hudenPosts') || '[]');
                const joinedDate = userProfile.joinedDate ? new Date(userProfile.joinedDate) : null;
                const daysSinceJoin = joinedDate ? Math.floor((new Date() - joinedDate) / (1000 * 60 * 60 * 24)) : 0;
                
                statsDiv.innerHTML = `
                    <div class="ritual-stat">
                        <div class="ritual-stat-value">${daysSinceJoin}</div>
                        <div class="ritual-stat-label">Days</div>
                    </div>
                    <div class="ritual-stat">
                        <div class="ritual-stat-value">${posts.length}</div>
                        <div class="ritual-stat-label">Reflections</div>
                    </div>
                    <div class="ritual-stat">
                        <div class="ritual-stat-value">${getJoinedPacks().length}</div>
                        <div class="ritual-stat-label">Packs</div>
                    </div>
                `;
            } else {
                statsDiv.style.display = 'none';
            }
            
            // Apply seasonal theme if applicable
            overlay.className = 'ritual-overlay active';
            if (milestone.seasonal) {
                overlay.classList.add(milestone.seasonal);
            }
            
            // Play subtle sound effect (optional - placeholder)
            // playRitualSound();
        }

        function closeRitual() {
            const overlay = document.getElementById('ritualOverlay');
            overlay.classList.remove('active');
            setTimeout(() => {
                overlay.className = 'ritual-overlay';
            }, 300);
        }

        function shareRitual() {
            // Create a post about the milestone
            const overlay = document.getElementById('ritualOverlay');
            const title = document.getElementById('ritualTitle').textContent;
            const subtitle = document.getElementById('ritualSubtitle').textContent;
            
            closeRitual();
            
            // Open new post modal with pre-filled content
            setTimeout(() => {
                openModal('newPostModal');
                document.getElementById('postContent').value = `ğŸ”¥ ${title}\n\n${subtitle}`;
            }, 300);
        }

        function triggerPathCompletion(pathName) {
            // Manually trigger path completion ceremony
            // This would be called when user completes Flow or Mastery path
            if (pathName === 'flow') {
                showRitual('FLOW_COMPLETE');
                markMilestone('FLOW_COMPLETE');
            } else if (pathName === 'mastery') {
                showRitual('MASTERY_COMPLETE');
                markMilestone('MASTERY_COMPLETE');
            }
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // PACKS FUNCTIONS
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function loadPacks() {
            const container = document.getElementById('packsContainer');
            const joinedPacks = getJoinedPacks();

            setTimeout(() => {
                container.innerHTML = '';

                MOCK_DATA.packs.forEach(pack => {
                    const isJoined = joinedPacks.includes(pack.id);
                    const packCard = document.createElement('div');
                    packCard.className = 'pack-card';
                    packCard.onclick = () => showPackDetail(pack.id);
                    
                    packCard.innerHTML = `
                        <img src="${pack.image}" alt="${pack.name}" class="pack-image">
                        <div class="pack-content">
                            <h3 class="pack-name">${pack.name}</h3>
                            <p class="pack-location">${pack.location}</p>
                            <p class="pack-description">${pack.description}</p>
                            <div class="pack-stats">
                                <span>${pack.members} members</span>
                                <span>${pack.nextSession}</span>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(packCard);
                });

                logEvent('packs_loaded');
            }, 300);
        }

        function showPackDetail(packId) {
            const pack = MOCK_DATA.packs.find(p => p.id === packId);
            if (!pack) return;

            const modal = document.getElementById('packDetailModal');
            const content = document.getElementById('packDetailContent');
            const joinedPacks = getJoinedPacks();
            const isJoined = joinedPacks.includes(packId);
            
            content.innerHTML = `
                <img src="${pack.image}" alt="${pack.name}" style="width: 100%; height: 300px; object-fit: cover;">
                <div style="padding: var(--space-4);">
                    <h2 class="section-title" style="margin-bottom: var(--space-2);">${pack.name}</h2>
                    <p style="font-size: 16px; font-weight: 600; color: var(--gray-500); margin-bottom: var(--space-3);">${pack.location}</p>
                    <p style="font-size: 16px; line-height: 1.6; color: var(--gray-700); margin-bottom: var(--space-4);">${pack.description}</p>
                    
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: var(--space-3); margin-bottom: var(--space-4);">
                        <div>
                            <div style="font-size: 14px; font-weight: 600; color: var(--gray-500); margin-bottom: 4px;">Members</div>
                            <div style="font-size: 24px; font-weight: 800; color: var(--black);">${pack.members}</div>
                        </div>
                        <div>
                            <div style="font-size: 14px; font-weight: 600; color: var(--gray-500); margin-bottom: 4px;">Next Session</div>
                            <div style="font-size: 16px; font-weight: 700; color: var(--black);">${pack.nextSession}</div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: var(--space-4);">
                        <div style="font-size: 14px; font-weight: 700; color: var(--black); margin-bottom: var(--space-2);">Focus Areas</div>
                        <p style="font-size: 15px; color: var(--gray-700);">${pack.focus}</p>
                    </div>
                    
                    <div style="margin-bottom: var(--space-4);">
                        <div style="font-size: 14px; font-weight: 700; color: var(--black); margin-bottom: var(--space-2);">Led by</div>
                        <p style="font-size: 15px; color: var(--gray-700);">${pack.leader}</p>
                    </div>
                    
                    <div style="display: flex; gap: var(--space-2);">
                        <button class="btn ${isJoined ? 'btn-secondary' : 'btn-primary'} btn-large" style="flex: 1;" onclick="${isJoined ? 'leavePack' : 'joinPack'}(${packId})">
                            ${isJoined ? 'Leave Pack' : 'Join Pack'}
                        </button>
                        ${isJoined ? `<button class="btn btn-primary btn-large" style="flex: 1;" onclick="openPackChat(${packId}, '${pack.name.replace(/'/g, "\\'")}'); closeModal('packDetailModal')">Open Pack Chat</button>` : ''}
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            logEvent('pack_detail_opened', { packId });
        }

        function joinPack(packId) {
            const joinedPacks = getJoinedPacks();
            if (!joinedPacks.includes(packId)) {
                joinedPacks.push(packId);
                saveJoinedPacks(joinedPacks);
                toast('Joined pack successfully');
                showPackDetail(packId);
                logEvent('pack_joined', { packId });
                
                // Check for milestones (NEW v27 - Ritual & Ceremony)
                checkMilestones();
            }
        }

        function leavePack(packId) {
            const joinedPacks = getJoinedPacks();
            const index = joinedPacks.indexOf(packId);
            if (index > -1) {
                joinedPacks.splice(index, 1);
                saveJoinedPacks(joinedPacks);
                toast('Left pack');
                closeModal('packDetailModal');
                loadMyPacks();
                logEvent('pack_left', { packId });
            }
        }

        function submitNewPack(event) {
            event.preventDefault();
            toast('Pack created successfully');
            closeModal('newPackModal');
            logEvent('pack_created');
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MAP PERMISSIONS - Tier-based access control
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function checkMapPermissions() {
            const tier = getUserTier().toLowerCase();
            
            const permissions = {
                'essential': {
                    viewMap: true,
                    openPanel: true,
                    interact: false
                },
                'flow': {
                    viewMap: true,
                    openPanel: true,
                    interact: true,
                    joinPack: true,
                    messageFacilitator: true,
                    getDirections: true,
                    rsvpEvent: true,
                    saveSpot: true
                },
                'mastery': {
                    viewMap: true,
                    openPanel: true,
                    interact: true,
                    joinPack: true,
                    messageFacilitator: true,
                    getDirections: true,
                    rsvpEvent: true,
                    saveSpot: true,
                    editOwnPack: true
                },
                'mentorship': {
                    viewMap: true,
                    openPanel: true,
                    interact: true,
                    joinPack: true,
                    messageFacilitator: true,
                    getDirections: true,
                    rsvpEvent: true,
                    saveSpot: true,
                    editOwnPack: true,
                    viewWisdomLibrary: true,
                    mentorAccess: true
                },
                'coach': {
                    viewMap: true,
                    openPanel: true,
                    interact: true,
                    joinPack: true,
                    messageFacilitator: true,
                    getDirections: true,
                    rsvpEvent: true,
                    saveSpot: true,
                    editOwnPack: true,
                    viewWisdomLibrary: true,
                    mentorAccess: true,
                    viewReports: true,
                    manage: true,
                    bypassRestrictions: true
                }
            };
            
            return permissions[tier] || permissions['flow'];
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // MAP SERVICE - ABSTRACTION LAYER
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        const MapService = (() => {
            // Private variables
            let map = null;
            let markersLayer = null;
            let selectCallback = null;
            let mapData = [];
            let activeFilters = {
                type: 'all',
                environment: 'all',
                searchQuery: ''
            };
            let _isClosing = false; // Prevent reopening during close animation

            const mockMapData = [
                {
                    id: 'pack_1',
                    type: 'pack',
                    name: 'Barcelona Urban Runners',
                    archetype: ['gorilla', 'gibbon'],
                    environment: 'urban',
                    location: 'Barcelona, Spain',
                    lat: 41.3874,
                    lng: 2.1686,
                    members: 24,
                    nextSession: '2025-11-02T18:00:00',
                    image: 'https://images.unsplash.com/photo-1552674605-db6ffd4facb5?w=800',
                    description: 'Weekly urban movement sessions exploring Barcelona\'s architecture and street obstacles.'
                },
                {
                    id: 'spot_1',
                    type: 'spot',
                    name: 'Ciutadella Park Rails',
                    archetype: ['gorilla'],
                    environment: 'urban',
                    location: 'Barcelona, Spain',
                    lat: 41.3883,
                    lng: 2.1856,
                    image: 'https://images.unsplash.com/photo-1518709268805-4e9042af9f23?w=800',
                    description: 'Perfect rails for balance work and precision jumps. Mix of natural and urban obstacles.'
                },
                {
                    id: 'facilitator_1',
                    type: 'facilitator',
                    name: 'Ana Martinez',
                    specialty: 'Urban Movement & Parkour',
                    archetype: ['gorilla', 'gibbon'],
                    environment: 'urban',
                    location: 'Barcelona, Spain',
                    lat: 41.3851,
                    lng: 2.1734,
                    availability: 'Weekday evenings, Weekend mornings',
                    image: 'https://i.pravatar.cc/300?img=45',
                    bio: 'Certified HUDEN coach with 8 years of urban movement practice.'
                },
                {
                    id: 'event_1',
                    type: 'event',
                    name: 'Urban Flow Workshop',
                    archetype: ['gorilla', 'gibbon'],
                    environment: 'urban',
                    location: 'Barcelona, Spain',
                    lat: 41.3890,
                    lng: 2.1590,
                    date: '2025-11-15T10:00:00',
                    duration: '3 hours',
                    image: 'https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=800',
                    description: 'Full-day workshop exploring urban architecture through movement. All levels welcome.'
                }
            ];

            // Public API
            return {
                init: function(containerId) {
                    if (!map) {
                        map = L.map(containerId).setView([41.3874, 2.1686], 12);
                        
                        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                            attribution: 'Â© OpenStreetMap contributors',
                            maxZoom: 18
                        }).addTo(map);
                        
                        // Conditional clustering: only activate if data > 50 items
                        if (mockMapData.length > 50) {
                            markersLayer = L.markerClusterGroup().addTo(map);
                        } else {
                            markersLayer = L.layerGroup().addTo(map);
                        }
                        
                        this.setData(mockMapData);
                        this.setupFilters();
                        
                        logEvent('map_init', { clustering: mockMapData.length > 50, itemCount: mockMapData.length });
                    } else {
                        setTimeout(() => {
                            map.invalidateSize();
                            this.updateMarkers();
                        }, 100);
                    }
                },

                setData: function(items) {
                    mapData = items;
                    this.updateMarkers();
                },

                on: function(event, callback) {
                    if (event === 'select') {
                        selectCallback = callback;
                    }
                },

                centerOnUserLocation: function() {
                    if (!navigator.geolocation) {
                        toast('Geolocation not supported', 'error');
                        return;
                    }

                    const btn = document.getElementById('myLocationBtn');
                    btn.disabled = true;
                    btn.style.opacity = '0.6';
                    
                    let userMarker = null;

                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const { latitude, longitude } = position.coords;
                            if (map) {
                                map.setView([latitude, longitude], 14);
                                
                                // Add temporary marker
                                userMarker = L.marker([latitude, longitude], {
                                    icon: L.divIcon({
                                        className: 'marker-icon',
                                        html: 'ğŸ“',
                                        iconSize: [44, 44]
                                    })
                                }).addTo(map);

                                setTimeout(() => {
                                    if (userMarker) {
                                        map.removeLayer(userMarker);
                                        userMarker = null;
                                    }
                                }, 3000);

                                toast('Location found');
                                logEvent('geo_center', { lat: latitude, lng: longitude, success: true });
                            }
                            btn.disabled = false;
                            btn.style.opacity = '1';
                        },
                        (error) => {
                            // Clean up marker if it was created
                            if (userMarker) {
                                map.removeLayer(userMarker);
                                userMarker = null;
                            }
                            
                            let message = 'Location error';
                            if (error.code === error.PERMISSION_DENIED) message = 'Location permission denied';
                            if (error.code === error.POSITION_UNAVAILABLE) message = 'Location unavailable';
                            if (error.code === error.TIMEOUT) message = 'Location timeout';
                            
                            toast(message, 'error');
                            btn.disabled = false;
                            btn.style.opacity = '1';
                            logEvent('geo_center', { code: error.code, success: false });
                        },
                        {
                            enableHighAccuracy: true,
                            timeout: 8000,
                            maximumAge: 0
                        }
                    );
                },

                setupFilters: function() {
                    // Prevent duplicate listeners - only setup once
                    if (this._filtersInitialized) return;
                    this._filtersInitialized = true;
                    
                    // Type filters
                    document.querySelectorAll('#typeFilters .filter-pill').forEach(pill => {
                        pill.addEventListener('click', () => {
                            document.querySelectorAll('#typeFilters .filter-pill').forEach(p => p.classList.remove('active'));
                            pill.classList.add('active');
                            activeFilters.type = pill.dataset.type;
                            
                            // Reset search when changing type filter
                            const searchInput = document.getElementById('mapSearch');
                            if (searchInput && searchInput.value) {
                                searchInput.value = '';
                                activeFilters.searchQuery = '';
                            }
                            
                            this.updateMarkers();
                            logEvent('filter_change', { type: 'type', value: activeFilters.type });
                        });
                    });
                    
                    // Environment dropdown
                    const environmentToggle = document.getElementById('environmentToggle');
                    const environmentMenu = document.getElementById('environmentMenu');
                    
                    environmentToggle.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const isOpen = environmentMenu.classList.contains('open');
                        
                        if (isOpen) {
                            environmentMenu.classList.remove('open');
                            environmentToggle.classList.remove('open');
                        } else {
                            environmentMenu.classList.add('open');
                            environmentToggle.classList.add('open');
                        }
                    });
                    
                    // Close dropdown when clicking outside
                    const closeDropdown = () => {
                        environmentMenu.classList.remove('open');
                        environmentToggle.classList.remove('open');
                    };
                    document.addEventListener('click', closeDropdown);
                    
                    // Store cleanup function
                    this._cleanupFunctions = this._cleanupFunctions || [];
                    this._cleanupFunctions.push(() => {
                        document.removeEventListener('click', closeDropdown);
                    });
                    
                    // Environment options
                    document.querySelectorAll('.environment-option').forEach(option => {
                        option.addEventListener('click', (e) => {
                            e.stopPropagation();
                            document.querySelectorAll('.environment-option').forEach(o => o.classList.remove('active'));
                            option.classList.add('active');
                            activeFilters.environment = option.dataset.environment;
                            
                            // Update label
                            const label = option.textContent;
                            document.getElementById('environmentLabel').textContent = label;
                            environmentToggle.classList.add('active');
                            
                            // Reset search when changing environment filter
                            const searchInput = document.getElementById('mapSearch');
                            if (searchInput && searchInput.value) {
                                searchInput.value = '';
                                activeFilters.searchQuery = '';
                            }
                            
                            // Close dropdown
                            environmentMenu.classList.remove('open');
                            environmentToggle.classList.remove('open');
                            
                            this.updateMarkers();
                            logEvent('filter_change', { type: 'environment', value: activeFilters.environment });
                        });
                    });
                    
                    // Search input with cancelable debounce
                    const searchInput = document.getElementById('mapSearch');
                    let searchTimeout;
                    
                    const searchHandler = (e) => {
                        clearTimeout(searchTimeout);
                        searchTimeout = setTimeout(() => {
                            activeFilters.searchQuery = e.target.value.toLowerCase().trim();
                            this.updateMarkers();
                            logEvent('filter_change', { type: 'search', query: activeFilters.searchQuery });
                        }, 300);
                    };
                    
                    searchInput.addEventListener('input', searchHandler);
                    
                    // Store cleanup for search timeout
                    this._cleanupFunctions.push(() => {
                        clearTimeout(searchTimeout);
                        searchInput.removeEventListener('input', searchHandler);
                    });
                },

                cleanup: function() {
                    // Cancel pending debounces and remove listeners
                    if (this._cleanupFunctions) {
                        this._cleanupFunctions.forEach(fn => fn());
                        this._cleanupFunctions = [];
                    }
                    this._filtersInitialized = false;
                },

                updateMarkers: function() {
                    if (!markersLayer) return;
                    
                    markersLayer.clearLayers();
                    
                    const filteredData = mapData.filter(item => {
                        // Type filter
                        if (activeFilters.type !== 'all' && item.type !== activeFilters.type) {
                            return false;
                        }
                        
                        // Environment filter
                        if (activeFilters.environment !== 'all' && item.environment !== activeFilters.environment) {
                            return false;
                        }
                        
                        // Search filter
                        if (activeFilters.searchQuery) {
                            const searchLower = activeFilters.searchQuery;
                            const nameMatch = item.name.toLowerCase().includes(searchLower);
                            const locationMatch = item.location.toLowerCase().includes(searchLower);
                            const descriptionMatch = item.description && item.description.toLowerCase().includes(searchLower);
                            const specialtyMatch = item.specialty && item.specialty.toLowerCase().includes(searchLower);
                            
                            if (!nameMatch && !locationMatch && !descriptionMatch && !specialtyMatch) {
                                return false;
                            }
                        }
                        
                        return true;
                    });
                    
                    filteredData.forEach(item => {
                        const markerIcon = this.getMarkerIcon(item.type);
                        const marker = L.marker([item.lat, item.lng], {
                            icon: L.divIcon({
                                className: 'marker-icon ' + item.type,
                                html: markerIcon,
                                iconSize: [44, 44]
                            })
                        }).addTo(markersLayer);
                        
                        marker.on('click', () => {
                            console.log('ğŸ¯ MARKER CLICKED:', item.name, item.type);
                            if (selectCallback) {
                                selectCallback(item);
                            }
                            logEvent('marker_select', { type: item.type, id: item.id, name: item.name });
                            console.log('ğŸ“± Calling showDetail...');
                            this.showDetail(item);
                        });
                    });
                    
                    logEvent('map_markers_updated', { count: filteredData.length, filters: activeFilters });
                },

                getMarkerIcon: function(type) {
                    const icons = {
                        pack: 'ğŸ‘¥',
                        spot: 'ğŸ“',
                        facilitator: 'ğŸ“',
                        event: 'ğŸ“…'
                    };
                    return icons[type] || 'ğŸ“';
                },

                showDetail: function(item) {
                    console.log('ğŸ” showDetail called:', item);
                    
                    // Prevent reopening if panel is closing
                    if (_isClosing) {
                        console.log('âš ï¸ Panel is closing, preventing reopen');
                        return;
                    }
                    
                    const panel = document.getElementById('mapDetailPanel');
                    const content = document.getElementById('mapDetailContent');
                    
                    console.log('ğŸ“¦ Panel element:', panel);
                    console.log('ğŸ“ Content element:', content);
                    
                    if (!panel || !content) {
                        console.error('âŒ ERROR: Panel or content element not found!');
                        return;
                    }
                    
                    const tier = getUserTier().toLowerCase();
                    const perms = checkMapPermissions();
                    
                    // Helper function to render buttons with permission checks
                    const renderButton = (label, action, isPrimary = true, condition = true) => {
                        if (!condition) return '';
                        
                        if (!perms.interact) {
                            return `<button type="button" class="detail-action-btn${!isPrimary ? ' secondary' : ''}" 
                                    disabled 
                                    style="opacity: 0.5; cursor: not-allowed;" 
                                    onclick="toast('Available with Flow tier. Upgrade to connect.'); logEvent('map_upgrade_prompt', {tier: '${tier}', action: '${label}'})">
                                    ${label}
                                    </button>`;
                        }
                        
                        return `<button type="button" class="detail-action-btn${!isPrimary ? ' secondary' : ''}" onclick="${action}">${label}</button>`;
                    };
                    
                    let html = '';
                    
                    if (item.type === 'pack') {
                        html = `
                            <img src="${item.image}" alt="${item.name}" class="detail-panel-image">
                            <div class="detail-panel-category">Pack</div>
                            <h3 class="detail-panel-title">${item.name}</h3>
                            <p class="detail-panel-subtitle">${item.location}</p>
                            
                            ${item.archetype ? `
                            <div class="archetype-tags">
                                ${item.archetype.map(a => `<span class="archetype-tag">${a}</span>`).join('')}
                            </div>
                            ` : ''}
                            
                            <div class="detail-panel-info">
                                <div class="detail-info-item">
                                    <span class="detail-info-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="9" cy="7" r="4"></circle>
                                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                        </svg>
                                    </span>
                                    <div class="detail-info-text">
                                        <div class="detail-info-label">Members</div>
                                        <div class="detail-info-value">${item.members}</div>
                                    </div>
                                </div>
                                <div class="detail-info-item">
                                    <span class="detail-info-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                            <line x1="16" y1="2" x2="16" y2="6"></line>
                                            <line x1="8" y1="2" x2="8" y2="6"></line>
                                            <line x1="3" y1="10" x2="21" y2="10"></line>
                                        </svg>
                                    </span>
                                    <div class="detail-info-text">
                                        <div class="detail-info-label">Next Session</div>
                                        <div class="detail-info-value">${this.formatDate(item.nextSession)}</div>
                                    </div>
                                </div>
                                <div class="detail-info-item">
                                    <span class="detail-info-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <line x1="2" y1="12" x2="22" y2="12"></line>
                                            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                                        </svg>
                                    </span>
                                    <div class="detail-info-text">
                                        <div class="detail-info-label">Environment</div>
                                        <div class="detail-info-value">${item.environment}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <p class="detail-panel-description">${item.description}</p>
                            
                            <div class="detail-panel-actions">
                                ${renderButton('View Pack', `viewPackDetail('${item.id}'); logEvent('map_button_clicked', {action: 'view_pack', tier: '${tier}', blocked: ${!perms.interact}})`, true, true)}
                                ${renderButton('Send Message', `ensureDM('${item.id}', {ref: 'map'}); logEvent('map_button_clicked', {action: 'message', tier: '${tier}', blocked: ${!perms.interact}})`, false, perms.interact)}
                                ${perms.editOwnPack && item.isOwn ? renderButton('Edit Pack', `toast('Edit pack - Coming soon'); logEvent('map_button_clicked', {action: 'edit_pack', tier: '${tier}'})`, false, true) : ''}
                            </div>
                        `;
                    } else if (item.type === 'spot') {
                        html = `
                            <img src="${item.image}" alt="${item.name}" class="detail-panel-image">
                            <div class="detail-panel-category">Practice Spot</div>
                            <h3 class="detail-panel-title">${item.name}</h3>
                            <p class="detail-panel-subtitle">${item.location}</p>
                            
                            ${item.archetype ? `
                            <div class="archetype-tags">
                                ${item.archetype.map(a => `<span class="archetype-tag">${a}</span>`).join('')}
                            </div>
                            ` : ''}
                            
                            <div class="detail-panel-info">
                                <div class="detail-info-item">
                                    <span class="detail-info-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <line x1="2" y1="12" x2="22" y2="12"></line>
                                            <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                                        </svg>
                                    </span>
                                    <div class="detail-info-text">
                                        <div class="detail-info-label">Environment</div>
                                        <div class="detail-info-value">${item.environment}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <p class="detail-panel-description">${item.description}</p>
                            
                            <div class="detail-panel-actions">
                                ${renderButton('Get Directions', `MapService.getDirections(${item.lat}, ${item.lng}); logEvent('map_button_clicked', {action: 'directions', tier: '${tier}', blocked: ${!perms.interact}})`, true, perms.getDirections || !perms.interact)}
                                ${renderButton('Save Spot', `toast('Saved!'); logEvent('map_button_clicked', {action: 'save_spot', tier: '${tier}', blocked: ${!perms.interact}})`, false, perms.saveSpot || !perms.interact)}
                            </div>
                        `;
                    } else if (item.type === 'facilitator') {
                        html = `
                            <img src="${item.image}" alt="${item.name}" class="detail-panel-image" style="border-radius: 50%; width: 120px; height: 120px; object-fit: cover; margin: 0 auto var(--space-3);">
                            <div class="detail-panel-category">Certified Facilitator</div>
                            <h3 class="detail-panel-title">${item.name}</h3>
                            <p class="detail-panel-subtitle">${item.specialty}</p>
                            
                            ${item.archetype ? `
                            <div class="archetype-tags">
                                ${item.archetype.map(a => `<span class="archetype-tag">${a}</span>`).join('')}
                            </div>
                            ` : ''}
                            
                            <div class="detail-panel-info">
                                <div class="detail-info-item">
                                    <span class="detail-info-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                            <circle cx="12" cy="10" r="3"></circle>
                                        </svg>
                                    </span>
                                    <div class="detail-info-text">
                                        <div class="detail-info-label">Location</div>
                                        <div class="detail-info-value">${item.location}</div>
                                    </div>
                                </div>
                                <div class="detail-info-item">
                                    <span class="detail-info-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                            <line x1="16" y1="2" x2="16" y2="6"></line>
                                            <line x1="8" y1="2" x2="8" y2="6"></line>
                                            <line x1="3" y1="10" x2="21" y2="10"></line>
                                        </svg>
                                    </span>
                                    <div class="detail-info-text">
                                        <div class="detail-info-label">Availability</div>
                                        <div class="detail-info-value">${item.availability}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <p class="detail-panel-description">${item.bio}</p>
                            
                            <div class="detail-panel-actions">
                                ${renderButton('View Profile', `closeMapDetailPanel(); showUserProfile('${item.name}', '${item.image}', '${item.id}'); logEvent('map_button_clicked', {action: 'view_profile', tier: '${tier}', blocked: ${!perms.interact}})`, true, true)}
                                ${renderButton('Send Message', `ensureDM('${item.id}', {ref: 'map'}); logEvent('map_button_clicked', {action: 'message_facilitator', tier: '${tier}', blocked: ${!perms.interact}})`, false, perms.interact)}
                                ${perms.mentorAccess ? renderButton('Book Session', `toast('Booking - Coming soon'); logEvent('map_button_clicked', {action: 'book_session', tier: '${tier}'})`, false, true) : ''}
                            </div>
                        `;
                    } else if (item.type === 'event') {
                        html = `
                            <img src="${item.image}" alt="${item.name}" class="detail-panel-image">
                            <div class="detail-panel-category">Event</div>
                            <h3 class="detail-panel-title">${item.name}</h3>
                            <p class="detail-panel-subtitle">${item.location}</p>
                            
                            ${item.archetype ? `
                            <div class="archetype-tags">
                                ${item.archetype.map(a => `<span class="archetype-tag">${a}</span>`).join('')}
                            </div>
                            ` : ''}
                            
                            <div class="detail-panel-info">
                                <div class="detail-info-item">
                                    <span class="detail-info-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                            <line x1="16" y1="2" x2="16" y2="6"></line>
                                            <line x1="8" y1="2" x2="8" y2="6"></line>
                                            <line x1="3" y1="10" x2="21" y2="10"></line>
                                        </svg>
                                    </span>
                                    <div class="detail-info-text">
                                        <div class="detail-info-label">Date</div>
                                        <div class="detail-info-value">${this.formatDate(item.date)}</div>
                                    </div>
                                </div>
                                <div class="detail-info-item">
                                    <span class="detail-info-icon">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <polyline points="12 6 12 12 16 14"></polyline>
                                        </svg>
                                    </span>
                                    <div class="detail-info-text">
                                        <div class="detail-info-label">Duration</div>
                                        <div class="detail-info-value">${item.duration}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <p class="detail-panel-description">${item.description}</p>
                            
                            <div class="detail-panel-actions">
                                ${renderButton('RSVP', `toast('RSVP confirmed!'); logEvent('map_button_clicked', {action: 'rsvp', tier: '${tier}', blocked: ${!perms.interact}})`, true, perms.rsvpEvent || !perms.interact)}
                                ${renderButton('Get Directions', `MapService.getDirections(${item.lat}, ${item.lng}); logEvent('map_button_clicked', {action: 'directions', tier: '${tier}', blocked: ${!perms.interact}})`, false, perms.getDirections || !perms.interact)}
                            </div>
                        `;
                    }
                    
                    content.innerHTML = html;
                    
                    console.log('âœ… Content set, adding active class to panel...');
                    
                    // Save currently focused element for restoration
                    this._lastFocusedElement = document.activeElement;
                    
                    panel.classList.add('active');
                    console.log('âœ… Active class added. Panel should be visible now!');
                    console.log('   Panel classList:', panel.classList.toString());
                    
                    // Invalidate map size after panel opens
                    setTimeout(() => {
                        if (map) map.invalidateSize();
                    }, 350);
                    
                    // Focus on close button for accessibility
                    setTimeout(() => {
                        const closeBtn = panel.querySelector('.detail-panel-close');
                        if (closeBtn) closeBtn.focus();
                    }, 400);
                    
                    // Update URL with deep-link (URL-safe encoding)
                    const safeId = encodeURIComponent(item.id);
                    window.location.hash = `tribe/map?id=${safeId}`;
                    
                    logEvent('map_detail_opened', { type: item.type, id: item.id, tier: tier });
                    console.log('ğŸ‰ showDetail complete!');
                },

                closeDetail: function() {
                    _isClosing = true; // Prevent reopening
                    
                    const panel = document.getElementById('mapDetailPanel');
                    panel.classList.remove('active');
                    
                    // Invalidate map size after panel closes
                    setTimeout(() => {
                        if (map) map.invalidateSize();
                    }, 350);
                    
                    // Restore focus to last focused element
                    if (this._lastFocusedElement) {
                        setTimeout(() => {
                            this._lastFocusedElement.focus();
                            this._lastFocusedElement = null;
                        }, 400);
                    }
                    
                    // Clear the hash query param silently
                    history.replaceState(null, '', '#tribe/map');
                    
                    // Clear closing flag after animation completes
                    setTimeout(() => {
                        _isClosing = false;
                    }, 500);
                    
                    logEvent('map_detail_closed');
                },

                formatDate: function(dateString) {
                    const date = new Date(dateString);
                    return date.toLocaleDateString('en-US', { 
                        weekday: 'short',
                        month: 'short', 
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                },

                getDirections: function(lat, lng) {
                    window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`, '_blank');
                    logEvent('directions_requested', { lat, lng });
                },

                handleDeepLink: function(itemId) {
                    // Prevent reopening if panel is closing
                    if (_isClosing) {
                        return;
                    }
                    
                    // Decode URL-safe ID
                    const decodedId = decodeURIComponent(itemId);
                    const item = mapData.find(d => d.id === decodedId);
                    
                    if (item) {
                        // Center map on item
                        if (map) {
                            map.setView([item.lat, item.lng], 15);
                        }
                        // Show detail
                        this.showDetail(item);
                        logEvent('deeplink_open', { type: item.type, id: item.id });
                    } else {
                        // Invalid deep link
                        toast('Item not found', 'error');
                        logEvent('deeplink_open', { id: decodedId, success: false });
                    }
                }
            };
        })();

        // Backward compatibility - Keep original function names
        function loadMap() {
            MapService.init('map');
        }

        function closeMapDetail() {
            MapService.closeDetail();
        }

        function getDirections(lat, lng) {
            MapService.getDirections(lat, lng);
        }

        function retryMapLoad() {
            toast('Retrying map load...');
            loadMap();
            logEvent('map_retry_clicked');
        }

        function getCoordinatesForLocation(location) {
            const locations = {
                'Brooklyn, New York': [40.6782, -73.9442],
                'Santa Monica, California': [34.0195, -118.4912],
                'Portland, Oregon': [45.5152, -122.6784],
                'Chicago, Illinois': [41.8781, -87.6298],
                'Austin, Texas': [30.2672, -97.7431]
            };
            return locations[location] || [40.7128, -74.0060];
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // MY PACKS FUNCTIONS
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function loadMyPacks() {
            const container = document.getElementById('myPacksContainer');
            const joinedPackIds = getJoinedPacks();
            const myPacks = MOCK_DATA.packs.filter(pack => joinedPackIds.includes(pack.id));

            setTimeout(() => {
                if (myPacks.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3 class="empty-title">No Packs Yet</h3>
                            <p class="empty-message">Join a pack to start moving with your tribe.</p>
                            <button class="btn btn-primary btn-large" onclick="switchTab('packs')">
                                TRIBE Packs
                            </button>
                        </div>
                    `;
                } else {
                    container.innerHTML = '';
                    myPacks.forEach(pack => {
                        const packCard = document.createElement('div');
                        packCard.className = 'my-pack-card';
                        
                        packCard.innerHTML = `
                            <img src="${pack.image}" alt="${pack.name}" class="my-pack-image">
                            <div class="my-pack-content">
                                <h3 class="my-pack-name">${pack.name}</h3>
                                <p class="my-pack-location">${pack.location}</p>
                                <div class="my-pack-next-session">${pack.nextSession}</div>
                                <div class="my-pack-actions">
                                    <button class="btn btn-primary" onclick="showPackDetail(${pack.id})">View Details</button>
                                    <button class="btn btn-secondary" onclick="leavePack(${pack.id})">Leave Pack</button>
                                </div>
                            </div>
                        `;
                        
                        container.appendChild(packCard);
                    });
                }

                logEvent('my_packs_loaded');
            }, 300);
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // WISDOM LIBRARY FUNCTIONS - WITH TIER RESTRICTIONS
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        let currentFilter = 'latest';
        let currentSearchQuery = '';
        let currentWisdomCategory = 'all';

        // Wisdom Library Articles
        const wisdomArticles = [
            {
                id: 'wisdom-1',
                category: 'Philosophy',
                title: 'The Practice of Observation',
                excerpt: 'Movement is not about achieving perfect formâ€”it\'s about developing the ability to observe yourself without judgment. Learn how presence transforms practice.',
                author: 'HUDEN Team',
                readingTime: '8 min',
                image: 'https://images.unsplash.com/photo-1506126613408-eca07ce68773?w=800&q=80'
            },
            {
                id: 'wisdom-2',
                category: 'Philosophy',
                title: 'Anti-Performance Mindset',
                excerpt: 'Why the gym mentality keeps us disconnected from our bodies. Discover the philosophy behind observation-first movement practice.',
                author: 'Movement Philosophy',
                readingTime: '6 min',
                image: 'https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=800&q=80'
            },
            {
                id: 'wisdom-3',
                category: 'Philosophy',
                title: 'Learning to Feel',
                excerpt: 'The difference between knowing and feeling. How somatic awareness opens pathways that intellectual understanding cannot reach.',
                author: 'HUDEN Team',
                readingTime: '7 min',
                image: 'https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=800&q=80'
            },
            {
                id: 'wisdom-4',
                category: 'Movement',
                title: 'Natural Movement Patterns',
                excerpt: 'Rediscovering the movement vocabulary we\'ve lost. TRIBE the fundamental patterns humans evolved to perform with ease.',
                author: 'Coach Sarah Martinez',
                readingTime: '10 min',
                image: 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=800&q=80'
            },
            {
                id: 'wisdom-5',
                category: 'Movement',
                title: 'The Four Archetypes',
                excerpt: 'Understanding Gorilla, Gibbon, Orangutan, and Chimpanzee movement styles. Which resonates with your natural expression?',
                author: 'HUDEN Team',
                readingTime: '12 min',
                image: 'https://images.unsplash.com/photo-1518611012118-696072aa579a?w=800&q=80'
            },
            {
                id: 'wisdom-6',
                category: 'Movement',
                title: 'Ground Connection',
                excerpt: 'Why floor work is foundational to all movement. The lost art of being comfortable in any position on the ground.',
                author: 'Coach James Chen',
                readingTime: '9 min',
                image: 'https://images.unsplash.com/photo-1599058917212-d750089bc07e?w=800&q=80'
            },
            {
                id: 'wisdom-7',
                category: 'Community',
                title: 'Pack Dynamics',
                excerpt: 'How moving together amplifies individual practice. The neuroscience and social psychology of group movement.',
                author: 'Community Wisdom',
                readingTime: '8 min',
                image: 'https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=800&q=80'
            },
            {
                id: 'wisdom-8',
                category: 'Community',
                title: 'Building Authentic Connection',
                excerpt: 'Moving beyond performance and competition. How HUDEN creates spaces for genuine human connection through movement.',
                author: 'HUDEN Team',
                readingTime: '7 min',
                image: 'https://images.unsplash.com/photo-1511632765486-a01980e01a18?w=800&q=80'
            },
            {
                id: 'wisdom-9',
                category: 'Community',
                title: 'Building Authentic Connections',
                excerpt: 'Creating genuine community bonds through shared practice. How TRIBE fosters meaningful relationships beyond the mat.',
                author: 'Community Wisdom',
                readingTime: '6 min',
                image: 'https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=800&q=80'
            },
            {
                id: 'wisdom-10',
                category: 'Coaching',
                title: 'The Art of Facilitation',
                excerpt: 'From instructor to guide. How HUDEN coaches create containers for self-discovery rather than imposing corrections.',
                author: 'Coach Maria Rodriguez',
                readingTime: '11 min',
                image: 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=800&q=80'
            },
            {
                id: 'wisdom-11',
                category: 'Coaching',
                title: 'Holding Space',
                excerpt: 'The subtle skills of presence. What it means to truly witness another person\'s movement journey without interference.',
                author: 'Coach Development',
                readingTime: '9 min',
                image: 'https://images.unsplash.com/photo-1506126613408-eca07ce68773?w=800&q=80'
            },
            {
                id: 'wisdom-12',
                category: 'Coaching',
                title: 'Questions Over Answers',
                excerpt: 'Why great coaches ask instead of tell. The transformative power of inquiry-based teaching in movement practice.',
                author: 'HUDEN Team',
                readingTime: '8 min',
                image: 'https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=800&q=80'
            }
        ];

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // WISDOM LIBRARY FUNCTIONS
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function loadWisdomLibrary() {
            const container = document.getElementById('wisdomContainer');
            if (!container) return;

            container.innerHTML = `
                <div class="wisdom-editorial-container">
                    <!-- Editorial Hero -->
                    <div class="wisdom-editorial-hero">
                        <div class="wisdom-editorial-hero-image">
                            <img src="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=1920&q=80" alt="Movement Practice" />
                        </div>
                        <div class="wisdom-editorial-hero-content">
                            <span class="wisdom-editorial-category">Featured</span>
                            <h1 class="wisdom-editorial-hero-title">How Proper Sleep Hygiene Can Improve Your Athletic Performance</h1>
                            <p class="wisdom-editorial-hero-excerpt">
                                Good sleep hygieneâ€”a set of behaviours and an environment needed for optimal sleepâ€”is one of the most important recovery methods for athletes.
                            </p>
                            <button class="btn btn-primary btn-large" onclick="showWisdomArticle('featured-sleep')">
                                Read Article
                            </button>
                        </div>
                    </div>

                    <!-- Article List -->
                    <div class="wisdom-article-list">
                        <h2 class="wisdom-section-title">Latest Articles</h2>
                        <div class="wisdom-articles-grid" id="wisdomArticlesGrid"></div>
                    </div>
                </div>
            `;

            renderWisdomArticles();
        }

        function renderWisdomArticles() {
            const grid = document.getElementById('wisdomArticlesGrid');
            if (!grid) return;

            // Show latest articles (excluding the featured one)
            const articles = [
                {
                    id: 'movement-autonomy',
                    category: 'Philosophy',
                    title: 'The Path to Movement Autonomy',
                    excerpt: 'Why the goal isn\'t perfect form, but learning to feel and respond to your body\'s intelligence.',
                    readingTime: '5 min'
                },
                {
                    id: 'observe-without-fixing',
                    category: 'Practice',
                    title: 'Observe Without Fixing',
                    excerpt: 'The core principle that transforms how you approach movement and life.',
                    readingTime: '4 min'
                },
                {
                    id: 'four-archetypes',
                    category: 'Movement',
                    title: 'Four Archetypal Patterns',
                    excerpt: 'Gorilla, Gibbon, Orangutan, Chimpanzeeâ€”understanding the fundamental movement families.',
                    readingTime: '7 min'
                },
                {
                    id: 'authentic-community',
                    category: 'Community',
                    title: 'Building Authentic Connections',
                    excerpt: 'Creating genuine community bonds through shared practice and mutual support.',
                    readingTime: '6 min'
                },
                {
                    id: 'coach-facilitation',
                    category: 'Coaching',
                    title: 'The Art of Facilitation',
                    excerpt: 'From instructor to guideâ€”how HUDEN coaches create space for discovery.',
                    readingTime: '8 min'
                },
                {
                    id: 'somatic-awareness',
                    category: 'Practice',
                    title: 'Developing Somatic Awareness',
                    excerpt: 'Learning the language of your body through present-moment observation.',
                    readingTime: '6 min'
                }
            ];

            grid.innerHTML = articles.map(article => `
                <article class="wisdom-article-card" onclick="showWisdomArticle('${article.id}')">
                    <div class="wisdom-article-card-content">
                        <div class="wisdom-article-card-category">${article.category}</div>
                        <h3 class="wisdom-article-card-title">${article.title}</h3>
                        <p class="wisdom-article-card-excerpt">${article.excerpt}</p>
                        <div class="wisdom-article-card-meta">
                            <span>Read Article</span>
                            <span>${article.readingTime}</span>
                        </div>
                    </div>
                </article>
            `).join('');
        }

        function showWisdomArticle(articleId) {
            const container = document.getElementById('wisdomContainer');
            if (!container) return;

            // Featured Sleep Hygiene article content
            if (articleId === 'featured-sleep') {
                container.innerHTML = `
                    <div class="wisdom-article-detail">
                        <div class="wisdom-article-detail-header">
                            <div class="wisdom-article-detail-back" onclick="loadWisdomLibrary()">
                                â† Back to Library
                            </div>
                            <div class="wisdom-article-detail-category">RECOVERY</div>
                            <h1 class="wisdom-article-detail-title">How Proper Sleep Hygiene Can Improve Your Athletic Performance</h1>
                            <div class="wisdom-article-detail-meta">
                                <span>8 min read</span>
                                <span>Â·</span>
                                <span>HUDEN Performance Team</span>
                            </div>
                        </div>

                        <img 
                            src="https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=1920&q=80" 
                            alt="Sleep and Recovery" 
                            class="wisdom-article-detail-image"
                        />

                        <div class="wisdom-article-detail-content">
                            <p>Good sleep hygieneâ€”a set of behaviours and an environment needed for optimal sleepâ€”is one of the most important recovery methods for athletes. Getting proper sleep boosts immunity, reduces stress, improves mood, sharpens memory, and helps muscle repair, according to the U.S. Department of Health and Human Services. Without it, the effects may go beyond grogginessâ€”and for athletes, the downsides can be even more.</p>

                            <h2>Stages of Sleep</h2>
                            <p>To understand how sleep impacts athletic performance, it's helpful to know what happens during rest. Sleep is divided into two main phases: <strong>non-rapid eye movement (NREM)</strong> and <strong>rapid eye movement (REM)</strong>. NREM has three stages, progressing from light to deep sleep, while REM is when most dreaming occurs.</p>

                            <p>Each stage plays a crucial role in recovery. During <strong>stage 3 NREM</strong>â€”the deepest sleep phaseâ€”the body releases growth hormones essential for muscle repair and development. This is when physical recovery happens most effectively. REM sleep, on the other hand, is vital for cognitive functions like memory consolidation and emotional regulation.</p>

                            <h2>The Impact on Performance</h2>
                            <p>Athletes who consistently get quality sleep experience measurable improvements in performance. Studies show that proper rest enhances reaction time, decision-making, and coordination. It also reduces the risk of injury by maintaining sharp focus and physical readiness.</p>

                            <p>Conversely, sleep deprivation can lead to decreased endurance, slower recovery times, and impaired motor skills. Even mild sleep restriction accumulates over time, creating a "sleep debt" that affects both physical and mental performance.</p>

                            <h2>Creating Your Sleep Environment</h2>
                            <p>The foundation of good sleep hygiene starts with your environment. Your bedroom should be cool (around 15-19Â°C), dark, and quiet. Consider blackout curtains, white noise machines, or earplugs if needed.</p>

                            <p><strong>Key environmental factors:</strong></p>
                            <p>â€¢ Temperature regulation is criticalâ€”the body needs to cool slightly to initiate sleep</p>
                            <p>â€¢ Darkness triggers melatonin production, your body's natural sleep signal</p>
                            <p>â€¢ A comfortable, supportive mattress and pillows prevent physical discomfort</p>
                            <p>â€¢ Minimize electronic devicesâ€”blue light suppresses melatonin</p>

                            <h2>Pre-Sleep Routines</h2>
                            <p>What you do in the hours before bed significantly impacts sleep quality. Establish a consistent wind-down routine that signals to your body it's time to rest. This might include gentle stretching, reading, or meditation.</p>

                            <p>Avoid intense training within three hours of bedtimeâ€”while exercise improves sleep overall, late workouts can be too stimulating. Similarly, limit caffeine intake after 2 PM and avoid large meals close to bedtime.</p>

                            <h2>Consistency is Key</h2>
                            <p>Your body thrives on routine. Going to bed and waking up at the same time every dayâ€”even on weekendsâ€”helps regulate your circadian rhythm. This internal clock governs not just sleep, but hormone release, body temperature, and other vital functions.</p>

                            <p>For athletes, this consistency becomes even more important. Regular sleep patterns optimize recovery cycles and help maintain peak performance capacity.</p>

                            <h2>Integration with Training</h2>
                            <p>At HUDEN, we view sleep as an integral part of your movement practiceâ€”not separate from it. Just as you observe your body during training without judgment, approach sleep with the same awareness. Notice your patterns, understand what affects your rest, and make adjustments based on how you feel.</p>

                            <p>This isn't about perfection. It's about developing awareness of your body's needs and creating conditions that support natural recovery. Quality sleep isn't a luxury for athletesâ€”it's a fundamental component of sustainable practice.</p>

                            <p>Remember: the work you do while awake is only half the equation. The rest happens when you rest.</p>
                        </div>
                    </div>
                `;
            } else {
                // Other articles - show coming soon message
                container.innerHTML = `
                    <div class="wisdom-article-detail">
                        <div class="wisdom-article-detail-header">
                            <div class="wisdom-article-detail-back" onclick="loadWisdomLibrary()">
                                â† Back to Library
                            </div>
                        </div>
                        <div style="text-align: center; padding: var(--space-10) var(--space-4);">
                            <h2 style="font-size: 32px; font-weight: 900; margin-bottom: var(--space-3);">Article Coming Soon</h2>
                            <p style="font-size: 18px; color: var(--gray-600); margin-bottom: var(--space-4);">
                                We're working on bringing you more quality content. Check back soon.
                            </p>
                            <button class="btn btn-primary" onclick="loadWisdomLibrary()">
                                Browse Other Articles
                            </button>
                        </div>
                    </div>
                `;
            }
            
            logEvent('wisdom_article_opened', { articleId });
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // WISDOM LIBRARY THRESHOLD MODAL
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function submitNewDiscussion(event) {
            event.preventDefault();
            console.log('submitNewDiscussion called');
            
            const form = event.target;
            console.log('Form:', form);
            
            try {
                // More robust selectors - try multiple methods
                const titleInput = form.querySelector('input[placeholder="What\'s on your mind?"]') || 
                                   form.querySelectorAll('input[type="text"]')[0];
                const contentTextarea = form.querySelector('textarea[placeholder="Share your thoughts..."]') || 
                                        form.querySelector('textarea');
                const tagsInput = form.querySelector('input[placeholder="movement, practice, philosophy"]') || 
                                  form.querySelectorAll('input[type="text"]')[1];
                
                console.log('Title input:', titleInput);
                console.log('Content textarea:', contentTextarea);
                console.log('Tags input:', tagsInput);
                
                if (!titleInput || !contentTextarea) {
                    console.error('Required fields not found');
                    toast('Error: Could not find form fields');
                    return;
                }
                
                const title = titleInput.value.trim();
                const content = contentTextarea.value.trim();
                const tags = tagsInput && tagsInput.value ? tagsInput.value.split(',').map(t => t.trim()) : [];
                
                console.log('Title:', title);
                console.log('Content:', content);
                console.log('Tags:', tags);
                
                if (!title || !content) {
                    toast('Please fill in title and content');
                    return;
                }
                
                const discussions = getDiscussions();
                const newDiscussion = {
                    id: `disc-${Date.now()}`,
                    author: 'Current User',
                    avatar: 'https://i.pravatar.cc/150?img=10',
                    timestamp: new Date().toISOString(),
                    title: title,
                    content: content,
                    tags: tags,
                    comments: [],
                    views: 0
                };

                // Add image if uploaded
                if (selectedDiscussionImageDataURL) {
                    newDiscussion.image = selectedDiscussionImageDataURL;
                    console.log('Image added to discussion (compressed size:', selectedDiscussionImageDataURL.length, 'bytes)');
                }

                discussions.push(newDiscussion);
                console.log('New discussion created:', newDiscussion);
                
                // Save with quota error handling
                try {
                    saveDiscussions(discussions);
                    console.log('Discussion saved successfully');
                } catch (quotaError) {
                    if (quotaError.name === 'QuotaExceededError') {
                        console.error('localStorage quota exceeded');
                        // Remove image and try again
                        if (newDiscussion.image) {
                            delete newDiscussion.image;
                            console.log('Retrying without image...');
                            try {
                                discussions.pop(); // Remove the one we just added
                                discussions.push(newDiscussion);
                                saveDiscussions(discussions);
                                toast('Teaching saved (image removed due to storage limit)');
                            } catch (e) {
                                toast('Storage full. Please delete old content.');
                                return;
                            }
                        } else {
                            toast('Storage full. Please delete old content.');
                            return;
                        }
                    } else {
                        throw quotaError;
                    }
                }
                
                clearDiscussionImagePreview();
                toast('Teaching shared');
                closeModal('newDiscussionModal');
                loadWisdomLibrary();
                logEvent('discussion_created');
            } catch (error) {
                console.error('Error in submitNewDiscussion:', error);
                toast('Error creating discussion. Check console.');
            }
        }

        function showDiscussionDetail(discussionId) {
            const discussions = getDiscussions();
            const discussion = discussions.find(d => d.id === discussionId);
            if (!discussion) return;

            const modal = document.getElementById('discussionDetailModal');
            const content = document.getElementById('discussionDetailContent');
            
            content.innerHTML = `
                <div class="discussion-detail-header">
                    <div class="discussion-detail-meta" style="cursor: pointer;" onclick="showUserProfile('${discussion.author}', '${discussion.avatar}', ${discussion.id})">
                        <img src="${discussion.avatar}" alt="${discussion.author}" class="discussion-avatar">
                        <div class="discussion-meta">
                            <div class="discussion-author">${discussion.author}</div>
                            <div class="discussion-timestamp">${formatTimestamp(discussion.timestamp)}</div>
                        </div>
                    </div>
                </div>
                ${discussion.tags && discussion.tags.length > 0 ? `
                    <div class="discussion-tags" style="padding: var(--space-4); padding-bottom: 0;">
                        ${discussion.tags.map(tag => `<span class="discussion-tag">${tag}</span>`).join('')}
                    </div>
                ` : ''}
                ${discussion.image ? `
                    <div style="padding: var(--space-4); padding-bottom: 0;">
                        <img src="${discussion.image}" alt="${discussion.title}" style="width: 100%; height: auto; border-radius: var(--radius-md); display: block;">
                    </div>
                ` : ''}
                <div style="padding: var(--space-4);">
                    <h2 class="section-title" style="margin-bottom: var(--space-3);">${discussion.title}</h2>
                </div>
                <div class="discussion-detail-content">${discussion.content}</div>
                ${discussion.author === 'Current User' ? `
                    <div class="discussion-actions">
                        <button class="btn btn-secondary" onclick="deleteDiscussion('${discussionId}')">Remove Teaching</button>
                    </div>
                ` : ''}
                <div class="comments-section">
                    <h3 class="comments-title">Reflections</h3>
                    <form class="comment-form" onsubmit="addDiscussionComment(event, '${discussionId}')">
                        <textarea class="comment-input" placeholder="Share your reflection..." required></textarea>
                        <button type="submit" class="btn btn-primary">Add Reflection</button>
                    </form>
                    <div class="comments-list">
                        ${(discussion.comments || []).map((comment, idx) => `
                            <div class="comment-card">
                                <div class="comment-header">
                                    <img src="${comment.avatar}" alt="${comment.author}" class="comment-avatar">
                                    <div class="comment-meta">
                                        <div class="comment-author">${comment.author}</div>
                                        <div class="comment-timestamp">${comment.timestamp}</div>
                                    </div>
                                    ${comment.author === 'Current User' ? `<button class="comment-delete" onclick="deleteDiscussionComment('${discussionId}', ${idx})">Remove</button>` : ''}
                                </div>
                                <p class="comment-text">${comment.text}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            logEvent('discussion_detail_opened', { discussionId });
        }

        function addDiscussionComment(event, discussionId) {
            event.preventDefault();
            const form = event.target;
            const text = form.querySelector('textarea').value;
            
            const discussions = getDiscussions();
            const discussion = discussions.find(d => d.id === discussionId);
            
            if (!discussion.comments) discussion.comments = [];
            
            discussion.comments.push({
                author: 'Current User',
                avatar: 'https://i.pravatar.cc/150?img=10',
                timestamp: 'Just now',
                text: text
            });
            
            saveDiscussions(discussions);
            form.reset();
            showDiscussionDetail(discussionId);
            toast('Reflection added');
            logEvent('discussion_comment_added', { discussionId });
        }

        function deleteDiscussionComment(discussionId, commentIdx) {
            const discussions = getDiscussions();
            const discussion = discussions.find(d => d.id === discussionId);
            
            if (discussion && discussion.comments) {
                discussion.comments.splice(commentIdx, 1);
                saveDiscussions(discussions);
                showDiscussionDetail(discussionId);
                toast('Comment deleted');
                logEvent('discussion_comment_deleted', { discussionId });
            }
        }

        async function deleteDiscussion(discussionId) {
            const confirmed = await CustomModal.confirm(
                'Delete Discussion',
                'Are you sure you want to delete this discussion? This action cannot be undone.',
                { 
                    confirmText: 'Delete', 
                    cancelText: 'Cancel',
                    critical: true
                }
            );
            
            if (!confirmed) return;
            
            const discussions = getDiscussions();
            const index = discussions.findIndex(d => d.id === discussionId);
            
            if (index > -1) {
                discussions.splice(index, 1);
                saveDiscussions(discussions);
                closeModal('discussionDetailModal');
                toast('Teaching removed');
                loadWisdomLibrary();
                logEvent('discussion_deleted', { discussionId });
            }
        }

        function formatTimestamp(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return 'Just now';
            if (minutes < 60) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
            if (hours < 24) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
            if (days < 7) return `${days} day${days > 1 ? 's' : ''} ago`;
            
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // MODAL FUNCTIONS - WITH FOCUS MANAGEMENT
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        let lastFocusedElement = null;

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            
            // Save currently focused element
            lastFocusedElement = document.activeElement;
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            const firstInput = modal.querySelector('input, textarea, button');
            if (firstInput) {
                setTimeout(() => firstInput.focus(), 100);
            }

            logEvent('modal_opened', { modalId });
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.classList.remove('active');
            document.body.style.overflow = '';
            
            const form = modal.querySelector('form');
            if (form) {
                form.reset();
                // Reset archetype pills (NEW v14)
                form.querySelectorAll('.archetype-pill').forEach(pill => {
                    pill.classList.remove('active');
                });
            }
            
            // Clear image preview if closing new post modal (NEW v15)
            if (modalId === 'newPostModal') {
                clearPostImagePreview();
            }
            
            // Clear image preview if closing new discussion modal
            if (modalId === 'newDiscussionModal') {
                clearDiscussionImagePreview();
            }
            
            // Restore focus to previously focused element
            if (lastFocusedElement) {
                setTimeout(() => {
                    lastFocusedElement.focus();
                    lastFocusedElement = null;
                }, 100);
            }

            logEvent('modal_closed', { modalId });
        }

        // Close modal on overlay click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    closeModal(overlay.id);
                }
            });
        });

        // Close modal on ESC key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const activeModal = document.querySelector('.modal-overlay.active');
                if (activeModal) {
                    closeModal(activeModal.id);
                }
            }
        });

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // HASH ROUTING - COMPLETE WITH THREAD SUPPORT & MAP DEEP-LINKING
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        window.addEventListener('hashchange', () => {
            const hashFull = window.location.hash.replace('#tribe/', '');
            const [hash, queryString] = hashFull.split('?');
            
            // Handle inbox thread routing: #tribe/inbox/thread/:conversationId
            if (hash.startsWith('inbox/thread/')) {
                const conversationId = hash.split('/')[2];
                if (conversationId) {
                    openThread(conversationId);
                    return;
                }
            }
            
            // Handle map deep-linking: #tribe/map?id=ID
            if (hash === 'map' && queryString) {
                const params = new URLSearchParams(queryString);
                const itemId = params.get('id');
                if (itemId) {
                    switchTab('map');
                    // Delay to ensure map is loaded
                    setTimeout(() => {
                        MapService.handleDeepLink(itemId);
                    }, 500);
                    return;
                }
            }
            
            // Handle regular tabs
            if (hash && ['feed', 'packs', 'map', 'my-packs', 'inbox'].includes(hash)) {
                switchTab(hash);
            } else if (!hash) {
                switchTab('home');
            }
        });

        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // WELCOME WIZARD SYSTEM (v24)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        let currentWizardStep = 1;
        let selectedArchetypes = [];
        let wizardData = {};
        
        function showWelcomeWizard() {
            const wizard = document.getElementById('welcomeWizard');
            wizard.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            currentWizardStep = 1;
            updateWizardProgress();
        }
        
        function hideWelcomeWizard() {
            const wizard = document.getElementById('welcomeWizard');
            wizard.style.display = 'none';
            document.body.style.overflow = '';
        }
        
        function nextWizardStep() {
            // Validate current step
            if (currentWizardStep === 2 && selectedArchetypes.length === 0) {
                toast('Please select at least one archetype');
                return;
            }
            
            if (currentWizardStep === 3) {
                const name = document.getElementById('wizardName').value.trim();
                if (!name) {
                    toast('Please enter your name');
                    return;
                }
                wizardData.name = name;
                wizardData.location = document.getElementById('wizardLocation').value.trim();
                wizardData.bio = document.getElementById('wizardBio').value.trim();
            }
            
            if (currentWizardStep === 4) {
                wizardData.path = document.getElementById('wizardPath').value;
                wizardData.exploring = document.getElementById('wizardExploring').value.trim();
            }
            
            // Hide current step
            document.getElementById(`wizardStep${currentWizardStep}`).style.display = 'none';
            
            // Show next step
            currentWizardStep++;
            
            if (currentWizardStep === 5) {
                loadSuggestedPacks();
            }
            
            document.getElementById(`wizardStep${currentWizardStep}`).style.display = 'block';
            updateWizardProgress();
        }
        
        function prevWizardStep() {
            // Hide current step
            document.getElementById(`wizardStep${currentWizardStep}`).style.display = 'none';
            
            // Show previous step
            currentWizardStep--;
            document.getElementById(`wizardStep${currentWizardStep}`).style.display = 'block';
            updateWizardProgress();
        }
        
        function updateWizardProgress() {
            const progress = (currentWizardStep / 5) * 100;
            document.getElementById('wizardProgress').style.width = progress + '%';
        }
        
        function toggleArchetype(archetype) {
            const card = document.querySelector(`.archetype-card[data-archetype="${archetype}"]`);
            const check = card.querySelector('.archetype-check');
            
            if (selectedArchetypes.includes(archetype)) {
                // Deselect
                selectedArchetypes = selectedArchetypes.filter(a => a !== archetype);
                card.style.borderColor = 'transparent';
                card.style.background = 'var(--gray-100)';
                check.style.display = 'none';
            } else {
                // Select
                selectedArchetypes.push(archetype);
                card.style.borderColor = 'var(--black)';
                card.style.background = 'var(--white)';
                check.style.display = 'block';
            }
        }
        
        function loadSuggestedPacks() {
            const container = document.getElementById('suggestedPacks');
            const location = wizardData.location || '';
            
            // Get all packs
            const allPacks = [
                {
                    id: 'barcelona-tribe',
                    name: 'Barcelona Movement Tribe',
                    location: 'Barcelona, Spain',
                    members: 47,
                    description: 'Urban practice meets beach training'
                },
                {
                    id: 'berlin-parkour',
                    name: 'Berlin Parkour Collective',
                    location: 'Berlin, Germany',
                    members: 63,
                    description: 'Industrial spaces and creative lines'
                },
                {
                    id: 'london-flow',
                    name: 'London Flow Pack',
                    location: 'London, UK',
                    members: 82,
                    description: 'Parks and outdoor structures'
                }
            ];
            
            // Filter by location if provided, otherwise show all
            let packs = allPacks;
            if (location) {
                const locationLower = location.toLowerCase();
                packs = allPacks.filter(p => p.location.toLowerCase().includes(locationLower));
                
                // If no matches, show all
                if (packs.length === 0) {
                    packs = allPacks.slice(0, 3);
                }
            }
            
            container.innerHTML = packs.map(pack => `
                <div class="pack-suggestion" style="background: var(--gray-100); padding: 24px; border-radius: 12px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s ease;" onclick="selectPack('${pack.id}')">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                        <div>
                            <h3 style="font-size: 18px; font-weight: 700; margin-bottom: 4px;">${pack.name}</h3>
                            <p style="font-size: 14px; color: var(--gray-600);">${pack.location}</p>
                        </div>
                        <div class="pack-check" style="display: none; font-size: 24px; font-weight: 700;">âœ“</div>
                    </div>
                    <p style="font-size: 14px; color: var(--gray-700); margin-bottom: 8px;">${pack.description}</p>
                    <p style="font-size: 13px; color: var(--gray-500);">${pack.members} members</p>
                </div>
            `).join('');
        }
        
        function selectPack(packId) {
            // Toggle selection
            const packElem = document.querySelector(`.pack-suggestion[onclick*="${packId}"]`);
            const check = packElem.querySelector('.pack-check');
            
            if (wizardData.selectedPack === packId) {
                wizardData.selectedPack = null;
                packElem.style.borderColor = 'transparent';
                packElem.style.background = 'var(--gray-100)';
                check.style.display = 'none';
            } else {
                // Deselect all others
                document.querySelectorAll('.pack-suggestion').forEach(p => {
                    p.style.borderColor = 'transparent';
                    p.style.background = 'var(--gray-100)';
                    p.querySelector('.pack-check').style.display = 'none';
                });
                
                // Select this one
                wizardData.selectedPack = packId;
                packElem.style.borderColor = 'var(--black)';
                packElem.style.background = 'var(--white)';
                check.style.display = 'block';
            }
        }
        
        function skipPacks() {
            completeWizard();
        }
        
        function completeWizard() {
            // Save user profile
            const userProfile = {
                name: wizardData.name,
                location: wizardData.location,
                bio: wizardData.bio,
                archetypes: selectedArchetypes,
                path: wizardData.path,
                exploring: wizardData.exploring,
                joinedDate: new Date().toISOString(),
                tier: getUserTier()
            };
            
            localStorage.setItem('hudenUserProfile', JSON.stringify(userProfile));
            
            // Join pack if selected
            if (wizardData.selectedPack) {
                const joinedPacks = getJoinedPacks();
                if (!joinedPacks.includes(wizardData.selectedPack)) {
                    joinedPacks.push(wizardData.selectedPack);
                    saveJoinedPacks(joinedPacks);
                }
            }
            
            // Mark onboarding as complete
            localStorage.setItem('hudenOnboardingComplete', 'true');
            
            // Hide wizard
            hideWelcomeWizard();
            
            // Show welcome toast
            toast('Welcome to TRIBE! Share your first reflection.');
            
            // Initialize app
            initInboxSystem();
            const hash = window.location.hash.replace('#tribe/', '');
            if (hash && ['feed', 'packs', 'map', 'my-packs', 'inbox'].includes(hash)) {
                switchTab(hash);
            } else {
                switchTab('home');
            }
            
            logEvent('onboarding_completed', { 
                archetypes: selectedArchetypes,
                path: wizardData.path,
                joinedPack: !!wizardData.selectedPack
            });
        }
        
        // Testing function - Reset onboarding (Ctrl+Shift+O)
        function resetOnboarding() {
            localStorage.removeItem('hudenOnboardingComplete');
            localStorage.removeItem('hudenUserProfile');
            toast('Onboarding reset. Reload page to see wizard.');
            logEvent('onboarding_reset', { source: 'testing' });
        }
        
        // Keyboard shortcut for reset (Ctrl+Shift+O)
        document.addEventListener('keydown', async (e) => {
            if (e.ctrlKey && e.shiftKey && e.key === 'O') {
                e.preventDefault();
                const confirmed = await CustomModal.confirm(
                    'Reset Onboarding',
                    'This will clear your profile and show the welcome wizard on reload.',
                    { 
                        confirmText: 'Reset', 
                        cancelText: 'Cancel'
                    }
                );
                
                if (confirmed) {
                    resetOnboarding();
                }
            }
        });

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // INITIALIZATION
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function init() {
            // Initialize role selector UI to show current tier
            updateRoleSelectorUI();
            
            // Check if user has completed onboarding
            const onboardingComplete = localStorage.getItem('hudenOnboardingComplete');
            if (!onboardingComplete) {
                showWelcomeWizard();
                return;
            }
            
            // Initialize Event Organization (NEW v26)
            populateEventPackSelect();
            
            // Initialize Inbox System
            initInboxSystem();
            
            // Check for milestones and seasonal transitions (NEW v27 - Ritual & Ceremony)
            setTimeout(() => {
                checkMilestones();
            }, 1000);

            const hashFull = window.location.hash.replace('#tribe/', '');
            const [hash, queryString] = hashFull.split('?');
            
            // Handle inbox thread routing: #tribe/inbox/thread/:conversationId
            if (hash.startsWith('inbox/thread/')) {
                const conversationId = hash.split('/')[2];
                if (conversationId) {
                    openThread(conversationId);
                    return;
                }
            }
            
            // Handle map deep-linking: #tribe/map?id=ID
            if (hash === 'map' && queryString) {
                const params = new URLSearchParams(queryString);
                const itemId = params.get('id');
                if (itemId) {
                    switchTab('map');
                    // Delay to ensure map is loaded
                    setTimeout(() => {
                        MapService.handleDeepLink(itemId);
                    }, 500);
                    return;
                }
            }
            
            // Handle regular tabs
            if (hash && ['feed', 'packs', 'map', 'my-packs', 'guide', 'wisdom-library', 'inbox'].includes(hash)) {
                switchTab(hash);
            } else {
                switchTab('home'); // Use switchTab to ensure hero updates
            }
            
            logEvent('tribe_initialized', { tier: getUserTier() });
        }

        document.addEventListener('DOMContentLoaded', init);
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // GUIDE SECTION - Find Your Coach (FASE 5: Mentorship & Wisdom)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        const mockCoaches = [
            {
                id: 1,
                name: 'Marcus Rivera',
                location: 'Barcelona, Spain',
                tier: 'coach',
                image: 'https://images.unsplash.com/photo-1568602471122-7832951cc4c5?w=400&q=80',
                bio: '10+ years exploring natural movement. Certified in trauma-informed practices. Specialized in outdoor training and primal voice work.',
                specialties: ['outdoor', 'trauma', 'coaching'],
                rate: 80,
                available: true,
                rating: 4.9,
                reviewCount: 27,
                reviews: [
                    {
                        id: 1,
                        author: 'Sarah Mitchell',
                        authorAvatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&q=80',
                        rating: 5,
                        date: '2 weeks ago',
                        content: 'Marcus has an incredible ability to create a safe space for exploration. His trauma-informed approach helped me reconnect with my body in ways I didn\'t think possible. Highly recommend for anyone looking to go deeper.',
                        verified: true
                    },
                    {
                        id: 2,
                        author: 'David Park',
                        authorAvatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&q=80',
                        rating: 5,
                        date: '1 month ago',
                        content: 'Best coach I\'ve worked with. Marcus focuses on observation rather than correction, which completely changed how I approach movement. The outdoor sessions in Barcelona are unforgettable.',
                        verified: true
                    },
                    {
                        id: 3,
                        author: 'Emma Thompson',
                        authorAvatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&q=80',
                        rating: 5,
                        date: '2 months ago',
                        content: 'Marcus brings authentic presence to every session. His primal voice work integrated beautifully with the movement practice. Transformative experience.',
                        verified: true
                    }
                ]
            },
            {
                id: 2,
                name: 'Sofia Chen',
                location: 'London, UK',
                tier: 'coach',
                image: 'https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?w=400&q=80',
                bio: 'Movement coach with background in somatic therapy. Teaching presence through observation. Urban environment specialist.',
                specialties: ['urban', 'trauma'],
                rate: 75,
                available: true,
                rating: 4.8,
                reviewCount: 19,
                reviews: [
                    {
                        id: 4,
                        author: 'Michael Chen',
                        authorAvatar: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&q=80',
                        rating: 5,
                        date: '1 week ago',
                        content: 'Sofia\'s somatic therapy background really shines through. She helped me understand the connection between trauma and movement patterns. Life-changing work.',
                        verified: true
                    },
                    {
                        id: 5,
                        author: 'Lisa Anderson',
                        authorAvatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=100&q=80',
                        rating: 5,
                        date: '3 weeks ago',
                        content: 'Working with Sofia in urban spaces opened my eyes to possibilities everywhere. Her approach is gentle yet powerful. Highly recommended.',
                        verified: true
                    },
                    {
                        id: 6,
                        author: 'James Wilson',
                        authorAvatar: 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=100&q=80',
                        rating: 4,
                        date: '1 month ago',
                        content: 'Great coach with deep knowledge of somatic practices. Sessions in London parks were excellent. Would love more availability.',
                        verified: true
                    }
                ]
            },
            {
                id: 3,
                name: 'Alex Thompson',
                location: 'Portland, USA',
                tier: 'mentorship',
                image: 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=400&q=80',
                bio: 'Focused on coach training and facilitation development. Helping practitioners transition into teaching roles.',
                specialties: ['coaching', 'outdoor'],
                rate: 100,
                available: true,
                rating: 4.7,
                reviewCount: 15,
                reviews: [
                    {
                        id: 7,
                        author: 'Rachel Green',
                        authorAvatar: 'https://images.unsplash.com/photo-1580489944761-15a19d654956?w=100&q=80',
                        rating: 5,
                        date: '2 weeks ago',
                        content: 'Alex\'s mentorship program transformed my coaching practice. His insights on facilitation are invaluable. Worth every penny.',
                        verified: true
                    },
                    {
                        id: 8,
                        author: 'Marcus Silva',
                        authorAvatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&q=80',
                        rating: 5,
                        date: '1 month ago',
                        content: 'Helped me transition from practitioner to teacher. Alex has a gift for helping coaches find their authentic voice.',
                        verified: true
                    },
                    {
                        id: 9,
                        author: 'Nina Patel',
                        authorAvatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&q=80',
                        rating: 4,
                        date: '2 months ago',
                        content: 'Excellent coach development program. Very thorough and practical. Some sessions felt a bit rushed but overall fantastic.',
                        verified: true
                    }
                ]
            },
            {
                id: 4,
                name: 'Maya Patel',
                location: 'Mumbai, India',
                tier: 'mastery',
                image: 'https://images.unsplash.com/photo-1580489944761-15a19d654956?w=400&q=80',
                bio: 'Integrating traditional practices with natural movement. Deep work in presence and embodiment.',
                specialties: ['outdoor', 'trauma'],
                rate: 60,
                available: false,
                rating: 4.9,
                reviewCount: 22,
                reviews: [
                    {
                        id: 10,
                        author: 'Raj Kumar',
                        authorAvatar: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&q=80',
                        rating: 5,
                        date: '3 weeks ago',
                        content: 'Maya brings ancient wisdom into modern practice seamlessly. Her integration of traditional techniques is profound.',
                        verified: true
                    },
                    {
                        id: 11,
                        author: 'Anna Kowalski',
                        authorAvatar: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&q=80',
                        rating: 5,
                        date: '1 month ago',
                        content: 'Deepest embodiment work I\'ve experienced. Maya creates sacred space for transformation.',
                        verified: true
                    }
                ]
            },
            {
                id: 5,
                name: 'JoÃ£o Santos',
                location: 'Rio de Janeiro, Brazil',
                tier: 'coach',
                image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&q=80',
                bio: 'Urban movement specialist. Creating training spaces in city environments. Group facilitation expert.',
                specialties: ['urban', 'coaching'],
                rate: 70,
                available: true,
                rating: 4.6,
                reviewCount: 18,
                reviews: [
                    {
                        id: 12,
                        author: 'Carlos Mendes',
                        authorAvatar: 'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=100&q=80',
                        rating: 5,
                        date: '1 week ago',
                        content: 'JoÃ£o transforms Rio\'s urban landscape into a movement playground. His energy is infectious!',
                        verified: true
                    },
                    {
                        id: 13,
                        author: 'Maria Silva',
                        authorAvatar: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=100&q=80',
                        rating: 4,
                        date: '2 weeks ago',
                        content: 'Great group sessions with excellent facilitation. Sometimes groups are a bit large but overall fantastic experience.',
                        verified: true
                    }
                ]
            },
            {
                id: 6,
                name: 'Emma Larsson',
                location: 'Stockholm, Sweden',
                tier: 'coach',
                image: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=400&q=80',
                bio: 'Nature-based movement practice. Seasonal training approaches. Working with cold exposure and adaptation.',
                specialties: ['outdoor'],
                rate: 85,
                available: true,
                rating: 4.8,
                reviewCount: 21,
                reviews: [
                    {
                        id: 14,
                        author: 'Erik Johansson',
                        authorAvatar: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&q=80',
                        rating: 5,
                        date: '4 days ago',
                        content: 'Emma\'s approach to cold exposure and seasonal training is revolutionary. Training in Swedish forests with her is magical.',
                        verified: true
                    },
                    {
                        id: 15,
                        author: 'Sarah Lindberg',
                        authorAvatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&q=80',
                        rating: 5,
                        date: '2 weeks ago',
                        content: 'Nature-based practice at its finest. Emma helps you understand adaptation in profound ways.',
                        verified: true
                    },
                    {
                        id: 16,
                        author: 'Thomas Berg',
                        authorAvatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&q=80',
                        rating: 4,
                        date: '1 month ago',
                        content: 'Excellent outdoor sessions. Very knowledgeable about seasonal training. Would appreciate more variety in locations.',
                        verified: true
                    }
                ]
            }
        ];

        /**
         * Render Coaches - UPDATED with API Integration (PASO 4b) + Performance Monitoring (PASO 4c)
         * Now fetches coaches from API with performance tracking
         */
        async function renderCoaches() {
            const grid = document.getElementById('coachesGrid');
            const emptyState = document.getElementById('coachesEmptyState');
            const loadingState = document.getElementById('coachesLoadingState');
            const errorState = document.getElementById('coachesErrorState');

            // Get current filters
            const searchTerm = document.getElementById('coachSearchInput')?.value.toLowerCase() || '';
            const levelFilter = document.getElementById('coachLevelFilter')?.value || 'all';
            const specialtyFilter = document.getElementById('coachSpecialtyFilter')?.value || 'all';

            // Start performance timer
            const perfTimer = perfMonitor.startTimer('renderCoaches');

            try {
                // Show loading state
                if (loadingState) loadingState.style.display = 'block';
                if (grid) grid.style.display = 'none';
                if (emptyState) emptyState.style.display = 'none';
                if (errorState) errorState.style.display = 'none';

                // Fetch coaches from API (or mock data if useMock = true)
                const coaches = await networkSim.apply(async () => {
                    return await coachAPI.fetchCoaches({
                        search: searchTerm,
                        level: levelFilter !== 'all' ? levelFilter : undefined,
                        specialty: specialtyFilter !== 'all' ? specialtyFilter : undefined
                    });
                });

                // Record successful API call
                perfMonitor.recordCall(perfTimer, true, API_CONFIG.useMock);

                // Client-side filtering (in case API doesn't support all filters)
                let filtered = coaches.filter(coach => {
                    const matchesSearch = searchTerm === '' || 
                        coach.name.toLowerCase().includes(searchTerm) || 
                        coach.location.toLowerCase().includes(searchTerm) ||
                        coach.bio.toLowerCase().includes(searchTerm);
                    const matchesLevel = levelFilter === 'all' || coach.tier === levelFilter;
                    const matchesSpecialty = specialtyFilter === 'all' || coach.specialties.includes(specialtyFilter);
                    
                    return matchesSearch && matchesLevel && matchesSpecialty;
                });

                // Hide loading state
                if (loadingState) loadingState.style.display = 'none';

                // Handle empty results
                if (filtered.length === 0) {
                    if (grid) grid.style.display = 'none';
                    if (emptyState) emptyState.style.display = 'block';
                    return;
                }

                // Show grid and hide empty state
                if (grid) grid.style.display = 'grid';
                if (emptyState) emptyState.style.display = 'none';

                // Render coach cards
                if (grid) {
                    grid.innerHTML = filtered.map(coach => `
                        <div class="coach-card" onclick="viewCoachProfile(${coach.id})">
                            <img src="${coach.image}" alt="${coach.name}" class="coach-card-image">
                            <div class="coach-card-content">
                                <div class="coach-card-header">
                                    <h3 class="coach-card-name">${coach.name}</h3>
                                    <div class="coach-rating">
                                        ${renderStarRating(coach.rating)}
                                        <span class="coach-rating-number">${coach.rating}</span>
                                        <span class="coach-rating-count">(${coach.reviewCount})</span>
                                    </div>
                                    <div class="coach-card-location">${coach.location}</div>
                                    <span class="coach-card-tier">${coach.tier === 'coach' ? 'Coach Certified' : coach.tier.charAt(0).toUpperCase() + coach.tier.slice(1)}</span>
                                </div>
                                <p class="coach-card-bio">${coach.bio}</p>
                                <div class="coach-card-specialties">
                                    ${coach.specialties.map(s => `
                                        <span class="coach-specialty-tag">${s.charAt(0).toUpperCase() + s.slice(1)}</span>
                                    `).join('')}
                                </div>
                                <div class="coach-card-footer">
                                    <div>
                                        <span class="coach-card-rate">â‚¬${coach.rate}</span>
                                        <span class="coach-card-rate-period">/session</span>
                                    </div>
                                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                        <button 
                                            class="coach-card-btn" 
                                            ${!coach.available ? 'disabled' : ''}
                                            onclick="event.stopPropagation(); ${coach.available ? `openBookingModal(${coach.id})` : ''}">
                                            ${coach.available ? 'Book Session' : 'Unavailable'}
                                        </button>
                                        <button 
                                            class="coach-card-btn" 
                                            style="background: var(--white); color: var(--black); border: 1.5px solid var(--black);"
                                            data-coach-id="${coach.id}"
                                            data-coach-name="${coach.name}"
                                            data-coach-location="${coach.location}"
                                            data-coach-image="${coach.image}"
                                            data-coach-specialties="${coach.specialties.join(',')}"
                                            onclick="event.stopPropagation(); openMentorshipRequestFromCard(this)">
                                            Request Mentorship
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                }

                console.log(`[RENDER COACHES] Successfully rendered ${filtered.length} coaches`);

            } catch (error) {
                console.error('[RENDER COACHES] Error:', error);
                
                // Record failed API call
                perfMonitor.recordCall(perfTimer, false);
                
                // Hide loading state
                if (loadingState) loadingState.style.display = 'none';
                
                // Show error state
                if (grid) grid.style.display = 'none';
                if (emptyState) emptyState.style.display = 'none';
                if (errorState) errorState.style.display = 'block';

                toast('Failed to load coaches. Please try again.', 'error');
            }
        }

        function filterCoaches() {
            renderCoaches();
        }

        function clearCoachFilters() {
            const searchInput = document.getElementById('coachSearchInput');
            const levelFilter = document.getElementById('coachLevelFilter');
            const specialtyFilter = document.getElementById('coachSpecialtyFilter');
            
            if (searchInput) searchInput.value = '';
            if (levelFilter) levelFilter.value = 'all';
            if (specialtyFilter) specialtyFilter.value = 'all';
            
            renderCoaches();
        }

        /**
         * View Coach Profile - UPDATED with API Integration (PASO 4b)
         * Now fetches coach details from API
         */
        async function viewCoachProfile(coachId) {
            try {
                console.log(`[VIEW PROFILE] Fetching coach ID: ${coachId}`);
                
                // Show loading toast
                toast('Loading coach profile...', 'info');

                // Fetch coach from API (or mock data if useMock = true)
                const coach = await coachAPI.fetchCoachById(coachId);
                
                if (!coach) {
                    toast('Coach not found', 'error');
                    return;
                }

                console.log(`[VIEW PROFILE] Successfully loaded: ${coach.name}`);
                toast(`Opening profile for ${coach.name}`, 'info');
                
                // Store for potential future use (e.g., detailed modal)
                currentCoachProfile = coach;

                // In production, this would open a detailed coach profile modal
                // For now, just show a toast with coach info
                
            } catch (error) {
                console.error('[VIEW PROFILE] Error:', error);
                toast('Failed to load coach profile', 'error');
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // COACH BOOKING MODAL SYSTEM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        let bookingData = {
            coachId: null,
            coach: null,
            selectedDate: null,
            selectedTime: null,
            sessionType: '',
            sessionLocation: '',
            goals: '',
            notes: '',
            currentStep: 1
        };

        /**
         * Open Booking Modal - UPDATED with API Integration (PASO 4b)
         * Now fetches coach details from API
         */
        async function openBookingModal(coachId) {
            try {
                console.log(`[BOOKING MODAL] Opening for coach ID: ${coachId}`);
                
                // Show loading state in modal (if needed)
                const modal = document.getElementById('bookingModal');
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';

                // Show loading overlay
                const modalContent = modal.querySelector('.booking-modal-content');
                if (modalContent) {
                    const loadingOverlay = document.createElement('div');
                    loadingOverlay.className = 'loading-overlay';
                    loadingOverlay.id = 'bookingLoadingOverlay';
                    loadingOverlay.innerHTML = `
                        <div class="loading-spinner-lg"></div>
                        <div class="loading-overlay-text">Loading coach details...</div>
                    `;
                    modalContent.appendChild(loadingOverlay);
                }

                // Fetch coach from API
                const coach = await coachAPI.fetchCoachById(coachId);
                
                if (!coach) {
                    toast('Coach not found', 'error');
                    closeBookingModal();
                    return;
                }

                // Remove loading overlay
                const loadingOverlay = document.getElementById('bookingLoadingOverlay');
                if (loadingOverlay) loadingOverlay.remove();

                // Reset booking data
                bookingData = {
                    coachId: coach.id,
                    coach: coach,
                    selectedDate: null,
                    selectedTime: null,
                    sessionType: '',
                    sessionLocation: '',
                    goals: '',
                    notes: '',
                    currentStep: 1
                };

                // Populate coach info in modal
                document.getElementById('bookingCoachAvatar').src = coach.image;
                document.getElementById('bookingCoachAvatar').alt = coach.name;
                document.getElementById('bookingCoachName').textContent = coach.name;
                document.getElementById('bookingCoachLocation').textContent = coach.location;

                // Initialize booking availability calendar
                bookingAvailabilityState.coachId = coachId;
                bookingAvailabilityState.currentWeekOffset = 0;
                bookingAvailabilityState.selectedSlot = null;
                await fetchCoachAvailability(coachId);
                generateDatePicker(); // Calls renderBookingAvailabilityCalendar internally

                // Reset to step 1
                setBookingStep(1);

                logEvent('booking_modal_opened', { coachId: coach.id, coachName: coach.name });
                console.log(`[BOOKING MODAL] Successfully loaded for ${coach.name}`);

            } catch (error) {
                console.error('[BOOKING MODAL] Error:', error);
                toast('Failed to open booking modal', 'error');
                closeBookingModal();
            }
        }

        function closeBookingModal() {
            const modal = document.getElementById('bookingModal');
            modal.classList.remove('active');
            document.body.style.overflow = '';

            logEvent('booking_modal_closed', { step: bookingData.currentStep });
        }

        function setBookingStep(step) {
            bookingData.currentStep = step;

            // Update step indicators
            document.querySelectorAll('.booking-step').forEach(stepEl => {
                const stepNum = parseInt(stepEl.dataset.step);
                stepEl.classList.remove('active', 'completed');
                
                if (stepNum === step) {
                    stepEl.classList.add('active');
                } else if (stepNum < step) {
                    stepEl.classList.add('completed');
                }
            });

            // Update step content
            document.querySelectorAll('.booking-body-step').forEach(stepEl => {
                stepEl.classList.remove('active');
            });
            document.querySelector(`.booking-body-step[data-step="${step}"]`).classList.add('active');

            // Update buttons
            const backBtn = document.getElementById('bookingBackBtn');
            const nextBtn = document.getElementById('bookingNextBtn');

            if (step === 1) {
                backBtn.style.display = 'none';
                nextBtn.textContent = 'Next';
                nextBtn.disabled = !bookingData.selectedDate || !bookingData.selectedTime;
            } else if (step === 2) {
                backBtn.style.display = 'block';
                nextBtn.textContent = 'Review';
                nextBtn.disabled = false;
            } else if (step === 3) {
                backBtn.style.display = 'block';
                nextBtn.textContent = 'Confirm Booking';
                nextBtn.disabled = false;
                updateBookingSummary();
            } else if (step === 4) {
                backBtn.style.display = 'none';
                nextBtn.textContent = 'Close';
                nextBtn.disabled = false;
            }
        }

        function nextBookingStep() {
            const step = bookingData.currentStep;

            if (step === 1) {
                // Validate date and time selection
                if (!bookingData.selectedDate || !bookingData.selectedTime) {
                    showNotification('Please select a date and time', 'error');
                    return;
                }
                setBookingStep(2);
            } else if (step === 2) {
                // Validate form fields
                if (!validateBookingForm()) {
                    return;
                }
                setBookingStep(3);
            } else if (step === 3) {
                // Submit booking
                submitBooking();
            } else if (step === 4) {
                // Close modal after confirmation
                closeBookingModal();
            }
        }

        function previousBookingStep() {
            const step = bookingData.currentStep;
            if (step > 1 && step <= 3) {
                setBookingStep(step - 1);
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AVAILABILITY CALENDAR SYSTEM - Calendly-Style
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        let availabilityState = {
            currentMonth: new Date(),
            selectedDate: null,
            selectedTime: null,
            coachId: null,
            availability: {} // { 'YYYY-MM-DD': ['08:00', '08:30', '09:00', ...] }
        };

        let bookingAvailabilityState = {
            currentMonth: new Date(),
            selectedDate: null,
            selectedTime: null,
            coachId: null,
            availability: {}
        };

        /**
         * Initialize coach profile availability calendar
         */
        async function initCoachAvailabilityCalendar(coachId) {
            availabilityState.coachId = coachId;
            availabilityState.currentMonth = new Date();
            availabilityState.selectedDate = null;
            availabilityState.selectedTime = null;
            
            await fetchCoachAvailability(coachId);
            renderMiniCalendar('availability');
            clearTimeSlots('availability');
        }

        /**
         * Fetch coach availability from API
         */
        async function fetchCoachAvailability(coachId) {
            try {
                console.log(`[AVAILABILITY] Fetching for coach ${coachId}`);
                
                const data = await coachAPI.fetchCoachAvailability(coachId);
                
                if (data && data.availability) {
                    availabilityState.availability = data.availability;
                    bookingAvailabilityState.availability = data.availability;
                } else {
                    const mockData = generateMockAvailability();
                    availabilityState.availability = mockData;
                    bookingAvailabilityState.availability = mockData;
                }
                
                console.log('[AVAILABILITY] Data loaded');
                
            } catch (error) {
                console.error('[AVAILABILITY] Fetch error:', error);
                const mockData = generateMockAvailability();
                availabilityState.availability = mockData;
                bookingAvailabilityState.availability = mockData;
            }
        }

        /**
         * Generate mock availability data
         */
        function generateMockAvailability() {
            const availability = {};
            const today = new Date();
            
            for (let dayOffset = 0; dayOffset < 60; dayOffset++) {
                const date = new Date(today);
                date.setDate(today.getDate() + dayOffset);
                const dateStr = formatDate(date);
                
                // Skip Sundays
                if (date.getDay() === 0) continue;
                
                const slots = [];
                for (let hour = 8; hour <= 18; hour++) {
                    for (let minute = 0; minute < 60; minute += 30) {
                        const timeStr = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                        
                        // 70% chance of being available
                        if (Math.random() < 0.7) {
                            slots.push(timeStr);
                        }
                    }
                }
                
                if (slots.length > 0) {
                    availability[dateStr] = slots;
                }
            }
            
            return availability;
        }

        /**
         * Render mini calendar
         */
        function renderMiniCalendar(context = 'availability') {
            const state = context === 'availability' ? availabilityState : bookingAvailabilityState;
            const containerId = context === 'availability' ? 'availabilityMiniCalendar' : 'bookingMiniCalendar';
            const container = document.getElementById(containerId);
            
            if (!container) return;
            
            const year = state.currentMonth.getFullYear();
            const month = state.currentMonth.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const prevLastDay = new Date(year, month, 0);
            
            const monthName = firstDay.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            
            // Build HTML
            let html = `
                <div class="mini-calendar-header">
                    <div class="mini-calendar-month">${monthName}</div>
                    <div class="mini-calendar-nav">
                        <button class="mini-calendar-nav-btn" onclick="navigateMonth(-1, '${context}')">â†</button>
                        <button class="mini-calendar-nav-btn" onclick="navigateMonth(1, '${context}')">â†’</button>
                    </div>
                </div>
                <div class="mini-calendar-grid">
            `;
            
            // Day headers
            const dayHeaders = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
            dayHeaders.forEach(day => {
                html += `<div class="mini-calendar-day-header">${day}</div>`;
            });
            
            // Empty cells for days before month starts
            const startDay = firstDay.getDay();
            for (let i = 0; i < startDay; i++) {
                const prevDate = prevLastDay.getDate() - startDay + i + 1;
                html += `<div class="mini-calendar-day other-month disabled">${prevDate}</div>`;
            }
            
            // Days of current month
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            for (let day = 1; day <= lastDay.getDate(); day++) {
                const date = new Date(year, month, day);
                date.setHours(0, 0, 0, 0);
                const dateStr = formatDate(date);
                
                const isPast = date < today;
                const isToday = date.getTime() === today.getTime();
                const isSelected = state.selectedDate === dateStr;
                const hasAvailability = state.availability[dateStr] && state.availability[dateStr].length > 0;
                
                let classes = ['mini-calendar-day'];
                if (isPast) classes.push('disabled');
                if (isToday) classes.push('today');
                if (isSelected) classes.push('selected');
                if (hasAvailability) classes.push('has-availability');
                if (!hasAvailability && !isPast) classes.push('unavailable');
                
                const clickHandler = (isPast || !hasAvailability) ? '' : `onclick="selectCalendarDate('${dateStr}', '${context}')"`;
                
                html += `<div class="${classes.join(' ')}" ${clickHandler}>${day}</div>`;
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        /**
         * Navigate months
         */
        function navigateMonth(direction, context = 'availability') {
            const state = context === 'availability' ? availabilityState : bookingAvailabilityState;
            
            state.currentMonth = new Date(
                state.currentMonth.getFullYear(),
                state.currentMonth.getMonth() + direction,
                1
            );
            
            renderMiniCalendar(context);
        }

        /**
         * Select date from calendar
         */
        function selectCalendarDate(dateStr, context = 'availability') {
            const state = context === 'availability' ? availabilityState : bookingAvailabilityState;
            
            state.selectedDate = dateStr;
            state.selectedTime = null;
            
            renderMiniCalendar(context);
            renderTimeSlots(dateStr, context);
            
            // Update button state
            if (context === 'availability') {
                document.getElementById('bookSelectedSlotBtn').disabled = true;
            } else {
                document.getElementById('bookingNextBtn').disabled = true;
            }
        }

        /**
         * Render time slots for selected date
         */
        function renderTimeSlots(dateStr, context = 'availability') {
            const state = context === 'availability' ? availabilityState : bookingAvailabilityState;
            const containerId = context === 'availability' ? 'availabilityTimeSlots' : 'bookingTimeSlotsList';
            const labelId = context === 'availability' ? 'availableTimesLabel' : 'bookingAvailableTimesLabel';
            const container = document.getElementById(containerId);
            const label = document.getElementById(labelId);
            
            if (!container) return;
            
            const slots = state.availability[dateStr] || [];
            
            // Update label
            if (label) {
                const date = new Date(dateStr);
                const dateLabel = date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                label.textContent = `Available Times â€“ ${dateLabel}`;
            }
            
            if (slots.length === 0) {
                container.innerHTML = `
                    <div style="padding: var(--space-4); text-align: center; color: var(--gray-500);">
                        No available times on this date
                    </div>
                `;
                return;
            }
            
            // Group slots by AM/PM
            const amSlots = slots.filter(time => {
                const hour = parseInt(time.split(':')[0]);
                return hour < 12;
            });
            const pmSlots = slots.filter(time => {
                const hour = parseInt(time.split(':')[0]);
                return hour >= 12;
            });
            
            let html = '';
            
            if (amSlots.length > 0) {
                amSlots.forEach(time => {
                    const isSelected = state.selectedTime === time;
                    html += `
                        <div class="availability-time-slot-item ${isSelected ? 'selected' : ''}"
                             onclick="selectTimeSlot('${time}', '${context}')">
                            ${formatTime(time)}
                        </div>
                    `;
                });
            }
            
            if (pmSlots.length > 0) {
                pmSlots.forEach(time => {
                    const isSelected = state.selectedTime === time;
                    html += `
                        <div class="availability-time-slot-item ${isSelected ? 'selected' : ''}"
                             onclick="selectTimeSlot('${time}', '${context}')">
                            ${formatTime(time)}
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html;
        }

        /**
         * Select time slot
         */
        function selectTimeSlot(time, context = 'availability') {
            const state = context === 'availability' ? availabilityState : bookingAvailabilityState;
            
            state.selectedTime = time;
            
            // Update UI
            const containerId = context === 'availability' ? 'availabilityTimeSlots' : 'bookingTimeSlotsList';
            document.querySelectorAll(`#${containerId} .availability-time-slot-item`).forEach(slot => {
                slot.classList.remove('selected');
            });
            event.target.classList.add('selected');
            
            // Enable button
            if (context === 'availability') {
                document.getElementById('bookSelectedSlotBtn').disabled = false;
            } else {
                // Update booking data
                bookingData.selectedDate = state.selectedDate;
                bookingData.selectedTime = state.selectedTime;
                document.getElementById('bookingNextBtn').disabled = false;
            }
        }

        /**
         * Clear time slots
         */
        function clearTimeSlots(context = 'availability') {
            const containerId = context === 'availability' ? 'availabilityTimeSlots' : 'bookingTimeSlotsList';
            const labelId = context === 'availability' ? 'availableTimesLabel' : 'bookingAvailableTimesLabel';
            const container = document.getElementById(containerId);
            const label = document.getElementById(labelId);
            
            if (label) {
                label.textContent = 'Select Time';
            }
            
            if (container) {
                container.innerHTML = `
                    <div style="padding: var(--space-4); text-align: center; color: var(--gray-500);">
                        Select a date to view available times
                    </div>
                `;
            }
        }

        /**
         * Book selected slot from coach profile
         */
        function bookSelectedSlot() {
            if (!availabilityState.selectedDate || !availabilityState.selectedTime) return;
            
            // Set booking data
            bookingData.selectedDate = availabilityState.selectedDate;
            bookingData.selectedTime = availabilityState.selectedTime;
            
            // Open booking modal at step 2
            openBookingModal(availabilityState.coachId);
            
            setTimeout(() => {
                bookingAvailabilityState.selectedDate = availabilityState.selectedDate;
                bookingAvailabilityState.selectedTime = availabilityState.selectedTime;
                renderMiniCalendar('booking');
                if (bookingAvailabilityState.selectedDate) {
                    renderTimeSlots(bookingAvailabilityState.selectedDate, 'booking');
                }
                setBookingStep(2);
            }, 200);
        }

        /**
         * Helper: Format date as YYYY-MM-DD
         */
        function formatDate(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        /**
         * Helper: Format time for display (e.g., "09:00" -> "9:00 AM")
         */
        function formatTime(time) {
            const [hour, minute] = time.split(':').map(Number);
            const period = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;
            return `${displayHour}:${minute.toString().padStart(2, '0')} ${period}`;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // LEGACY BOOKING MODAL FUNCTIONS (backward compatibility)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function generateDatePicker() {
            // Now replaced by renderMiniCalendar('booking')
            if (bookingData && bookingData.coachId) {
                bookingAvailabilityState.coachId = bookingData.coachId;
                bookingAvailabilityState.currentMonth = new Date();
                bookingAvailabilityState.selectedDate = null;
                bookingAvailabilityState.selectedTime = null;
                renderMiniCalendar('booking');
                clearTimeSlots('booking');
            }
        }

        function selectDate(dateStr) {
            console.log('[LEGACY] selectDate called:', dateStr);
        }

        function generateTimeSlots(dateStr) {
            console.log('[LEGACY] generateTimeSlots called:', dateStr);
        }

        function selectTimeSlot(time) {
            console.log('[LEGACY] selectTimeSlot called:', time);
        }

        function validateBookingForm() {
            const sessionType = document.getElementById('sessionType').value;
            const sessionLocation = document.getElementById('sessionLocation').value;
            const goals = document.getElementById('sessionGoals').value.trim();

            if (!sessionType) {
                showNotification('Please select a session type', 'error');
                return false;
            }

            if (!sessionLocation) {
                showNotification('Please select a session location', 'error');
                return false;
            }

            if (!goals) {
                showNotification('Please describe your goals and focus areas', 'error');
                return false;
            }

            // Save form data
            bookingData.sessionType = sessionType;
            bookingData.sessionLocation = sessionLocation;
            bookingData.goals = goals;
            bookingData.notes = document.getElementById('sessionNotes').value.trim();

            return true;
        }

        function updateBookingSummary() {
            const coach = bookingData.coach;
            const date = new Date(bookingData.selectedDate);
            const dateStr = date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                month: 'long', 
                day: 'numeric',
                year: 'numeric'
            });

            const sessionTypeLabels = {
                'intro': 'Introduction Session (30 min)',
                'regular': 'Regular Session (60 min)',
                'deep': 'Deep Dive Session (90 min)'
            };

            const locationLabels = {
                'online': 'Online (Video Call)',
                'in-person': 'In-Person'
            };

            document.getElementById('summaryCoachName').textContent = coach.name;
            document.getElementById('summaryDateTime').textContent = `${dateStr} at ${bookingData.selectedTime}`;
            document.getElementById('summarySessionType').textContent = sessionTypeLabels[bookingData.sessionType] || bookingData.sessionType;
            document.getElementById('summaryLocation').textContent = locationLabels[bookingData.sessionLocation] || bookingData.sessionLocation;
            document.getElementById('summaryPrice').textContent = `â‚¬${coach.rate}`;
        }

        /**
         * Submit Booking - UPDATED with API Integration (PASO 4b)
         * Now creates booking via API
         */
        async function submitBooking() {
            const nextBtn = document.getElementById('bookingNextBtn');
            nextBtn.classList.add('loading');
            nextBtn.disabled = true;

            try {
                console.log('[SUBMIT BOOKING] Creating booking...', bookingData);

                // Prepare booking data for API
                const bookingPayload = {
                    coachId: bookingData.coachId,
                    date: bookingData.selectedDate,
                    time: bookingData.selectedTime,
                    sessionType: bookingData.sessionType,
                    location: bookingData.sessionLocation,
                    goals: bookingData.goals,
                    notes: bookingData.notes
                };

                // Create booking via API
                const result = await coachAPI.createBooking(bookingPayload);

                console.log('[SUBMIT BOOKING] Booking created successfully:', result);

                nextBtn.classList.remove('loading');
                
                // Show confirmation screen
                setBookingStep(4);

                // Update confirmation screen with booking ID if available
                if (result.bookingId) {
                    const confirmationText = document.querySelector('.booking-confirmation-text');
                    if (confirmationText) {
                        const bookingIdElement = document.createElement('div');
                        bookingIdElement.className = 'booking-id';
                        bookingIdElement.style.cssText = 'margin-top: 16px; padding: 12px; background: var(--gray-50); border-radius: 8px; font-size: 14px; font-weight: 600;';
                        bookingIdElement.textContent = `Booking ID: ${result.bookingId}`;
                        confirmationText.appendChild(bookingIdElement);
                    }
                }

                // Log event
                logEvent('booking_confirmed', {
                    coachId: bookingData.coachId,
                    coachName: bookingData.coach.name,
                    date: bookingData.selectedDate,
                    time: bookingData.selectedTime,
                    sessionType: bookingData.sessionType,
                    location: bookingData.sessionLocation,
                    bookingId: result.bookingId || 'N/A'
                });

                // Show success notification
                showNotification(
                    'Booking Confirmed!',
                    'You will receive a confirmation email shortly.'
                );

            } catch (error) {
                console.error('[SUBMIT BOOKING] Error:', error);
                
                nextBtn.classList.remove('loading');
                nextBtn.disabled = false;

                // Show error message
                toast('Failed to create booking. Please try again.', 'error');
                
                // Could also show a more detailed error state here
                showNotification(
                    'Booking Failed',
                    'There was an error processing your booking. Please try again or contact support.',
                    'error'
                );
            }
        }

        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const modal = document.getElementById('bookingModal');
                if (modal.classList.contains('active')) {
                    closeBookingModal();
                }
            }
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // COACH REVIEWS SYSTEM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        let currentCoachProfile = null;
        let currentProfileTab = 'about';

        function renderStarRating(rating, large = false) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            
            let starsHTML = '';
            
            // Full stars
            for (let i = 0; i < fullStars; i++) {
                starsHTML += `
                    <svg class="star filled" viewBox="0 0 24 24">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                `;
            }
            
            // Half star
            if (hasHalfStar) {
                starsHTML += `
                    <svg class="star half" viewBox="0 0 24 24">
                        <defs>
                            <linearGradient id="half-star-gradient">
                                <stop offset="50%" stop-color="#FFC107"/>
                                <stop offset="50%" stop-color="var(--gray-300)"/>
                            </linearGradient>
                        </defs>
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                `;
            }
            
            // Empty stars
            for (let i = 0; i < emptyStars; i++) {
                starsHTML += `
                    <svg class="star" viewBox="0 0 24 24">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                `;
            }
            
            return `<div class="star-rating ${large ? 'star-rating-large' : ''}">${starsHTML}</div>`;
        }

        function viewCoachProfile(coachId) {
            const coach = mockCoaches.find(c => c.id === coachId);
            if (!coach) return;

            currentCoachProfile = coach;
            currentProfileTab = 'about';

            // Populate coach info
            document.getElementById('profileCoachAvatar').src = coach.image;
            document.getElementById('profileCoachAvatar').alt = coach.name;
            document.getElementById('profileCoachName').textContent = coach.name;
            document.getElementById('profileCoachLocation').textContent = coach.location;
            document.getElementById('profileStarRating').innerHTML = renderStarRating(coach.rating, true).replace('<div class="star-rating star-rating-large">', '').replace('</div>', '');
            document.getElementById('profileRatingNumber').textContent = coach.rating.toFixed(1);
            document.getElementById('profileRatingCount').textContent = `(${coach.reviewCount} reviews)`;
            document.getElementById('profileReviewsTabCount').textContent = `(${coach.reviewCount})`;

            // About tab
            document.getElementById('profileCoachBio').textContent = coach.bio;
            document.getElementById('profileCoachSpecialties').innerHTML = coach.specialties.map(s => 
                `<span class="coach-specialty-tag">${s.charAt(0).toUpperCase() + s.slice(1)}</span>`
            ).join('');
            document.getElementById('profileCoachRate').textContent = coach.rate;

            // Reviews tab
            renderCoachReviews();

            // Show modal
            const modal = document.getElementById('coachProfileModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';

            // Reset to about tab
            switchCoachProfileTab('about');

            logEvent('coach_profile_opened', { coachId: coach.id, coachName: coach.name });
        }

        function closeCoachProfileModal() {
            const modal = document.getElementById('coachProfileModal');
            modal.classList.remove('active');
            document.body.style.overflow = '';
            currentCoachProfile = null;

            logEvent('coach_profile_closed');
        }

        function switchCoachProfileTab(tab) {
            currentProfileTab = tab;

            // Update tabs
            document.querySelectorAll('.coach-profile-tab').forEach(t => {
                t.classList.remove('active');
            });
            document.querySelector(`.coach-profile-tab[data-tab="${tab}"]`).classList.add('active');

            // Update sections
            document.querySelectorAll('.coach-profile-section').forEach(s => {
                s.classList.remove('active');
            });
            document.querySelector(`.coach-profile-section[data-section="${tab}"]`).classList.add('active');

            // Initialize availability calendar when switching to availability tab
            if (tab === 'availability' && currentCoachProfile) {
                initCoachAvailabilityCalendar(currentCoachProfile.id);
            }

            logEvent('coach_profile_tab_switched', { tab });
        }

        function renderCoachReviews() {
            if (!currentCoachProfile) return;

            const coach = currentCoachProfile;
            const reviewsList = document.getElementById('reviewsList');

            // Update overview
            document.getElementById('reviewsOverviewRating').textContent = coach.rating.toFixed(1);
            document.getElementById('reviewsOverviewStars').innerHTML = renderStarRating(coach.rating, true).replace('<div class="star-rating star-rating-large">', '').replace('</div>', '');
            document.getElementById('reviewsOverviewLabel').textContent = `Based on ${coach.reviewCount} reviews`;

            // Render reviews
            if (!coach.reviews || coach.reviews.length === 0) {
                reviewsList.innerHTML = `
                    <div class="reviews-empty">
                        <div class="reviews-empty-icon">ğŸ’¬</div>
                        <h3 class="reviews-empty-title">No Reviews Yet</h3>
                        <p class="reviews-empty-message">
                            Be the first to share your experience with ${coach.name.split(' ')[0]}!
                        </p>
                        <button class="write-review-btn" onclick="showNotification('Write Review', 'Review system coming soon in production!')">
                            Write First Review
                        </button>
                    </div>
                `;
                return;
            }

            reviewsList.innerHTML = coach.reviews.map(review => `
                <div class="review-card">
                    <div class="review-header">
                        <img src="${review.authorAvatar}" alt="${review.author}" class="review-avatar">
                        <div class="review-author-info">
                            <div class="review-author">${review.author}</div>
                            <div class="review-meta">
                                ${review.verified ? `
                                    <span class="review-verified">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                        </svg>
                                        Verified Session
                                    </span>
                                ` : ''}
                                <span>${review.date}</span>
                            </div>
                        </div>
                    </div>
                    <div class="review-rating-display">
                        ${renderStarRating(review.rating)}
                    </div>
                    <p class="review-content">${review.content}</p>
                </div>
            `).join('');
        }

        function openBookingFromProfile() {
            if (!currentCoachProfile) return;
            
            closeCoachProfileModal();
            
            // Small delay to let profile modal close
            setTimeout(() => {
                openBookingModal(currentCoachProfile.id);
            }, 300);
        }

        // Close profile modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const profileModal = document.getElementById('coachProfileModal');
                if (profileModal && profileModal.classList.contains('active')) {
                    closeCoachProfileModal();
                }
            }
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // IMPROVED ERROR HANDLING & ACTIVITY INDICATORS (FASE 6)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function showLoadingButton(buttonElement) {
            if (!buttonElement) return;
            buttonElement.classList.add('loading');
            buttonElement.disabled = true;
        }

        function hideLoadingButton(buttonElement) {
            if (!buttonElement) return;
            buttonElement.classList.remove('loading');
            buttonElement.disabled = false;
        }

        function showLoadingOverlay(containerElement, message = 'Loading...') {
            if (!containerElement) return;
            
            const overlay = document.createElement('div');
            overlay.className = 'loading-overlay';
            overlay.innerHTML = `
                <div class="spinner-dark"></div>
                <div class="loading-text">${message}</div>
            `;
            containerElement.style.position = 'relative';
            containerElement.appendChild(overlay);
            
            return overlay;
        }

        function hideLoadingOverlay(overlay) {
            if (overlay && overlay.parentNode) {
                overlay.parentNode.removeChild(overlay);
            }
        }

        // Improved error handler with better user feedback
        function handleError(error, context = 'Operation') {
            console.error(`${context} failed:`, error);
            
            let userMessage = `${context} failed. `;
            
            if (error.message) {
                if (error.message.includes('storage')) {
                    userMessage += 'Storage limit reached. Try removing old content.';
                } else if (error.message.includes('network')) {
                    userMessage += 'Check your connection and try again.';
                } else {
                    userMessage += error.message;
                }
            } else {
                userMessage += 'Please try again.';
            }
            
            showToast(userMessage, 'error');
        }

        // Example: Enhanced post creation with loading states
        async function createPostWithLoading() {
            const submitBtn = document.querySelector('#newPostModal .btn-primary');
            const modalBody = document.querySelector('#newPostModal .modal-body');
            
            try {
                showLoadingButton(submitBtn);
                const overlay = showLoadingOverlay(modalBody, 'Creating reflection...');
                
                // Simulate async operation
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Original createPost logic here
                // createPost();
                
                hideLoadingOverlay(overlay);
                hideLoadingButton(submitBtn);
                
                showToast('Reflection shared successfully', 'success');
            } catch (error) {
                hideLoadingButton(submitBtn);
                handleError(error, 'Post creation');
            }
        }
        
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // CONSOLE LOG
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        console.log('HUDEN TRIBE v28 - MENTORSHIP, WISDOM & POLISH');
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        console.log('âœ“ Nike Run Club design patterns');
        console.log('âœ“ Mobile + Desktop optimized');
        console.log('âœ“ Black, White, Gray only (NO chocolate orange)');
        console.log('âœ“ All content in English');
        console.log('âœ“ ROLE SELECTOR - Press Ctrl+R to test different tiers');
        console.log('âœ“ ONBOARDING RESET - Press Ctrl+Shift+O to reset wizard');
        console.log('');
        console.log('NEW IN v28 - MENTORSHIP, WISDOM & POLISH:');
        console.log('âœ“ GUIDE Tab - Find Your Coach (6 mock coaches)');
        console.log('âœ“ Coach filters - Search, level, specialty');
        console.log('âœ“ Coach cards - Nike-style clean design');
        console.log('âœ“ COACH BOOKING MODAL - 3-step booking system');
        console.log('  â†’ Step 1: Date & Time selection with calendar picker');
        console.log('  â†’ Step 2: Session details form (type, location, goals)');
        console.log('  â†’ Step 3: Booking summary & confirmation');
        console.log('  â†’ Full validation, loading states, success screen');
        console.log('âœ“ COACH REVIEWS SYSTEM - Full rating & review display (NEW!)');
        console.log('  â†’ Star ratings on coach cards (4.6-4.9 stars)');
        console.log('  â†’ Coach profile modal with tabs (About, Reviews, Availability)');
        console.log('  â†’ 122 total reviews across 6 coaches');
        console.log('  â†’ Verified session badges, avatars, dates');
        console.log('  â†’ Empty states & write review button');
        console.log('âœ“ Activity indicators - Spinners and loaders');
        console.log('âœ“ Improved error handling - Better user feedback');
        console.log('âœ“ Enhanced empty states - Visual elements & CTAs');
        console.log('âœ“ Loading overlays - For async operations');
        console.log('âœ“ Button loading states - Inline spinners');
        console.log('âœ“ WISDOM LIBRARY - 12 articles across 4 categories');
        console.log('âœ“ Category filtering - Philosophy, Movement, Community, Coaching');
        console.log('âœ“ Nike-style cards - Brutal typography & clean design');
        console.log('âœ“ Performance optimizations - Smoother UX');
        console.log('');
        console.log('NEW IN v27 - RITUAL & CEREMONY (FASE 4):');
        console.log('âœ“ Milestone Celebrations - First post, week one, month one');
        console.log('âœ“ Completion Ceremonies - Flow Path & Mastery Path completions');
        console.log('âœ“ Seasonal Transitions - Spring, Summer, Autumn, Winter markers');
        console.log('âœ“ Journey Stats - Track days, reflections, packs joined');
        console.log('âœ“ Sacred Moments - Full-screen immersive ritual overlays');
        console.log('âœ“ Contemplative Language - Anti-performance milestone messaging');
        console.log('âœ“ Share Rituals - Option to post milestone moments to feed');
        console.log('âœ“ Auto-detection - Milestones trigger automatically');
        console.log('âœ“ Seasonal Themes - Visual themes for each season transition');
        console.log('');
        console.log('v26 - EVENT ORGANIZATION (FASE 3):');
        console.log('âœ“ Pack Calendar - Visual calendar with training events');
        console.log('âœ“ Event Creation - Post training sessions and gatherings');
        console.log('âœ“ RSVP System - Confirm attendance to events');
        console.log('âœ“ Event Cards - Horizontal Nike Run Club style layout');
        console.log('âœ“ Event Images - Featured images for each training session');
        console.log('âœ“ Session Linking - Connect events to Flow/Mastery days');
        console.log('âœ“ Month Navigation - Browse past and future events');
        console.log('âœ“ Event Persistence - localStorage event storage');
        console.log('âœ“ Pack Integration - Events linked to specific packs');
        console.log('âœ“ Nike Aesthetics - Brutal typography, generous spacing, pill buttons');
        console.log('');
        console.log('v25 - TRAINING INTEGRATION:');
        console.log('âœ“ Session Tags - Link posts to specific Flow/Mastery days');
        console.log('âœ“ Practice Partner Finder - Find who\'s on the same training day');
        console.log('âœ“ "Today\'s Practice" filter - View session-linked posts');
        console.log('âœ“ Session Discussion Threads - Day-specific reflections');
        console.log('âœ“ Day Progress Badges - Visual indicators (Flow Day X, Mastery Day Y)');
        console.log('');
        console.log('v24 - WELCOME WIZARD & ONBOARDING:');;
        console.log('âœ“ 5-step onboarding flow for first-time users');
        console.log('âœ“ Philosophy introduction (observe, presence, balance)');
        console.log('âœ“ Archetype selection quiz (Gorilla, Gibbon, Orangutan, Chimpanzee)');
        console.log('âœ“ Profile creation (name, location, personal statement)');
        console.log('âœ“ Practice focus setup (current path, exploration areas)');
        console.log('âœ“ Pack suggestions based on location');
        console.log('âœ“ User profile stored in localStorage (hudenUserProfile)');
        console.log('âœ“ Prevents empty feed confusion on first visit');
        console.log('âœ“ Sets context for anti-performance philosophy');
        console.log('âœ“ Progressive disclosure (doesn\'t overwhelm new users)');
        console.log('âœ“ Smooth animations and progress tracking');
        console.log('âœ“ Mobile-responsive wizard design');
        console.log('');
        console.log('NEW IN v25 - TRAINING INTEGRATION:');
        console.log('âœ“ Session Tags - Link posts to specific Flow/Mastery days');
        console.log('âœ“ Practice Partner Finder - Find who\'s on the same training day');
        console.log('âœ“ "Today\'s Practice" filter - View session-linked posts');
        console.log('âœ“ Session Discussion Threads - Day-specific reflections');
        console.log('âœ“ Day Progress Badges - Visual indicators (Flow Day X, Mastery Day Y)');
        console.log('âœ“ Flow Path: 48 days | Mastery Path: 96 days');
        console.log('âœ“ Connect with practitioners on same journey point');
        console.log('âœ“ Deep integration between training and community');
        console.log('');
        console.log('v24 - WELCOME WIZARD & ONBOARDING:');
        console.log('âœ“ 5-step onboarding flow for first-time users');
        console.log('âœ“ Philosophy introduction (observe, presence, balance)');
        console.log('âœ“ Archetype selection quiz (Gorilla, Gibbon, Orangutan, Chimpanzee)');
        console.log('âœ“ Profile creation (name, location, personal statement)');
        console.log('âœ“ Practice focus setup (current path, exploration areas)');
        console.log('âœ“ Pack suggestions based on location');
        console.log('âœ“ User profile stored in localStorage (hudenUserProfile)');
        console.log('âœ“ Prevents empty feed confusion on first visit');
        console.log('âœ“ Sets context for anti-performance philosophy');
        console.log('âœ“ Progressive disclosure (doesn\'t overwhelm new users)');
        console.log('âœ“ Smooth animations and progress tracking');
        console.log('âœ“ Mobile-responsive wizard design');
        console.log('');
        console.log('v23.1 - TRIBE OPTIMIZATIONS:');
        console.log('âœ“ Wisdom Library: Clean knowledge base interface');
        console.log('âœ“ Nike aesthetic: Minimal, bold typography');
        console.log('âœ“ Discussion cards: WHITE cards with clean styling');
        console.log('âœ“ Buttons: Normal styling (black on white)');
        console.log('âœ“ Community-focused features');
        console.log('');
        console.log('v23 - WISDOM LIBRARY SACRED SPACE:');
        console.log('âœ“ Threshold modal on first visit (ritual entrance)');
        console.log('âœ“ Pack-style grid layout (1/2/3 columns responsive)');
        console.log('âœ“ Compact cards with image preview (160px height)');
        console.log('âœ“ Optimized for multiple discussions on screen');
        console.log('âœ“ "Popular" eliminated â†’ "Active Inquiries" (anti-performance)');
        console.log('âœ“ "My Posts" â†’ "Your Reflections" (less ego-centric)');
        console.log('âœ“ "Start Discussion" â†’ "Share Teaching" (contemplative language)');
        console.log('âœ“ "Comments" â†’ "Reflections" (contemplative language)');
        console.log('âœ“ Image upload in discussions (native file input + preview)');
        console.log('âœ“ Automatic image compression (1200px width, 70% quality, JPEG)');
        console.log('âœ“ localStorage quota management (graceful degradation)');
        console.log('âœ“ Comment indicators in discussion cards ("Active reflection â†’")');
        console.log('âœ“ Counters REMOVED (no views, no comment counts)');
        console.log('âœ“ Darker theme (#171717 background) for sacred space feel');
        console.log('âœ“ Active Inquiries = discussions with activity in last 7 days');
        console.log('âœ“ localStorage tracking for first-visit threshold');
        console.log('âœ“ Modal optimized: 680px width, generous spacing, Nike proportions');
        console.log('âœ“ All toast messages use contemplative language');
        console.log('');
        console.log('NEW IN v23 - NIKE RUN CLUB OPTIMIZATIONS:');
        console.log('âœ“ Typography: Hero weight 950, tighter letter-spacing');
        console.log('âœ“ Buttons: 14px 28px padding, pill-shaped, smoother hover');
        console.log('âœ“ Cards: 0.5px borders (subtle), 4px hover lift, slower transitions');
        console.log('âœ“ Feed filters: 10px 24px padding, weight 700, better active state');
        console.log('âœ“ Generous spacing: gap increased from 32px to 40px');
        console.log('âœ“ Smooth transforms: translateY(-4px) on hover');
        console.log('');
        console.log('NEW IN v22.1 - ROLE SELECTOR:');
        console.log('âœ“ Keyboard shortcut: Ctrl+R');
        console.log('âœ“ Toggle show/hide functionality');
        console.log('âœ“ Functional tier switching (Essential, Flow, Mastery, Mentorship, Coach)');
        console.log('âœ“ Visual indicator of active role');
        console.log('âœ“ localStorage persistence');
        console.log('âœ“ Real-time UI updates on role change');
        console.log('âœ“ Nike brutal minimal design');
        console.log('âœ“ ESC key also closes selector');
        console.log('');
        console.log('v22 - FEED CRITICAL UPDATES:');
        console.log('âœ“ "Share Reflection" button (not "New Post")');
        console.log('âœ“ NO COUNTERS in footer - Qualitative language');
        console.log('âœ“ Avatar clickable â†’ opens user profile');
        console.log('âœ“ Archetipos FIRST (before text content)');
        console.log('âœ“ Footer: "Active discussion â†’" / "Start conversation â†’"');
        console.log('âœ“ Hover states on action invites');
        console.log('âœ“ Aligned with anti-performance philosophy');
        console.log('');
        console.log('v21 - USER PROFILE REDESIGN:');
        console.log('âœ“ Compact 100px avatar (down from 160px)');
        console.log('âœ“ Brutal typography - 36px name');
        console.log('âœ“ Archetype display (Gibbon Â· Orangutan Â· Tier)');
        console.log('âœ“ Personal statement (italic, practice-focused)');
        console.log('âœ“ Journey section (time, tier, location)');
        console.log('âœ“ NO COUNTERS - Qualitative presence only');
        console.log('âœ“ NO ARROWS - Clean, minimal design');
        console.log('âœ“ Practice focus section');
        console.log('âœ“ "Connect" CTA (not "Message")');
        console.log('âœ“ Aligned with anti-performance philosophy');
        console.log('');
        console.log('v15 - IMAGE UPLOAD:');
        console.log('âœ“ Native file input (accept="image/*")');
        console.log('âœ“ Visual preview with remove button');
        console.log('âœ“ File validation (type & 10MB limit)');
        console.log('âœ“ Automatic compression (1200px, 70% JPEG quality)');
        console.log('âœ“ localStorage quota management');
        console.log('âœ“ Mobile camera integration');
        console.log('âœ“ Nike-style design for upload UI');
        console.log('');
        console.log('v14 - ARCHETYPE SELECTOR:');
        console.log('âœ“ Gorilla - Power & Ground');
        console.log('âœ“ Gibbon - Flow & Suspension');
        console.log('âœ“ Orangutan - Integration & Core');
        console.log('âœ“ Chimpanzee - Play & Explosiveness');
        console.log('âœ“ Multi-select enabled');
        console.log('âœ“ Nike pill-style buttons');
        console.log('âœ“ Integrated in New Post modal');
        console.log('');
        console.log('INBOX SYSTEM:');
        console.log('âœ“ 1-on-1 DMs (Mastery+)');
        console.log('âœ“ Pack Chat (Flow+)');
        console.log('âœ“ Tier-based permissions');
        console.log('âœ“ Global rate limiting (2s)');
        console.log('âœ“ Hash routing with deep linking');
        console.log('âœ“ localStorage persistence');
        console.log('âœ“ Unread badges');
        console.log('âœ“ Auto-scroll on send');
        console.log('');
        console.log('WISDOM LIBRARY:');
        console.log('âœ“ Tier restrictions (Mentorship/Coach only)');
        console.log('âœ“ Full CRUD - Create, Read, Update, Delete');
        console.log('âœ“ Comment system with persistence');
        console.log('âœ“ Search & filter functionality');
        console.log('âœ“ NO LIKES - Anti-performance philosophy');
        console.log('');
        console.log('ACCESSIBILITY:');
        console.log('âœ“ ARIA attributes on all tabs');
        console.log('âœ“ Focus management in modals');
        console.log('âœ“ Keyboard navigation (ESC to close)');
        console.log('');
        console.log('CORE IMPROVEMENTS:');
        console.log('âœ“ Map invalidateSize() fix');
        console.log('âœ“ Toast stacking prevention');
        console.log('âœ“ Empty state improvements');
        console.log('âœ“ Tier fallback to "flow"');
        console.log('âœ“ Complete hash routing support');
        console.log('');
        console.log('API INTEGRATION (PASO 4):');
        console.log('âœ“ PASO 4a: API Service Layer with retry logic');
        console.log('âœ“ PASO 4b: UI Integration with loading/error states');
        console.log('âœ“ PASO 4c: Testing tools & Performance monitoring');
        console.log('âœ“ Mock/Real toggle ready for production');
        console.log('âœ“ Automatic fallback to mock data on errors');
        console.log('âœ“ Network simulation for testing');
        console.log('âœ“ Performance metrics tracking');
        console.log('âœ“ Developer tools available (hudenDevTools)');
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');


        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PRODUCTION DEPLOYMENT CHECKLIST - PASO 4c
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        /**
         * Pre-Deployment Checklist
         * Run this before deploying to production
         */
        function runPreDeploymentChecklist() {
            console.log(`
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš€ PRODUCTION DEPLOYMENT CHECKLIST - HUDEN TRIBE v29
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CONFIGURATION:
${API_CONFIG.useMock ? 'âŒ API_CONFIG.useMock = true (MUST SET TO FALSE FOR PRODUCTION)' : 'âœ… API_CONFIG.useMock = false'}
${API_CONFIG.baseURL.includes('localhost') || API_CONFIG.baseURL.includes('127.0.0.1') ? 'âŒ API_CONFIG.baseURL points to localhost' : 'âœ… API_CONFIG.baseURL configured'}

API ENDPOINTS TO TEST:
â–¡ GET  ${API_CONFIG.baseURL}${API_CONFIG.endpoints.coaches}
â–¡ GET  ${API_CONFIG.baseURL}${API_CONFIG.endpoints.coachById.replace(':id', '1')}
â–¡ GET  ${API_CONFIG.baseURL}${API_CONFIG.endpoints.coachReviews.replace(':id', '1')}
â–¡ GET  ${API_CONFIG.baseURL}${API_CONFIG.endpoints.coachAvailability.replace(':id', '1')}
â–¡ POST ${API_CONFIG.baseURL}${API_CONFIG.endpoints.bookings}
â–¡ POST ${API_CONFIG.baseURL}${API_CONFIG.endpoints.reviews}

PRE-DEPLOYMENT STEPS:
1. â–¡ Set API_CONFIG.useMock = false
2. â–¡ Configure production API_CONFIG.baseURL
3. â–¡ Test all endpoints with real API
4. â–¡ Run: hudenDevTools.testAll()
5. â–¡ Verify error handling with: hudenDevTools.testErrors()
6. â–¡ Test retry logic with: hudenDevTools.testRetry()
7. â–¡ Check performance: hudenDevTools.perfReport()
8. â–¡ Test with slow network: hudenDevTools.slow()
9. â–¡ Test offline fallback: hudenDevTools.offline()
10. â–¡ Remove or disable dev tools for production (optional)

TESTING COMMANDS (Run in console):
  hudenDevTools.testAll()      // Test all endpoints
  hudenDevTools.perfReport()   // Check performance
  hudenDevTools.slow()         // Test slow network
  hudenDevTools.offline()      // Test offline mode
  hudenDevTools.networkOff()   // Reset network simulation

PRODUCTION CONFIGURATION:
// In production, set these values:
API_CONFIG.useMock = false;
API_CONFIG.baseURL = 'https://api.huden.movement/v1'; // Your production URL

OPTIONAL OPTIMIZATIONS FOR PRODUCTION:
1. Remove or comment out dev tools initialization
2. Minimize console logging
3. Remove network simulator
4. Consider adding Sentry/error tracking
5. Add analytics for API performance

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            `);
        }

        // Expose checklist function
        window.hudenDevTools.deployCheck = runPreDeploymentChecklist;

        // Auto-run checklist in console if NOT in mock mode
        if (!API_CONFIG.useMock) {
            console.warn('âš ï¸  PRODUCTION MODE DETECTED - Running deployment checklist...');
            runPreDeploymentChecklist();
        }



        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // VIDEO CALLS SYSTEM (v31)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        let localStream = null;
        let remoteStream = null;
        let isMicMuted = false;
        let isVideoMuted = false;
        let selectedTimeSlot = null;

        function startVideoCall(clientId) {
            const videoContainer = document.getElementById('videoCallContainer');
            const videoGrid = document.getElementById('videoGrid');
            const remoteWrapper = document.getElementById('remoteVideoWrapper');
            
            videoContainer.classList.add('active');
            videoGrid.classList.remove('single');
            videoGrid.classList.add('dual');
            remoteWrapper.style.display = 'block';
            
            showToast(`Connecting to ${clientId}...`);
            
            setTimeout(() => {
                showToast('Video call connected');
                document.getElementById('remoteName').textContent = clientId.replace(/-/g, ' ');
            }, 1500);
        }

        function toggleMicrophone() {
            isMicMuted = !isMicMuted;
            const micBtn = document.getElementById('toggleMicBtn');
            const micStatus = document.getElementById('localMicStatus');
            
            micBtn.classList.toggle('active', !isMicMuted);
            micStatus.classList.toggle('muted', isMicMuted);
            micBtn.textContent = isMicMuted ? 'ğŸ”‡' : 'ğŸ¤';
            
            showToast(isMicMuted ? 'Microphone muted' : 'Microphone active');
        }

        function toggleVideo() {
            isVideoMuted = !isVideoMuted;
            const videoBtn = document.getElementById('toggleVideoBtn');
            
            videoBtn.classList.toggle('active', !isVideoMuted);
            videoBtn.textContent = isVideoMuted ? 'ğŸš«' : 'ğŸ“¹';
            
            showToast(isVideoMuted ? 'Camera off' : 'Camera on');
        }

        function endVideoCall() {
            const videoContainer = document.getElementById('videoCallContainer');
            videoContainer.classList.remove('active');
            
            isMicMuted = false;
            isVideoMuted = false;
            
            showToast('Video call ended');
        }

        function toggleScreenShare() {
            showToast('Screen sharing feature coming soon');
        }

        function toggleChat() {
            showToast('In-call chat feature coming soon');
        }

        function openVideoBookingModal(coachId) {
            const modal = document.getElementById('videoBookingModal');
            modal.classList.add('active');
            
            const dateInput = document.getElementById('sessionDate');
            const today = new Date().toISOString().split('T')[0];
            dateInput.min = today;
            
            if (coachId) {
                document.getElementById('coachSelect').value = 'coach1';
                updateBookingSummary();
            }
        }

        function closeVideoBookingModal() {
            const modal = document.getElementById('videoBookingModal');
            modal.classList.remove('active');
            resetBookingForm();
        }

        function resetBookingForm() {
            document.getElementById('coachSelect').value = '';
            document.getElementById('sessionDate').value = '';
            document.getElementById('sessionType').value = 'intro';
            document.getElementById('sessionNotes').value = '';
            selectedTimeSlot = null;
            
            document.querySelectorAll('.time-slot-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            document.getElementById('bookingSummary').style.display = 'none';
            document.getElementById('confirmBookingBtn').disabled = true;
        }

        function updateBookingSummary() {
            const coach = document.getElementById('coachSelect');
            const date = document.getElementById('sessionDate');
            const sessionType = document.getElementById('sessionType');
            const summary = document.getElementById('bookingSummary');
            
            if (coach.value && date.value && selectedTimeSlot) {
                summary.style.display = 'block';
                
                document.getElementById('summaryCoach').textContent = 
                    coach.options[coach.selectedIndex].text;
                
                const dateObj = new Date(date.value);
                const formattedDate = dateObj.toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric', 
                    year: 'numeric' 
                });
                document.getElementById('summaryDateTime').textContent = 
                    `${formattedDate} at ${selectedTimeSlot}`;
                
                const durations = {
                    'intro': '30 minutes',
                    'regular': '60 minutes',
                    'intensive': '90 minutes'
                };
                document.getElementById('summaryDuration').textContent = 
                    durations[sessionType.value] || '60 minutes';
                
                document.getElementById('confirmBookingBtn').disabled = false;
            } else {
                summary.style.display = 'none';
                document.getElementById('confirmBookingBtn').disabled = true;
            }
        }

        function confirmVideoBooking() {
            showToast('Video session booked successfully!');
            closeVideoBookingModal();
            
            console.log('Booking confirmed:', {
                coach: document.getElementById('coachSelect').value,
                date: document.getElementById('sessionDate').value,
                time: selectedTimeSlot,
                type: document.getElementById('sessionType').value,
                notes: document.getElementById('sessionNotes').value
            });
        }

        // Video Calls Event Listeners
        function initVideoCallsSystem() {
            document.getElementById('toggleMicBtn')?.addEventListener('click', toggleMicrophone);
            document.getElementById('toggleVideoBtn')?.addEventListener('click', toggleVideo);
            document.getElementById('endCallBtn')?.addEventListener('click', endVideoCall);
            document.getElementById('toggleScreenBtn')?.addEventListener('click', toggleScreenShare);
            document.getElementById('toggleChatBtn')?.addEventListener('click', toggleChat);
            
            document.getElementById('closeBookingModal')?.addEventListener('click', closeVideoBookingModal);
            document.getElementById('cancelBookingBtn')?.addEventListener('click', closeVideoBookingModal);
            document.getElementById('confirmBookingBtn')?.addEventListener('click', confirmVideoBooking);
            
            document.getElementById('coachSelect')?.addEventListener('change', updateBookingSummary);
            document.getElementById('sessionDate')?.addEventListener('change', updateBookingSummary);
            document.getElementById('sessionType')?.addEventListener('change', updateBookingSummary);
            
            document.querySelectorAll('.time-slot-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    if (btn.disabled) return;
                    
                    document.querySelectorAll('.time-slot-btn').forEach(b => {
                        b.classList.remove('selected');
                    });
                    btn.classList.add('selected');
                    selectedTimeSlot = btn.dataset.time;
                    updateBookingSummary();
                });
            });
        }

        // Initialize video calls on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initVideoCallsSystem);
        } else {
            initVideoCallsSystem();
        }


        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CONSOLE LOGGING - v31 UPDATE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        console.log('HUDEN TRIBE v31 - VIDEO CALLS & REMOTE SESSIONS');
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        console.log('');
        console.log('NEW IN v31 - VIDEO CALLS:');
        console.log('âœ“ Full-screen video call interface');
        console.log('âœ“ Nike-inspired minimal controls');
        console.log('âœ“ Video booking modal with time slots');
        console.log('âœ“ Session management for coaches');
        console.log('âœ“ Remote session integration');
        console.log('âœ“ Participant status indicators');
        console.log('âœ“ Mic/video toggle controls');
        console.log('âœ“ Screen share placeholder');
        console.log('âœ“ In-call chat placeholder');
        console.log('âœ“ Coach profile video badge');
        console.log('âœ“ Booking summary and confirmation');
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');



        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MENTORSHIP REQUEST FLOW (v32)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        let currentCoachForRequest = null;

        function openMentorshipRequest(coach) {
            currentCoachForRequest = coach;
            const modal = document.getElementById('mentorshipRequestModal');
            modal.classList.add('active');
            
            // Populate coach info
            document.getElementById('requestCoachName').textContent = coach.name;
            document.getElementById('requestCoachDetails').textContent = 
                `${coach.location} Â· ${coach.specialties.join(', ')}`;
            document.getElementById('requestCoachAvatar').src = coach.image;
            
            // Update investment based on frequency
            updateInvestmentSummary();
        }

        function closeMentorshipRequest() {
            const modal = document.getElementById('mentorshipRequestModal');
            modal.classList.remove('active');
            resetMentorshipForm();
        }

        function resetMentorshipForm() {
            document.getElementById('currentExperience').value = '';
            document.getElementById('practiceHistory').value = '';
            document.getElementById('mentorshipGoals').value = '';
            document.getElementById('sessionFrequency').value = '';
            document.getElementById('timezone').value = '';
            document.getElementById('bestTimes').value = '';
            
            document.querySelectorAll('input[name="focus"]').forEach(cb => cb.checked = false);
        }

        function updateInvestmentSummary() {
            const frequency = document.getElementById('sessionFrequency').value;
            let amount = 'â‚¬750';
            let sessionType = 'Weekly 1-on-1';
            
            switch(frequency) {
                case 'weekly':
                    amount = 'â‚¬900';
                    sessionType = 'Weekly (12 sessions)';
                    break;
                case 'biweekly':
                    amount = 'â‚¬600';
                    sessionType = 'Bi-weekly (6 sessions)';
                    break;
                case 'flexible':
                    amount = 'â‚¬750';
                    sessionType = 'Flexible schedule';
                    break;
            }
            
            document.getElementById('investmentAmount').textContent = amount;
            document.getElementById('sessionTypeDisplay').textContent = sessionType;
        }

        function submitMentorshipRequest() {
            // Validation
            const experience = document.getElementById('currentExperience').value;
            const history = document.getElementById('practiceHistory').value;
            const goals = document.getElementById('mentorshipGoals').value;
            const frequency = document.getElementById('sessionFrequency').value;
            const timezone = document.getElementById('timezone').value;
            
            if (!experience || !history || !goals || !frequency || !timezone) {
                showToast('Please complete all required fields');
                return;
            }
            
            // Gather focus areas
            const focusAreas = Array.from(document.querySelectorAll('input[name="focus"]:checked'))
                .map(cb => cb.value);
            
            const requestData = {
                coach: currentCoachForRequest,
                experience: experience,
                practiceHistory: history,
                goals: goals,
                focusAreas: focusAreas,
                frequency: frequency,
                timezone: timezone,
                bestTimes: document.getElementById('bestTimes').value,
                timestamp: new Date().toISOString()
            };
            
            // Save to localStorage (mock persistence)
            const requests = JSON.parse(localStorage.getItem('mentorshipRequests') || '[]');
            requests.push(requestData);
            localStorage.setItem('mentorshipRequests', JSON.stringify(requests));
            
            console.log('Mentorship Request Submitted:', requestData);
            
            showToast('Mentorship request sent! Coach will respond within 48 hours.');
            closeMentorshipRequest();
            
            // In production: POST to API
            // Send email to coach
            // Create private thread in Wisdom Library
            // Setup payment flow
        }

        function initMentorshipSystem() {
            document.getElementById('closeMentorshipRequest')?.addEventListener('click', closeMentorshipRequest);
            document.getElementById('cancelMentorshipRequest')?.addEventListener('click', closeMentorshipRequest);
            document.getElementById('submitMentorshipRequest')?.addEventListener('click', submitMentorshipRequest);
            document.getElementById('sessionFrequency')?.addEventListener('change', updateInvestmentSummary);
            
            // ESC to close
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const modal = document.getElementById('mentorshipRequestModal');
                    if (modal?.classList.contains('active')) {
                        closeMentorshipRequest();
                    }
                }
            });
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initMentorshipSystem);
        } else {
            initMentorshipSystem();
        }

        // Make function globally available
        window.openMentorshipRequest = openMentorshipRequest;
        
        // Helper function to open mentorship request from card data attributes
        function openMentorshipRequestFromCard(buttonElement) {
            const coach = {
                id: parseInt(buttonElement.dataset.coachId),
                name: buttonElement.dataset.coachName,
                location: buttonElement.dataset.coachLocation,
                image: buttonElement.dataset.coachImage,
                specialties: buttonElement.dataset.coachSpecialties.split(',')
            };
            openMentorshipRequest(coach);
        }
        
        window.openMentorshipRequestFromCard = openMentorshipRequestFromCard;
        
        function acceptMentorshipRequest(studentId) {
            showToast('Mentorship request accepted! Processing...');
            
            // In production:
            // 1. POST to API to create mentorship
            // 2. Trigger payment flow (Stripe)
            // 3. Send confirmation emails (coach + student)
            // 4. Create private Wisdom Library thread
            // 5. Generate Zoom link & calendar invite
            // 6. Update mentorship status
            
            console.log('Accepted mentorship request from:', studentId);
            
            setTimeout(() => {
                showToast('Mentorship activated! Zoom link sent via email.');
            }, 2000);
        }
        
        window.acceptMentorshipRequest = acceptMentorshipRequest;
        
        // Show My Mentorships section for coaches in Guide tab
        function showMyMentorshipsSection() {
            const section = document.getElementById('myMentorshipsSection');
            if (!section) return;
            
            const userTier = getUserTier();
            section.style.display = userTier === 'coach' ? 'block' : 'none';
        }
        
        // Hook into tab switching to show/hide My Mentorships
        const originalSwitchTabFunc = window.switchTab;
        window.switchTab = function(tabName) {
            if (originalSwitchTabFunc) originalSwitchTabFunc(tabName);
            if (tabName === 'guide') {
                setTimeout(showMyMentorshipsSection, 100);
            }
        };


        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MY MENTORSHIPS - COACH VIEW (v32)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function renderMyMentorships() {
            const container = document.getElementById('wisdomContainer');
            if (!container) return;

            // Load mentorship requests from localStorage
            const requests = JSON.parse(localStorage.getItem('mentorshipRequests') || '[]');
            
            // Mock active mentorships (in production, fetch from API)
            const mockActiveMentorships = [
                {
                    id: 1,
                    student: {
                        name: 'Ana Martinez',
                        avatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100&q=80',
                        tier: 'mentorship',
                        archetype: 'Gibbon'
                    },
                    startDate: '2024-10-01',
                    endDate: '2025-01-01',
                    frequency: 'weekly',
                    sessionsCompleted: 8,
                    sessionsTotal: 12,
                    nextSession: '2024-11-05 10:00',
                    zoomLink: 'https://zoom.us/j/example123',
                    status: 'active',
                    focusAreas: ['suspension', 'integration']
                },
                {
                    id: 2,
                    student: {
                        name: 'Marcus Johnson',
                        avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100&q=80',
                        tier: 'mentorship',
                        archetype: 'Chimpanzee'
                    },
                    startDate: '2024-09-15',
                    endDate: '2024-12-15',
                    frequency: 'biweekly',
                    sessionsCompleted: 4,
                    sessionsTotal: 6,
                    nextSession: '2024-11-08 14:00',
                    zoomLink: 'https://zoom.us/j/example456',
                    status: 'active',
                    focusAreas: ['groundwork', 'outdoor']
                }
            ];

            // Combine active + pending requests
            const allMentorships = [
                ...mockActiveMentorships,
                ...requests.map((req, idx) => ({
                    id: `request-${idx}`,
                    student: {
                        name: req.coach?.name || 'New Request',
                        avatar: req.coach?.image || 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=100&q=80',
                        tier: 'mentorship'
                    },
                    requestDate: req.timestamp,
                    frequency: req.frequency,
                    status: 'pending',
                    focusAreas: req.focusAreas || [],
                    goals: req.goals,
                    experience: req.experience
                }))
            ];

            if (allMentorships.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: var(--space-10) var(--space-4);">
                        <div style="font-size: 64px; margin-bottom: var(--space-3); opacity: 0.3;">ğŸ”¥</div>
                        <h3 style="font-size: 24px; font-weight: 700; margin-bottom: var(--space-2);">No Active Mentorships</h3>
                        <p style="font-size: 15px; color: var(--gray-600); max-width: 400px; margin: 0 auto;">
                            When students request mentorship with you, they'll appear here.
                        </p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="active-mentorships">
                    ${allMentorships.map(m => `
                        <div class="mentorship-card">
                            <div class="mentorship-card-header">
                                <div class="mentorship-participant">
                                    <img src="${m.student.avatar}" alt="${m.student.name}" class="mentorship-avatar">
                                    <div class="mentorship-participant-info">
                                        <h4>${m.student.name}</h4>
                                        <div class="mentorship-participant-role">${m.student.tier}${m.student.archetype ? ` Â· ${m.student.archetype}` : ''}</div>
                                    </div>
                                </div>
                                <span class="mentorship-status ${m.status}">${m.status === 'active' ? 'Active' : 'Pending'}</span>
                            </div>

                            ${m.status === 'active' ? `
                                <div class="mentorship-meta">
                                    <div class="mentorship-meta-item">
                                        <span class="mentorship-meta-label">Progress</span>
                                        <span class="mentorship-meta-value">${m.sessionsCompleted}/${m.sessionsTotal} sessions</span>
                                    </div>
                                    <div class="mentorship-meta-item">
                                        <span class="mentorship-meta-label">Frequency</span>
                                        <span class="mentorship-meta-value">${m.frequency}</span>
                                    </div>
                                    <div class="mentorship-meta-item">
                                        <span class="mentorship-meta-label">Next Session</span>
                                        <span class="mentorship-meta-value">${new Date(m.nextSession).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>
                                    </div>
                                    <div class="mentorship-meta-item">
                                        <span class="mentorship-meta-label">End Date</span>
                                        <span class="mentorship-meta-value">${new Date(m.endDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</span>
                                    </div>
                                </div>

                                <div class="mentorship-actions">
                                    <button class="btn btn-primary video-link-btn" onclick="window.open('${m.zoomLink}', '_blank')">
                                        Join Video Call
                                    </button>
                                    <button class="btn btn-ghost btn-small" onclick="openSessionNotes(${m.id})">
                                        Session Notes
                                    </button>
                                    <button class="btn btn-ghost btn-small" onclick="openMentorshipThread(${m.id})">
                                        Private Thread
                                    </button>
                                </div>
                            ` : `
                                <div style="padding: var(--space-3); background: var(--gray-50); border-radius: var(--radius-md); margin-bottom: var(--space-3);">
                                    <p style="font-size: 14px; margin-bottom: var(--space-2);"><strong>Request Date:</strong> ${new Date(m.requestDate).toLocaleDateString()}</p>
                                    <p style="font-size: 14px; margin-bottom: var(--space-2);"><strong>Frequency:</strong> ${m.frequency}</p>
                                    ${m.focusAreas.length > 0 ? `
                                        <p style="font-size: 14px;"><strong>Focus:</strong> ${m.focusAreas.join(', ')}</p>
                                    ` : ''}
                                </div>

                                <div class="mentorship-actions">
                                    <button class="btn btn-primary btn-small" onclick="acceptMentorshipRequest('${m.id}')">
                                        Accept Request
                                    </button>
                                    <button class="btn btn-ghost btn-small" onclick="viewRequestDetails('${m.id}')">
                                        View Details
                                    </button>
                                    <button class="btn btn-ghost btn-small" onclick="declineMentorshipRequest('${m.id}')">
                                        Decline
                                    </button>
                                </div>
                            `}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function acceptMentorshipRequest(requestId) {
            showToast('Mentorship accepted! Setup email sent to student.');
            // In production: 
            // - POST to API
            // - Send confirmation email with Zoom link
            // - Create calendar invites
            // - Setup payment
            // - Create private thread
            setTimeout(() => renderMyMentorships(), 1000);
        }

        function declineMentorshipRequest(requestId) {
            if (confirm('Decline this mentorship request?')) {
                showToast('Request declined. Student has been notified.');
                setTimeout(() => renderMyMentorships(), 1000);
            }
        }

        function viewRequestDetails(requestId) {
            showToast('Request details modal - Coming soon');
        }

        function openSessionNotes(mentorshipId) {
            showToast('Session notes feature - Coming soon');
        }

        function openMentorshipThread(mentorshipId) {
            showToast('Opening private thread...');
            // In production: navigate to inbox with mentorship thread
        }


        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // NIKE CAROUSEL SCROLL FUNCTIONALITY
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function scrollCarousel(direction) {
            const track = document.getElementById('nikeCarouselTrack');
            if (!track) return;
            
            const scrollAmount = track.offsetWidth * 0.8; // Scroll 80% of visible width
            const currentScroll = track.scrollLeft;
            
            track.scrollTo({
                left: currentScroll + (scrollAmount * direction),
                behavior: 'smooth'
            });
            
            logEvent('carousel_scrolled', { direction: direction > 0 ? 'next' : 'previous' });
        }


        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CONSOLE LOGGING - v32 UPDATE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        console.log('HUDEN TRIBE v44 - NIKE NAVIGATION OPTIMIZATION');
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        console.log('');
        console.log('NEW IN v44 - NIKE RUN CLUB BOTTOM BAR:');
        console.log('âœ“ Edge-to-edge white bottom bar (NO rounded corners)');
        console.log('âœ“ 1px top separator (#E5E5E5)');
        console.log('âœ“ 4 tabs: Home, Explore, Training, Profile');
        console.log('âœ“ Icon + label vertical stack (gap: 4px)');
        console.log('âœ“ Active state: Black (#000), weight 600, stroke 2.5px');
        console.log('âœ“ Inactive state: Gray (#8E8E93), weight 500, stroke 2px');
        console.log('âœ“ NO shadows, NO background on active tab');
        console.log('âœ“ Simple line icons (24x24px)');
        console.log('âœ“ iOS safe area support');
        console.log('âœ“ 44x44px minimum tap target (Apple HIG)');
        console.log('âœ“ Tap opacity: 0.7 (NO scale transform)');
        console.log('');
        console.log('NIKE DESIGN PRINCIPLES APPLIED:');
        console.log('â€¢ Clean, minimalist aesthetic');
        console.log('â€¢ Typography-driven hierarchy');
        console.log('â€¢ Generous white space');
        console.log('â€¢ Subtle, surgical interactions');
        console.log('â€¢ No decorative elements');
        console.log('â€¢ System fonts (SF Pro)');
        console.log('');
        console.log('PREVIOUS VERSIONS:');
        console.log('v33: Advanced Search & Filter Panel');
        console.log('v32: Mentorship Request Flow');
        console.log('v31: Video Calls (deferred)');
        console.log('v30: Calendar Integration');
        console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // NEW NAVIGATION HELPER FUNCTIONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function filterTRIBE(type) {
            // Remove active from all filter pills
            document.querySelectorAll('.filter-pill').forEach(pill => {
                pill.classList.remove('active');
            });
            
            // Add active to clicked pill
            event.target.classList.add('active');
            
            // Filter content based on type
            showToast(`Filtering by: ${type}`);
            
            // In production: filter the packs/events/coaches display
            logEvent('tribe_filter_changed', { filterType: type });
        }
        
        function switchTRIBESection(section) {
            // Remove active from all tabs
            document.querySelectorAll('.tribe-nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Add active to clicked tab
            const activeTab = document.getElementById(`tab${section.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join('')}`);
            if (activeTab) {
                activeTab.classList.add('active');
            }
            
            // Hide all tribe sections
            document.querySelectorAll('.tribe-section').forEach(sec => {
                sec.classList.remove('active');
            });
            
            // Show selected section
            const activeSection = document.getElementById(`tribe${section.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join('')}Section`);
            if (activeSection) {
                activeSection.classList.add('active');
            }
            
            // Load content for each section
            if (section === 'feed') {
                // Load user posts feed
                loadFeed('All');
            } else if (section === 'map') {
                // Use the existing loadMap function
                setTimeout(() => {
                    loadMap();
                }, 300);
            } else if (section === 'packs') {
                loadPacks();
            } else if (section === 'guide') {
                // Load coaches
                if (typeof renderCoaches === 'function') {
                    renderCoaches();
                }
            } else if (section === 'wisdom-library') {
                // Load Wisdom Library content
                console.log('[TRIBE] Wisdom Library section selected');
                loadWisdomLibrary();
            }
            
            logEvent('tribe_section_switched', { section });
        }
        
        function toggleQuickActionsDropdown() {
            const dropdown = document.getElementById('quickActionsDropdown');
            dropdown.classList.toggle('active');
            logEvent('quick_actions_fab_clicked');
        }

        function handleQuickAction(action) {
            const dropdown = document.getElementById('quickActionsDropdown');
            dropdown.classList.remove('active');
            
            switch(action) {
                case 'newPost':
                    openModal('newPostModal');
                    break;
                case 'findPack':
                    switchTab('tribe');
                    setTimeout(() => switchTRIBESection('packs'), 100);
                    break;
                case 'startTraining':
                    switchTab('training');
                    break;
                case 'findCoach':
                    switchTab('tribe');
                    setTimeout(() => switchTRIBESection('guide'), 100);
                    break;
            }
            
            logEvent('quick_action_clicked', { action });
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const fab = document.getElementById('quickActionsFab');
            const dropdown = document.getElementById('quickActionsDropdown');
            
            if (fab && dropdown && !fab.contains(event.target) && !dropdown.contains(event.target)) {
                dropdown.classList.remove('active');
            }
        });
        
        function openMyProfile() {
            const currentUser = getCurrentUser();
            if (currentUser) {
                showUserProfile(currentUser.name, currentUser.avatar, currentUser.id);
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // HOME ARTICLES FUNCTION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function openArticle(articleId) {
            showToast(`Opening article: ${articleId}`);
            // In production: Navigate to article detail page or open modal
            logEvent('home_article_clicked', { articleId });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // HERO CAROUSEL - Auto-rotate with pause button only
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        let currentHeroSlide = 0;
        let heroCarouselInterval;
        let heroCarouselPaused = false;
        
        function startHeroCarousel() {
            if (!heroCarouselPaused) {
                heroCarouselInterval = setInterval(() => {
                    const slides = document.querySelectorAll('.hero-slide');
                    
                    // Remove active class from current slide
                    slides[currentHeroSlide].classList.remove('active');
                    
                    // Calculate new slide index (loop forward)
                    currentHeroSlide = (currentHeroSlide + 1) % slides.length;
                    
                    // Add active class to new slide
                    slides[currentHeroSlide].classList.add('active');
                }, 5000); // Change every 5 seconds
            }
        }
        
        function stopHeroCarousel() {
            if (heroCarouselInterval) {
                clearInterval(heroCarouselInterval);
            }
        }
        
        function toggleHeroCarousel() {
            heroCarouselPaused = !heroCarouselPaused;
            const pauseBtn = document.getElementById('heroPauseBtn');
            
            if (heroCarouselPaused) {
                stopHeroCarousel();
                // Change icon to play
                pauseBtn.innerHTML = `
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                `;
            } else {
                startHeroCarousel();
                // Change icon to pause
                pauseBtn.innerHTML = `
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                        <rect x="6" y="4" width="4" height="16"></rect>
                        <rect x="14" y="4" width="4" height="16"></rect>
                    </svg>
                `;
            }
        }
        
        // Start carousel when page loads
        if (currentTab === 'home') {
            startHeroCarousel();
        }


        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           TRAINING TAB v1 - Complete JavaScript Implementation
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // TRAINING CURRICULUM ADAPTER - Use HUDEN_CURRICULUM from external file
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        // Backwards compatibility layer - convert new HUDEN_CURRICULUM to old format
        const TRAINING_CURRICULUM = {};
        
        function initializeTrainingCurriculum() {
            if (typeof HUDEN_CURRICULUM === 'undefined') {
                console.error('âŒ HUDEN_CURRICULUM not loaded! Check HUDEN_CURRICULUM_DATA.js');
                return;
            }
            
            // Convert each program from new format to old format
            ['essential', 'flow', 'mastery'].forEach(programKey => {
                const newProgram = HUDEN_CURRICULUM[programKey];
                if (!newProgram) return;
                
                // Build sessions array from weeks
                const sessions = [];
                newProgram.weeks.forEach(week => {
                    week.days.forEach(day => {
                        sessions.push({
                            day: day.day,
                            title: day.title,
                            subtitle: day.subtitle,
                            duration: day.duration,
                            archetype: day.archetype,
                            description: day.description,
                            observation: day.intention, // Use intention as the observation quote
                            restDay: day.restDay,
                            structure: day.structure,
                            videoId: day.videoId,
                            week: week.week,
                            weekTheme: week.theme
                        });
                    });
                });
                
                // Create old format structure
                TRAINING_CURRICULUM[programKey] = {
                    name: newProgram.name,
                    tier: programKey,
                    duration: newProgram.duration,
                    price: programKey === 'essential' ? 'FREE' : 
                           programKey === 'flow' ? 'â‚¬29/month' : 'â‚¬49/month',
                    description: newProgram.description,
                    completionMessage: `"You completed ${newProgram.name}. Integration complete."`,
                    nextProgram: programKey === 'essential' ? 'flow' :
                                programKey === 'flow' ? 'mastery' : null,
                    sessions: sessions
                };
            });
            
            console.log('âœ“ HUDEN_CURRICULUM loaded and adapted');
            console.log(`  - Essential: ${TRAINING_CURRICULUM.essential.sessions.length} days`);
            console.log(`  - Flow: ${TRAINING_CURRICULUM.flow.sessions.length} days`);
            console.log(`  - Mastery: ${TRAINING_CURRICULUM.mastery.sessions.length} days`);
        }
        
        // NOTE: initializeTrainingCurriculum() will be called AFTER HUDEN_CURRICULUM is defined at end of file

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // USER PROGRESS TRACKING (localStorage)
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function getUserTrainingProgress() {
            const progress = localStorage.getItem('trainingProgress');
            return progress ? JSON.parse(progress) : {
                essential: { enrolled: false, currentDay: 0, completedDays: [], observations: {} },
                flow: { enrolled: false, currentDay: 0, completedDays: [], observations: {} },
                mastery: { enrolled: false, currentDay: 0, completedDays: [], observations: {} }
            };
        }

        function saveUserTrainingProgress(progress) {
            localStorage.setItem('trainingProgress', JSON.stringify(progress));
        }

        function getActiveProgram() {
            const progress = getUserTrainingProgress();
            if (progress.mastery.enrolled && progress.mastery.currentDay < 48) return 'mastery';
            if (progress.flow.enrolled && progress.flow.currentDay < 48) return 'flow';
            if (progress.essential.enrolled && progress.essential.currentDay < 48) return 'essential';
            return null;
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // TIER PERMISSIONS & PROGRAM ACCESS
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function canAccessProgram(program) {
            const tier = getUserTier().toLowerCase();
            
            // Subscription-based access model
            if (program === 'essential') return true; // Always accessible (FREE)
            if (program === 'flow') {
                // Requires Flow subscription (â‚¬29/month)
                return ['flow', 'mastery', 'mentorship', 'coach'].includes(tier);
            }
            if (program === 'mastery') {
                // Requires Mastery subscription (â‚¬49/month)
                return ['mastery', 'mentorship', 'coach'].includes(tier);
            }
            return false;
        }

        function isProgramCompleted(program) {
            const progress = getUserTrainingProgress();
            return progress[program].completedDays.includes(48);
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // TAB INITIALIZATION - Called when Training tab is opened
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function initializeTrainingTab() {
            // FOR TESTING: Assume user is logged in
            // TODO: Replace with real authentication check when auth system is ready
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true' || true; // TEMP: always true for testing
            
            if (!isLoggedIn) {
                showTrainingAuthGate();
                return;
            }

            const activeProgram = getActiveProgram();
            
            if (activeProgram) {
                showActiveProgramView(activeProgram);
            } else {
                showProgramSelectionView();
            }
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // VIEW CONTROLLERS
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function hideAllTrainingViews() {
            document.getElementById('trainingAuthGate').style.display = 'none';
            document.getElementById('trainingProgramSelection').style.display = 'none';
            document.getElementById('trainingActiveProgram').style.display = 'none';
            document.getElementById('trainingSessionDetail').style.display = 'none';
        }

        function showTrainingAuthGate() {
            hideAllTrainingViews();
            document.getElementById('trainingAuthGate').style.display = 'flex';
        }

        function showProgramSelectionView() {
            hideAllTrainingViews();
            document.getElementById('trainingProgramSelection').style.display = 'block';
            updateProgramLocks();
        }

        function updateProgramLocks() {
            const progress = getUserTrainingProgress();
            const tier = getUserTier().toLowerCase();

            // Flow lock - Simple subscription check
            const flowLocked = !canAccessProgram('flow');
            const flowCard = document.getElementById('flowProgramCard');
            const flowLockOverlay = document.getElementById('flowLockOverlay');
            const flowBtn = document.getElementById('flowUpgradeBtn');
            
            if (flowLocked) {
                flowLockOverlay.style.display = 'flex';
                flowCard.style.opacity = '0.7';
                flowBtn.textContent = 'UPGRADE TO FLOW';
                flowBtn.disabled = false;
                flowBtn.onclick = upgradeToFlow;
            } else {
                flowLockOverlay.style.display = 'none';
                flowCard.style.opacity = '1';
                flowBtn.textContent = 'START FLOW';
                flowBtn.disabled = false;
                flowBtn.onclick = () => enrollInProgram('flow');
            }

            // Mastery lock - Simple subscription check
            const masteryLocked = !canAccessProgram('mastery');
            const masteryCard = document.getElementById('masteryProgramCard');
            const masteryLockOverlay = document.getElementById('masteryLockOverlay');
            const masteryBtn = document.getElementById('masteryUpgradeBtn');
            
            if (masteryLocked) {
                masteryLockOverlay.style.display = 'flex';
                masteryCard.style.opacity = '0.7';
                masteryBtn.textContent = 'UPGRADE TO MASTERY';
                masteryBtn.disabled = false;
                masteryBtn.onclick = upgradeToMastery;
            } else {
                masteryLockOverlay.style.display = 'none';
                masteryCard.style.opacity = '1';
                masteryBtn.textContent = 'START MASTERY';
                masteryBtn.disabled = false;
                masteryBtn.onclick = () => enrollInProgram('mastery');
            }
        }

        function showActiveProgramView(programKey) {
            hideAllTrainingViews();
            document.getElementById('trainingActiveProgram').style.display = 'block';
            
            const program = TRAINING_CURRICULUM[programKey];
            const progress = getUserTrainingProgress()[programKey];
            const currentDay = progress.currentDay || 1;
            const currentSession = program.sessions[currentDay - 1];

            // Update header
            document.getElementById('activeProgramTitle').textContent = program.name.toUpperCase();
            document.getElementById('currentDayDisplay').textContent = `Day ${currentDay} of ${program.duration}`;
            document.getElementById('currentWeekDisplay').textContent = `Week ${currentSession.week}`;
            
            // Update progress bar
            const progressPercent = Math.round((currentDay / program.duration) * 100);
            document.getElementById('trainingProgressFill').style.width = `${progressPercent}%`;

            // Update today's session card with new structure
            const todayImage = document.getElementById('todaySessionImage');
            if (todayImage && typeof getRandomImage === 'function') {
                todayImage.src = getRandomImage('feed.solo');
            }
            document.getElementById('todaySessionTitle').textContent = currentSession.title;
            document.getElementById('todaySessionMeta').textContent = `${currentSession.duration} min Â· ${currentSession.archetype}`;

            // Update week overview
            updateWeekOverview(programKey, currentDay, currentSession.week);

            // Update milestone - show week theme instead
            const milestoneEl = document.getElementById('milestoneText');
            if (milestoneEl) {
                milestoneEl.textContent = `Week ${currentSession.week} Â· ${currentSession.weekTheme}`;
            }

            // Update recent sessions
            updateRecentSessions(programKey, progress);
        }

        function updateWeekOverview(programKey, currentDay, weekNum) {
            const container = document.getElementById('trainingWeekDays');
            const progress = getUserTrainingProgress()[programKey];
            const startDay = (weekNum - 1) * 4 + 1;
            
            container.innerHTML = '';
            
            for (let i = 0; i < 4; i++) {
                const dayNum = startDay + i;
                if (dayNum > 48) break;
                
                const isCompleted = progress.completedDays.includes(dayNum);
                const isCurrent = dayNum === currentDay;
                const isLocked = dayNum > currentDay;
                
                const dayDiv = document.createElement('div');
                dayDiv.className = `training-day-item ${isCompleted ? 'completed' : ''} ${isCurrent ? 'current' : ''} ${isLocked ? 'locked' : ''}`;
                
                const statusIcon = isCompleted ? 'âœ“' : isCurrent ? 'â—' : 'â—‹';
                const weekDays = ['Mon', 'Tue', 'Wed', 'Thu'];
                
                dayDiv.innerHTML = `
                    <div class="training-day-number">DAY ${dayNum}</div>
                    <div class="training-day-status">${statusIcon}</div>
                    <div class="training-day-label">${weekDays[i]}</div>
                `;
                
                container.appendChild(dayDiv);
            }
        }

        function updateRecentSessions(programKey, progress) {
            const container = document.getElementById('recentSessionsList');
            const program = TRAINING_CURRICULUM[programKey];
            const completed = progress.completedDays.slice(-3).reverse(); // Last 3 completed
            
            container.innerHTML = '';
            
            completed.forEach(dayNum => {
                const session = program.sessions[dayNum - 1];
                const div = document.createElement('div');
                div.className = 'training-recent-item';
                div.innerHTML = `Day ${dayNum}: ${session.title} <span>âœ“</span>`;
                container.appendChild(div);
            });
        }

        function toggleRecentSessions() {
            const list = document.getElementById('recentSessionsList');
            const toggle = document.getElementById('recentSessionsToggle');
            const isOpen = list.style.display === 'block';
            
            list.style.display = isOpen ? 'none' : 'block';
            toggle.classList.toggle('active', !isOpen);
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // SESSION DETAIL VIEW
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        let currentSessionContext = null; // {program, day}

        function openSessionDetail() {
            console.log('ğŸ”µ openSessionDetail() called');
            
            const activeProgram = getActiveProgram();
            console.log('  - Active program:', activeProgram);
            
            if (!activeProgram) {
                console.error('âŒ No active program found');
                return;
            }
            
            const program = TRAINING_CURRICULUM[activeProgram];
            console.log('  - Program data:', program ? 'âœ“ Found' : 'âŒ Not found');
            
            if (!program) {
                console.error('âŒ Program not found in TRAINING_CURRICULUM');
                return;
            }
            
            const progress = getUserTrainingProgress()[activeProgram];
            const currentDay = progress.currentDay || 1;
            console.log('  - Current day:', currentDay);
            
            const session = program.sessions[currentDay - 1];
            console.log('  - Session:', session ? `âœ“ ${session.title}` : 'âŒ Not found');
            
            if (!session) {
                console.error('âŒ Session not found for day', currentDay);
                return;
            }
            
            currentSessionContext = { program: activeProgram, day: currentDay };
            console.log('  - Context set:', currentSessionContext);
            
            hideAllTrainingViews();
            document.getElementById('trainingSessionDetail').style.display = 'block';
            console.log('  - Session detail view displayed');
            
            // Populate session details
            document.getElementById('sessionDayLabel').textContent = `DAY ${currentDay}`;
            document.getElementById('sessionDetailTitle').textContent = session.title.toUpperCase();
            document.getElementById('sessionDetailMeta').textContent = `Week ${session.week} Â· ${session.duration} min Â· ${session.archetype}`;
            document.getElementById('sessionOverview').textContent = session.description;
            
            // Update structure with new format
            const structureList = document.getElementById('sessionStructure');
            const structure = session.structure;
            structureList.innerHTML = `
                <li><strong>Warm-up (${structure.warmup.duration} min):</strong> ${structure.warmup.content}</li>
                <li><strong>Practice (${structure.practice.duration} min):</strong> ${structure.practice.content}</li>
                <li><strong>Cool-down (${structure.cooldown.duration} min):</strong> ${structure.cooldown.content}</li>
            `;
            
            // Update video cover image - use archetype-specific image from HUDEN_IMAGES
            const videoCover = document.getElementById('sessionVideoCover');
            if (videoCover && typeof getRandomImage === 'function') {
                videoCover.src = getRandomImage('feed.solo');
            }
            
            // Reset video player state
            const videoPlayer = document.getElementById('sessionVideoPlayer');
            const videoPlaceholder = document.getElementById('sessionVideoPlaceholder');
            if (videoPlayer) videoPlayer.style.display = 'none';
            if (videoPlaceholder) videoPlaceholder.style.display = 'block';
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            console.log('âœ“ Session detail opened successfully');
        }

        function playSessionVideo() {
            if (!currentSessionContext) {
                console.error('âŒ No session context available');
                return;
            }
            
            const { program, day } = currentSessionContext;
            const programData = TRAINING_CURRICULUM[program];
            const session = programData.sessions[day - 1];
            
            // Hide placeholder, show video player
            const videoPlaceholder = document.getElementById('sessionVideoPlaceholder');
            const videoPlayer = document.getElementById('sessionVideoPlayer');
            const videoIframe = document.getElementById('sessionVideoIframe');
            
            if (!videoPlaceholder || !videoPlayer || !videoIframe) {
                console.error('âŒ Video elements not found');
                return;
            }
            
            // For now, show a placeholder message (replace with real video URL when available)
            const videoId = session.videoId || 'placeholder';
            
            // TEMPORARY: Show message instead of video
            videoPlayer.innerHTML = `
                <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; flex-direction: column; padding: var(--space-6); text-align: center; background: var(--gray-900);">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="margin-bottom: var(--space-3); opacity: 0.5;">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    <h3 style="font-size: 24px; font-weight: 700; margin-bottom: var(--space-2); color: var(--white);">Video Coming Soon</h3>
                    <p style="font-size: 16px; opacity: 0.7; max-width: 400px; color: var(--white);">
                        Session video for ${session.title} will be available when video content is uploaded.
                    </p>
                    <p style="font-size: 14px; opacity: 0.5; margin-top: var(--space-2); color: var(--white);">
                        Video ID: ${videoId}
                    </p>
                    <button class="btn btn-outline" onclick="closeSessionVideo()" style="margin-top: var(--space-4); color: var(--white); border-color: var(--white);">Close Player</button>
                </div>
            `;
            
            videoPlaceholder.style.display = 'none';
            videoPlayer.style.display = 'block';
            
            // Scroll to top to show video player
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            console.log('âœ“ Video player opened:', videoId);
        }

        function closeSessionVideo() {
            const videoPlaceholder = document.getElementById('sessionVideoPlaceholder');
            const videoPlayer = document.getElementById('sessionVideoPlayer');
            
            if (videoPlaceholder) videoPlaceholder.style.display = 'block';
            if (videoPlayer) videoPlayer.style.display = 'none';
            
            // Scroll to top to show video placeholder again
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            console.log('âœ“ Video player closed');
        }

        function closeSessionDetail() {
            if (!currentSessionContext) return;
            showActiveProgramView(currentSessionContext.program);
            currentSessionContext = null;
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // SESSION COMPLETION FLOW
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function completeSession() {
            if (!currentSessionContext) return;
            
            const { program, day } = currentSessionContext;
            const programData = TRAINING_CURRICULUM[program];
            const session = programData.sessions[day - 1];
            
            // Show completion modal
            document.getElementById('completedDayNumber').textContent = day;
            document.getElementById('completionMessage').textContent = session.observation;
            document.getElementById('trainingCompletionModal').style.display = 'flex';
        }

        function skipObservation() {
            finishSessionCompletion(null, false);
        }

        function saveObservation() {
            console.log('ğŸ”„ saveObservation called');
            try {
                const observation = document.getElementById('sessionObservationInput').value.trim();
                const shareToFeed = document.getElementById('shareToFeedCheckbox').checked;
                console.log(`ğŸ“ Observation: "${observation}"`);
                console.log(`ğŸ“¤ Share to Feed: ${shareToFeed}`);
                finishSessionCompletion(observation, shareToFeed);
            } catch (error) {
                console.error('âŒ Error in saveObservation:', error);
                alert('Error saving observation. Please try again.');
            }
        }

        function finishSessionCompletion(observation, shareToFeed = false) {
            console.log('ğŸ finishSessionCompletion called');
            if (!currentSessionContext) {
                console.error('âŒ No currentSessionContext');
                return;
            }
            
            try {
                const { program, day } = currentSessionContext;
                const progress = getUserTrainingProgress();
                
                console.log(`ğŸ“Š Completing: ${program} - Day ${day}`);
                
                // Update progress
                if (!progress[program].completedDays.includes(day)) {
                    progress[program].completedDays.push(day);
                }
                
                // Save observation if provided
                if (observation) {
                    progress[program].observations[day] = observation;
                    console.log('âœ“ Observation saved');
                }
                
                // Share to Feed if requested
                if (shareToFeed) {
                    console.log('ğŸ“¤ Sharing to Feed...');
                    shareSessionToFeed(program, day, observation);
                }
                
                // Send push notification for completion
                if (typeof PushNotifications !== 'undefined') {
                    PushNotifications.notifySessionComplete(program, day);
                }
                
                // Unlock next day
                progress[program].currentDay = day + 1;
                
                saveUserTrainingProgress(progress);
                console.log('âœ“ Progress saved');
                
                // Hide modal and reset
                document.getElementById('trainingCompletionModal').style.display = 'none';
                document.getElementById('sessionObservationInput').value = '';
                document.getElementById('shareToFeedCheckbox').checked = false;
                
                // Check if program complete (Day 48)
                if (day === 48) {
                    showCelebration(program);
                } else {
                    // Return to active program view
                    closeSessionDetail();
                }
                
                console.log('âœ… Session completion finished');
            } catch (error) {
                console.error('âŒ Error in finishSessionCompletion:', error);
                alert('Error completing session. Please try again.');
            }
        }

        function shareSessionToFeed(program, day, observation) {
            try {
                // Get program details
                const programNames = {
                    essential: 'Essential Path',
                    flow: 'Flow Path',
                    mastery: 'Mastery Path'
                };
                
                const programName = programNames[program] || program.toUpperCase();
                const sessionTitle = TRAINING_CURRICULUM[program]?.sessions[day - 1]?.title || `Day ${day}`;
                
                // Get user name from localStorage or use default
                const userName = localStorage.getItem('userName') || 'You';
                const userAvatar = localStorage.getItem('userAvatar') || 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=400&q=80';
                
                // Create Feed post
                const post = {
                    id: `post_session_${Date.now()}`,
                    userId: currentUserId,
                    userName: userName,
                    userAvatar: userAvatar,
                    type: 'training_session',
                    timestamp: Date.now(),
                    content: observation || `Completed ${sessionTitle}`,
                    trainingData: {
                        program: program,
                        programName: programName,
                        day: day,
                        sessionTitle: sessionTitle
                    },
                    likes: [],
                    comments: []
                };
                
                // Add to Feed
                let feedPosts = JSON.parse(localStorage.getItem('feedPosts') || '[]');
                feedPosts.unshift(post); // Add to beginning
                localStorage.setItem('feedPosts', JSON.stringify(feedPosts));
                
                console.log(`âœ“ Session shared to Feed: ${programName} - Day ${day}`);
            } catch (error) {
                console.error('âŒ Error sharing session to Feed:', error);
            }
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // PROGRAM ENROLLMENT
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // SCHEDULE CONFIGURATION (v46 - Custom Training Schedule)
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        let pendingProgramEnrollment = null;
        let selectedFrequency = 3; // Default 3 days/week
        let selectedDays = []; // Will store day numbers (0=Sun, 1=Mon, etc)

        function enrollInProgram(programKey) {
            if (!canAccessProgram(programKey)) {
                const programNames = {
                    flow: 'Flow Path',
                    mastery: 'Mastery Path'
                };
                const programName = programNames[programKey] || programKey;
                alert(`Subscribe to ${programName} to access this program.`);
                openUpgradeModal(programKey);
                return;
            }
            
            // Store program to enroll after schedule config
            pendingProgramEnrollment = programKey;
            
            // Open schedule configuration modal
            openScheduleConfig(programKey);
        }

        function openScheduleConfig(programKey) {
            const modal = document.getElementById('scheduleConfigModal');
            modal.style.display = 'flex';
            
            // Set program-specific info
            const programDays = programKey === 'mastery' ? 96 : 48;
            document.getElementById('programDaysText').textContent = `${programDays} days`;
            
            // Reset state
            selectedFrequency = 3;
            selectedDays = [];
            
            // Pre-select 3 days/week as default
            selectFrequency(3);
            
            console.log(`âœ“ Schedule config opened for ${programKey}`);
        }

        function closeScheduleConfig() {
            const modal = document.getElementById('scheduleConfigModal');
            modal.style.display = 'none';
            pendingProgramEnrollment = null;
            selectedFrequency = 3;
            selectedDays = [];
            
            // Reset UI
            document.querySelectorAll('.frequency-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.day-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('daySelectionSection').style.display = 'none';
            document.getElementById('scheduleInfo').style.display = 'none';
            document.getElementById('startProgramBtn').disabled = true;
        }

        function selectFrequency(daysPerWeek) {
            selectedFrequency = daysPerWeek;
            selectedDays = [];
            
            // Update UI - highlight selected frequency
            document.querySelectorAll('.frequency-btn').forEach(btn => {
                if (parseInt(btn.dataset.days) === daysPerWeek) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // Show day selection section (unless 7 days/week)
            const daySection = document.getElementById('daySelectionSection');
            if (daysPerWeek === 7) {
                daySection.style.display = 'none';
                // Auto-select all days
                selectedDays = [0, 1, 2, 3, 4, 5, 6];
                updateScheduleInfo();
            } else {
                daySection.style.display = 'block';
                // Auto-suggest days based on frequency
                suggestDays(daysPerWeek);
            }
            
            // Update frequency text
            document.getElementById('frequencyText').textContent = `${daysPerWeek} days/week`;
            
            console.log(`âœ“ Frequency selected: ${daysPerWeek} days/week`);
        }

        function suggestDays(daysPerWeek) {
            // Reset day selection
            document.querySelectorAll('.day-btn').forEach(btn => btn.classList.remove('active'));
            selectedDays = [];
            
            // Auto-suggestions based on best practices
            const suggestions = {
                3: [1, 3, 5], // Mon, Wed, Fri
                4: [1, 3, 4, 6], // Mon, Wed, Thu, Sat
                5: [1, 2, 3, 4, 5], // Mon-Fri
                6: [1, 2, 3, 4, 5, 6] // Mon-Sat
            };
            
            const suggestedDays = suggestions[daysPerWeek] || [];
            selectedDays = [...suggestedDays];
            
            // Highlight suggested days
            document.querySelectorAll('.day-btn').forEach(btn => {
                const dayNum = parseInt(btn.dataset.day);
                if (suggestedDays.includes(dayNum)) {
                    btn.classList.add('active');
                }
            });
            
            // Update helper text
            const dayNames = {
                0: 'Sunday', 1: 'Monday', 2: 'Tuesday', 3: 'Wednesday',
                4: 'Thursday', 5: 'Friday', 6: 'Saturday'
            };
            const selectedNames = suggestedDays.map(d => dayNames[d]).join(', ');
            document.getElementById('scheduleHelper').textContent = 
                `Recommended: ${selectedNames} (you can change)`;
            
            updateScheduleInfo();
        }

        function toggleDay(dayNum) {
            const dayBtn = document.querySelector(`.day-btn[data-day="${dayNum}"]`);
            
            if (selectedDays.includes(dayNum)) {
                // Remove day
                selectedDays = selectedDays.filter(d => d !== dayNum);
                dayBtn.classList.remove('active');
            } else {
                // Add day (check if limit reached)
                if (selectedDays.length >= selectedFrequency) {
                    // Remove oldest selected day first
                    const oldestDay = selectedDays.shift();
                    const oldestBtn = document.querySelector(`.day-btn[data-day="${oldestDay}"]`);
                    oldestBtn.classList.remove('active');
                }
                selectedDays.push(dayNum);
                dayBtn.classList.add('active');
            }
            
            // Sort days for display
            selectedDays.sort((a, b) => a - b);
            
            updateScheduleInfo();
        }

        function updateScheduleInfo() {
            const infoSection = document.getElementById('scheduleInfo');
            const startBtn = document.getElementById('startProgramBtn');
            
            // Enable start button only if correct number of days selected
            if (selectedDays.length === selectedFrequency) {
                infoSection.style.display = 'block';
                startBtn.disabled = false;
                
                // Calculate program duration
                const programDays = pendingProgramEnrollment === 'mastery' ? 96 : 48;
                const weeks = Math.ceil(programDays / selectedFrequency);
                document.getElementById('durationText').textContent = `${weeks} weeks`;
            } else {
                infoSection.style.display = 'none';
                startBtn.disabled = true;
            }
        }

        function confirmScheduleAndEnroll() {
            if (!pendingProgramEnrollment || selectedDays.length !== selectedFrequency) {
                console.error('âŒ Invalid schedule configuration');
                return;
            }
            
            const programKey = pendingProgramEnrollment;
            
            // Save schedule configuration
            const scheduleConfig = {
                frequency: selectedFrequency,
                days: selectedDays,
                startDate: new Date().toISOString()
            };
            
            localStorage.setItem(`${programKey}_schedule`, JSON.stringify(scheduleConfig));
            
            // Enroll in program
            const progress = getUserTrainingProgress();
            progress[programKey].enrolled = true;
            progress[programKey].currentDay = 1;
            progress[programKey].schedule = scheduleConfig; // Store in progress too
            saveUserTrainingProgress(progress);
            
            console.log(`âœ“ Enrolled in ${programKey} with ${selectedFrequency} days/week schedule`);
            console.log('Training days:', selectedDays);
            
            // Close modal and show program
            closeScheduleConfig();
            showActiveProgramView(programKey);
        }

        // Helper function to get next training date based on schedule
        function getNextTrainingDate(programKey) {
            const scheduleConfig = JSON.parse(localStorage.getItem(`${programKey}_schedule`));
            if (!scheduleConfig) return new Date(); // Fallback to today if no schedule
            
            const today = new Date();
            const currentDay = today.getDay();
            const trainingDays = scheduleConfig.days;
            
            // Find next training day
            let daysUntilNext = null;
            for (let i = 1; i <= 7; i++) {
                const checkDay = (currentDay + i) % 7;
                if (trainingDays.includes(checkDay)) {
                    daysUntilNext = i;
                    break;
                }
            }
            
            if (daysUntilNext === null) return today;
            
            const nextDate = new Date(today);
            nextDate.setDate(today.getDate() + daysUntilNext);
            return nextDate;
        }

        // Helper function to check if today is a training day
        function isTodayTrainingDay(programKey) {
            const scheduleConfig = JSON.parse(localStorage.getItem(`${programKey}_schedule`));
            if (!scheduleConfig) return true; // Fallback to allow training if no schedule
            
            const today = new Date().getDay();
            return scheduleConfig.days.includes(today);
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // PROGRAM MANAGEMENT
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        

        function returnToProgramSelection() {
            showProgramSelectionView();
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // STRIPE PAYMENT INTEGRATION
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        function upgradeToFlow() {
            openUpgradeModal('flow');
        }

        function upgradeToMastery() {
            openUpgradeModal('mastery');
        }

        function openUpgradeModal(preselectedTier = null) {
            const modal = document.getElementById('upgradeModal');
            
            // Show modal with smooth fade-in
            modal.style.display = 'flex';
            setTimeout(() => {
                modal.style.opacity = '1';
            }, 10);
            
            console.log('âœ“ Upgrade modal opened', preselectedTier ? `(Tier: ${preselectedTier})` : '');
        }

        function closeUpgradeModal() {
            const modal = document.getElementById('upgradeModal');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
            console.log('âœ“ Upgrade modal closed');
        }

        function initiateStripeCheckout(tier) {
            console.log(`ğŸ”„ Initiating Stripe Checkout for ${tier.toUpperCase()} Path...`);
            
            // TIER PRICING (matches business model: â‚¬29 Flow, â‚¬49 Mastery)
            const pricing = {
                flow: { amount: 29, currency: 'EUR', name: 'Flow Path' },
                mastery: { amount: 49, currency: 'EUR', name: 'Mastery Path' }
            };
            
            const selectedPrice = pricing[tier];
            
            if (!selectedPrice) {
                console.error('âŒ Invalid tier selection');
                return;
            }
            
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            // TEST MODE: Mock Stripe Checkout
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            // In production, replace this section with:
            // 
            // const stripe = Stripe('YOUR_PUBLISHABLE_KEY');
            // const response = await fetch('/api/create-checkout-session', {
            //     method: 'POST',
            //     headers: { 'Content-Type': 'application/json' },
            //     body: JSON.stringify({ 
            //         tier: tier,
            //         priceId: selectedPrice.stripePriceId,
            //         successUrl: `${window.location.origin}/training?session_id={CHECKOUT_SESSION_ID}`,
            //         cancelUrl: `${window.location.origin}/training`
            //     })
            // });
            // const session = await response.json();
            // return stripe.redirectToCheckout({ sessionId: session.id });
            //
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            
            const mockStripeCheckout = confirm(
                `STRIPE CHECKOUT (TEST MODE)\n\n` +
                `${selectedPrice.name}\n` +
                `â‚¬${selectedPrice.amount}/month Â· Billed monthly\n\n` +
                `âœ“ Cancel anytime\n` +
                `âœ“ Full access while subscribed\n` +
                `âœ“ Automatic progression tracking\n\n` +
                `Click OK to simulate successful payment\n` +
                `Click Cancel to return`
            );
            
            if (mockStripeCheckout) {
                // Simulate processing delay
                console.log('â³ Processing payment...');
                setTimeout(() => {
                    handleStripeSuccess(tier);
                }, 500);
            } else {
                // User cancelled
                console.log('âŒ Payment cancelled by user');
                closeUpgradeModal();
            }
        }

        function handleStripeSuccess(tier) {
            console.log(`âœ… Payment successful for ${tier.toUpperCase()} Path`);
            
            // 1. Update user tier in localStorage
            localStorage.setItem('userTier', tier);
            
            // 2. Auto-enroll in program
            const programKey = tier; // 'flow' or 'mastery'
            const enrollmentData = {
                program: programKey,
                enrolledAt: new Date().toISOString(),
                currentDay: 1,
                completedDays: [],
                lastPracticeDate: null
            };
            localStorage.setItem('activeEnrollment', JSON.stringify(enrollmentData));
            console.log(`âœ“ Auto-enrolled in ${tier.toUpperCase()} Path`);
            
            // 3. Update training progress if doesn't exist
            const progress = getUserTrainingProgress();
            if (!progress[programKey]) {
                progress[programKey] = {
                    currentDay: 1,
                    completedDays: [],
                    observations: {}
                };
                saveUserTrainingProgress(progress);
            }
            
            // 4. Close modal
            closeUpgradeModal();
            
            // 5. Update UI to reflect new tier
            updateUIForTier(tier);
            updateProgramLocks();
            
            // 6. Show success message (Nike-style minimal)
            const tierName = tier === 'flow' ? 'Flow Path' : 'Mastery Path';
            setTimeout(() => {
                alert(
                    `Welcome to ${tierName}\n\n` +
                    `Your subscription is active. Configure your training schedule to begin.`
                );
                
                // 7. Open schedule configuration for the correct program
                enrollInProgram(tier); // This will open schedule config modal
                
                console.log(`âœ“ ${tierName} activated and schedule config opened`);
            }, 100);
        }

        function updateUIForTier(tier) {
            // Update role selector display
            const tierDisplay = document.getElementById('currentTierDisplay');
            if (tierDisplay) {
                tierDisplay.textContent = tier.toUpperCase();
            }
            
            // Update lock overlays and buttons
            const flowLock = document.getElementById('flowLockOverlay');
            const masteryLock = document.getElementById('masteryLockOverlay');
            const flowBtn = document.getElementById('flowUpgradeBtn');
            const masteryBtn = document.getElementById('masteryUpgradeBtn');
            const flowCard = document.getElementById('flowProgramCard');
            const masteryCard = document.getElementById('masteryProgramCard');
            
            // Flow Path access
            if (tier === 'flow' || tier === 'mastery' || tier === 'mentorship' || tier === 'coach') {
                if (flowLock) flowLock.style.display = 'none';
                if (flowCard) flowCard.style.opacity = '1';
                if (flowBtn) {
                    flowBtn.textContent = 'START FLOW';
                    flowBtn.disabled = false;
                }
            }
            
            // Mastery Path access
            if (tier === 'mastery' || tier === 'mentorship' || tier === 'coach') {
                if (masteryLock) masteryLock.style.display = 'none';
                if (masteryCard) masteryCard.style.opacity = '1';
                if (masteryBtn) {
                    masteryBtn.textContent = 'START MASTERY';
                    masteryBtn.disabled = false;
                }
            }
            
            console.log(`âœ“ UI updated for ${tier.toUpperCase()} tier`);
        }

        // Close modal on ESC key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modal = document.getElementById('upgradeModal');
                if (modal && modal.style.display === 'flex') {
                    closeUpgradeModal();
                }
            }
        });

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // CELEBRATION SCREEN (Day 48)
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function showCelebration(programKey) {
            const programData = TRAINING_CURRICULUM[programKey];
            
            document.getElementById('celebrationProgramName').textContent = programData.name.toUpperCase();
            document.getElementById('celebrationMessage').textContent = programData.completionMessage;
            
            const nextBtn = document.getElementById('celebrationNextBtn');
            if (programData.nextProgram && canAccessProgram(programData.nextProgram)) {
                nextBtn.textContent = `START ${TRAINING_CURRICULUM[programData.nextProgram].name.toUpperCase()}`;
                nextBtn.style.display = 'block';
            } else if (programData.nextProgram) {
                nextBtn.textContent = `UPGRADE TO ${TRAINING_CURRICULUM[programData.nextProgram].name.toUpperCase()}`;
                nextBtn.style.display = 'block';
            } else {
                nextBtn.style.display = 'none';
            }
            
            document.getElementById('trainingCelebration').style.display = 'flex';
        }

        function closeCelebration() {
            document.getElementById('trainingCelebration').style.display = 'none';
            showProgramSelectionView();
        }

        function startNextProgram() {
            const activeProgram = getActiveProgram();
            if (!activeProgram) return;
            
            const nextProgram = TRAINING_CURRICULUM[activeProgram].nextProgram;
            if (!nextProgram) return;
            
            if (canAccessProgram(nextProgram)) {
                enrollInProgram(nextProgram);
            } else {
                // Trigger upgrade flow
                if (nextProgram === 'flow') upgradeToFlow();
                if (nextProgram === 'mastery') upgradeToMastery();
            }
            
            closeCelebration();
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // AUTO-ENROLLMENT FOR ESSENTIAL (on first app load)
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        
        function autoEnrollEssential() {
            const progress = getUserTrainingProgress();
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            
            if (isLoggedIn && !progress.essential.enrolled) {
                progress.essential.enrolled = true;
                progress.essential.currentDay = 1;
                saveUserTrainingProgress(progress);
                console.log('âœ“ Auto-enrolled in Essential Path');
            }
        }

        // Call on app load
        autoEnrollEssential();

        console.log('âœ“ Training Tab v1 initialized');
        console.log('âœ“ Nike Run Club inspired design loaded');
        console.log('âœ“ Essential Path auto-enrollment active');

    </script>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         HUDEN CURATED IMAGE LIBRARY v45
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script>
        // HUDEN IMAGES - Centralized Unsplash library matching brand aesthetic
        const HUDEN_IMAGES = {
            hero: {
                forest1: 'https://images.unsplash.com/photo-1551632811-561732d1e306?w=1600&q=80',
                forest2: 'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1600&q=80',
                landscape1: 'https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=1600&q=80',
                landscape2: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1600&q=80',
                movement1: 'https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?w=1600&q=80',
                movement2: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=1600&q=80'
            },
            feed: {
                solo: [
                    'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&q=80',
                    'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=800&q=80',
                    'https://images.unsplash.com/photo-1551632811-561732d1e306?w=800&q=80',
                    'https://images.unsplash.com/photo-1486218119243-13883505764c?w=800&q=80',
                    'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=800&q=80',
                    'https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=800&q=80',
                    'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=800&q=80',
                    'https://images.unsplash.com/photo-1518611012118-696072aa579a?w=800&q=80'
                ],
                group: [
                    'https://images.unsplash.com/photo-1529333166437-7750a6dd5a70?w=800&q=80',
                    'https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=800&q=80',
                    'https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=800&q=80',
                    'https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?w=800&q=80'
                ]
            },
            archetypes: {
                gorilla: [
                    'https://images.unsplash.com/photo-1605296867304-46d5465a13f1?w=1200&q=80',
                    'https://images.unsplash.com/photo-1486218119243-13883505764c?w=1200&q=80',
                    'https://images.unsplash.com/photo-1518611012118-696072aa579a?w=1200&q=80'
                ],
                gibbon: [
                    'https://images.unsplash.com/photo-1551632811-561732d1e306?w=1200&q=80',
                    'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=1200&q=80',
                    'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1200&q=80'
                ],
                orangutan: [
                    'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1200&q=80',
                    'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=1200&q=80',
                    'https://images.unsplash.com/photo-1542273917363-3b1817f69a2d?w=1200&q=80'
                ],
                chimpanzee: [
                    'https://images.unsplash.com/photo-1529333166437-7750a6dd5a70?w=1200&q=80',
                    'https://images.unsplash.com/photo-1522071820081-009f0129c71c?w=1200&q=80',
                    'https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=1200&q=80'
                ]
            },
            avatars: {
                male: [
                    'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=400&q=80',
                    'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&q=80',
                    'https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?w=400&q=80',
                    'https://images.unsplash.com/photo-1568602471122-7832951cc4c5?w=400&q=80'
                ],
                female: [
                    'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=400&q=80',
                    'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=400&q=80',
                    'https://images.unsplash.com/photo-1487412720507-e7ab37603c6f?w=400&q=80'
                ]
            },
            training: {
                paths: [
                    'https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=1200&q=85',
                    'https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?w=1200&q=85',
                    'https://images.unsplash.com/photo-1551632811-561732d1e306?w=1200&q=85'
                ],
                sessions: [
                    'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1200&q=85',
                    'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=1200&q=85',
                    'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=1200&q=85',
                    'https://images.unsplash.com/photo-1551632811-561732d1e306?w=1200&q=85',
                    'https://images.unsplash.com/photo-1518611012118-696072aa579a?w=1200&q=85'
                ]
            },
            events: {
                outdoor: [
                    'https://images.unsplash.com/photo-1465447142348-e9952c393450?w=600&q=85',
                    'https://images.unsplash.com/photo-1461896836934-ffe607ba8211?w=600&q=85',
                    'https://images.unsplash.com/photo-1483721310020-03333e577078?w=600&q=85',
                    'https://images.unsplash.com/photo-1515886657613-9f3515b0c78f?w=600&q=85',
                    'https://images.unsplash.com/photo-1556906781-9a412961c28c?w=600&q=85'
                ]
            },
            placeholders: {
                default: 'https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=1200&q=80',
                profile: 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=400&q=80'
            }
        };

        // Helper: Get random image from array
        function getRandomImage(category) {
            const parts = category.split('.');
            let current = HUDEN_IMAGES;
            for (const part of parts) {
                current = current[part];
                if (!current) return HUDEN_IMAGES.placeholders.default;
            }
            if (Array.isArray(current)) {
                return current[Math.floor(Math.random() * current.length)];
            }
            return current;
        }

        // Auto-load images with data-huden-image attribute
        function loadHudenImages() {
            document.querySelectorAll('[data-huden-image]').forEach(el => {
                const category = el.getAttribute('data-huden-image');
                const imageUrl = getRandomImage(category);
                if (el.tagName === 'IMG') {
                    el.src = imageUrl;
                } else {
                    el.style.backgroundImage = `url(${imageUrl})`;
                }
            });
        }

        // Expose globally
        window.HUDEN_IMAGES = HUDEN_IMAGES;
        window.getRandomImage = getRandomImage;
        window.loadHudenImages = loadHudenImages;

        // Auto-load images on page ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadHudenImages);
        } else {
            loadHudenImages();
        }

        console.log('âœ“ HUDEN Curated Image Library v45 loaded');
    </script>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         HUDEN CURRICULUM DATA v1 - INLINE
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <script>
        // HUDEN CURRICULUM - Complete 48-Day Programs (INLINE)
        const HUDEN_CURRICULUM = {
            essential: {
                name: "Essential Path",
                tier: "essential",
                duration: "48 days",
                description: "Foundation of natural movement. Learn to observe without fixing.",
                weeks: [
                    {
                        week: 1,
                        theme: "Ground Connection",
                        days: [
                            {
                                day: 1,
                                title: "Your First Session",
                                subtitle: "Welcome to Natural Movement",
                                duration: 45,
                                archetype: "Gorilla",
                                intention: "Notice how the ground supports you",
                                description: "Begin your journey with fundamental ground-based movements. Learn to feel the earth beneath you.",
                                structure: {
                                    warmup: { duration: 10, content: "Floor breathing, body scan, gentle rolling" },
                                    practice: { duration: 30, content: "Quadrupedal exploration, bear crawls, ground transitions" },
                                    cooldown: { duration: 5, content: "Seated breathing, reflection" }
                                },
                                videoId: "essential-w1d1",
                                restDay: false
                            },
                            {
                                day: 2,
                                title: "Breath & Base",
                                subtitle: "Finding Your Foundation",
                                duration: 45,
                                archetype: "Gorilla",
                                intention: "Your breath anchors every movement",
                                description: "Deepen connection between breath and movement patterns.",
                                structure: {
                                    warmup: { duration: 10, content: "Breath awareness, spine waves" },
                                    practice: { duration: 30, content: "Crawling patterns, weight shifting, push-up variations" },
                                    cooldown: { duration: 5, content: "Child's pose, deep breathing" }
                                },
                                videoId: "essential-w1d2",
                                restDay: false
                            },
                            {
                                day: 3,
                                title: "Hip Mobility Flow",
                                subtitle: "Opening the Center",
                                duration: 45,
                                archetype: "Orangutan",
                                intention: "Hips are the gateway to power",
                                description: "Explore hip mobility through natural movement patterns.",
                                structure: {
                                    warmup: { duration: 10, content: "Hip circles, leg swings, frog stretches" },
                                    practice: { duration: 30, content: "Deep squat holds, lateral lunges, 90/90 transitions" },
                                    cooldown: { duration: 5, content: "Pigeon pose, hip flexor release" }
                                },
                                videoId: "essential-w1d3",
                                restDay: false
                            },
                            {
                                day: 4,
                                title: "Shoulder Freedom",
                                subtitle: "Upper Body Exploration",
                                duration: 45,
                                archetype: "Gibbon",
                                intention: "Your shoulders were made to reach",
                                description: "Develop shoulder mobility and stability through hanging and reaching.",
                                structure: {
                                    warmup: { duration: 10, content: "Arm circles, thread the needle, shoulder CAR" },
                                    practice: { duration: 30, content: "Dead hangs, scapular pulls, plank variations" },
                                    cooldown: { duration: 5, content: "Doorway stretch, shoulder relaxation" }
                                },
                                videoId: "essential-w1d4",
                                restDay: false
                            },
                            {
                                day: 5,
                                title: "Spine Articulation",
                                subtitle: "Finding Your Wave",
                                duration: 45,
                                archetype: "Chimpanzee",
                                intention: "Your spine moves in waves, not blocks",
                                description: "Learn to move each vertebra independently through flowing patterns.",
                                structure: {
                                    warmup: { duration: 10, content: "Cat-cow, spinal twists, segmental rolling" },
                                    practice: { duration: 30, content: "Wave push-ups, bridge variations, thoracic rotation" },
                                    cooldown: { duration: 5, content: "Supine twist, relaxation" }
                                },
                                videoId: "essential-w1d5",
                                restDay: false
                            },
                            {
                                day: 6,
                                title: "Integration Day",
                                subtitle: "Putting It Together",
                                duration: 45,
                                archetype: "Gorilla",
                                intention: "Movement is a conversation with yourself",
                                description: "Combine everything learned this week into flowing sequences.",
                                structure: {
                                    warmup: { duration: 10, content: "Full body exploration" },
                                    practice: { duration: 30, content: "Ground flow sequence, transition practice, creative exploration" },
                                    cooldown: { duration: 5, content: "Stillness, observation" }
                                },
                                videoId: "essential-w1d6",
                                restDay: false
                            }
                        ]
                    }
                ]
            },
            flow: {
                name: "Flow Path",
                tier: "flow",
                duration: "48 days",
                description: "Deepen your practice with advanced flows and autonomy.",
                weeks: [
                    {
                        week: 1,
                        theme: "Advanced Ground Flow",
                        days: Array(6).fill(null).map((_, i) => ({
                            day: 1 + i,
                            title: `Flow Session ${i + 1}`,
                            subtitle: "Advanced Practice",
                            duration: 50,
                            archetype: ["Gibbon", "Gorilla", "Orangutan", "Chimpanzee", "Gibbon", "Gorilla"][i],
                            intention: "Flow begins where technique ends",
                            description: "Advanced movement with increased autonomy.",
                            structure: {
                                warmup: { duration: 10, content: "Self-directed warm-up" },
                                practice: { duration: 35, content: "Advanced patterns, creative sequences" },
                                cooldown: { duration: 5, content: "Personal reflection" }
                            },
                            videoId: `flow-w1d${i + 1}`,
                            restDay: false
                        }))
                    }
                ]
            },
            mastery: {
                name: "Mastery Path",
                tier: "mastery",
                duration: "48 days",
                description: "Expert-level practice with 90% autonomy.",
                weeks: [
                    {
                        week: 1,
                        theme: "Personal Practice Design",
                        days: Array(6).fill(null).map((_, i) => ({
                            day: 1 + i,
                            title: `Mastery Session ${i + 1}`,
                            subtitle: "Your Practice, Your Way",
                            duration: 60,
                            archetype: ["Gibbon", "Gorilla", "Orangutan", "Chimpanzee", "Gibbon", "Gorilla"][i],
                            intention: "Mastery is personal expression",
                            description: "90% self-directed practice.",
                            structure: {
                                warmup: { duration: 10, content: "Self-designed warm-up" },
                                practice: { duration: 45, content: "Complete autonomy" },
                                cooldown: { duration: 5, content: "Personal integration" }
                            },
                            videoId: `mastery-w1d${i + 1}`,
                            restDay: false
                        }))
                    }
                ]
            }
        };

        // Generate remaining weeks programmatically to reach 48 days
        function generateRemainingWeeks(program, startWeek, totalWeeks) {
            const themes = {
                essential: ["Balance & Stability", "Pulling & Hanging", "Locomotion & Travel", "Strength Foundations", "Flexibility & Range", "Power & Plyometrics", "Integration & Mastery"],
                flow: ["Strength Integration", "Mobility Mastery", "Partner Work", "Power Development", "Endurance Flow", "Environmental Practice", "Flow Path Completion"],
                mastery: ["Advanced Integration", "Peak Performance", "Movement Artistry", "Teaching Practice", "Personal Mastery", "Community Leadership", "Mastery Completion"]
            };

            for (let week = startWeek; week <= totalWeeks; week++) {
                const weekData = {
                    week: week,
                    theme: themes[program][week - 2] || "Practice Week",
                    days: []
                };

                for (let day = 0; day < 6; day++) {
                    const dayNumber = (week - 1) * 6 + day + 1;
                    const archetypes = ["Gorilla", "Gibbon", "Orangutan", "Chimpanzee"];
                    
                    weekData.days.push({
                        day: dayNumber,
                        title: `Day ${dayNumber} Practice`,
                        subtitle: `Week ${week} Session`,
                        duration: program === 'essential' ? 45 : program === 'flow' ? 50 : 60,
                        archetype: archetypes[day % 4],
                        intention: "Continue your practice with presence",
                        description: `Progressive practice for day ${dayNumber}.`,
                        structure: {
                            warmup: { duration: 10, content: "Dynamic preparation" },
                            practice: { duration: program === 'essential' ? 30 : program === 'flow' ? 35 : 45, content: "Main practice session" },
                            cooldown: { duration: 5, content: "Integration and reflection" }
                        },
                        videoId: `${program}-w${week}d${day + 1}`,
                        restDay: false
                    });
                }

                HUDEN_CURRICULUM[program].weeks.push(weekData);
            }
        }

        // Generate remaining weeks for all programs
        generateRemainingWeeks('essential', 2, 8);
        generateRemainingWeeks('flow', 2, 8);
        generateRemainingWeeks('mastery', 2, 8);

        console.log('âœ“ HUDEN_CURRICULUM loaded (inline)');
        console.log(`  - Essential: ${HUDEN_CURRICULUM.essential.weeks.reduce((sum, w) => sum + w.days.length, 0)} days`);
        console.log(`  - Flow: ${HUDEN_CURRICULUM.flow.weeks.reduce((sum, w) => sum + w.days.length, 0)} days`);
        console.log(`  - Mastery: ${HUDEN_CURRICULUM.mastery.weeks.reduce((sum, w) => sum + w.days.length, 0)} days`);

        // NOTE: initializeTrainingCurriculum() will be called at the end of main script
    </script>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         STRIPE PAYMENT MODAL - Nike Brutal Minimalism
         â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="upgradeModal" class="upgrade-modal" style="display: none;">
        <div class="upgrade-modal-backdrop" onclick="closeUpgradeModal()"></div>
        <div class="upgrade-modal-content">
            <button class="upgrade-modal-close" onclick="closeUpgradeModal()" aria-label="Close">Ã—</button>
            
            <div class="upgrade-modal-header">
                <h2 class="upgrade-modal-title">Choose Your Path</h2>
                <p class="upgrade-modal-subtitle">Unlock structured progression and deepen your practice</p>
            </div>

            <div class="upgrade-modal-body">
                <!-- Flow Path Card -->
                <div class="upgrade-tier-card" id="upgradeFlowCard">
                    <div class="upgrade-tier-header">
                        <h3 class="upgrade-tier-name">Flow Path</h3>
                        <div class="upgrade-tier-price">
                            <span class="upgrade-tier-amount">â‚¬29</span>
                            <span class="upgrade-tier-period">/month</span>
                        </div>
                    </div>
                    <div class="upgrade-tier-features">
                        <div class="upgrade-feature">48 days structured practice</div>
                        <div class="upgrade-feature">3 movement archetypes</div>
                        <div class="upgrade-feature">Progress to 40% autonomy</div>
                        <div class="upgrade-feature">Sensory and relational training</div>
                        <div class="upgrade-feature">Community integration</div>
                    </div>
                    <button class="btn btn-primary btn-large upgrade-tier-button" onclick="initiateStripeCheckout('flow')" style="width: 100%;">
                        Upgrade to Flow
                    </button>
                </div>

                <!-- Mastery Path Card -->
                <div class="upgrade-tier-card" id="upgradeMasteryCard">
                    <div class="upgrade-tier-header">
                        <h3 class="upgrade-tier-name">Mastery Path</h3>
                        <div class="upgrade-tier-price">
                            <span class="upgrade-tier-amount">â‚¬49</span>
                            <span class="upgrade-tier-period">/month</span>
                        </div>
                    </div>
                    <div class="upgrade-tier-features">
                        <div class="upgrade-feature">48 days autonomous practice</div>
                        <div class="upgrade-feature">90% autonomy freedom</div>
                        <div class="upgrade-feature">Pack creator certification</div>
                        <div class="upgrade-feature">Leadership development</div>
                        <div class="upgrade-feature">Coach pathway preparation</div>
                    </div>
                    <button class="btn btn-outline btn-large upgrade-tier-button" onclick="initiateStripeCheckout('mastery')" style="width: 100%;" id="upgradeMasteryButton">
                        Upgrade to Mastery
                    </button>
                </div>
            </div>

            <div class="upgrade-modal-footer">
                <p class="upgrade-footer-note">Cancel anytime Â· No commitment Â· Full access while subscribed</p>
            </div>
        </div>
    </div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PAGE INITIALIZATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        // Initialize Training Curriculum
        if (typeof initializeTrainingCurriculum === 'function') {
            initializeTrainingCurriculum();
        }
        
        // Initialize Push Notifications
        if (typeof PushNotifications !== 'undefined') {
            PushNotifications.init();
        }
        
        console.log('âœ“ HUDEN TRIBE v47 initialized');
    </script>

</body>
</html>
